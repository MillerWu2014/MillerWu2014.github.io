<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æœºå™¨å­¦ä¹ ä¸­æ ·æœ¬å¤±è¡¡ä¸‹çš„åˆ†ç±»è¯„ä¼°æŒ‡æ ‡é€‰å–æŒ‡å—</title>
    <link href="/2020/04/17/Tour%20of%20Evaluation%20Metrics%20for%20Imbalanced%20Classification/"/>
    <url>/2020/04/17/Tour%20of%20Evaluation%20Metrics%20for%20Imbalanced%20Classification/</url>
    
    <content type="html"><![CDATA[<p>From:<a href="https://machinelearningmastery.com/tour-of-evaluation-metrics-for-imbalanced-classification/" target="_blank" rel="noopener">https://machinelearningmastery.com/tour-of-evaluation-metrics-for-imbalanced-classification/</a></p><p>A classifier is only as good as the metric used to evaluate it.</p><p>If you choose the wrong metric to evaluate your models, you are likely to choose a poor model, or in the worst case, be misled about the expected performance of your model.</p><p>Choosing an appropriate metric is challenging generally in applied machine learning, but is particularly difficult for imbalanced classification problems. Firstly, because most of the standard metrics that are widely used assume a balanced class distribution, and because typically not all classes, and therefore, not all prediction errors, are equal for imbalanced classification.</p><p>In this tutorial, you will discover metrics that you can use for imbalanced classification.</p><p>After completing this tutorial, you will know:</p><ul><li>About the challenge of choosing metrics for classification, and how it is particularly difficult when there is a skewed class distribution.</li><li>How there are three main types of metrics for evaluating classifier models, referred to as rank, threshold, and probability.</li><li>How to choose a metric for imbalanced classification if you donâ€™t know where to start.</li></ul><p>Discover SMOTE, one-class classification, cost-sensitive learning, threshold moving, and much more <a href="https://machinelearningmastery.com/imbalanced-classification-with-python/" target="_blank" rel="noopener">in my new book</a>, with 30 step-by-step tutorials and full Python source code.</p><p>Letâ€™s get started.</p><a id="more"></a><h2 id="Tutorial-Overview"><a href="#Tutorial-Overview" class="headerlink" title="Tutorial Overview"></a><strong>Tutorial Overview</strong></h2><p>This tutorial is divided into three parts; they are:</p><ol><li>Challenge of Evaluation Metrics</li><li>Taxonomy of Classifier Evaluation Metrics</li><li>How to Choose an Evaluation Metric</li></ol><h2 id="Challenge-of-Evaluation-Metrics"><a href="#Challenge-of-Evaluation-Metrics" class="headerlink" title="Challenge of Evaluation Metrics"></a><strong>Challenge of Evaluation Metrics</strong></h2><p>An evaluation metric quantifies the performance of a predictive model.</p><p>This typically involves training a model on a dataset, using the model to make predictions on a holdout dataset not used during training, then comparing the predictions to the expected values in the holdout dataset.</p><p>For classification problems, metrics involve comparing the expected class label to the predicted class label or interpreting the predicted probabilities for the class labels for the problem.</p><p>Selecting a model, and even the data preparation methods together are a search problem that is guided by the evaluation metric. Experiments are performed with different models and the outcome of each experiment is quantified with a metric.</p><blockquote><p><em>Evaluation measures play a crucial role in both assessing the classification performance and guiding the classifier modeling.</em></p></blockquote><p>â€” <a href="https://www.worldscientific.com/doi/abs/10.1142/S0218001409007326" target="_blank" rel="noopener">Classification Of Imbalanced Data: A Review</a>, 2009.</p><p>There are standard metrics that are widely used for evaluating classification predictive models, such as classification accuracy or classification error.</p><p>There are standard metrics that are widely used for evaluating classification predictive models, such as classification accuracy or classification error.</p><p>Standard metrics work well on most problems, which is why they are widely adopted. But all metrics make assumptions about the problem or about what is important in the problem. Therefore an evaluation metric must be chosen that best captures what you or your project stakeholders believe is important about the model or predictions, which makes choosing model evaluation metrics challenging.</p><p>This challenge is made even more difficult when there is a skew in the class distribution. The reason for this is that many of the standard metrics become unreliable or even misleading when classes are imbalanced, or severely imbalanced, such as 1:100 or 1:1000 ratio between a minority and majority class.</p><blockquote><p><em>In the case of class imbalances, the problem is even more acute because the default, relatively robust procedures used for unskewed data can break down miserably when the data is skewed.</em></p></blockquote><p>â€” Page 187, <a href="https://amzn.to/32K9K6d" target="_blank" rel="noopener">Imbalanced Learning: Foundations, Algorithms, and Applications</a>, 2013.</p><p>For example, reporting classification accuracy for a severely imbalanced classification problem could be dangerously misleading. This is the case if project stakeholders use the results to draw conclusions or plan new projects.</p><blockquote><p><em>In fact, the use of common metrics in imbalanced domains can lead to sub-optimal classification models and might produce misleading conclusions since these measures are insensitive to skewed domains.</em></p></blockquote><p>â€” <a href="https://arxiv.org/abs/1505.01658" target="_blank" rel="noopener">A Survey of Predictive Modelling under Imbalanced Distributions</a>, 2015.</p><p>Importantly, different evaluation metrics are often required when working with imbalanced classification.</p><p>Unlike standard evaluation metrics that treat all classes as equally important, imbalanced classification problems typically rate classification errors with the minority class as more important than those with the majority class. As such performance metrics may be needed that focus on the minority class, which is made challenging because it is the minority class where we lack observations required to train an effective model.</p><blockquote><p><em>The main problem of imbalanced data sets lies on the fact that they are often associated with a user preference bias towards the performance on cases that are poorly represented in the available data sample.</em></p></blockquote><p>â€” <a href="https://arxiv.org/abs/1505.01658" target="_blank" rel="noopener">A Survey of Predictive Modelling under Imbalanced Distributions</a>, 2015.</p><p>Now that we are familiar with the challenge of choosing a model evaluation metric, letâ€™s look at some examples of different metrics from which we might choose.</p><h2 id="Taxonomy-of-Classifier-Evaluation-Metrics"><a href="#Taxonomy-of-Classifier-Evaluation-Metrics" class="headerlink" title="Taxonomy of Classifier Evaluation Metrics"></a><strong>Taxonomy of Classifier Evaluation Metrics</strong></h2><p>There are tens of metrics to choose from when evaluating classifier models, and perhaps hundreds, if you consider all of the pet versions of metrics proposed by academics.</p><p>In order to get a handle on the metrics that you could choose from, we will use a taxonomy proposed by <a href="http://personales.upv.es/ceferra/" target="_blank" rel="noopener">Cesar Ferri</a>, et al. in their 2008 paper titled â€œ<a href="https://www.sciencedirect.com/science/article/abs/pii/S0167865508002687" target="_blank" rel="noopener">An Experimental Comparison Of Performance Measures For Classification</a>.â€ It was also adopted in the 2013 book titled â€œ<a href="https://amzn.to/32K9K6d" target="_blank" rel="noopener">Imbalanced Learning</a>â€ and I think proves useful.</p><p>We can divide evaluation metrics into three useful groups; they are:</p><ol><li>Threshold Metrics</li><li>Ranking Metrics</li><li>Probability Metrics.</li></ol><p>This division is useful because the top metrics used by practitioners for classifiers generally, and specifically imbalanced classification, fit into the taxonomy neatly.</p><blockquote><p><em>Several machine learning researchers have identified three families of evaluation metrics used in the context of classification. These are the threshold metrics (e.g., accuracy and F-measure), the ranking methods and metrics (e.g., receiver operating characteristics (ROC) analysis and AUC), and the probabilistic metrics (e.g., root-mean-squared error).</em></p></blockquote><p>â€” Page 189, <a href="https://amzn.to/32K9K6d" target="_blank" rel="noopener">Imbalanced Learning: Foundations, Algorithms, and Applications</a>, 2013.</p><p>Letâ€™s take a closer look at each group in turn.</p><h3 id="Threshold-Metrics-for-Imbalanced-Classification"><a href="#Threshold-Metrics-for-Imbalanced-Classification" class="headerlink" title="Threshold Metrics for Imbalanced Classification"></a><strong>Threshold Metrics for Imbalanced Classification</strong></h3><p>Threshold metrics are those that quantify the classification prediction errors.</p><p>That is, they are designed to summarize the fraction, ratio, or rate of when a predicted class does not match the expected class in a holdout dataset.</p><blockquote><p><em>Metrics based on a threshold and a qualitative understanding of error [â€¦] These measures are used when we want a model to minimise the number of errors.</em></p></blockquote><p>â€” <a href="https://www.sciencedirect.com/science/article/abs/pii/S0167865508002687" target="_blank" rel="noopener">An Experimental Comparison Of Performance Measures For Classification</a>, 2008.</p><p>Perhaps the most widely used threshold metric is classification accuracy.</p><ul><li><strong>Accuracy</strong> = Correct Predictions / Total Predictions</li></ul><p>And the complement of classification accuracy called classification error.</p><ul><li><strong>Error</strong> = Incorrect Predictions / Total Predictions</li></ul><p>Although widely used, classification accuracy is almost universally inappropriate for imbalanced classification. The reason is, a high accuracy (or low error) is achievable by a no skill model that only predicts the majority class.</p><p>For more on the failure of classification accuracy, see the tutorial:</p><ul><li><a href="https://machinelearningmastery.com/failure-of-accuracy-for-imbalanced-class-distributions/" target="_blank" rel="noopener">Failure of Classification Accuracy for Imbalanced Class Distributions</a></li></ul><p>For imbalanced classification problems, the majority class is typically referred to as the negative outcome (e.g. such as â€œ<em>no change</em>â€ or â€œ<em>negative test result</em>â€œ), and the minority class is typically referred to as the positive outcome (e.g. â€œ<em>change</em>â€ or â€œ<em>positive test result</em>â€œ).</p><ul><li><strong>Majority Class</strong>: Negative outcome, class 0.</li><li><strong>Minority Class</strong>: Positive outcome, class 1.</li></ul><p>Most threshold metrics can be best understood by the terms used in a confusion matrix for a binary (two-class) classification problem. This does not mean that the metrics are limited for use on binary classification; it is just an easy way to quickly understand what is being measured.</p><p>The confusion matrix provides more insight into not only the performance of a predictive model but also which classes are being predicted correctly, which incorrectly, and what type of errors are being made. In this type of confusion matrix, each cell in the table has a specific and well-understood name, summarized as follows:</p><table><thead><tr><th></th><th>Positive Prediction</th><th>Negative Prediction</th></tr></thead><tbody><tr><td>Positive Class</td><td>True Positive (TP)</td><td>False Negative (FN)</td></tr><tr><td>Negative Class</td><td>False Positive (FP)</td><td>True Negative (TN)</td></tr></tbody></table><p>There are two groups of metrics that may be useful for imbalanced classification because they focus on one class; they are sensitivity-specificity and precision-recall.</p><h4 id="Sensitivity-Specificity-Metrics"><a href="#Sensitivity-Specificity-Metrics" class="headerlink" title="Sensitivity-Specificity Metrics"></a><strong>Sensitivity-Specificity Metrics</strong></h4><p>Sensitivity refers to the true positive rate and summarizes how well the positive class was predicted.</p><ul><li><strong>Sensitivity</strong> = TruePositive / (TruePositive + FalseNegative)</li></ul><p>Specificity is the complement to sensitivity, or the true negative rate, and summarises how well the negative class was predicted.</p><ul><li><strong>Specificity</strong> = TrueNegative / (FalsePositive + TrueNegative)</li></ul><p>For imbalanced classification, the sensitivity might be more interesting than the specificity.</p><p>Sensitivity and Specificity can be combined into a single score that balances both concerns, called the <a href="https://machinelearningmastery.com/arithmetic-geometric-and-harmonic-means-for-machine-learning/" target="_blank" rel="noopener">geometric mean</a> or G-Mean.</p><ul><li><strong>G-Mean</strong> = sqrt(Sensitivity * Specificity)</li></ul><h4 id="Precision-Recall-Metrics"><a href="#Precision-Recall-Metrics" class="headerlink" title="Precision-Recall Metrics"></a><strong>Precision-Recall Metrics</strong></h4><p>Precision summarizes the fraction of examples assigned the positive class that belong to the positive class.</p><ul><li><strong>Precision</strong> = TruePositive / (TruePositive + FalsePositive)</li></ul><p>Recall summarizes how well the positive class was predicted and is the same calculation as sensitivity.</p><ul><li><strong>Recall</strong> = TruePositive / (TruePositive + FalseNegative)</li></ul><p>Precision and recall can be combined into a single score that seeks to balance both concerns, called the F-score or the F-measure.</p><ul><li><strong>F-Measure</strong> = (2 * Precision * Recall) / (Precision + Recall)</li></ul><p>The F-Measure is a popular metric for imbalanced classification.</p><p>The Fbeta-measure measure is an abstraction of the F-measure where the balance of precision and recall in the calculation of the <a href="https://machinelearningmastery.com/arithmetic-geometric-and-harmonic-means-for-machine-learning/" target="_blank" rel="noopener">harmonic mean</a> is controlled by a coefficient called <em>beta</em>.</p><ul><li><strong>Fbeta-Measure</strong> = ((1 + beta^2) * Precision * Recall) / (beta^2 * Precision + Recall)</li></ul><p>For more on precision, recall and F-measure for imbalanced classification, see the tutorial:</p><ul><li><a href="https://machinelearningmastery.com/precision-recall-and-f-measure-for-imbalanced-classification/" target="_blank" rel="noopener">How to Calculate Precision, Recall, and F-Measure for Imbalanced Classification</a></li></ul><h4 id="Additional-Threshold-Metrics"><a href="#Additional-Threshold-Metrics" class="headerlink" title="Additional Threshold Metrics"></a><strong>Additional Threshold Metrics</strong></h4><p>These are probably the most popular metrics to consider, although many others do exist. To give you a taste, these include Kappa, Macro-Average Accuracy, Mean-Class-Weighted Accuracy, Optimized Precision, Adjusted Geometric Mean, Balanced Accuracy, and more.</p><p>Threshold metrics are easy to calculate and easy to understand.</p><p>One limitation of these metrics is that they assume that the class distribution observed in the training dataset will match the distribution in the test set and in real data when the model is used to make predictions. This is often the case, but when it is not the case, the performance can be quite misleading.</p><blockquote><p><em>An important disadvantage of all the threshold metrics discussed in the previous section is that they assume full knowledge of the conditions under which the classifier will be deployed. In particular, they assume that the class imbalance present in the training set is the one that will be encountered throughout the operating life of the classifier</em></p></blockquote><p>â€” Page 196, <a href="https://amzn.to/32K9K6d" target="_blank" rel="noopener">Imbalanced Learning: Foundations, Algorithms, and Applications</a>, 2013.</p><p>Ranking metrics donâ€™t make any assumptions about class distributions.</p><h3 id="Ranking-Metrics-for-Imbalanced-Classification"><a href="#Ranking-Metrics-for-Imbalanced-Classification" class="headerlink" title="Ranking Metrics for Imbalanced Classification"></a><strong>Ranking Metrics for Imbalanced Classification</strong></h3><p>Rank metrics are more concerned with evaluating classifiers based on how effective they are at separating classes.</p><blockquote><p><em>Metrics based on how well the model ranks the examples [â€¦] These are important for many applications [â€¦] where classifiers are used to select the best n instances of a set of data or when good class separation is crucial.</em></p></blockquote><p>â€” <a href="https://www.sciencedirect.com/science/article/abs/pii/S0167865508002687" target="_blank" rel="noopener">An Experimental Comparison Of Performance Measures For Classification</a>, 2008.</p><p>These metrics require that a classifier predicts a score or a probability of class membership.</p><p>From this score, different thresholds can be applied to test the effectiveness of classifiers. Those models that maintain a good score across a range of thresholds will have good class separation and will be ranked higher.</p><blockquote><p><em>â€¦ consider a classifier that gives a numeric score for an instance to be classified in the positive class. Therefore, instead of a simple positive or negative prediction, the score introduces a level of granularity</em></p></blockquote><p>â€“ Page 53, <a href="https://amzn.to/307Xlva" target="_blank" rel="noopener">Learning from Imbalanced Data Sets</a>, 2018.</p><p>The most commonly used ranking metric is the ROC Curve or ROC Analysis.</p><p>ROC is an acronym that means Receiver Operating Characteristic and summarizes a field of study for analyzing binary classifiers based on their ability to discriminate classes.</p><p>A ROC curve is a diagnostic plot for summarizing the behavior of a model by calculating the false positive rate and true positive rate for a set of predictions by the model under different thresholds.</p><p>The true positive rate is the recall or sensitivity.</p><ul><li><strong>TruePositiveRate</strong> = TruePositive / (TruePositive + FalseNegative)</li></ul><p>The false positive rate is calculated as:</p><ul><li><strong>FalsePositiveRate</strong> = FalsePositive / (FalsePositive + TrueNegative)</li></ul><p>Each threshold is a point on the plot and the points are connected to form a curve. A classifier that has no skill (e.g. predicts the majority class under all thresholds) will be represented by a diagonal line from the bottom left to the top right.</p><p>Any points below this line have worse than no skill. A perfect model will be a point in the top right of the plot.</p><p><img src="./uploads/figure_roc_cure" srcset="/img/loading.gif" alt="Depiction of a ROC Curve"></p><p>The ROC Curve is a helpful diagnostic for one model.</p><p>The area under the ROC curve can be calculated and provides a single score to summarize the plot that can be used to compare models.</p><p>A no skill classifier will have a score of 0.5, whereas a perfect classifier will have a score of 1.0.</p><ul><li><strong>ROC AUC</strong> = ROC Area Under Curve</li></ul><p>Although generally effective, the ROC Curve and ROC AUC can be optimistic under a severe class imbalance, especially when the number of examples in the minority class is small.</p><p>An alternative to the ROC Curve is the precision-recall curve that can be used in a similar way, although focuses on the performance of the classifier on the minority class.</p><p>Again, different thresholds are used on a set of predictions by a model, and in this case, the precision and recall are calculated. The points form a curve and classifiers that perform better under a range of different thresholds will be ranked higher.</p><p>A no-skill classifier will be a horizontal line on the plot with a precision that is proportional to the number of positive examples in the dataset. For a balanced dataset this will be 0.5. A perfect classifier is represented by a point in the top right.</p><p><img src="./uploads/precision_recall_curve" srcset="/img/loading.gif" alt="Depiction of a Precision-Recall Curve"></p><p>Like the ROC Curve, the Precision-Recall Curve is a helpful diagnostic tool for evaluating a single classifier but challenging for comparing classifiers.</p><p>And like the ROC AUC, we can calculate the area under the curve as a score and use that score to compare classifiers. In this case, the focus on the minority class makes the Precision-Recall AUC more useful for imbalanced classification problems.</p><ul><li><strong>PR AUC</strong> = Precision-Recall Area Under Curve</li></ul><p>There are other ranking metrics that are less widely used, such as modification to the ROC Curve for imbalanced classification and cost curves.</p><p>For more on ROC curves and precision-recall curves for imbalanced classification, see the tutorial:</p><ul><li><a href="https://machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-imbalanced-classification/" target="_blank" rel="noopener">ROC Curves and Precision-Recall Curves for Imbalanced Classification</a></li></ul><h3 id="Probabilistic-Metrics-for-Imbalanced-Classification"><a href="#Probabilistic-Metrics-for-Imbalanced-Classification" class="headerlink" title="Probabilistic Metrics for Imbalanced Classification"></a><strong>Probabilistic Metrics for Imbalanced Classification</strong></h3><p>Probabilistic metrics are designed specifically to quantify the uncertainty in a classifierâ€™s predictions.</p><p>These are useful for problems where we are less interested in incorrect vs. correct class predictions and more interested in the uncertainty the model has in predictions and penalizing those predictions that are wrong but highly confident.</p><blockquote><p><em>Metrics based on a probabilistic understanding of error, i.e. measuring the deviation from the true probability [â€¦] These measures are especially useful when we want an assessment of the reliability of the classifiers, not only measuring when they fail but whether they have selected the wrong class with a high or low probability.</em></p></blockquote><p>â€” <a href="https://www.sciencedirect.com/science/article/abs/pii/S0167865508002687" target="_blank" rel="noopener">An Experimental Comparison Of Performance Measures For Classification</a>, 2008.</p><p>Evaluating a model based on the predicted probabilities requires that the probabilities are calibrated.</p><p>Some classifiers are trained using a probabilistic framework, such as maximum likelihood estimation, meaning that their probabilities are already calibrated. An example would be logistic regression.</p><p>Many nonlinear classifiers are not trained under a probabilistic framework and therefore require their probabilities to be calibrated against a dataset prior to being evaluated via a probabilistic metric. Examples might include support vector machines and k-nearest neighbors.</p><p>Perhaps the most common metric for evaluating predicted probabilities is log loss for binary classification (or the negative log likelihood), or known more generally as <a href="https://machinelearningmastery.com/cross-entropy-for-machine-learning/" target="_blank" rel="noopener">cross-entropy</a>.</p><p>For a binary classification dataset where the expected values are y and the predicted values are yhat, this can be calculated as follows:</p><ul><li><strong>LogLoss</strong> = -((1 â€“ y) * log(1 â€“ yhat) + y * log(yhat))</li></ul><p>The score can be generalized to multiple classes by simply adding the terms; for example:</p><ul><li><strong>LogLoss</strong> = -( sum c in C y_c * log(yhat_c))</li></ul><p>The score summarizes the average difference between two probability distributions. A perfect classifier has a log loss of 0.0, with worse values being positive up to infinity.</p><p>Another popular score for predicted probabilities is the Brier score.</p><p>The benefit of the Brier score is that it is focused on the positive class, which for imbalanced classification is the minority class. This makes it more preferable than log loss, which is focused on the entire probability distribution.</p><p>The Brier score is calculated as the mean squared error between the expected probabilities for the positive class (e.g. 1.0) and the predicted probabilities. Recall that the mean squared error is the average of the squared differences between the values.</p><ul><li><strong>BrierScore</strong> = 1/N * Sum i to N (yhat_i â€“ y_i)^2</li></ul><p>A perfect classifier has a Brier score of 0.0. Although typically described in terms of binary classification tasks, the Brier score can also be calculated for multiclass classification problems.</p><p>The differences in Brier score for different classifiers can be very small. In order to address this problem, the score can be scaled against a reference score, such as the score from a no skill classifier (e.g. predicting the probability distribution of the positive class in the training dataset).</p><p>Using the reference score, a Brier Skill Score, or BSS, can be calculated where 0.0 represents no skill, worse than no skill results are negative, and the perfect skill is represented by a value of 1.0.</p><ul><li><strong>BrierSkillScore</strong> = 1 â€“ (BrierScore / BrierScore_ref)</li></ul><p>Although popular for balanced classification problems, probability scoring methods are less widely used for classification problems with a skewed class distribution.</p><p>For more on probabilistic metrics for imbalanced classification, see the tutorial:</p><ul><li><a href="https://machinelearningmastery.com/probability-metrics-for-imbalanced-classification/" target="_blank" rel="noopener">A Gentle Introduction to Probability Metrics for Imbalanced Classification</a></li></ul><h2 id="How-to-Choose-an-Evaluation-Metric"><a href="#How-to-Choose-an-Evaluation-Metric" class="headerlink" title="How to Choose an Evaluation Metric"></a><strong>How to Choose an Evaluation Metric</strong></h2><p>There is an enormous number of model evaluation metrics to choose from.</p><p>Given that choosing an evaluation metric is so important and there are tens or perhaps hundreds of metrics to choose from, what are you supposed to do?</p><blockquote><p><em>The correct evaluation of learned models is one of the most important issues in pattern recognition.</em></p></blockquote><p>â€” <a href="https://www.sciencedirect.com/science/article/abs/pii/S0167865508002687" target="_blank" rel="noopener">An Experimental Comparison Of Performance Measures For Classification</a>, 2008.</p><p>Perhaps the best approach is to talk to project stakeholders and figure out what is important about a model or set of predictions. Then select a few metrics that seem to capture what is important, then test the metric with different scenarios.</p><p>A scenario might be a mock set of predictions for a test dataset with a skewed class distribution that matches your problem domain. You can test what happens to the metric if a model predicts all the majority class, all the minority class, does well, does poorly, and so on. A few small tests can rapidly help you get a feeling for how the metric might perform.</p><p>Another approach might be to perform a literature review and discover what metrics are most commonly used by other practitioners or academics working on the same general type of problem. This can often be insightful, but be warned that some fields of study may fall into groupthink and adopt a metric that might be excellent for comparing large numbers of models at scale, but terrible for model selection in practice.</p><p>Still have no idea?</p><p>Here are some first-order suggestions:</p><ul><li><strong>Are you predicting probabilities?</strong></li><li><ul><li><strong>Do you need class labels?</strong></li><li><ul><li><strong>Is the positive class more important?</strong></li><li><ul><li>Use Precision-Recall AUC</li></ul></li><li><strong>Are both classes important?</strong></li><li><ul><li>Use ROC AUC</li></ul></li></ul></li><li><strong>Do you need probabilities?</strong></li><li><ul><li>Use Brier Score and Brier Skill Score</li></ul></li></ul></li><li><strong>Are you predicting class labels?</strong></li><li><ul><li><strong>Is the positive class more important?</strong></li><li><ul><li><strong>Are False Negatives and False Positives Equally Important?</strong></li><li><ul><li>Use F1-Measure</li></ul></li><li><strong>Are False Negatives More Important?</strong></li><li><ul><li>Use F2-Measure</li></ul></li><li><strong>Are False Positives More Important?</strong></li><li><ul><li>Use F0.5-Measure</li></ul></li></ul></li><li><strong>Are both classes important?</strong></li><li><ul><li><strong>Do you have &lt; 80%-90% Examples for the Majority Class?</strong> </li><li><ul><li>Use Accuracy</li></ul></li><li><strong>Do you have &gt; 80%-90% Examples for the Majority Class?</strong> </li><li><ul><li>Use G-Mean</li></ul></li></ul></li></ul></li></ul><p>These suggestions take the important case into account where we might use models that predict probabilities, but require crisp class labels. This is an important class of problems that allow the operator or implementor to choose the threshold to trade-off misclassification errors. In this scenario, error metrics are required that consider all reasonable thresholds, hence the use of the area under curve metrics.</p><p>We can transform these suggestions into a helpful template.</p><p><img src="./uploads/how_to_choose_imbalanced" srcset="/img/loading.gif" alt="How to Choose a Metric for Imbalanced Classification"></p><h2 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a><strong>Further Reading</strong></h2><p>This section provides more resources on the topic if you are looking to go deeper.</p><h3 id="Papers"><a href="#Papers" class="headerlink" title="Papers"></a><strong>Papers</strong></h3><ul><li><a href="https://www.sciencedirect.com/science/article/abs/pii/S0167865508002687" target="_blank" rel="noopener">An Experimental Comparison Of Performance Measures For Classification</a>, 2008.</li><li><a href="https://www.worldscientific.com/doi/abs/10.1142/S0218001409007326" target="_blank" rel="noopener">Classification Of Imbalanced Data: A Review</a>, 2009.</li><li><a href="https://arxiv.org/abs/1505.01658" target="_blank" rel="noopener">A Survey of Predictive Modelling under Imbalanced Distributions</a>, 2015.</li></ul><h3 id="Books"><a href="#Books" class="headerlink" title="Books"></a><strong>Books</strong></h3><ul><li>Chapter 8 Assessment Metrics For Imbalanced Learning, <a href="https://amzn.to/32K9K6d" target="_blank" rel="noopener">Imbalanced Learning: Foundations, Algorithms, and Applications</a>, 2013.</li><li><a href="https://amzn.to/307Xlva" target="_blank" rel="noopener">Chapter 3 Performance Measures, Learning from Imbalanced Data Sets</a>, 2018.</li></ul><h3 id="Articles"><a href="#Articles" class="headerlink" title="Articles"></a><strong>Articles</strong></h3><ul><li><a href="https://en.wikipedia.org/wiki/Precision_and_recall" target="_blank" rel="noopener">Precision and recall, Wikipedia</a>.</li><li><a href="https://en.wikipedia.org/wiki/Sensitivity_and_specificity" target="_blank" rel="noopener">Sensitivity and specificity, Wikipedia</a>.</li><li><a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic" target="_blank" rel="noopener">Receiver operating characteristic, Wikipedia</a>.</li><li><a href="https://en.wikipedia.org/wiki/Cross_entropy" target="_blank" rel="noopener">Cross entropy, Wikipedia</a>.</li><li><a href="https://en.wikipedia.org/wiki/Brier_score" target="_blank" rel="noopener">Brier score, Wikipedia</a>.</li></ul><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a><strong>Summary</strong></h2><p>In this tutorial, you discovered metrics that you can use for imbalanced classification.</p><p>Specifically, you learned:</p><ul><li>About the challenge of choosing metrics for classification, and how it is particularly difficult when there is a skewed class distribution.</li><li>How there are three main types of metrics for evaluating classifier models, referred to as rank, threshold, and probability.</li><li>How to choose a metric for imbalanced classification if you donâ€™t know where to start.</li></ul>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>imbalance</tag>
      
      <tag>metrics</tag>
      
      <tag>evaluation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ”¹å–„(ä»Šäº•æ­£æ˜)è¯»ä¹¦ç¬”è®°</title>
    <link href="/2020/01/20/%E6%94%B9%E5%96%84(%E4%BB%8A%E4%BA%95%E6%AD%A3%E6%98%8E)%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <url>/2020/01/20/%E6%94%B9%E5%96%84(%E4%BB%8A%E4%BA%95%E6%AD%A3%E6%98%8E)%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>æ”¹å–„ï¼ˆKaiZenï¼‰æ˜¯ä¸–ç•Œè‘—åçš„è´¨é‡ç®¡ç†å¤§å¸ˆï¼Œæ”¹å–„æ€æƒ³ä¹‹çˆ¶ä»Šäº•æ­£æ˜çš„ä»£è¡¨ä½œï¼Œæ”¹å–„æˆä¸ºäº†ä¸€ç§æ–‡åŒ–ï¼Œä¸€ç§ç”Ÿæ´»æ–¹å¼ã€‚å®ƒæ˜¯ç§¯å°æˆå¤šï¼Œé‡å˜å¼•èµ·è´¨å˜çš„ä¸€ç§ä½“ç°ã€‚ä¸‹é¢æ˜¯æ•´ä¹¦çš„æ¢³ç†å¹¶ç»“åˆè‡ªå·±çš„æ€è€ƒæ¢³ç†å…³äºæ”¹å–„çš„æ€ç»´å¯¼å›¾ï¼š</p><p><img src="/uploads/gaizen_mind_pic.png" srcset="/img/loading.gif" alt="æ”¹å–„æ•´ä¹¦çš„æ€ç»´å¯¼å›¾"></p><p>æ”¹å–„æ˜¯ä¸€ç§ç†å¿µï¼Œå®ƒåŒ…å«äº†çªå˜ï¼Œæ¸å˜çš„è¿‡ç¨‹ï¼Œæ˜¯åŸºäºç°çŠ¶ä¹‹ä¸Šæºæºä¸æ–­çš„è¿›è¡Œå¾®å°çš„æ”¹è¿›ï¼Œæ”¹å–„ä¸ä»…åŒ…æ‹¬äº†æ”¹è¿›ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬åˆ›æ–°ã€‚æ”¹å–„æ˜¯æ°¸æ’çš„å­˜åœ¨ï¼Œå› æ­¤æ˜¯æ°¸æ— æ­¢å¢ƒçš„ã€‚æ”¹å–„åœ¨ä¸åŒçš„å²—ä½ä¸Šå­˜åœ¨ä¸€å®šçš„å·®å¼‚ï¼Œå¦‚æ™®é€šå‘˜å·¥ï¼Œç®¡ç†äººå‘˜åœ¨æ”¹å–„ä¸Šå¯ä»¥æ˜¯ä¸‹é¢çš„æ–¹å¼ï¼Œä½†æ˜¯æ”¹å–„å§‹ç»ˆæ˜¯è‡ªä¸‹è€Œä¸Šå’Œè‡ªä¸Šè€Œä¸‹çš„åŒå‘è¿‡ç¨‹ã€‚<a id="more"></a></p><img src="/uploads/æ”¹å–„.png" srcset="/img/loading.gif" alt="å„ä¸ªå²—ä½æ”¹å–„å®æ–½çš„ä¸åŒæ¯”ä¾‹" style="zoom:80%;" /><p>ç«äº‰çš„é©±åŠ¨åŠ›æ˜¯ä»·æ ¼ï¼Œè´¨é‡å’ŒæœåŠ¡ï¼Œä½†æ˜¯åœ¨æ—¥æœ¬ï¼Œç«äº‰çš„æœ¬è´¨è¿˜æ˜¯ç«äº‰æœ¬èº«ã€‚å¦‚æœå°†åˆ©æ¶¦çœ‹ä½œä¼ä¸šæˆåŠŸçš„å‡†åˆ™ï¼Œé‚£ä¹ˆå°±ä¸éš¾ç†è§£ä¸€ä¸ªå…¬å¸å‡ åå¹´æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚å¦‚æœå…¬å¸ä¹‹é—´æ¿€çƒˆçš„ç«äº‰æ”¹å–„çš„å®åŠ›ï¼Œé‚£ä¹ˆè¿™æ ·çš„å…¬å¸ä¼šæŒç»­çš„æ”¹è¿›ï¼Œå¤„äºæ°¸è¿œè¿›å–çš„çŠ¶æ€ã€‚</p><p>æ”¹å–„å’Œåˆ›æ–°æ˜¯ä¸¤ç§ä¸åŒçš„æ€ç»´å¯¼å‘ï¼Œæ”¹å–„æ˜¯ä»¥è¿‡ç¨‹ä¸ºå¯¼å‘ï¼Œè€Œåˆ›æ–°æ˜¯ä»¥ç›®æ ‡ä¸ºå¯¼å‘ã€‚ä¹Ÿæ˜¯å› ä¸ºç›®æ ‡å¯¼å‘çš„ä¸åŒï¼Œä¸¤è€…çš„æ€æƒ³ä¸åŒï¼Œç»“æœä¸åŒï¼Œå‘å±•ä¸åŒã€‚è¥¿æ–¹ç®¡ç†è€…æ˜¯ä¿¡ä»°åˆ›æ–°çš„ï¼Œå› æ­¤å¾ˆå¤šæ–°çš„æŠ€æœ¯ï¼Œäº§å“éƒ½å‡ºè‡ªäºè¥¿æ–¹æŠ€æœ¯ã€‚ åˆ›æ–°è¢«çœ‹æˆæ˜¯ç”±æŠ€æœ¯çªç ´ï¼Œåº”ç”¨çš„æœ€æ–°ç®¡ç†ç†å¿µè€Œå‘ç”Ÿçš„ä¸­å¸¦æ”¹å˜ã€‚åˆ›æ–°æ˜¯è¿…é€Ÿçš„ï¼Œéå¸¸å¤§çš„å˜åŠ¨ï¼›è€Œæ”¹å–„æ˜¯æ¸©å’Œçš„ï¼Œå¾®å¦™çš„ï¼Œè¿ç»­çš„è¿‡ç¨‹ã€‚åˆ›æ–°æ˜¯è·³è·ƒæ€§çš„å‘å±•ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ç¨³å®šçš„ï¼›è€Œæ”¹å–„æ˜¯æŒç»­æ€§çš„ï¼Œç¨³å®šçš„ã€‚åˆ›æ–°æ˜¯ä¸¥é‡çš„ä¸ªäººä¸»ä¹‰ï¼Œä¸ªäººæ€æƒ³ï¼›è€Œæ”¹å–„æ˜¯å›¢é˜Ÿå‹çš„ï¼Œç³»ç»Ÿçš„æ–¹å¼ã€‚æ”¹å–„çš„é’ˆå¯¹çš„æ–¹å‘æ˜¯äººï¼Œè€Œåˆ›æ–°ä¸»è¦æ˜¯é’ˆå¯¹æŸä¸ªæŠ€æœ¯ã€‚</p><p>åœ¨ä½œè€…çš„è§‚ç‚¹ä¸­ï¼Œä»»ä½•äº‹ç‰©æˆ–ç³»ç»Ÿåœ¨å­˜åœ¨å¼€å§‹ï¼Œå°±å¼€å§‹è¡°è´¥ï¼ˆå¸•é‡‘æ£®å®šå¾‹ï¼‰ï¼Œå› æ­¤ä»»ä½•æ—¶å€™éƒ½åº”è¯¥ç»´æŒåŠªåŠ›ï¼Œæ”¹å–„ï¼›å³ä½¿æ˜¯åˆ›æ–°ä¹‹åéƒ½åº”è¯¥ç”¨ä¸€ç³»åˆ—æ”¹å–„å»ç»´æŠ¤å’Œæ”¹è¿›åˆ›æ–°çš„æˆæœã€‚éå¸¸æ˜æ˜¾çš„æ˜¯å»ºç«‹æ ‡å‡†-å®æ–½-æ”¹å–„æ ‡å‡†-å†å®æ–½çš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸æ–­è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œç›¸äº’ä¼˜åŒ–ï¼Œæœ€ç»ˆä¸æ–­çš„å¢å¼ºè‡ªèº«çš„ç«äº‰åŠ›ä»¥åŠäº§å“è´¨é‡ç­‰ã€‚</p><p>æ”¹å–„å’Œåˆ›æ–°ä¸¤ç§æ€ç»´åœ¨å®ç”¨æ€§ä¸Šä¹Ÿæœ‰ä¸€å®šçš„åŒºåˆ«ï¼Œæ”¹å–„å“²å­¦é€‚ç”¨äºå¢é•¿è¾ƒæ…¢çš„ç»æµï¼›è€Œåˆ›æ–°é€‚åˆå¢é•¿è¾ƒå¿«çš„ç»æµã€‚æ¯”å¦‚å½“æˆ‘é—¨å¢åŠ é”€é‡10%æ—¶éå¸¸è‹¦éš¾ï¼Œä½†æ˜¯æˆ‘ä»¬å‡å°‘10%çš„æˆæœ¬å¯èƒ½æ›´åŠ å®¹æ˜“ï¼Œè¿™æ—¶æ”¹å–„åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­æ˜¯éå¸¸é‡è¦çš„ã€‚</p><p><strong>æœ€åæ€»ç»“ä¸€å¥è¯</strong>ï¼šæ¯ä¸ªäººåº”è¯¥è¯•ç€æ”¹å˜è‡ªå·±ï¼Œè™½ç„¶ä¸æ˜¯æ¯ä¸€ä¸ªäººéƒ½æ˜¯å¤©æ‰ï¼Œä½†æ˜¯æ¯ä¸ªäººéƒ½å¯ä»¥é€æ¸çš„å¼ºå¤§ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªæ™®é€šçš„äººã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ€è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”Ÿå‘½å½¢æ€çš„æ€è€ƒ</title>
    <link href="/2019/10/21/%E7%94%9F%E5%91%BD%E5%BD%A2%E6%80%81%E7%9A%84%E6%80%9D%E8%80%83/"/>
    <url>/2019/10/21/%E7%94%9F%E5%91%BD%E5%BD%A2%E6%80%81%E7%9A%84%E6%80%9D%E8%80%83/</url>
    
    <content type="html"><![CDATA[<p>ç”Ÿå‘½çš„å®šä¹‰åœ¨æˆ‘ä»¬çš„æ„è¯†ä¸­éå¸¸ç®€å•ï¼Œç”Ÿå‘½æ˜¯åŸºäºç”Ÿç‰©çš„ï¼Œç”Ÿç‰©åˆå¿…é¡»ä¾èµ–äºç”Ÿå‘½çš„å­˜åœ¨ï¼Œä»ç™¾ç§‘ä¸Šä¸»è¦è§£é‡Šä¸º2ç‚¹ï¼š1.ç”Ÿç‰©ç”Ÿå­˜ï¼Œç”Ÿç‰©æ‰€å…·å¤‡æ´»åŠ¨ï¼Œæ„è¯†ç­‰çš„èƒ½åŠ›ï¼›2.æŒ‡äº‹ç‰©çš†ä»¥ç”Ÿå­˜çš„æ ¹æœ¬æ¡ä»¶ã€‚å¦‚æœä»ä¸¥æ ¼ä¸Šæ¥è®²ï¼Œç›®å‰çš„å®šè¾ƒä¸ºå®˜æ–¹çš„åº”è¯¥æ˜¯ä¸‹é¢çš„å®šä¹‰ï¼š</p><blockquote><p><strong>ç”Ÿå‘½</strong>æ³›æŒ‡ä¸€ç±»å…·æœ‰ç¨³å®šçš„<a href="https://zh.wikipedia.org/wiki/ç‰©è´¨" target="_blank" rel="noopener">ç‰©è´¨</a>å’Œ<a href="https://zh.wikipedia.org/wiki/èƒ½é‡" target="_blank" rel="noopener">èƒ½é‡</a><a href="https://zh.wikipedia.org/wiki/ä»£è°¢" target="_blank" rel="noopener">ä»£è°¢</a>ç°è±¡å¹¶ä¸”èƒ½å›åº”<a href="https://zh.wikipedia.org/wiki/åˆºæ¿€" target="_blank" rel="noopener">åˆºæ¿€</a>ã€èƒ½è¿›è¡Œè‡ªæˆ‘å¤åˆ¶ï¼ˆ<a href="https://zh.wikipedia.org/wiki/ç¹æ®–" target="_blank" rel="noopener">ç¹æ®–</a>ï¼‰çš„åŠå¼€æ”¾ç‰©è´¨ç³»ç»Ÿã€‚ç®€å•æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯å…·æœ‰ç”Ÿå‘½æœºåˆ¶çš„ç‰©ä½“ã€‚ç”Ÿå‘½ä¸ªä½“ä¸€å®šä¼šç»å†<a href="https://zh.wikipedia.org/wiki/å‡ºç”Ÿ" target="_blank" rel="noopener">å‡ºç”Ÿ</a>ã€<a href="https://zh.wikipedia.org/wiki/æˆé•¿" target="_blank" rel="noopener">æˆé•¿</a>ã€<a href="https://zh.wikipedia.org/wiki/è¡°è€" target="_blank" rel="noopener">è¡°è€</a>å’Œ<a href="https://zh.wikipedia.org/wiki/æ­»äº¡" target="_blank" rel="noopener">æ­»äº¡</a>ã€‚</p></blockquote><p>å…¶å®ï¼Œç”Ÿå‘½æ˜¯æ²¡æœ‰å‡†ç¡®å®šä¹‰çš„ï¼Œæ²¡æœ‰å…¬è®¤çš„å®šä¹‰ï¼Œä¸åŒçš„ç§‘å­¦å®¶éƒ½æœ‰è‡ªå·±çš„å„ç§å®šä¹‰ã€‚é‚£ä¹ˆç”Ÿå‘½çš„å½¢æ€ä¹Ÿå°±å­˜åœ¨äº†å¾ˆå¤šçš„ä¸åŒçš„ç†è§£ï¼ç›®å‰æˆ‘ä»¬ä¸€èˆ¬è®¤è¯†ä¸­ï¼Œç”Ÿå‘½çš„å½¢æ€æœ‰ğŸ’åŠ¨ç‰©ï¼ŒğŸŒ³æ¤ç‰©ï¼ŒğŸ‘¬äººç±»ï¼Œç»†èŒğŸ¦ ï¼Œå¾®ç”Ÿç‰©ï¼Œç—…æ¯’ğŸ¦ ç­‰è¿™äº›å‡è®¤ä¸ºæ˜¯æœ‰ç”Ÿå‘½çš„ã€‚é‚£ä¹ˆç”Ÿå‘½æœ‰å…¶ä»–å½¢æ€å—ï¼Ÿ</p><h2 id="éä¼ ç»Ÿç”Ÿå‘½"><a href="#éä¼ ç»Ÿç”Ÿå‘½" class="headerlink" title="éä¼ ç»Ÿç”Ÿå‘½"></a>éä¼ ç»Ÿç”Ÿå‘½</h2><p>å¦‚ä»Šç§‘æŠ€å‘éå¸¸å…ˆè¿›ï¼Œäººå·¥æ™ºèƒ½å·²ç»é€æ¸åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­æ¥è§¦æˆ–ä½¿ç”¨ã€‚æ¯”å¦‚ä¸€ä¸ªäººå·¥æ™ºèƒ½çš„æœºå™¨äººï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰ç”Ÿå‘½çš„â€œç”Ÿç‰©â€å—ï¼Ÿå¦‚æœä»ä¼ ç»Ÿçš„å®šä¹‰ä¸Šæ¥è¯´å¥½åƒæ˜¯ï¼Œä¹Ÿå¥½åƒä¸æ˜¯ã€‚ä½†æ˜¯ä¸€èˆ¬æ¥è¯´å…·æœ‰è‡ªæˆ‘æ„è¯†çš„ä¸€ä¸ªæœºå™¨äººï¼Œå¤§å®¶å¯èƒ½ä¼šå½“ä½œä¸€ä¸ªç”Ÿå‘½ã€‚å®ƒèƒ½ï¼Œè‡ªæˆ‘æ€è€ƒï¼Œè‡ªæˆ‘è¿›åŒ–ï¼Œä¹Ÿä¼šå‡ºç”Ÿï¼ˆäººç±»åˆ›é€ äº†å®ƒï¼‰ï¼Œå¯èƒ½ä¹Ÿä¼šæ­»äº¡ï¼ˆæ¯ç­å®ƒï¼‰ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥ç®—ä½œä¸€ä¸ªç”Ÿå‘½ã€‚</p><p>åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­ï¼ŒæŠŠå¾ˆå¤šäº‹ç‰©éƒ½èµ‹äºˆäº†ç”Ÿå‘½ï¼Œæ¯”å¦‚è‡ªå·±çš„äº§å“ï¼Œè‡ªå·±çš„ä½œå“ç­‰ï¼Œå®ƒï¼ˆäº§å“æˆ–ä½œå“ï¼Œç”šè‡³å…¶ä»–ï¼‰çš„è¿‡ç¨‹æ˜¯é€šè¿‡æˆ‘ä»¬è‡ªå·±æ¥æ§åˆ¶ï¼Œå®ƒä¹Ÿå­˜åœ¨å‡ºç”Ÿå’Œæ­»äº¡ï¼Œæˆé•¿å’Œè¡°é€€ç­‰ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­ï¼Œç±»ä¼¼è¿™æ ·â€œç”Ÿå‘½â€å¾ˆå¤šï¼Œä½†æ˜¯è¿™äº›éƒ½è¿˜æ˜¯åœ¨æˆ‘ä»¬æ„è¯†ä¸­çš„ç”Ÿå‘½å½¢æ€ã€‚å¹¶æ²¡æœ‰è·³å‡ºä¼ ç»Ÿçš„ç”Ÿå‘½ç†å¿µï¼Œå¯¹ç”Ÿå‘½çš„è®¤è¯†è¿˜æ˜¯è¾ƒä¸ºå›ºåŒ–ã€‚å¯ä»¥å‡è®¾å¤–æ˜Ÿç”Ÿå‘½çš„å½¢æ€æ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿå®ƒä»¬ä¸€å®šæ˜¯æœ‰åŸå­ï¼Œåˆ†å­ç»„æˆå—ï¼Ÿå®ƒä»¬ä¸€å®šæ˜¯ä¼šæ´»åŠ¨å—ï¼Ÿå®ƒä»¬çš„æ„è¯†å’Œæˆ‘ä»¬æ‰€è®¤è¯†çš„â€œæ„è¯†â€æ˜¯ä¸€æ ·çš„å—ï¼Ÿ</p><h2 id="ç•…æƒ³ç”Ÿå‘½å½¢æ€"><a href="#ç•…æƒ³ç”Ÿå‘½å½¢æ€" class="headerlink" title="ç•…æƒ³ç”Ÿå‘½å½¢æ€"></a>ç•…æƒ³ç”Ÿå‘½å½¢æ€</h2><p>å…¶å®æˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„æƒ³è±¡ä¸€ä¸‹ï¼Œç”Ÿå‘½å½¢æ€ä¸ä¸€å®šä¸€å®šæ˜¯ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†çš„â€œç”Ÿå‘½ä½“â€ã€‚åœ¨ç°å®ä¸­ï¼Œæˆ‘ä»¬æ˜¯è§‚å¯Ÿä¸åˆ°éƒ¨åˆ†ç”Ÿå‘½çš„ï¼Œå¦‚ç»†èŒã€‚é‚£ä¹ˆæ˜¯ä¸æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›ç”Ÿå‘½å½¢æ€ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•æ„Ÿå—åˆ°æˆ–è§‚å¯Ÿåˆ°çš„å‘¢ï¼Ÿç‰¹åˆ«å¯¹äºå¤–æ˜Ÿç”Ÿå‘½ï¼Œå…¶ä»–æ˜Ÿçƒçš„ç¯å¢ƒå’Œæˆ‘ä»¬æ‰€åœ¨çš„åœ°çƒä¸åŒï¼Œæˆ‘ä»¬æ˜¯åœ¨åœ°çƒè¿™ç§ç¯å¢ƒä¸‹å‡ºç°çš„ç”Ÿå‘½ä½“ï¼Œå…¶ä»–æ˜Ÿçƒçš„çš„ç¯å¢ƒä¸‹å¯èƒ½ä¹Ÿä¼šå‡ºç°æ‰€å±é‚£ä¸ªæ˜Ÿçƒçš„ç”Ÿå‘½ä½“ã€‚å®ƒä»¬æ‰€å¤„çš„ç¯å¢ƒé€ å°±äº†å®ƒä»¬æ˜¯ä»¥å¦å¤–ä¸€ç§å½¢æ€å­˜åœ¨ï¼Œåªæ˜¯æˆ‘ä»¬ä¸èƒ½æ„Ÿå—åˆ°å®ƒä»¬æˆ–å®ƒä»¬ä¹Ÿæ— æ³•æ„Ÿå—åˆ°æˆ‘ä»¬ï¼Œå®ƒä»¬ä¸æˆ‘ä»¬çš„ç”Ÿå‘½å½¢æ€å®Œå…¨ä¸åŒï¼Œæˆ–è®¸å®ƒä»¬ï¼ˆå¤–æ˜Ÿç”Ÿå‘½ä½“ï¼‰å¹¶ä¸æ˜¯ç”±åŸå­ï¼Œåˆ†å­ç»„æˆï¼Œç”Ÿå‘½çš„å½¢å¼å’Œæˆ‘ä»¬å¤§ç›¸å¾„åº­ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆå¿…ç„¶æ¯ä¸ªæ˜Ÿçƒçš„ç”Ÿå‘½å½¢æ€éƒ½ä¸ä¸€æ ·ï¼Œå½¼æ­¤éš”ç¦»ï¼Œä¼¼ä¹åƒå¹³è¡Œç©ºé—´ çš„æˆ‘ä»¬ï¼Œå½¼æ­¤æ²¡æœ‰äº¤é›†ã€‚</p><p>ä¸Šé¢åªæ˜¯æˆ‘çš„å‡è±¡ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯æ²¡æœ‰è¿™ç§å¯èƒ½ã€‚ç›®å‰æˆ‘ä»¬åœ¨å®‡å®™çš„æ¢ç´¢ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäºåœ°çƒç”Ÿå‘½çš„å†å²å’Œå½¢æ€æ¥æ‰¾åˆ°å’Œæˆ‘ä»¬ç±»ä¼¼çš„ç”Ÿå‘½ã€‚ç”šè‡³å¯¹äºåœ°çƒçš„ç ”ç©¶ï¼Œæ¥æ¢ç´¢å…¶ä»–æ˜Ÿçƒçš„æ„æˆï¼Œç¯å¢ƒç­‰ã€‚å®‡å®™ä¸­è¿™ä¹ˆå¤šå¤§å°æ˜Ÿçƒï¼Œå®ƒä»¬å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿˜æ˜¯æ ¹æœ¬æ²¡æœ‰æ„ä¹‰ï¼Ÿè€Œè¿™äº›æ˜Ÿçƒæ˜¯ä¸€ä¸ªç”Ÿå‘½ä½“å—ï¼Ÿæˆ‘æƒ³è¿™ä¸ªé—®é¢˜ç§‘å­¦å®¶ä»¬æˆ–è®¸èƒ½å›ç­”ã€‚</p><h2 id="å®‡å®™ç”Ÿå‘½"><a href="#å®‡å®™ç”Ÿå‘½" class="headerlink" title="å®‡å®™ç”Ÿå‘½"></a>å®‡å®™ç”Ÿå‘½</h2><p>ç”Ÿå‘½è‚¯å®šæ˜¯å¤šç§å½¢æ€çš„ï¼Œä½†å®‡å®™ä¸­çš„æ˜Ÿçƒæ˜¯å¦æ˜¯ä¸€ä¸ªç”Ÿå‘½ä½“æˆ‘ä»¬ä¸å¾—è€ŒçŸ¥ã€‚å‡è®¾å„ä¸ªæ˜Ÿçƒä¹Ÿæ˜¯ä¸€ä¸ªç”Ÿå‘½ä½“ï¼ŒæŒ‰ç…§æˆ‘ä»¬å¯¹ç”Ÿå‘½çš„å®šä¹‰ï¼Œç”Ÿå‘½æœ‰å‡ºç”Ÿï¼ˆèµ·æºï¼‰ï¼Œæœ‰æˆé•¿è¿‡ç¨‹ï¼Œæœ‰æ­»äº¡ï¼ˆæ¯ç­ï¼‰ï¼Œåº”ç”¨åˆ°æ˜Ÿçƒä¸Šå¥½åƒä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯æ˜Ÿçƒæœ‰æ— æ„è¯†ï¼Œæˆ‘ä»¬ä¸å¾—è€ŒçŸ¥ï¼Œæˆ–è€…è¯´å®ƒä»¬çš„æ„è¯†å’Œæˆ‘ä»¬çš„æ„è¯†å®Œå…¨ä¸åŒä¸€ä¸ªå½¢æ€ã€‚å¦‚æœæ˜Ÿçƒä¹Ÿæ˜¯æœ‰ç”Ÿå‘½çš„ï¼Œé‚£æˆ‘ä»¬åªæ˜¯åœ°çƒè¿™ä¸ªç”Ÿå‘½ä½“å†…çš„ä¸€ä¸ªéå¸¸å°çš„â€œå¾®ç”Ÿç‰©â€ï¼Œæˆ‘ä»¬çš„ç”Ÿå‘½è¿‡ç¨‹æˆ–è®¸åªæ˜¯ä¸ºå®ƒï¼ˆåœ°çƒï¼‰æä¾›ç€ä»€ä¹ˆï¼Ÿè¿™æ ·å»æƒ³è±¡çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªå®‡å®™éƒ½æ˜¯æœ‰ç”Ÿå‘½çš„ã€‚åªæ˜¯æ¯ä¸ªç”Ÿå‘½ä½“çš„å½¢æ€ä¸åŒï¼Œæˆ‘ä»¬åªæ˜¯å®‡å®™ç”Ÿå‘½ä½“ä¸­çš„é™„ç€åœ¨æ˜Ÿçƒç”Ÿå‘½ä½“ä¸Šçš„æŸä¸ªå¼‚å½¢æ€ç”Ÿå‘½ä½“ã€‚å°±åƒå¾®ç”Ÿç‰©é™„ç€åœ¨äººä½“å†…ä¸€æ ·ã€‚é‚£ä¹ˆï¼Œå¾®ç”Ÿç‰©èƒ½å¦ç†è§£å’Œå®ƒçš„å®¿ä¸»å°±åƒæˆ‘ä»¬èƒ½å¦ç†è§£åœ°çƒä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç ”ç©¶å®ƒï¼Œç ´åå®ƒï¼Œæ˜¯å¦èƒ½å¤Ÿå®Œå…¨ç†è§£å®ƒçš„ç”Ÿå‘½å½¢æ€å‘¢ğŸ¤”ï¼Ÿ</p><p>éƒ½è¯´æ¯ä¸ªäººéƒ½æœ‰å­˜åœ¨çš„æ„ä¹‰ï¼Œæˆ‘è®¤ä¸ºåœ¨å®‡å®™ä¸­ä¹ŸåŒæ ·é€‚ç”¨ã€‚æ¯ä¸ªæ˜Ÿçƒï¼Œæ˜Ÿçƒä¸Šæ¯ä¸ªä¸ªä½“éƒ½æœ‰å®ƒå­˜åœ¨çš„æ„ä¹‰ã€‚é‚£æˆ‘ä»¬å¯¹äºå®‡å®™å’Œåœ°çƒå­˜åœ¨çš„æ„ä¹‰åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>]]></content>
    
    
    <categories>
      
      <category>æ€è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
      <tag>ç”Ÿå‘½å½¢æ€</tag>
      
      <tag>æ„è¯†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦ä¼šé™(Peace,å®‰é™,å¹³é™)</title>
    <link href="/2019/08/20/%E5%AD%A6%E4%BC%9A%E9%9D%99(Peace,%20%E5%AE%89%E9%9D%99,%20%E5%B9%B3%E9%9D%99)/"/>
    <url>/2019/08/20/%E5%AD%A6%E4%BC%9A%E9%9D%99(Peace,%20%E5%AE%89%E9%9D%99,%20%E5%B9%B3%E9%9D%99)/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä½›è¯´ï¼Œé™èƒ½ç”Ÿæ…§ã€‚<br>è¯—äººè¯´ï¼Œæ²‰é™æœ€ç¾ã€‚<br>æƒ…ç§è¯´ï¼Œå²æœˆé™å¥½ã€‚<br>æ™ºè€…è¯´ï¼Œé™æ°´æµæ·±ã€‚<br>ç”˜åœ°è¯´ï¼Œå¯‚é™æ˜¯æˆ‘å¿ƒåº•æœ€å¼ºå¤§çš„å£°éŸ³ã€‚</p></blockquote><p>åœ¨å½“ä¸‹ï¼Œå„æ–¹é¢éƒ½æ˜¯è¿…é€Ÿçš„ã€‚ç§‘æŠ€å‘å±•è¿…é€Ÿï¼Œç”Ÿæ´»èŠ‚å¥åŠ å¿«ï¼Œç¤¾ä¼šå˜å¾—æµ®èºèµ·æ¥ï¼Œåœ¨è¿™æ ·çš„å¤§ç¯å¢ƒä¸‹ï¼Œå¤ªå¤šçš„äººéƒ½åœ¨è¿™æ ·å¿«èŠ‚å¥ä¸‹ç”Ÿæ´»ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ›´éœ€è¦â€œç¼“æ…¢â€ä¸‹æ¥ï¼Œä¸æ–­çš„å¹³é™ï¼Œæ€è€ƒï¼Œæ€»ç»“ï¼Œå­¦ä¼šåœ¨å¿«èŠ‚å¥ä¸­çš„æ…¢ç”Ÿæ´»ï¼Œå¿«èŠ‚å¥ä¸‹çš„æ…¢ç­–ç•¥ç­‰ï¼Œå°†æœ‰é™çš„æ—¶é—´ç”¨åœ¨é‡è¦ï¼Œæ›´å…·æœ‰ä»·å€¼çš„äº‹æƒ…ä¸Šã€‚è€Œé™çš„äººç”Ÿå“²å­¦å¯ä»¥å¸®åŠ©æˆ‘ä»¬ã€‚</p><p>é™æ˜¯ä¸€ç§å¿ƒå¢ƒï¼Œä¸€äº›äººåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯»æ±‚å†…å¿ƒçš„å¹³é™ï¼Œåœ¨åŠ¨çš„è¿‡ç¨‹ä¸­å¯»æ±‚é™æ˜¯ä¸€ç§å¤šä¹ˆé«˜çš„å¢ƒç•Œï¼ˆåŠ¨ä¸é™çš„å“²å­¦ï¼‰ï¼Œä»–ä»¬æ— æ—¶æ— åˆ»ä¸åœ¨æ€è€ƒï¼Œè¡ŒåŠ¨ï¼Œæ”¹å˜ï¼›å°±åƒä¸Šé¢æ‰€è¯´çš„é™èƒ½ç”Ÿæ…§ï¼Œå†æ˜ç¡®ä¸è¿‡äº†ã€‚éæ·¡æ³Šæ— ä»¥æ˜å¿—ï¼Œéå®é™æ— ä»¥å¿—è¿œï¼Œä¸å°±æ˜¯è¯´çš„é™ï¼ˆå®é™ï¼Œå®‰é™ï¼‰çš„å¿ƒæ€æ˜¯å¦‚æ­¤é‡è¦å—ï¼</p><p>é™æ˜¯ä¸€ç§å“è´¨ï¼Œé™ä¸æ˜¯å¹³æ·¡ï¼Œæ›´ä¸æ˜¯å¹³åº¸ï¼Œæ˜¯å…·æœ‰ä¸€ç§éå¸¸ä¸°å¯Œå†…æ¶µå“è´¨çš„å¹½è¿œã€‚çŠ¹å¦‚å±±ä¹‹å®ä¼Ÿï¼ŒçŠ¹å¦‚ç‰¹ç«‹ç‹¬è¡Œï¼ŒçŠ¹å¦‚æ³°ç„¶è‡ªè‹¥çš„è‡³é«˜å¢ƒç•Œï¼Œå®ƒæ˜¯äººä¸€ç”Ÿä¸­é«˜è´µçš„å“è´¨ã€‚</p><p>é™æ˜¯ä¸€ç§ç”Ÿæ´»ï¼Œä¸æ€¥ï¼Œä¸ç‡¥ï¼Œä¸äº‰ã€‚åœ¨æ¬é™çš„æ—¶é—´é‡Œï¼Œé™ä¿®ï¼Œæ²å…»ï¼Œç”Ÿæ´»æ›´æœ‰æ ¼è°ƒï¼Œæ›´å…·æœ‰è‡ªå·±çš„ç”Ÿæ´»ç‰¹è‰²ã€‚å®ƒä¹Ÿæ˜¯æç®€çš„ä¸€ç§ç”Ÿæ´»æ–¹å¼ï¼Œè®©æ—¶é—´ç¼“æ…¢ä¸‹æ¥ï¼Œå……åˆ†çš„äº«å—ç”Ÿæ´»ã€‚å®ƒä¹Ÿæ˜¯æ…¢ç”Ÿæ´»çš„ä¸€ç§ä½“ç°ï¼Œå¹¶ä¸æ˜¯è®©æˆ‘ä»¬æ”¾å¼ƒä»€ä¹ˆæˆ–æ¶ˆæçš„æ€åº¦ï¼Œåè€Œæ˜¯æ›´åŠ çš„ç§¯æå¥‹æ–—ï¼Œéå¸¸å¥åº·çš„å¿ƒæ€ï¼Œæ˜¯å¦å¤–ä¸€ç§ç”Ÿæ´»ã€å¿ƒçµæ—…è¡Œçš„æ–¹å¼ã€‚</p><p>é™å¯ä»¥è®©æˆ‘ä»¬æ›´ç†æ€§çš„æ€è€ƒã€‚ä¸€èˆ¬ï¼Œå­¦ä¹ æ—¶éƒ½ä¼šåœ¨ä¸€ä¸ªæ¯”è¾ƒå®‰é™ï¼Œå¹³é™çš„ç¯å¢ƒä¸‹è¿›è¡Œï¼Œå› ä¸ºå˜ˆæ‚çš„ç¯å¢ƒä¸åˆ©äºæˆ‘ä»¬æ€è€ƒï¼›è€Œåœ¨ç¤¾ä¼šä¸­äº¦æ˜¯å¦‚æ­¤ã€‚ä¸€ä¸ªæµ®èºçš„äººæ€ä¹ˆèƒ½å¤Ÿè®¤çœŸæ€è€ƒï¼è€Œå¦‚ä»Šæµ®èºçš„äº‹ç‰©å¤ªå¤šï¼Œæ¯”å¦‚ç½‘ç»œç›´æ’­ï¼Œå°è§†é¢‘ï¼Œå„ç§æœ‹å‹åœˆï¼Œæ¯’â€œé¸¡æ±¤â€ç­‰ï¼Œæ— æ—¶æ— åˆ»ä¸å½±å“ç€æˆ‘ä»¬ã€‚å¦‚æœèƒ½å¤Ÿæ§åˆ¶è‡ªå·±ï¼Œä½¿å¾—è‡ªå·±èƒ½é™ä¸‹æ¥ï¼Œæ€è€ƒä¸€éƒ¨åˆ†ä¿¡æ¯çš„çœŸå®æ€§ï¼Œå®ƒçš„ä»·å€¼ç­‰ï¼Œè¿™æ ·å¯¹è‡ªå·±éå¸¸æœ‰ç›Šã€‚</p><p>é™å¯ä»¥æ˜¯æˆ‘ä»¬æ›´å…·æœ‰åˆ›é€ åŠ›ï¼Œæœ‰æ—¶é™ï¼ˆå¹³é™ï¼‰å¯ä»¥è®©æˆ‘ä»¬æ›´é«˜æ•ˆã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œé™å¯ä»¥è®©æˆ‘ä»¬æ›´ç†æ€§çš„æ€è€ƒï¼Œå› æ­¤åœ¨å·¥ä½œæˆ–ç”Ÿæ´»ä¸­ï¼Œçªç„¶é‡åˆ°æŸä¸ªé—®é¢˜ï¼Œéœ€è¦å®‰é™çš„æ€è€ƒï¼Œè€Œä¸æ˜¯é©¬ä¸Šè¿›è¡Œç€æ‰‹è¡ŒåŠ¨ã€‚æ¯”å¦‚ï¼Œåœ¨å·¥ä½œä¸­æ¥åˆ°æŸä¸ªé¡¹ç›®ï¼Œéœ€è¦å†·é™çš„æ€è€ƒé¡¹ç›®çš„æ•´ä¸ªæ–¹æ¡ˆï¼Œæ¶æ„ï¼Œå®æ–½ï¼Œè®¡åˆ’ç­‰å„ä¸ªæ–¹é¢çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯æµ®èºçš„ï¼Œæ— å…¨å±€æ€§å’Œæ— è®¡åˆ’æ€§çš„é©¬ä¸Šå¼€å±•ã€‚ç‰¹åˆ«æ˜¯ç°åœ¨äº’è”ç½‘ç››è¡Œçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ›´å¤šæ¥è§¦çš„æ˜¯ä¸€äº›é›¶ç¢åŒ–ï¼Œç‰‡æ®µåŒ–çš„ä¿¡æ¯ï¼›æŸäº›å°çš„é—®é¢˜åœ¨ç½‘ç»œä¸Šå¯èƒ½æœ‰â€œç­”æ¡ˆâ€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸¸å¸¸å€ŸåŠ©äº’è”ç½‘ï¼Œè€Œå¿½ç•¥äº†æ•´ä½“æ€§æ€ç»´å’Œæ€è€ƒçš„è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯å¯¹å­¦ç”Ÿï¼ˆå°å­¦ï¼Œä¸­å­¦ç”šè‡³å¤§å­¦ï¼‰çš„å®³å¤„ç‰¹åˆ«å¤§ã€‚æˆ‘åœ¨å·¥ä½œä¸­é‡åˆ°å¾ˆå¤šæ¬¡è¿™æ ·çš„æƒ…å†µï¼Œæ¯”å¦‚æŸä¸ªç¨‹åºçš„bugæˆ–é”™è¯¯ï¼Œéœ€è¦è‡ªå·±åå¤çš„æ€è€ƒï¼Œè€Œä¸æ˜¯é©¬ä¸Šå€ŸåŠ©äº’è”ç½‘æ¥å¯»æ±‚è§£å†³æ–¹æ¡ˆï¼›å†æ¯”å¦‚ï¼Œå­¦ä¹ æŸä¸ªæ–°çš„æŠ€æœ¯ï¼Œæ›´å¥½çš„æ–¹å¼å…ˆçœ‹ä¸€æœ¬è¯¥æŠ€æœ¯ç›¸å…³çº¸è´¨çš„ä¹¦ï¼Œå¯¹å±€éƒ¨æˆ–æ·±å…¥çš„é—®é¢˜å¯ä»¥é€šè¿‡äº’è”ç½‘æ¥å‚è€ƒæˆ–è§£å†³ï¼Œä¹¦æœ‰è‡ªå·±çš„æ•´ä½“æ€ç»´ç»“æ„ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æ›´åŠ æ•´ä½“æ€§çš„äº†è§£è¯¥æŠ€æœ¯ã€‚</p><p>ä¸€ä¸ªå¥½çš„ç¯å¢ƒæ‰èƒ½äº§ç”Ÿå¥½äº§å“ï¼Œäº‹ç‰©ã€‚ä¸°ç”°ç°æœ‰çš„æˆå°±ç»ä¸æ˜¯åœ¨æµ®èºï¼ŒèºåŠ¨çš„ç¯å¢ƒä¸‹äº§ç”Ÿï¼›è€Œæµ®èºçš„ç¯å¢ƒä¹Ÿä¸ä¼šå‡ºç°åƒçˆ±å› æ–¯å¦ï¼Œéœé‡‘ç­‰è¿™ç±»äººç‰©ã€‚</p><p>å¥½çš„ç¯å¢ƒæ˜¯å¦‚æ­¤çš„é‡è¦ï¼Œå³ä½¿åœ¨æµ®èºçš„ç¯å¢ƒä¸‹ï¼Œé™ï¼ˆå®‰é™ï¼Œå¹³é™ï¼‰ä¹Ÿèƒ½ä½¿å¾—æˆ‘ä»¬è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœï¼Œä½¿å¾—æˆ‘ä»¬åšäº‹æ›´åŠ çš„é«˜æ•ˆï¼Œä¹Ÿä½¿å¾—æˆ‘ä»¬æ›´å…·æœ‰åˆ›é€ åŠ›ã€‚</p><p>é™å¯ä»¥è®¤è¯†è‡ªå·±ï¼Œå…³æ³¨è‡ªå·±æœ‰ä»€ä¹ˆï¼Œè€Œä¸æ˜¯åªå…³æ³¨åˆ«äººæœ‰ä»€ä¹ˆã€‚å½“ä¸€ä¸ªäººé™ä¸‹æ¥çš„æ—¶å€™ï¼Œå¤šå¤šå°‘å°‘ä¼šæ€è€ƒè‡ªå·±çš„ä¸€è¨€ä¸€è¡Œï¼Œå¯¹è‡ªå·±çš„å†…å¿ƒæ‹·é—®ï¼Œåæ€ã€‚è¿™æ ·å¯ä»¥æ›´åŠ çš„äº†è§£è‡ªå·±éœ€è¦ä»€ä¹ˆï¼Œä»è€Œæ”¹å˜è‡ªå·±ï¼Œè¾¾åˆ°ç›®æ ‡ã€‚å¦‚ä»Šæµè¡Œçš„æœ‹å‹åœˆï¼Œéƒ½æ˜¯å…‰é²œäº®ä¸½ä¸€é¢ï¼Œå¾€å¾€æˆ‘ä»¬åªå…³æ³¨äº†åˆ«äººæœ‰ä»€ä¹ˆï¼Œåšä»€ä¹ˆï¼Œè€Œå¿½ç•¥äº†è‡ªå·±æœ‰ä»€ä¹ˆã€‚æ— å½¢ä¹‹ä¸­ï¼Œç”Ÿæ´»åœ¨äº†åˆ«äººçš„ç”Ÿæ´»é‡Œï¼Œç¼ºä¹äº†è‡ªå·±çš„å…‰ç¯ã€‚è‹¥è‹¥äººäººéƒ½èƒ½å¯¹è‡ªå·±åæ€ï¼Œå¯¹æ•´ä¸ªç¤¾ä¼šåæ€ï¼Œé‚£ä¹ˆæ˜¯ä¸€ä¸ªå¤šä¹ˆâ€œå¯æ€•â€çš„æƒ…å†µï¼Œåœ¨åæ€ä¸­ä¸æ®µæ”¹å–„ï¼Œæ”¹å˜ã€‚</p><p>äººç”Ÿä¸»è¦å¿™äºä¸¤ä»¶äº‹ï¼Œå¿™ç€ç”Ÿå’Œå¿™ç€æ­»ï¼ˆè‚–ç”Ÿå…‹çš„æ•‘èµï¼‰ã€‚æ­£ç¡®çš„è®¤è¯†è‡ªå·±æ˜¯å¤šé‡è¦ï¼Œå¤šä¹ˆæœ‰ä»·å€¼ã€‚é™ä¸å°±æ˜¯æˆ‘ä»¬æœ€å¥½çš„æ–¹å¼å—ï¼</p><p>å½“ç„¶ï¼Œé™ä¹Ÿæ˜¯è¦å–å†³äºåœºæ™¯å’Œæ–¹å¼çš„ã€‚é™æ›´å¤šæ˜¯æ€æƒ³ä¸Šçš„ï¼Œåœ¨è¡Œä¸ºä¸Šå’Œé™æ²¡æœ‰å…³ç³»ã€‚ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½éœ€è¦é™ï¼Œéœ€è¦è§†çŠ¶å†µè€Œå®šã€‚<a id="more"></a></p>]]></content>
    
    
    <categories>
      
      <category>æ€è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é™</tag>
      
      <tag>ç”Ÿæ´»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºè½¨è¿¹çš„æ•°æ®æŒ–æ˜ç›¸å…³æŠ€æœ¯æ€»ç»“</title>
    <link href="/2019/07/20/%E8%BD%A8%E8%BF%B9%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/"/>
    <url>/2019/07/20/%E8%BD%A8%E8%BF%B9%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰é¡¹ç›®ä¸­æ¥è§¦åˆ°äº†è½¨è¿¹æ•°æ®æŒ–æ˜é¢†åŸŸï¼Œå§‹ç»ˆéƒ½æ²¡æœ‰æ—¶é—´å¯¹è½¨è¿¹æ•°æ®æŒ–æ˜è¿›è¡Œæ•´ä½“çš„æ¢³ç†å’Œæ€»ç»“ï¼Œç°åœ¨æŠ½å‡ å¤©æ—¶é—´æ¥è¿›è¡Œæ€»ç»“å¹¶è¿›è¡Œè®°å½•ã€‚</p><p>ç›®å‰éå¸¸å¤šçš„æ•°æ®éƒ½æ˜¯è½¨è¿¹æ•°æ®ï¼Œå¦‚å…±äº«å•è½¦éª‘è¡Œçš„æ•°æ®ï¼Œæ‰‹æœºGPSå¯¼èˆªçš„æ•°æ®ï¼Œå®šä½æ•°æ®ï¼Œä¸€äº›ä¼ æ„Ÿå™¨æ•°æ®ç­‰ç­‰ã€‚åœ¨æœªæ¥5Gçš„å‘å±•ä¸‹ï¼Œç›¸ä¿¡è½¨è¿¹æ•°æ®æˆ–æ—¶ç©ºç±»å‹çš„æ•°æ®ä¼šæ›´å¤šï¼Œè€Œä¸”ä¼šæ›´åŠ çš„å¤æ‚ã€‚</p><p>ä»¥å‰æ¥è§¦çš„æ•°æ®å¤§å¤šæ²¡æœ‰ç©ºé—´çš„æ¦‚å¿µï¼Œéƒ½æ˜¯ä¸€äº›æ™®é€šçš„æ•°æ®æ ·æœ¬ã€‚è¿™äº›æ•°æ®å¯ä»¥è®¤ä¸ºæ˜¯ç©ºé—´ç‹¬ç«‹çš„ï¼Œå› æ­¤åœ¨æ•°æ®åˆ†ææˆ–æŒ–æ˜æ—¶ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ çš„æ–¹ä¾¿ï¼Œå…¶æŠ€æœ¯ä¹Ÿç›¸å¯¹äºæˆç†Ÿã€‚è€Œè½¨è¿¹æ•°æ®ä¸åŒï¼Œå®ƒåŒæ—¶å…·æœ‰æ—¶é—´å’Œç©ºé—´åŒç»´åº¦ï¼Œåœ¨å»ºæ¨¡çš„æ—¶å€™å¾ˆå¤šä¼ ç»Ÿç®—æ³•åœ¨åº”ç”¨æ—¶éƒ½å­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œå¦‚è½¨è¿¹çš„è·ç¦»åº¦é‡ï¼Œè¿™ä¹ˆä¸€ä¸ªç®€å•é—®é¢˜ï¼Œåœ¨è½¨è¿¹é‡Œé¢éƒ½ä¼šå˜å¾—å¤æ‚ã€‚</p><p>é€šè¿‡æœ¬æ¬¡é¡¹ç›®çš„å®æ–½ï¼Œä¹Ÿå¯¹è½¨è¿¹æ•°æ®æ¶‰åŠåˆ°çš„ä¸»è¦é—®é¢˜è¿›è¡Œäº†æ¢³ç†ï¼Œä¸€äº›æ¶‰åŠåˆ°çš„æŠ€æœ¯æ ˆè¿›è¡Œäº†æ€»ç»“ï¼Œä¾¿äºåé¢é¡¹ç›®ä¸­é‡åˆ°è¯¥ç±»é—®é¢˜æ—¶è¿›æŸ¥é˜…ï¼ŒåŒæ—¶å¢åŠ è‡ªå·±çš„ç†è§£ã€‚</p><h2 id="è½¨è¿¹æ•°æ®æ¶‰åŠçš„æŠ€æœ¯æ ˆ"><a href="#è½¨è¿¹æ•°æ®æ¶‰åŠçš„æŠ€æœ¯æ ˆ" class="headerlink" title="è½¨è¿¹æ•°æ®æ¶‰åŠçš„æŠ€æœ¯æ ˆ"></a>è½¨è¿¹æ•°æ®æ¶‰åŠçš„æŠ€æœ¯æ ˆ</h2><p>è½¨è¿¹æ•°æ®çš„æŠ€æœ¯æ ˆåŸºæœ¬å’Œæ™®é€šçš„æŠ€æœ¯æ ˆæ¶‰åŠåˆ°çš„è¿‡ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯è¿‡ç¨‹ä¸­æŸä¸ªéƒ¨åˆ†å…·æœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œä¸‹å›¾æ˜¯ç»è¿‡æ¢³ç†å¾—åˆ°çš„æ•´ä¸ªè½¨è¿¹æ•°æ®çš„æ¶‰åŠåˆ°çš„æŠ€æœ¯æ ˆï¼Œå…¶ä¸­æ¯ä¸ªéƒ¨åˆ†éƒ½å«æœ‰å¾ˆå¤šéƒ¨åˆ†ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/uploads/%E8%BD%A8%E8%BF%B9%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E6%8A%80%E6%9C%AF%E6%A0%88.png" srcset="/img/loading.gif" alt="è½¨è¿¹æ•°æ®æŒ–æ˜æŠ€æœ¯æ ˆ"><a id="more"></a></p><h3 id="è½¨è¿¹æ•°æ®å­˜å‚¨"><a href="#è½¨è¿¹æ•°æ®å­˜å‚¨" class="headerlink" title="è½¨è¿¹æ•°æ®å­˜å‚¨"></a>è½¨è¿¹æ•°æ®å­˜å‚¨</h3><p>è½¨è¿¹æ•°æ®çš„å­˜å‚¨å’Œæ™®é€šçš„æ•°æ®å­˜å‚¨ä¸åŒï¼Œè½¨è¿¹æ•°æ®å±äºGISæ•°æ®ï¼ŒåŒ…å«äº†ä½ç½®æ•°æ®ï¼Œè€Œä¸”è½¨è¿¹çš„è¡¨ç¤ºä¸ºå‡ ä½•å›¾å½¢ä¸­çš„<code>Line</code>æ ¼å¼ã€‚å› æ­¤ä¸€èˆ¬é‡‡ç”¨GISæ•°æ®åº“è¿›è¡Œå­˜å‚¨ï¼Œç›®å‰æ¯”è¾ƒæµè¡Œå­˜å‚¨æ•°æ®å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>æ•°æ®åº“å</th><th>åˆ†å¸ƒå¼</th><th>ç©ºé—´å¯¹è±¡</th><th>HDFS</th></tr></thead><tbody><tr><td><a href="https://en.wikipedia.org/wiki/Environmental_Systems_Research_Institute" target="_blank" rel="noopener">ESRI</a> GIS Tools for <a href="https://en.wikipedia.org/wiki/Hadoop" target="_blank" rel="noopener">Hadoop</a></td><td>yes</td><td>yes (own specific API)</td><td>yes</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/GeoMesa" target="_blank" rel="noopener">GeoMesa</a></td><td>yes</td><td>yes (<a href="https://en.wikipedia.org/wiki/Simple_Features" target="_blank" rel="noopener">Simple Features</a>)</td><td>yes</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/H2_(DBMS)" target="_blank" rel="noopener">H2</a> (H2GIS)</td><td>no</td><td>yes (custom, no raster)</td><td>no</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/Ingres_(database)" target="_blank" rel="noopener">Ingres</a></td><td>yes (if extension is installed)</td><td>yes (custom, no raster)</td><td>no</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/Neo4j" target="_blank" rel="noopener">Neo4J</a>-spatial<a href="https://en.wikipedia.org/wiki/Spatial_database#cite_note-15" target="_blank" rel="noopener">[15]</a></td><td>no</td><td>yes (<a href="https://en.wikipedia.org/wiki/Simple_Features" target="_blank" rel="noopener">Simple Features</a>)</td><td>no</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/PostgreSQL" target="_blank" rel="noopener">PostgreSQL</a>with <a href="https://en.wikipedia.org/wiki/PostGIS" target="_blank" rel="noopener">PostGIS</a></td><td>no</td><td>yes (<a href="https://en.wikipedia.org/wiki/Simple_Features" target="_blank" rel="noopener">Simple Features</a>and raster)</td><td>no</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/Postgres-XL" target="_blank" rel="noopener">Postgres-XL</a> with <a href="https://en.wikipedia.org/wiki/PostGIS" target="_blank" rel="noopener">PostGIS</a></td><td>yes</td><td>yes (<a href="https://en.wikipedia.org/wiki/Simple_Features" target="_blank" rel="noopener">Simple Features</a>and raster)</td><td>no</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/Rasdaman" target="_blank" rel="noopener">Rasdaman</a></td><td>yes</td><td>just raster</td><td>no</td></tr><tr><td><a href="https://en.wikipedia.org/wiki/RethinkDB" target="_blank" rel="noopener">RethinkDB</a></td><td>yes</td><td>yes</td><td>no</td></tr></tbody></table><p>ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¸º<code>PostgreSQL with PostGIS</code>ï¼Œ<code>GeoMesa</code>æ•°æ®åº“ï¼Œæ”¯æŒ<code>Point, Line, Poly</code>ç­‰å‡ ä½•å›¾å½¢çš„å­˜å‚¨ï¼Œè€Œä¸”åŒ…å«äº†å¾ˆå¤šGISç›¸å…³çš„åŠŸèƒ½å‡½æ•°ä½¿ç”¨ã€‚ç›®å‰ï¼ŒMySQLï¼ŒMongoDB, Redisç­‰éƒ½æ”¯æŒGEOï¼Œä½†æ˜¯å¯¹è½¨è¿¹æ•°æ®æ”¯æŒä¸å®Œæ•´ï¼Œé˜¿é‡Œï¼Œè…¾è®¯éƒ½æœ‰è‡ªå·±çš„æ—¶ç©ºæ•°æ®çš„æ•°æ®åº“ã€‚</p><p>###è½¨è¿¹æ•°æ®çš„å¤„ç†</p><p>è½¨è¿¹æ•°æ®å¤„ç†æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œæ•°æ®å¤„ç†åŒ…æ‹¬ï¼Œè½¨è¿¹çš„å‹ç¼©ï¼Œå™ªå£°çš„è¿‡æ»¤ï¼Œè½¨è¿¹åˆ†æ®µç­‰ç­‰ã€‚æ•°æ®å¤„ç†ä¸ä»…ä¼šå½±å“åé¢å»ºæ¨¡ï¼Œå¯¹ç‰¹å¾æå–ï¼ŒåæœŸåº”ç”¨éƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“ã€‚</p><h4 id="è½¨è¿¹å‹ç¼©"><a href="#è½¨è¿¹å‹ç¼©" class="headerlink" title="è½¨è¿¹å‹ç¼©"></a>è½¨è¿¹å‹ç¼©</h4><p>è½¨è¿¹æ•°æ®å¯èƒ½å­˜åœ¨çš„ä¸»è¦é—®é¢˜æœ‰ï¼šæ•°æ®é‡å¤§ï¼Œå™ªå£°å¤šï¼Œå®šä½ä¸å‡†ï¼Œä½ç½®åç§»ç­‰ï¼Œè€Œæ•°æ®å‹ç¼©å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è¿™äº›é—®é¢˜ï¼Œæ¯”å¦‚å‡å°‘æ•°æ®é‡ï¼Œåœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦éå¸¸å¯†é›†(æ—¶é—´)çš„è½¨è¿¹æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®å‹ç¼©åå¯ä»¥å‡å°æ•°æ®é‡ã€‚æ•°æ®å‹ç¼©ä¸»è¦æœ‰ç¦»çº¿å‹ç¼©ï¼ˆæ‰¹é‡ï¼‰å’Œåœ¨çº¿å‹ç¼©ã€‚</p><ul><li>ç¦»çº¿å‹ç¼©ï¼šDouglas-Peucker (DP)ï¼ŒTop-Down Time Ratioï¼ˆTDTRï¼‰ç­‰ç®—æ³•</li><li>åœ¨çº¿å‹ç¼©ï¼šReservoir Samplingï¼ŒSlicing Windowï¼Œopen windowç­‰ç®—æ³•</li></ul><h4 id="è½¨è¿¹å¹³æ»‘"><a href="#è½¨è¿¹å¹³æ»‘" class="headerlink" title="è½¨è¿¹å¹³æ»‘"></a>è½¨è¿¹å¹³æ»‘</h4><p>ç©ºé—´è½¨è¿¹æ˜¯ä¸€ä¸ª$(x,y)$ç‚¹çš„åºåˆ—,æ¯ä¸ªç‚¹éƒ½æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ã€‚å› ä¸ºè½¨è¿¹é€šå¸¸æ˜¯ç”±ä¼ æ„Ÿå™¨æµ‹é‡çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¸å¯é¿å…åœ°ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œå¹³æ»‘åŒ–å¤„ç†ã€‚ä¸»è¦æ–¹æ³•æœ‰ï¼š</p><ul><li>å‡å€¼æ»¤æ³¢</li><li>ä¸­å€¼æ»¤æ³¢</li><li>å¡å°”æ›¼æ»¤æ³¢ï¼ˆKalman filterï¼‰</li><li>ç²’å­æ»¤æ³¢</li></ul><h4 id="è½¨è¿¹åˆ†å‰²"><a href="#è½¨è¿¹åˆ†å‰²" class="headerlink" title="è½¨è¿¹åˆ†å‰²"></a>è½¨è¿¹åˆ†å‰²</h4><p>è½¨è¿¹åˆ†å‰²ä¸»è¦æ˜¯å¯¹ä¸€ä¸ªé•¿è½¨è¿¹åˆ†å‰²ä¸ºå„ä¸ªçŸ­çš„è½¨è¿¹ï¼Œå°†è½¨è¿¹è¿›è¡Œåˆ†è§£ä¸ºä¸åŒæ®µçš„è½¨è¿¹ã€‚åœ¨å¾ˆå¤šåº”ç”¨åœºæ™¯ä¸‹éƒ½ä¼šä½¿ç”¨è½¨è¿¹åˆ†å‰²æŠ€æœ¯ï¼Œç›®å‰ä¹Ÿæœ‰å¾ˆå¤šè½¨è¿¹åˆ†å‰²ç®—æ³•ï¼Œä¸»è¦æœ‰ï¼š</p><ul><li>é€šè¿‡<strong>é©»ç•™ç‚¹æˆ–åœç•™ç‚¹ï¼ˆ<code>stay point</code>ï¼‰</strong>æ£€æµ‹è¿›è¡Œè½¨è¿¹åˆ†å‰²</li><li>æ ¹æ®<strong>æ—¶é—´é—´éš”</strong>è¿›è¡Œè½¨è¿¹åˆ†å‰²</li><li>æ ¹æ®<strong>è½¨è¿¹ç‚¹å¯†åº¦</strong>è¿›è¡Œè½¨è¿¹åˆ†å‰²</li><li>æ ¹æ®é€Ÿåº¦æ¥è¿›è¡Œè½¨è¿¹åˆ†å‰²</li></ul><p>å…¶ä¸­è½¨è¿¹å¯†åº¦å¯ä»¥æœ‰å¾ˆå¤šæ–¹æ³•è¿›è¡Œæ£€æµ‹ï¼Œä¸€èˆ¬éƒ½åŸºäºå¯†åº¦èšç±»ç®—æ³•çš„æ”¹è¿›ç®—æ³•æ¥è¿›è¡Œæ£€æµ‹ï¼Œå¦‚ï¼šK-ä¸­å€¼ç®—æ³•ï¼Œ<code>DJ-Cluster</code>ç®—æ³•ï¼Œ<code>cb_swot</code>ç®—æ³•ï¼ŒMSN(Move-Stop-Noise)ç®—æ³•ç­‰ã€‚</p><h3 id="æ•°æ®ç®¡ç†"><a href="#æ•°æ®ç®¡ç†" class="headerlink" title="æ•°æ®ç®¡ç†"></a>æ•°æ®ç®¡ç†</h3><p>æ—¶ç©ºæ•°æ®ç®¡ç†æˆ–è½¨è¿¹æ•°æ®ç®¡ç†ï¼Œæ¶‰åŠåˆ°è¿‘é‚»æŸ¥è¯¢ï¼Œæ—¶é—´å’Œç©ºé—´ç»´åº¦çš„å¿«é€ŸæŸ¥è¯¢ï¼Œç©ºé—´ç´¢å¼•ç­‰ç›¸å…³æŠ€æœ¯ã€‚è€Œè¿™ä¸€éƒ¨åˆ†ï¼Œä¸€èˆ¬GISæ•°æ®åº“éƒ½åŒ…å«äº†ç›¸å…³çš„åŠŸèƒ½ï¼Œåªéœ€è¦åœ¨åˆ›å»ºè¡¨æ—¶ï¼Œå¢åŠ ç´¢å¼•æˆ–ä½¿ç”¨ç›¸å…³åŠŸèƒ½å‡½æ•°å³å¯ã€‚ä½†æ˜¯æœ‰æ—¶åœ¨å·¥ç¨‹åº”ç”¨æ—¶ä¹Ÿä¼šæ¶‰åŠåˆ°ç©ºé—´è¿‘é‚»åŒ¹é…æŸ¥è¯¢ã€‚</p><h4 id="ç©ºé—´ç´¢å¼•"><a href="#ç©ºé—´ç´¢å¼•" class="headerlink" title="ç©ºé—´ç´¢å¼•"></a>ç©ºé—´ç´¢å¼•</h4><p>ç©ºé—´ç´¢å¼•çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œç›®å‰ç»å¸¸ä½¿ç”¨çš„æœ‰KDæ ‘ï¼ŒRæ ‘ï¼Œå››å‰æ ‘åŠå›¾ç­‰ç›¸å…³ç»“æ„ã€‚ä½†æ˜¯ç›®å‰æ•ˆç‡è¾ƒé«˜è¿˜æ˜¯åŸºäºå›¾çš„ç´¢å¼•ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜ç»´ç©ºé—´æ—¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºNNç´¢å¼•æŸ¥è¯¢æ•ˆç‡å¯¹æ¯”ï¼š<a href="http://ann-benchmarks.com/" target="_blank" rel="noopener">http://ann-benchmarks.com/</a></p><h3 id="æ•°æ®æŒ–æ˜"><a href="#æ•°æ®æŒ–æ˜" class="headerlink" title="æ•°æ®æŒ–æ˜"></a>æ•°æ®æŒ–æ˜</h3><p>è½¨è¿¹æ•°æ®çš„æŒ–æ˜åŒ…å«å¾ˆå¤šæ–¹é¢ï¼ŒåŸºæœ¬ä¼ ç»Ÿæœºå™¨å­¦ä¹ çš„åŒ…å«çš„ï¼Œè½¨è¿¹æ•°æ®éƒ½åŒ…å«åœ¨å†…ã€‚ä½†æ˜¯ä¸»è¦çš„ä¸€äº›æ–¹å‘æœ‰è½¨è¿¹çš„åˆ†ç±»ï¼Œè½¨è¿¹èšç±»ï¼Œè½¨è¿¹å¼‚å¸¸æ£€æµ‹ï¼Œè½¨è¿¹æ¨èï¼Œè½¨è¿¹çš„å¯è§†åŒ–ç­‰å¾…ã€‚</p><h2 id="è®ºæ–‡è§£è¯»-Trajectory-Clustering-A-Partition-and-Group-Framework"><a href="#è®ºæ–‡è§£è¯»-Trajectory-Clustering-A-Partition-and-Group-Framework" class="headerlink" title="è®ºæ–‡è§£è¯»-Trajectory Clustering: A Partition-and-Group Framework"></a>è®ºæ–‡è§£è¯»-Trajectory Clustering: A Partition-and-Group Framework</h2><p>è¿™ç¯‡è®ºæ–‡æ¶‰åŠåˆ°äº†è½¨è¿¹æ•°æ®æŒ–æ˜è¿‡ç¨‹çš„å¾ˆå¤šé—®é¢˜ï¼Œè¯¥è®ºæ–‡æœ‰å¾ˆå¤šå€¼å¾—å€Ÿé‰´çš„åœ°æ–¹ï¼Œå› æ­¤å¯¹æ”¹è®ºæ–‡è¿›è¡Œè¯´æ˜ï¼Œå¹¶å¯¹è¯¥è®ºæ–‡ä¸­çš„æ‰€æœ‰çŸ­å‘æ¡†æ¶è¿›è¡Œäº†å®ç°(python)ã€‚è¯¥è®ºæ–‡æ¶‰åŠåˆ°äº†è½¨è¿¹çš„æ•°æ®å¤„ç†ï¼Œè½¨è¿¹åˆ†å‰²ï¼Œè½¨è¿¹è·ç¦»åº¦é‡ï¼Œè½¨è¿¹èšç±»ï¼Œä¸»è¦è½¨è¿¹æå–ç­‰å¾…ã€‚</p><h3 id="é—®é¢˜çš„æå‡º"><a href="#é—®é¢˜çš„æå‡º" class="headerlink" title="é—®é¢˜çš„æå‡º"></a>é—®é¢˜çš„æå‡º</h3><p><a href="http://hanj.cs.illinois.edu/pdf/sigmod07_jglee.pdf" target="_blank" rel="noopener">è¯¥è®ºæ–‡</a>ä¸»è¦ä»ä¼—å¤šçš„è½¨è¿¹ä¸­æ‰¾å‡ºèšé›†åœ¨ä¸€æœŸçš„åˆ†æ®µè½¨è¿¹éƒ¨åˆ†ï¼Œå¹¶åˆæˆæ–°çš„è½¨è¿¹ã€‚è¿™æ ·å¯ä»¥æ‰¾å‡ºå…¬å…±è½¨è¿¹éƒ¨åˆ†ï¼Œå¯†é›†è½¨è¿¹éƒ¨åˆ†ç­‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­æ–¹æ¡†å†…çš„éƒ¨åˆ†å°±è¡Œéœ€è¦æ‰¾å‡ºçš„éƒ¨åˆ†ã€‚</p><p><img src="/uploads/1553750720955.png" srcset="/img/loading.gif" alt=""></p><h3 id="ç®—æ³•è¿‡ç¨‹"><a href="#ç®—æ³•è¿‡ç¨‹" class="headerlink" title="ç®—æ³•è¿‡ç¨‹"></a>ç®—æ³•è¿‡ç¨‹</h3><h4 id="è½¨è¿¹çš„è·ç¦»åº¦é‡"><a href="#è½¨è¿¹çš„è·ç¦»åº¦é‡" class="headerlink" title="è½¨è¿¹çš„è·ç¦»åº¦é‡"></a>è½¨è¿¹çš„è·ç¦»åº¦é‡</h4><p>è½¨è¿¹çš„è·ç¦»ä»3ä¸ªæ–¹é¢è¿›è¡Œåº¦é‡ï¼Œä¸¤ä¸ªè½¨è¿¹ä¹‹é—´<strong>æœ€è¿œç‚¹å’Œæœ€çŸ­ç‚¹ä¹‹é—´çš„è·ç¦»</strong>ï¼Œè½¨è¿¹çš„<strong>é•¿åº¦</strong>ï¼Œè½¨è¿¹çš„<strong>è§’åº¦</strong>ã€‚ä¸‰è€…çš„åº¦é‡å…¬å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/uploads/traj_distance.png" srcset="/img/loading.gif" alt="trajectory distance"></p><p>æœ€ç»ˆçš„æ€»è·ç¦»ä¸ºï¼š<br>$$<br>dist(L_i;L_j) = w_{\bot} d_{\bot}(Li;Lj)+w_{\parallel} d_{\parallel}(Li;Lj)+w_{\theta} d_{\theta}(Li;Lj )<br>$$<br>å…¶ä¸­æƒé‡ä¸ºé»˜è®¤å‡ä¸º1ï¼Œæ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯å¯ä»¥ä¿®æ”¹æƒé‡ã€‚</p><h4 id="Partitionå¤„ç†"><a href="#Partitionå¤„ç†" class="headerlink" title="Partitionå¤„ç†"></a>Partitionå¤„ç†</h4><p>è½¨è¿¹çš„åˆ†æ®µä¸»è¦æ˜¯é€šè¿‡MDLï¼ˆæœ€å°æè¿°é•¿åº¦ï¼‰ç®—æ³•ã€‚é€šè¿‡æ‰¾åˆ°è½¨è¿¹çš„ç‰¹å¾ç‚¹æ¥ç¡®å®špartitionï¼Œé€šè¿‡è®¡ç®—ä¸¤ä¸ªç‚¹ä¹‹é—´å­˜åœ¨partitionç‰¹å¾ç‚¹æ—¶çš„MDLå¼€é”€å’Œä¸å­˜åœ¨partitionç‰¹å¾ç‚¹æ—¶çš„å¼€é”€ï¼Œè¿›è¡Œå¯¹æ¯”ï¼Œä»è€Œç¡®å®šç‰¹å¾ç‚¹ï¼Œå¹¶æ ‡è®°å‡ºæ¥ï¼Œç®—æ³•ç›¸å¯¹è¾ƒç®€å•ã€‚æœ€ç»ˆå°†è½¨è¿¹åˆ’åˆ†ä¸ºäº†Segmentï¼Œå…·ä½“ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/uploads/traj_partition.png" srcset="/img/loading.gif" alt="trajectory partition"></p><p>é€šè¿‡pythonå®ç°åå¾—åˆ°çš„æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="/uploads/trajectory_partition_theta_5.png" srcset="/img/loading.gif" alt="trajectory partition result"></p><h4 id="èšç±»"><a href="#èšç±»" class="headerlink" title="èšç±»"></a>èšç±»</h4><p>åŸºæœ¬æ€æƒ³å’ŒDBSCANç®—æ³•ä¸€è‡´ï¼Œç»™å®šæ‰€æœ‰è½¨è¿¹çš„Segmenté›†åˆï¼Œè¾“å‡ºèšç±»çš„é›†åˆã€‚ç®—æ³•ä¸»è¦åˆ†ä¸º3ä¸ªæ­¥éª¤ï¼Œä¸‹é¢å¯¹è¿™3ä¸ªæ­¥éª¤è¿›è¡Œç®€è¦è¯´æ˜ï¼š</p><ol><li>å¯¹äºæ¯ä¸€æ¡æœªåˆ†ç±»çš„çº¿æ®µLï¼Œç®—æ³•è®¡ç®—å…¶çš„$\epsilon$é‚»åŸŸä»¥åˆ¤æ–­è¯¥çº¿æ®µæ˜¯å¦ä¸ºæ ¸å¿ƒçº¿æ®µã€‚è‹¥Lä¸ºæ ¸å¿ƒçº¿æ®µï¼Œåˆ™ç¨‹åºè·³è½¬ç¬¬2æ­¥ã€‚ </li><li>è®¡ç®—æ ¸å¿ƒçº¿æ®µçš„å¯†åº¦ç›¸è¿é›†åˆå¹¶æŠŠå…¶åŠ å…¥è¯¥æ ¸å¿ƒçº¿æ®µç»„æˆçš„ç°‡ä¸­ã€‚å¦‚æœæ–°åŠ å…¥çš„çº¿æ®µæœªè¢«åˆ†ç±»ï¼Œåˆ™æŠŠå…¶åŠ å…¥é˜Ÿåˆ—Qä¸­ä»¥åšè¿›ä¸€æ­¥æ‰©å±•ï¼Œå› ä¸ºè¯¥çº¿æ®µå¯èƒ½æ˜¯æ ¸å¿ƒçº¿æ®µï¼›è‹¥æ–°åŠ å…¥çš„çº¿æ®µä¸æ˜¯æ ¸å¿ƒçº¿æ®µï¼Œåˆ™ä¸åŠ å…¥é˜Ÿåˆ—Qä¸­ã€‚ </li><li>è®¡ç®—æ¯ä¸ªç°‡çš„åŸºæ•°ï¼Œè‹¥å…¶å€¼å°äºé˜ˆå€¼ï¼Œåˆ™ç®—æ³•å°†è¯¥ç°‡æ·˜æ±°ï¼Œå› ä¸ºå…¶ä¸å¤Ÿå¯†é›†ã€‚ </li></ol><p>å¯è§†åŒ–éƒ¨åˆ†å°±ä¸è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒè®ºæ–‡ã€‚ä¸‹é¢æ˜¯å°†æ•´ä¸ªç®—æ³•å®ç°åï¼Œä½¿ç”¨æµ‹è¯•æ•°æ®æµ‹è¯•åçš„æ•ˆæœï¼Œç®—æ³•å¯ä»¥è®¾ç½®ä¸åŒçš„å‚æ•°ï¼Œå¾—åˆ°çš„æ•ˆæœä¸åŒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/uploads/trajectory-major.png" srcset="/img/loading.gif" alt="èšç±»å’Œå¯è§†åŒ–æ•ˆæœ"></p><h3 id="ä»£ç å¼€æº"><a href="#ä»£ç å¼€æº" class="headerlink" title="ä»£ç å¼€æº"></a>ä»£ç å¼€æº</h3><p>GitHub: trajectory-cluster-<a href="https://github.com/MillerWu2014/trajectory-cluster" target="_blank" rel="noopener">https://github.com/MillerWu2014/trajectory-cluster</a></p>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>trajectory</tag>
      
      <tag>cluster</tag>
      
      <tag>partition</tag>
      
      <tag>spatial</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>boostingç³»åˆ—ä¹‹LightGBMç®—æ³•è¯¦è§£</title>
    <link href="/2019/07/16/boosting%E7%B3%BB%E5%88%97%E4%B9%8BLightGBM%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3/"/>
    <url>/2019/07/16/boosting%E7%B3%BB%E5%88%97%E4%B9%8BLightGBM%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="LightGBMç®€ä»‹"><a href="#LightGBMç®€ä»‹" class="headerlink" title="LightGBMç®€ä»‹"></a>LightGBMç®€ä»‹</h2><p><code>LightGBM</code>æ˜¯ç”±å¾®è½¯å›¢é˜ŸåŸºäº<code>xgboost</code>çš„ç¼ºç‚¹æ–°çš„å®ç°ï¼Œä¸»è¦æ€æƒ³è¿˜æ˜¯åŸºäº<code>GBDT</code>ç®—æ³•ï¼Œåœ¨ç»†èŠ‚ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨æ•ˆç‡å’Œç²¾åº¦æ–¹é¢éƒ½è¶…è¿‡äº†<code>xgboost</code>çš„å®ç°ã€‚å¹¶ä¸”æ”¯æŒåˆ†å¸ƒå¼å¹¶è¡Œï¼ŒåŒ…æ‹¬ç‰¹å¾å¹¶è¡Œï¼Œæ•°æ®å¹¶è¡Œä»¥åŠGPUå¹¶è¡Œè®¡ç®—ã€‚ä¸‹é¢å°±å¯¹è¯¥ç®—æ³•çš„åŸç†å’Œç»†èŠ‚è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</p><p><code>LightGBM</code>ä¸»è¦é’ˆå¯¹<code>xgboost</code>æˆ–<code>gbdt</code>ä¸­ç‰¹å¾åˆ†è£‚è¿›è¡Œäº†ä¼˜åŒ–ï¼Œ<code>xgb</code>å’Œå…¶ä»–<code>gbdt</code>çš„å®ç°ä¸­éƒ½é‡‡ç”¨äº†<code>pre-sort</code>ï¼Œè¿™ç§æ–¹å¼å¯¹å†…å­˜æ¶ˆè€—å’Œè®­ç»ƒé€Ÿåº¦ä¸Šæ•ˆç‡éƒ½éå¸¸ä½ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§å®ç°å°±æ˜¯é€šè¿‡ç›´æ–¹å›¾ç®—æ³•ï¼ˆhistogram-based algorithmï¼‰å› æ­¤ï¼Œ<code>LightGBM</code>é‡‡ç”¨<code>histogram</code>ç®—æ³•æ¥å¯¹æ¯ä¸ªç‰¹å¾çš„åˆ†è£‚è¿›è¡Œä¼˜åŒ–ã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†å‡å°è®­ç»ƒæ•°æ®é›†ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸‹é‡‡ç”¨ï¼Œæˆ–è€…é€šè¿‡é˜ˆå€¼çš„æ–¹å¼æ¥è¿‡æ»¤æ‰æƒé‡è¾ƒå°çš„æ•°æ®ã€‚åŒæ ·ï¼Œå¯ä»¥é€šè¿‡è¿‡æ»¤æ‰å¼±ç‰¹å¾æ¥å‡å°‘ç‰¹å¾é‡ï¼Œä»è€Œåœ¨æ¯æ¬¡è®­ç»ƒå¼±åˆ†ç±»å™¨çš„è¿‡ç¨‹ä¸­æå‡æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡ã€‚ä½†æ˜¯<code>GBDT</code>ä¸­å¹¶æ²¡æœ‰æ ·æœ¬æƒé‡çš„æŒ‡æ ‡ï¼Œä¸‹é¢å°±åŸºäº<code>LightGBM</code>è®ºæ–‡ä¸­æå‡ºçš„ç‚¹è¿›è¡Œè¯¦ç»†æè¿°ã€‚</p><a id="more"></a><h2 id="ç®—æ³•è¿‡ç¨‹"><a href="#ç®—æ³•è¿‡ç¨‹" class="headerlink" title="ç®—æ³•è¿‡ç¨‹"></a>ç®—æ³•è¿‡ç¨‹</h2><p>ä¸»è¦å¯¹<code>LigthGBM</code>ä¸­çš„ç›´æ–¹å›¾ç®—æ³•ï¼Œ<code>GOSS</code>ç®—æ³•ä»¥åŠ<code>EFB</code>è¿›è¡Œè¯¦ç»†çš„è¯´æ˜å’Œç®—æ³•è¿‡ç¨‹æè¿°ï¼Œè¿™ä¸‰ä¸ªç‚¹æ˜¯è¯¥ç®—æ³•ä¸­æœ€æ ¸å¿ƒçš„ä¼˜åŒ–å’Œç»†èŠ‚å®ç°ã€‚å¹¶å¯¹è¿™ä¸‰ä¸ªç‚¹çš„ä½œç”¨è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="histogramç®—æ³•"><a href="#histogramç®—æ³•" class="headerlink" title="histogramç®—æ³•"></a>histogramç®—æ³•</h3><p>ç›´æ–¹å›¾ç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å…ˆæŠŠè¿ç»­çš„æµ®ç‚¹ç‰¹å¾å€¼ç¦»æ•£åŒ–æˆkä¸ªæ•´æ•°ï¼ŒåŒæ—¶æ„é€ ä¸€ä¸ªå®½åº¦ä¸ºkçš„ç›´æ–¹å›¾ã€‚åœ¨éå†æ•°æ®çš„æ—¶å€™ï¼Œæ ¹æ®ç¦»æ•£åŒ–åçš„å€¼ä½œä¸ºç´¢å¼•åœ¨ç›´æ–¹å›¾ä¸­ç´¯ç§¯ç»Ÿè®¡é‡ï¼Œå½“éå†ä¸€æ¬¡æ•°æ®åï¼Œç›´æ–¹å›¾ç´¯ç§¯äº†éœ€è¦çš„ç»Ÿè®¡é‡ï¼Œç„¶åæ ¹æ®ç›´æ–¹å›¾çš„ç¦»æ•£å€¼ï¼Œéå†å¯»æ‰¾æœ€ä¼˜çš„åˆ†å‰²ç‚¹ã€‚ä¸‹é¢æ˜¯<code>histogram</code>çš„è¿‡ç¨‹ï¼š</p><p><img src="/uploads/1563269661109.png" srcset="/img/loading.gif" alt="1563269661109"></p><p>ä»ä¸Šé¢çš„ç›´æ–¹å›¾ç®—æ³•æµç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦å¯¹ç‰¹å¾è¿›è¡Œç¦»æ•£åŒ–ï¼Œè½¬åŒ–ä¸ºbin valueã€‚é€šè¿‡åˆ†æ®µå‡½æ•°å°†ç‰¹å¾å–å€¼åˆ’åˆ†åˆ°æŸä¸ªbinä¸­ã€‚ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œç¬¬äºŒä¸ª<code>for</code>å¾ªç¯å¼€å§‹ï¼Œæ˜¯éå†<code>node</code>é›†åˆï¼Œå³åˆ›å»ºçš„æ¯ä¸ªæ ‘æ¨¡å‹ï¼›ç¬¬ä¸‰ä¸ª<code>for</code>å¾ªç¯å¼€å§‹éå†æ‰€æœ‰çš„ç‰¹å¾ï¼ˆmä¸ªç‰¹å¾ï¼‰ï¼Œä¸ºæ¯ä¸ªç‰¹å¾åˆ›å»ºä¸€ä¸ª<code>Histogram</code>å¯¹è±¡ï¼›åœ¨ç¬¬å››ä¸ª<code>for</code>å¾ªç¯å¼€å§‹éå†æ‰€æœ‰çš„æ ·æœ¬ï¼Œæ¥æ„å»ºç›´æ–¹å›¾ï¼Œåœ¨è¿™é‡Œä¸»è¦åšäº†2ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ˜¯ç»Ÿè®¡æ¯ä¸ªbinä¸‹æ ·æœ¬çš„ä¸ªæ•°ï¼Œä¸æ–­æ›´æ–°æ¯ä¸ªbinä¸‹çš„æ ·æœ¬æ•°ï¼Œå¦å¤–ä¸€ä¸ªæ“ä½œå°±æ˜¯ä¸æ–­æ›´æ–°æ¯ä¸ªbinä¸‹æ¢¯åº¦å’Œï¼Œè®¡ç®—æ¯ä¸ªbinä¸­æ ·æœ¬çš„æ¢¯åº¦å’Œã€‚åé¢å¼€å§‹åŸºäºbinæ¥æ‰¾æœ€ä½³åˆ†è£‚ã€‚</p><h3 id="Gradient-based-One-Side-Sampling-GOSS"><a href="#Gradient-based-One-Side-Sampling-GOSS" class="headerlink" title="Gradient-based One-Side Sampling (GOSS)"></a>Gradient-based One-Side Sampling (GOSS)</h3><p>åœ¨<code>AdaBoost</code>ä¸­ï¼Œæ ·æœ¬æƒé‡æ˜¯æ•°æ®æ ·æœ¬çš„é‡è¦æ€§æŒ‡æ ‡ï¼Œä½†æ˜¯åœ¨<code>GBDT</code>ä¸­å¹¶æ²¡æœ‰æ ·æœ¬æƒé‡ï¼Œä¸èƒ½é€šè¿‡æƒé‡æ¥å¯¹æ ·æœ¬è¿›è¡Œé‡‡æ ·ã€‚ä¸è¿‡åœ¨<code>GBDT</code>ä¸­å­˜åœ¨æ¯ä¸ªæ•°æ®ä¸åŒçš„æ¢¯åº¦å€¼ï¼Œè€Œè¿™ä¸ªä¿¡æ¯å¯¹é‡‡ç”¨éå¸¸æœ‰ç”¨ï¼Œ<strong>å³å®ä¾‹çš„æ¢¯åº¦å°ï¼Œå®ä¾‹è®­ç»ƒè¯¯å·®ä¹Ÿå°±è¾ƒå°ï¼Œå·²ç»è¢«å­¦ä¹ å¾—å¾ˆå¥½äº†ï¼Œç›´æ¥æƒ³æ³•å°±æ˜¯ä¸¢æ‰è¿™éƒ¨åˆ†æ¢¯åº¦å°çš„æ•°æ®</strong>ï¼Œä½†æ˜¯ç›´æ¥è¿™æ ·åšä¼šå¯¼è‡´æ•°æ®çš„åˆ†å¸ƒè¢«æ”¹å˜ï¼Œä»è€Œå½±å“è®­ç»ƒæ¨¡å‹çš„ç²¾åº¦ï¼Œè€ŒGOSSå³æ˜¯è§£å†³è¯¥é—®é¢˜è€Œæå‡ºã€‚</p><p><code>GOSS</code>ç®€å•çš„æè¿°å°±æ˜¯ä¿ç•™æ¢¯åº¦è¾ƒå¤§çš„æ ·æœ¬ï¼Œåœ¨æ¢¯åº¦è¾ƒå°çš„å®ä¾‹ä¸Šè¿›è¡Œéšæœºé‡‡æ ·ã€‚ä¸ºäº†æŠµæ¶ˆå¯¹æ•°æ®åˆ†å¸ƒçš„å½±å“ï¼Œè®¡ç®—ä¿¡æ¯å¢ç›Šçš„æ—¶å€™ï¼Œ<code>GOSS</code>å¯¹å°æ¢¯åº¦çš„æ•°æ®å¼•å…¥å¸¸é‡ä¹˜æ•°ã€‚<code>GOSS</code>é¦–å…ˆæ ¹æ®æ•°æ®çš„æ¢¯åº¦ç»å¯¹å€¼æ’åºï¼Œé€‰å–<code>top a</code>ä¸ªå®ä¾‹ã€‚ç„¶ååœ¨å‰©ä½™çš„æ•°æ®ä¸­éšæœºé‡‡æ ·<code>b</code>ä¸ªå®ä¾‹ã€‚åœ¨è®¡ç®—ä¿¡æ¯å¢ç›Šæ—¶ä¸ºé‡‡æ ·å‡ºçš„å°æ¢¯åº¦æ ·æœ¬ä¹˜ä»¥$\frac {1-a} {b}$çš„æƒé‡ï¼Œè¿™æ ·åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ¨¡å‹ä¼šæ›´å…³æ³¨è®­ç»ƒä¸è¶³çš„å®ä¾‹ï¼Œè€Œä¸ä¼šè¿‡å¤šæ”¹å˜åŸæ•°æ®é›†çš„åˆ†å¸ƒã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹:</p><p><img src="/uploads/1563331674809.png" srcset="/img/loading.gif" alt="1563331674809"></p><p>åœ¨è¿­ä»£ï¼ˆæ¯ä¸ªè¿­ä»£å°±æ˜¯ä¸€ä¸ªå¼±åˆ†ç±»å™¨ï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨æ¨¡å‹é¢„æµ‹è®­ç»ƒé›†çš„ç›®æ ‡å€¼ï¼Œå†è®¡ç®—<code>Loss</code>çš„æ¢¯åº¦å€¼ï¼Œå¹¶æ›´æ–°æ¯ä¸ªæ ·æœ¬çš„æ¢¯åº¦<code>g</code>å’Œæ¯ä¸ªæ ·æœ¬çš„æƒé‡<code>w</code>ï¼Œå†å¯¹æ‰€æœ‰æ ·æœ¬çš„æ¢¯åº¦å€¼è¿›è¡Œæ’åºï¼Œé€‰å–æ¢¯åº¦å€¼å¤§çš„<code>TOP N</code>ã€‚åœ¨å‰©ä¸‹çš„æ ·æœ¬ä¸­åœ¨éšæœºæŠ½å–<code>TOP N</code>ä¸ªæ ·æœ¬ï¼Œç»„åˆä¸ºæ–°çš„è®­ç»ƒé›†ã€‚å¹¶å†æ¥æ›´æ–°æ–°çš„æ ·æœ¬æƒé‡ï¼ˆå°æ¢¯åº¦æ ·æœ¬ä¹˜ä»¥<code>frac</code>ï¼‰ï¼Œå†è®­ç»ƒæ¨¡å‹ã€‚</p><h3 id="Exclusive-Feature-Bundling-EFB"><a href="#Exclusive-Feature-Bundling-EFB" class="headerlink" title="Exclusive Feature Bundling (EFB)"></a><strong>Exclusive Feature Bundling (EFB)</strong></h3><p>ä¸Šé¢çš„GOSSä¸»è¦æ˜¯å‡å°‘æ ·æœ¬æ•°é‡æ¥æå‡æ•ˆç‡ã€‚è€ŒEFBä¸»è¦å¯ä»¥ç†è§£ä¸ºäº’æ–¥ç‰¹å¾ç»‘å®šï¼Œå³å‡å°‘ç‰¹å¾çš„æ•°é‡ï¼Œä»è€Œæ¥æå‡è®­ç»ƒæ•ˆç‡ã€‚ä¸€èˆ¬åœ¨å»ºæ¨¡è¿‡ç¨‹ä¸­ï¼Œé«˜çº¬åº¦çš„æ•°æ®æ˜¯ç¨€ç–çš„ï¼Œæ—¢ç„¶æ˜¯ç¨€ç–çš„ï¼Œé‚£ä¹ˆèƒ½é€šè¿‡ä¸€ç§æ–¹å¼æ¥å‡å°‘ç‰¹å¾ç»´åº¦ä¹ˆï¼Ÿåœ¨é«˜ç»´å’Œç¨€ç–çš„ç‰¹å¾ç©ºé—´ä¸­ï¼Œå¾ˆå¤šç‰¹å¾æ˜¯äº’æ–¥çš„ï¼Œå³ä¸åŒæ—¶ä¸ºé0å€¼ã€‚é‚£ä¹ˆï¼Œå°±æå‡ºäº†ä¸€ç§å°†äº’æ–¥ç‰¹å¾è¿›è¡Œç»‘å®šä¸ºä¸€ä¸ªå•ä¸€çš„ç‰¹å¾ï¼Œæ¥å‡å°‘ç‰¹å¾ç»´åº¦ã€‚å¾®è½¯ç ”ç©¶å›¢é˜Ÿè®¾è®¡äº†ä¸€ç§å°†äº’æ–¥ç‰¹å¾æ†ç»‘åçš„ç‰¹å¾æ„å»ºä¸å•ä¸ªç‰¹å¾ç›¸åŒçš„ç›´æ–¹å›¾ï¼Œè¿™æ ·æ„å»ºç›´æ–¹å›¾çš„å¤æ‚åº¦ä»<code>O(#data*#feature)</code>å˜ä¸º<code>O(#data*#bundle)</code>ï¼Œè¿™æ ·æå‡äº†æ•ˆç‡ï¼Œè€Œä¸é™ä½æ¨¡å‹ç²¾åº¦ã€‚ä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨2ä¸ªå…³é”®çš„é—®é¢˜ï¼š</p><ol><li>å¦‚ä½•åˆ¤æ–­å“ªäº›ç‰¹å¾åº”è¯¥ç»‘å®šåœ¨ä¸€èµ·å‘¢ï¼Ÿï¼ˆä¸Šé¢æ—¶å€™è¿›è¡Œç»‘å®šï¼‰</li><li>æ€ä¹ˆå°†ç‰¹å¾ç»‘å®šåœ¨ä¸€èµ·å‘¢ï¼Ÿï¼ˆå¦‚ä½•ç»‘å®šï¼‰</li></ol><h4 id="ç‰¹å¾ç»‘å®š-bundle"><a href="#ç‰¹å¾ç»‘å®š-bundle" class="headerlink" title="ç‰¹å¾ç»‘å®š(bundle)"></a>ç‰¹å¾ç»‘å®š(bundle)</h4><p><code>LightGBM</code>ç®—æ³•ä¸­é‡‡ç”¨äº†â€å›¾ç€è‰²â€ä¸€ç±»é—®é¢˜è¿›è¡Œè§£å†³ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå›¾G(v, e)ï¼Œå…¶ä¸­vå°±æ˜¯ç‰¹å¾ï¼Œä¸ºå›¾ä¸­çš„èŠ‚ç‚¹ï¼Œeä¸ºGä¸­çš„è¾¹ï¼Œå°†ä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ç‰¹å¾ç”¨ä¸€æ¡è¾¹è¿æ¥èµ·æ¥ï¼Œè¾¹çš„æƒé‡å°±æ˜¯ä¸¤ä¸ªç›¸è¿æ¥çš„ç‰¹å¾çš„æ€»å†²çªå€¼ï¼Œè¿™æ ·éœ€è¦ç»‘å®šçš„ç‰¹å¾å°±æ˜¯åœ¨å›¾ç€è‰²é—®é¢˜ä¸­è¦æ¶‚ä¸ŠåŒä¸€ç§é¢œè‰²çš„é‚£äº›ç‚¹ï¼ˆç‰¹å¾ï¼‰ã€‚å…·ä½“ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/uploads/1563334789846.png" srcset="/img/loading.gif" alt="1563334789846"></p><h4 id="ç‰¹å¾åˆå¹¶-merging-feature"><a href="#ç‰¹å¾åˆå¹¶-merging-feature" class="headerlink" title="ç‰¹å¾åˆå¹¶(merging feature)"></a>ç‰¹å¾åˆå¹¶(merging feature)</h4><p>è¯¥è¿‡ç¨‹ä¸»è¦æ˜¯<strong>å…³é”®åœ¨äºåŸå§‹ç‰¹å¾å€¼å¯ä»¥ä»<code>bundle</code>ä¸­åŒºåˆ†å‡ºæ¥</strong>ï¼Œå³ç»‘å®šå‡ ä¸ªç‰¹å¾åœ¨åŒä¸€ä¸ªbundleé‡Œéœ€è¦ä¿è¯ç»‘å®šå‰çš„åŸå§‹ç‰¹å¾çš„å€¼å¯ä»¥åœ¨bundleä¸­è¯†åˆ«ï¼Œè€ƒè™‘åˆ°<code>histogram-based</code>ç®—æ³•å°†è¿ç»­çš„å€¼ä¿å­˜ä¸ºç¦»æ•£çš„<code>bins</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å¾—ä¸åŒç‰¹å¾çš„å€¼åˆ†åˆ°<code>bundle</code>ä¸­çš„ä¸åŒ<code>bins</code>ä¸­ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨ç‰¹å¾å€¼ä¸­åŠ ä¸€ä¸ªåç½®å¸¸é‡æ¥è§£å†³ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨bundleä¸­ç»‘å®šäº†ä¸¤ä¸ªç‰¹å¾Aå’ŒBï¼ŒAç‰¹å¾çš„åŸå§‹å–å€¼ä¸ºåŒºé—´[0,10)ï¼ŒBç‰¹å¾çš„åŸå§‹å–å€¼ä¸ºåŒºé—´[0,20ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Bç‰¹å¾çš„å–å€¼ä¸ŠåŠ ä¸€ä¸ªåç½®å¸¸é‡10ï¼Œå°†å…¶å–å€¼èŒƒå›´å˜ä¸º[10,30ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥æ”¾å¿ƒçš„èåˆç‰¹å¾Aå’ŒBäº†ï¼Œå› ä¸ºåœ¨æ ‘æ¨¡å‹ä¸­å¯¹äºæ¯ä¸€ä¸ªç‰¹å¾éƒ½ä¼šè®¡ç®—åˆ†è£‚èŠ‚ç‚¹çš„ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å°†ä»–ä»¬çš„å–å€¼èŒƒå›´é™å®šåœ¨ä¸åŒçš„<code>bins</code>ä¸­ï¼Œåœ¨åˆ†è£‚æ—¶å¯ä»¥å°†ä¸åŒç‰¹å¾å¾ˆå¥½çš„åˆ†è£‚åˆ°æ ‘çš„ä¸åŒåˆ†æ”¯ä¸­å»ã€‚å…·ä½“ç®—æ³•å¦‚ä¸‹ï¼š</p><p><img src="/uploads/1563335082001.png" srcset="/img/loading.gif" alt="1563335082001"></p><h2 id="å‚è€ƒæŒ‡å—"><a href="#å‚è€ƒæŒ‡å—" class="headerlink" title="å‚è€ƒæŒ‡å—"></a>å‚è€ƒæŒ‡å—</h2><ol><li><a href="https://lightgbm.apachecn.org/#/" target="_blank" rel="noopener">LightGBMä¸­æ–‡æ–‡æ¡£</a></li><li><a href="https://papers.nips.cc/paper/6907-lightgbm-a-highly-efficient-gradient-boosting-decision-tree.pdf" target="_blank" rel="noopener">å®˜æ–¹è®ºæ–‡åœ°å€</a></li><li><a href="https://blog.csdn.net/shine19930820/article/details/79123216" target="_blank" rel="noopener">LightGBMåŸç†-LightGBM: A Highly Efficient Gradient Boosting Decision Tree</a></li><li><a href="https://blog.csdn.net/anshuai_aw1/article/details/83048709" target="_blank" rel="noopener">Lightgbmæºè®ºæ–‡è§£æï¼šLightGBM: A Highly Efficient Gradient Boosting Decision Tree</a></li><li><a href="https://www.msra.cn/zh-cn/news/features/lightgbm-20170105" target="_blank" rel="noopener">LightGBMæ¨¡å‹ä¸­çš„æ”¹è¿›ç»†èŠ‚</a></li><li><a href="https://blog.csdn.net/anshuai_aw1/article/details/83040541" target="_blank" rel="noopener">Lightgbm ç›´æ–¹å›¾ä¼˜åŒ–ç®—æ³•æ·±å…¥ç†è§£</a></li><li><a href="https://www.deeplearn.me/2315.html" target="_blank" rel="noopener">LightGbmä¹‹ç›´æ–¹å›¾ä¼˜åŒ–ç†è§£</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>boosting</tag>
      
      <tag>gbdt</tag>
      
      <tag>lightgbm</tag>
      
      <tag>goss</tag>
      
      <tag>histogram</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonä¸­å®ç°å¤šçº¿ç¨‹(çœŸæ­£çš„)çš„æ¢ç´¢</title>
    <link href="/2019/06/25/Python%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B(%E7%9C%9F%E6%AD%A3%E7%9A%84)%E7%9A%84%E6%8E%A2%E7%B4%A2/"/>
    <url>/2019/06/25/Python%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B(%E7%9C%9F%E6%AD%A3%E7%9A%84)%E7%9A%84%E6%8E%A2%E7%B4%A2/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨Pythonå¤šçº¿ç¨‹çš„äººéƒ½çŸ¥é“ï¼ŒPythonä¸­ç”±äºGIL(å…¨å±€è§£é‡Šé”ï¼š<code>Global Interpreter Lock</code>)çš„å­˜åœ¨ï¼Œåœ¨å¤šçº¿ç¨‹æ—¶å¹¶æ²¡æœ‰çœŸæ­£çš„è¿›è¡Œå¤šçº¿ç¨‹è®¡ç®—ã€‚çŸ¥é“Pythonå†å²çš„å°±çŸ¥é“Pythonåœ¨1989å¹´å‘å¸ƒï¼Œå½“æ—¶è®¡ç®—æœºå…¨æ˜¯åŸºäºå•æ ¸ï¼ŒçŸ¥é“2000å¤šå¹´å¤šæ ¸å¤„ç†å™¨æ‰å‘å¸ƒã€‚å› æ­¤ï¼ŒGILä¸€è‡´æ²¿ç”¨åˆ°ç°åœ¨ï¼Œè€Œä¸”æ²¡æœ‰éå¸¸å¥½çš„æ›¿ä»£æ–¹å¼ã€‚å¦‚æœæ¶‰åŠåˆ°è®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡ï¼Œåœ¨å¤šæ ¸CPUçš„åŠ æŒä¸‹ä½¿å¾—æ•ˆç‡æ€¥é€Ÿä¸Šå‡ï¼Œå¦‚æœæ˜¯IOå¯†é›†å‹çš„æ•ˆæœå¯èƒ½æ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾ã€‚è¿™ä¸ªPythonçš„å®˜ç½‘ä¹Ÿè¿›è¡Œäº†è¯´æ˜ã€‚ä¸ºäº†è¯´æ˜Pythonçš„å¤šçº¿ç¨‹é—®é¢˜ï¼Œä¸‹é¢å¯ä»¥é€šè¿‡ä¸€äº›ä»£ç æ¥å®ç°Pythonå¤šçº¿ç¨‹çš„éªŒè¯ã€‚</p><h2 id="Pythonå’ŒC-å¤šçº¿ç¨‹çš„å¯¹æ¯”"><a href="#Pythonå’ŒC-å¤šçº¿ç¨‹çš„å¯¹æ¯”" class="headerlink" title="Pythonå’ŒC++å¤šçº¿ç¨‹çš„å¯¹æ¯”"></a>Pythonå’ŒC++å¤šçº¿ç¨‹çš„å¯¹æ¯”</h2><p>é¦–å…ˆä½¿ç”¨Pythonä¸­çš„å¤šçº¿ç¨‹è¿è¡Œï¼Œè§‚å¯ŸCPUçš„æƒ…å†µï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œä¸è¿›è¡Œä»»ä½•è®¡ç®—ï¼Œä½†æ˜¯ä¸€è‡´ä¿æŒè¿è¡Œå³å¯ï¼Œå†æŸ¥çœ‹CPUçš„æƒ…å†µï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="python">from concurrent.futures import ThreadPoolExecutordef f(a):    while 1:        passif __name__ == &#39;__main__&#39;:    pool = ThreadPoolExecutor()    pool.map(f, range(100))</code></pre><p>CPUçš„æƒ…å†µå¦‚ä¸‹,ä¹æ„çœ‹å‡ºåªæœ‰å…¶ä¸­ä¸€ä¸ªCPUçš„ä½¿ç”¨ç‡ä¸º100%ä»¥ä¸Šï¼Œå…¶ä»–æ²¡æœ‰ä½¿ç”¨ï¼Œè€Œä¸”æ¯æ¬¡åªè¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šPythonçš„å¤šçº¿ç¨‹å¹¶æ²¡æœ‰åˆ©ç”¨å¤šæ ¸è¿è¡Œã€‚    <img src="/uploads/1561516460850.png" srcset="/img/loading.gif" alt="1561516460850"></p><a id="more"></a><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨C++çš„å¤šçº¿ç¨‹æ¥è¿›è¡Œæµ‹è¯•ï¼Œä½¿ç”¨åŒæ ·çš„æ–¹å¼ï¼Œä¸‹é¢æ˜¯c++å¤šçº¿ç¨‹çš„ç®€å•å®ç°ï¼Œfå‡½æ•°ä¹Ÿæ˜¯ä¸€ç›´ä¿æŒè¿è¡Œï¼Œä¾¿äºåé¢çš„CPUä½¿ç”¨æƒ…å†µè§‚å¯Ÿï¼š</p><pre><code class="c++">#include &lt;thread&gt;#define NUM_THREADS 50using namespace std;void f(){    while(1){        continue;    };}void run_thread(){    std::thread threads[NUM_THREADS];    for(int i = 0; i &lt; NUM_THREADS; ++i)    {        threads[i] = std::thread(f);    }    for (int i = 0; i &lt; NUM_THREADS; ++i) {        threads[i].join();    }};int main(void){    run_thread();}</code></pre><p>ç»è¿‡ç¼–è¯‘åå¹¶è¿è¡Œï¼š<code>g++ -pthread -std=c++11 ./main_thread_cpp.cpp &amp;&amp; ./a.out</code>ï¼ŒCPUçš„ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹å‡ºCPUçš„ä½¿ç”¨ç‡ä¸º1200%ï¼Œ12æ ¸å…¨éƒ¨ä¸º100%çš„ä½¿ç”¨ç‡ï¼Œå¤šçº¿ç¨‹çœŸæ­£ä½¿ç”¨äº†å¤šæ ¸ã€‚é‚£ä¹ˆæˆ‘ä»¬<strong>èƒ½å°† pythonçš„å¤šçº¿ç¨‹æ”¹ä¸ºå¤šæ ¸çš„å¤šçº¿ç¨‹ä¹ˆ</strong>ï¼Ÿ</p><p><img src="/uploads/1561516889704.png" srcset="/img/loading.gif" alt="1561516889704"></p><h2 id="Pythonå¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¢ç´¢"><a href="#Pythonå¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¢ç´¢" class="headerlink" title="Pythonå¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¢ç´¢"></a>Pythonå¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¢ç´¢</h2><p>æˆ‘ä»¬çŸ¥é“Pythonä¸­çš„å¤šçº¿ç¨‹ä¸»è¦æ˜¯ç”±äºGILçš„å­˜åœ¨ï¼Œå¤šçº¿ç¨‹ä¹‹é—´ç›¸äº’ç«äº‰ï¼Œè€ŒPythonçš„å®˜ç½‘æ–‡æ¡£<code>C API Reference Manua</code>å¯¹GILè¿›è¡Œäº†è¯¦ç»†çš„è¯´æ˜ã€‚GILåªç”¨æ¥é™åˆ¶<code>pure python code</code>ï¼Œå¯¹å…¶ä»–çš„æ²¡æœ‰é™åˆ¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æµ‹è¯•æ¥éªŒè¯è¿™ä¸ªideaã€‚ä¸‹é¢å°±è¿›è¡ŒéªŒè¯ã€‚</p><h3 id="Pythonå¤šçº¿ç¨‹è°ƒç”¨C-ä¸­çš„å¤šçº¿ç¨‹"><a href="#Pythonå¤šçº¿ç¨‹è°ƒç”¨C-ä¸­çš„å¤šçº¿ç¨‹" class="headerlink" title="Pythonå¤šçº¿ç¨‹è°ƒç”¨C++ä¸­çš„å¤šçº¿ç¨‹"></a>Pythonå¤šçº¿ç¨‹è°ƒç”¨C++ä¸­çš„å¤šçº¿ç¨‹</h3><p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨pythonæ¥è°ƒç”¨C++çš„å¤šçº¿ç¨‹ä»£ç ï¼Œæ¥è§‚å¯ŸCPUçš„ä½¿ç”¨æƒ…å†µï¼Œæ¥éªŒè¯ä¹‹å‰çš„ç»“è®ºï¼Œè¿™é‡Œä½¿ç”¨pybind11æ¥è¿›è¡Œæ··åˆç¼–ç¨‹ï¼Œä¸‹é¢æ˜¯c++ä»£ç ï¼Œå¤šçº¿ç¨‹æ¥ç›´çº¿ä»»åŠ¡ï¼š</p><pre><code class="c++">#include &lt;thread&gt;#include &quot;pybind11/pybind11.h&quot;#define NUM_THREADS 50using namespace std;namespace py = pybind11;void f(){    while(1){        continue;    }}py::none nothing(){    std::thread threads[NUM_THREADS];    for(int i = 0; i &lt; NUM_THREADS; ++i)    {        threads[i] = std::thread(f);    }    for (int i = 0; i &lt; NUM_THREADS; ++i) {        threads[i].join();    }    return py::none();}PYBIND11_MODULE(example, m){    m.def(&quot;nothing&quot;, &amp;nothing, &quot;do nothing&quot;);}</code></pre><p>é€šè¿‡ä¸‹é¢çš„ç¼–è¯‘ï¼Œå¾—åˆ°ä¸€ä¸ªexampleçš„<code>.so</code>æ–‡ä»¶çš„åŒ…ï¼Œå†ä½¿ç”¨pythonæ¥è°ƒç”¨åŒ…é‡Œé¢çš„<code>nothing</code>å‡½æ•°ï¼Œå†è§‚å¯ŸCPUçš„è¿è¡Œæƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º.</p><pre><code class="shell">g++ -O3 -Wall -shared -std=c++11 -fPICpython3 -m pybind11 --includesmix_thread.cpp -o examplepython3-config --extension-suffix`</code></pre><pre><code class="python">from example import nothingfrom concurrent.futures import ThreadPoolExecutorpool = ThreadPoolExecutor()for i in range(12):    pool.submit(nothing)</code></pre><p><img src="/uploads/1561517891382.png" srcset="/img/loading.gif" alt="1561517891382"></p><p>ä»ä¸Šå›¾ä¸­çš„æ‰§è¡Œå¯ä»¥çœ‹å‡ºï¼Œç¼ºå¤±åˆ©ç”¨åˆ°äº†å¤šæ ¸ï¼Œå®ç°äº†å¤šçº¿ç¨‹çš„å¹¶è¡Œè®¡ç®—ã€‚ä½†æ˜¯è¿™ä¸ªå¤šçº¿ç¨‹å®é™…ä¸Šæ˜¯åœ¨C++ä¸­å®ç°çš„ï¼ŒPythonåªæ˜¯ä½œä¸ºæ¥å£è°ƒç”¨äº†C++ä¸­çš„å‡½æ•°è€Œå·²ã€‚è¿™æ ·è¿˜ä¸æ˜¯Pythonçš„å¤šçº¿ç¨‹ã€‚ä¸‹é¢æˆ‘ä»¬ç»§ç»­å¯¹ä»£ç è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="Pythonå¤šçº¿ç¨‹è°ƒç”¨C-ä¸­çš„æ™®é€šå‡½æ•°"><a href="#Pythonå¤šçº¿ç¨‹è°ƒç”¨C-ä¸­çš„æ™®é€šå‡½æ•°" class="headerlink" title="Pythonå¤šçº¿ç¨‹è°ƒç”¨C++ä¸­çš„æ™®é€šå‡½æ•°"></a>Pythonå¤šçº¿ç¨‹è°ƒç”¨C++ä¸­çš„æ™®é€šå‡½æ•°</h3><p>é¦–å…ˆæˆ‘ä»¬å»æ‰C++ä¸­çš„å¤šçº¿ç¨‹ï¼Œé€šè¿‡Pythonçš„å¤šçº¿ç¨‹ç›´æ¥è°ƒç”¨C++çš„å‡½æ•°æ¥çœ‹æ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿä¸‹é¢çš„ä»£ç æ¥è¿›è¡Œæµ‹è¯•ï¼Œå°†å¤šçº¿ç¨‹å»æ‰åï¼Œåœ¨Pythonä¸­è°ƒç”¨<code>nothing</code>å‡½æ•°æ¥è¿›è¡Œæµ‹è¯•ã€‚</p><pre><code class="c++">#include &lt;thread&gt;#include &quot;Python.h&quot;#include &quot;pybind11/pybind11.h&quot;#define NUM_THREADS 50using namespace std;namespace py = pybind11;int f(){    int n = 1000000000;    while(n &gt; 0){        n--;        sleep(0.2);    }    return n;}py::int_ nothing(){    int y;    y = f();    return py::int_(y);}PYBIND11_MODULE(example1, m){    m.def(&quot;nothing&quot;, &amp;nothing, &quot;do nothing&quot;);}</code></pre><p>ç¼–è¯‘ï¼Œç”Ÿæˆ<code>example1</code>çš„<code>.so</code>æ–‡ä»¶ï¼Œåœ¨ä½¿ç”¨Pythonç›´æ¥è°ƒç”¨è¯¥åŒ…å³å¯ï¼š</p><pre><code class="shell">g++ -O3 -Wall -shared -std=c++11 -fPIC `python3 -m pybind11 --includes` main_multi_nothread.cpp -o example1`python3-config --extension-suffix`</code></pre><pre><code class="python">from example1 import nothingfrom concurrent import futuresfrom concurrent.futures import ThreadPoolExecutorpool = ThreadPoolExecutor()future_list = []for i in range(12):    future = pool.submit(nothing)    future_list.append(future)for future in futures.as_completed(future_list):    res = future.result()    print(res)</code></pre><p>ç»è¿‡ç¼–è¯‘ï¼Œå†åœ¨Pythonä¸­è¿›è¡Œè°ƒç”¨å¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œå› æ­¤å¹¶æ²¡æœ‰ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½å®ç°å‰é¢æ‰€è¯´çš„å¤šçº¿ç¨‹çœŸæ­£çš„å¹¶è¡Œè®¡ç®—å—ï¼Ÿ</p><p><img src="/uploads/1561518345849.png" srcset="/img/loading.gif" alt="1561518345849"></p><h3 id="Pythonå¤šçº¿ç¨‹è°ƒç”¨C-ä¸­çš„é‡Šæ”¾GILçš„å‡½æ•°"><a href="#Pythonå¤šçº¿ç¨‹è°ƒç”¨C-ä¸­çš„é‡Šæ”¾GILçš„å‡½æ•°" class="headerlink" title="Pythonå¤šçº¿ç¨‹è°ƒç”¨C++ä¸­çš„é‡Šæ”¾GILçš„å‡½æ•°"></a>Pythonå¤šçº¿ç¨‹è°ƒç”¨C++ä¸­çš„é‡Šæ”¾GILçš„å‡½æ•°</h3><p>ç»è¿‡ä¸€ç•ª<code>Google</code>å’Œå®˜æ–¹æ–‡æ¡£çš„æŸ¥è¯¢ä¹‹åï¼ŒåŸºæœ¬äº†è§£ï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåœ¨Pythonæ‰§è¡Œæ—¶ä¼šè‡ªåŠ¨åŠ GILï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„å°†GILè¿›è¡Œé‡Šæ”¾ï¼Œå°†ä¸Šé¢çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œåœ¨è°ƒç”¨å‡½æ•°<code>f</code>çš„å‰é¢åŠ å…¥<code>Py_BEGIN_ALLOW_THREADS</code>ï¼Œåé¢åŠ å…¥<code>Py_END_ALLOW_THREADS</code>ã€‚å†å’Œä¸Šé¢ç›¸åŒçš„æ­¥éª¤è¿è¡Œï¼Œæ¥è§‚å¯ŸCPUçš„ä½¿ç”¨æƒ…å†µã€‚</p><pre><code class="c++">#include &quot;Python.h&quot;#include &quot;pybind11/pybind11.h&quot;#define NUM_THREADS 50using namespace std;namespace py = pybind11;int f(){    int n = 1000000000;    while(n &gt; 0){        n--;        sleep(0.2);    }    return n;}py::int_ nothing(){    int y;    Py_BEGIN_ALLOW_THREADS    y = f();    Py_END_ALLOW_THREADS    return py::int_(y);}PYBIND11_MODULE(example1, m){    m.def(&quot;nothing&quot;, &amp;nothing, &quot;do nothing&quot;);}</code></pre><p>ä¸‹é¢æ˜¯pythonå¤šçº¿ç¨‹è¿è¡Œæ—¶CPUä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„CPUå‡ä¸º100%ï¼Œè€Œä¸”åŒæ—¶12ä¸ªçº¿ç¨‹åœ¨è¿è¡Œã€‚ç°åœ¨å¯ä»¥ç¡®å®šæˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„ã€‚æ•´ä¸ªpythonå¤šçº¿ç¨‹æœ€æ ¸å¿ƒçš„å°±æ˜¯GILçš„é™åˆ¶ï¼Œä½†æ˜¯å¯ä»¥æ‰‹åŠ¨æ¥é‡Šæ”¾GILï¼Œæ¥è¿›è¡Œå¤šçº¿ç¨‹ã€‚ä¸Šé¢çš„ä»£ç ï¼Œå°±æ˜¯PythonçœŸæ­£çš„å¤šçº¿ç¨‹å®ç°æ–¹å¼äº†ã€‚</p><p><img src="/uploads/1561519146831.png" srcset="/img/loading.gif" alt="1561519146831"></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æ ¹æ®ä¸Šé¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šå¾—åˆ°ç»“è®ºï¼šï¼ˆ1ï¼‰Pythonä¸­çš„GILåªä½œç”¨äº<code>pure python code</code>ï¼Œå…¶ä»–çš„GILé™åˆ¶ä¸äº†ä¹Ÿä¸ä¼šé™åˆ¶ï¼›ï¼ˆ2ï¼‰æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç®¡ç†GILæ¥å®ç°Pythonä¸‹çš„å¤šçº¿ç¨‹ï¼›ï¼ˆ3ï¼‰GILå…¶å®å°±æ˜¯ä¸€æŠŠé”è€Œå·²ï¼Œå¹¶ä¸éœ€è¦å¯¹GILè¿›è¡Œå›°æƒ‘ï¼Œå½“é¢å¯¹GILæ—¶ï¼Œéœ€è¦æ‰“å¼€â€é”â€ã€‚</p><h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><ol><li><p>Python C APIä¸­æä¾›äº†<code>Py_BEGIN_ALLOW_THREADS</code>å’Œ<code>Py_END_ALLOW_THREADS</code>å®æ¥é‡Šæ”¾GILï¼Œè¿™ä¸¤ä¸ªå®çš„åŸå‹å®šä¹‰å¦‚ä¸‹ï¼š<code>{PyThreadState *_save; _save = PyEval_SaveThread();</code>å’Œ<code>PyEval_RestoreThread(_save); }</code>,å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p></li><li><p>pybind11ä¸­ä¹Ÿæä¾›äº†é‡Šæ”¾GILçš„æ–¹æ³•ï¼š<code>py::gil_scoped_acquire acquire;</code>è¯¥æ–¹æ³•æ˜¯é€šè¿‡ä¸€ä¸ªclassæ¥å®ç°ï¼Œç±»ä¼¼äºä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class="c++">class gil_scoped_acquire{public:    inline ScopedGILRelease() {        m_thread_state = PyEval_SaveThread();    }    inline ~ScopedGILRelease() {        PyEval_RestoreThread(m_thread_state);        m_thread_state = NULL;    }private:    PyThreadState * m_thread_state;};</code></pre></li><li><p>åªè¦ä½¿ç”¨c/c++/cythonç­‰æ¥é‡Šæ”¾GILçš„å‡½æ•°è°ƒç”¨å°±å¯ä»¥å®ç°Pythonä¸‹çš„å¤šçº¿ç¨‹ï¼ŒCä½¿ç”¨1ä¸­çš„æ–¹å¼ï¼ŒC++ä½¿ç”¨1ï¼Œ2ä¸­çš„æ–¹å¼å‡å¯ï¼ŒCythonä½¿ç”¨<code>with nogil</code>å¯ä»¥å®ç°ã€‚</p></li></ol><p>å‚è€ƒæ–‡æ¡£ï¼š</p><ol><li><a href="https://cyrusin.github.io/2016/04/27/python-gil-implementaion/" target="_blank" rel="noopener">GILå®ç°ç»†èŠ‚è§£æ</a></li><li><a href="http://blog.zhanglun.me/2018/09/15/è§¦æ‘¸Pythonçš„GIL/" target="_blank" rel="noopener">è§¦æ‘¸Pythonçš„GIL</a></li><li><a href="[https://closure11.com/%E9%80%9A%E8%BF%87cc%E6%89%A9%E5%B1%95%E7%9A%84%E6%96%B9%E5%BC%8F%E5%9C%A8python%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%B9%B6%E5%8F%91/](https://closure11.com/é€šè¿‡ccæ‰©å±•çš„æ–¹å¼åœ¨pythonä¸­è¿›è¡Œå¹¶å‘/)">é€šè¿‡C/C++æ‰©å±•çš„æ–¹å¼åœ¨pythonä¸­è¿›è¡Œå¹¶å‘</a></li><li><a href="https://docs.python.org/3/c-api/init.html" target="_blank" rel="noopener">Initialization, Finalization, and Threads</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>c/c++</tag>
      
      <tag>thread</tag>
      
      <tag>pybind11</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é«˜æ–¯è¿‡ç¨‹ï¼ˆGaussian Processï¼‰ç†è§£</title>
    <link href="/2019/05/01/%E9%AB%98%E6%96%AF%E8%BF%87(Gaussian%20Process)%E7%A8%8B%E7%90%86%E8%A7%A3/"/>
    <url>/2019/05/01/%E9%AB%98%E6%96%AF%E8%BF%87(Gaussian%20Process)%E7%A8%8B%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>å¯¹äºé«˜æ–¯è¿‡ç¨‹ï¼ˆGaussian Processï¼‰å·²ç»å¿ƒä»ªå·²ä¹…ï¼Œä½†æ˜¯ä¹‹å‰å¤§æ¦‚çœ‹äº†ä¸€äº›æ–‡ç« ï¼Œæ²¡æœ‰å®Œå…¨ç†è§£ï¼Œæœ¬èº«è¿™ä¸ªæ¨¡å‹æ˜¯æ¯”è¾ƒç†è§£çš„ï¼Œå› æ­¤ç°åœ¨æŠ½å‡ºæ—¶é—´æ¥ç ”ç©¶ä¸€ç•ªï¼Œæœ¬æ–‡ä¸­ä¸ä¼šè¿›è¡Œå¤æ‚çš„å…¬å¼æ¨å¯¼ï¼Œä¸»è¦å¯¹é«˜æ–¯è¿‡ç¨‹è¿›è¡Œç†è§£ã€‚</p><p>é«˜æ–¯è¿‡ç¨‹æ˜¯æœºå™¨å­¦ä¹ ä¸­ ä¸€ç§æˆ–è€…è¯´ä¸€ç±»çš„å»ºæ¨¡æ–¹æ³•ã€‚è¿™ç§å»ºæ¨¡æ–¹æ³•å¾—å‡ºçš„æ¨¡å‹ç»Ÿç§°ä¸ºéå‚æ•°æ¨¡å‹ï¼Œæ¯”å¦‚ï¼šé«˜æ–¯è¿‡ç¨‹ï¼Œè´å¶æ–¯ï¼ŒKNNç­‰ï¼ˆå‚æ•°æ¨¡å‹ï¼šå›å½’ï¼Œæ·±åº¦å­¦ä¹ ï¼Œé€»è¾‘å›å½’ï¼‰ã€‚é«˜æ–¯è¿‡ç¨‹æ˜¯ä»æ¦‚ç‡ç»Ÿè®¡å­¦çš„è§’åº¦æ¥è§£å†³é—®é¢˜ï¼Œæ›´ç¡®åˆ‡çš„è¯´åº”è¯¥æ˜¯éšæœºè¿‡ç¨‹ï¼ˆStochastic Processï¼‰ç§ä¸€ä¸ªç‰¹æ®Šçš„ä¾‹å­ï¼Œä¸‹é¢æ˜¯WIKIä¸Šçš„å®šä¹‰ï¼š</p><blockquote><p><strong>é«˜æ–¯è¿‡ç¨‹</strong>ï¼ˆ<strong>Gaussian process</strong>ï¼‰æ˜¯<a href="https://zh.wikipedia.org/wiki/éšæœºå˜é‡" target="_blank" rel="noopener">è§‚æµ‹å€¼</a>å‡ºç°åœ¨ä¸€ä¸ªè¿ç»­åŸŸï¼ˆä¾‹å¦‚æ—¶é—´æˆ–ç©ºé—´ï¼‰çš„ç»Ÿè®¡æ¨¡å‹ã€‚åœ¨é«˜æ–¯è¿‡ç¨‹ä¸­ï¼Œè¿ç»­è¾“å…¥ç©ºé—´ä¸­æ¯ä¸ªç‚¹éƒ½æ˜¯ä¸ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/æ­£æ€åˆ†å¸ƒ" target="_blank" rel="noopener">æ­£æ€åˆ†å¸ƒ</a>çš„<a href="https://zh.wikipedia.org/wiki/éšæœºå˜é‡" target="_blank" rel="noopener">éšæœºå˜é‡</a>ç›¸å…³è”ã€‚æ­¤å¤–ï¼Œè¿™äº›éšæœºå˜é‡çš„æ¯ä¸ªæœ‰é™é›†åˆéƒ½æœ‰ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/å¤šå…ƒæ­£æ€åˆ†å¸ƒ" target="_blank" rel="noopener">å¤šå…ƒæ­£æ€åˆ†å¸ƒ</a>ã€‚é«˜æ–¯è¿‡ç¨‹çš„åˆ†å¸ƒæ˜¯æ‰€æœ‰é‚£äº›ï¼ˆæ— é™å¤šä¸ªï¼‰éšæœºå˜é‡çš„è”åˆåˆ†å¸ƒï¼Œæ­£å› å¦‚æ­¤ï¼Œå®ƒæ˜¯è¿ç»­åŸŸï¼ˆä¾‹å¦‚æ—¶é—´æˆ–ç©ºé—´ï¼‰çš„åˆ†å¸ƒã€‚</p><p>é«˜æ–¯è¿‡ç¨‹è¢«è®¤ä¸ºæ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/æœºå™¨å­¦ä¹ " target="_blank" rel="noopener">æœºå™¨å­¦ä¹ </a>ç®—æ³•ï¼Œæ˜¯ä»¥<a href="https://zh.wikipedia.org/w/index.php?title=æƒ°æ€§å­¸ç¿’&action=edit&redlink=1" target="_blank" rel="noopener">æƒ°æ€§å­¦ä¹ </a>æ–¹å¼ï¼Œåˆ©ç”¨ç‚¹ä¸ç‚¹ä¹‹é—´åŒè´¨æ€§çš„åº¦é‡ä½œä¸º<a href="https://zh.wikipedia.org/w/index.php?title=æ ¸å‡½æ•¸&action=edit&redlink=1" target="_blank" rel="noopener">æ ¸å‡½æ•°</a>ï¼Œä»¥ä»è¾“å…¥çš„è®­ç»ƒæ•°æ®é¢„æµ‹æœªçŸ¥ç‚¹çš„å€¼ã€‚å…¶é¢„æµ‹ç»“æœä¸ä»…åŒ…å«è¯¥ç‚¹çš„å€¼ï¼Œè€ŒåŒæ—¶åŒ…å«ä¸ç¡®å®šæ€§çš„èµ„æ–™ï¼å®ƒçš„ä¸€ç»´é«˜æ–¯åˆ†å¸ƒï¼ˆå³è¯¥ç‚¹çš„<a href="https://zh.wikipedia.org/wiki/è¾¹é™…åˆ†å¸ƒ" target="_blank" rel="noopener">è¾¹é™…åˆ†å¸ƒ</a>ï¼‰ã€‚</p></blockquote><p>ä¸‹é¢ä¸»è¦å¯¹é«˜æ–¯è¿‡ç¨‹ä»å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯¦ç»†çš„è®²è§£ï¼Œé¦–å…ˆæˆ‘ä»¬å¯¹é«˜æ–¯è¿‡ç¨‹æœ‰ä¸€ä¸ªå¤§æ¦‚çš„è®¤çŸ¥ï¼Œé€šè¿‡ä¸€ç§é€šä¿—æ˜“æ‡‚çš„æ–¹å¼æ¥è¿›è¡Œè¯´æ˜ï¼Œå†ä»ç†è®ºçš„è§’åº¦æ¥å¯¹é«˜æ–¯è¿‡ç¨‹è¿›è¡Œè¯¦ç»†çš„ç†è®ºè®²è§£ï¼Œæœ€åä¼šå¯¹é«˜æ–¯è¿‡ç¨‹ç§ä½¿ç”¨çš„åæ–¹å·®å‡½æ•°ï¼ˆæ ¸å‡½æ•°ï¼‰è¿›è¡Œåˆ—ä¸¾è¯´æ˜ã€‚å¦å¤–ä¼šå¯¹ä½¿ç”¨é«˜æ–¯è¿‡ç¨‹åº”è¯¥è€ƒè™‘çš„é—®é¢˜è¿›è¡Œè¯´æ˜ã€‚</p><h2 id="1-é«˜æ–¯è¿‡ç¨‹çš„é€šä¿—ç†è§£ï¼ˆæ€»ä½“è®¤çŸ¥ï¼‰"><a href="#1-é«˜æ–¯è¿‡ç¨‹çš„é€šä¿—ç†è§£ï¼ˆæ€»ä½“è®¤çŸ¥ï¼‰" class="headerlink" title="1. é«˜æ–¯è¿‡ç¨‹çš„é€šä¿—ç†è§£ï¼ˆæ€»ä½“è®¤çŸ¥ï¼‰"></a>1. é«˜æ–¯è¿‡ç¨‹çš„é€šä¿—ç†è§£ï¼ˆæ€»ä½“è®¤çŸ¥ï¼‰</h2><p>åœ¨æœ¬æ–‡ä¸­é€šè¿‡<strong>é«˜æ–¯è¿‡ç¨‹å›å½’</strong>ï¼ˆGPRï¼‰æ¥å¸®åŠ©é«˜æ–¯è¿‡ç¨‹çš„ç†è§£ã€‚ä¸‹é¢æˆ‘ä»¬ä»å›å½’çš„è§’åº¦ï¼Œä»è§£å†³é—®é¢˜çš„è§’åº¦çœ‹GPRæ˜¯æ€ä¹ˆä¸€æ­¥ä¸€æ­¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚</p><p>å¯¹äºå›å½’æˆ‘ä»¬æ˜¯ç»™å‡º$Xå’ŒY$ï¼Œå†ç»™å‡ºæµ‹è¯•çš„$X_{test}$ï¼Œè¦æ±‚é¢„æµ‹å¾—åˆ°$Y_{test}$ã€‚é«˜æ–¯è¿‡ç¨‹çš„å‡ºå‘ç‚¹å°±æ˜¯ï¼š<strong>å¦‚æœä¸¤ä¸ª$x$æ¯”è¾ƒæ¥è¿‘ï¼Œé‚£ä¹ˆå®ƒä»¬å¯¹åº”çš„$y$ä¸€å®šæ¯”è¾ƒæ¥è¿‘</strong>ã€‚å¯¹äºç»™å®šçš„æ–°$X_{test}$ä¸ä¹‹å‰ç»™å‡ºçš„$X$æœ‰å¤šè¿‘ï¼Œä»è€Œå°±çŸ¥é“äº†è¦é¢„æµ‹$Y$çš„$Y_{test}$æœ‰å¤šè¿‘ï¼Œæ¥é¢„æµ‹$Y_{test}$ã€‚é‚£ä¹ˆå¦‚ä½•åº¦é‡Yä¹‹é—´æœ‰å¤šè¿‘å‘¢ï¼Ÿé«˜æ–¯è¿‡ç¨‹æ˜¯é€šè¿‡åæ–¹å·®çŸ©é˜µï¼ˆç›¸å…³ç³»æ•°çŸ©é˜µï¼‰ï¼Œè€Œè¿™ä¸ªåæ–¹å·®çŸ©é˜µæ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿè¿™å„¿å°†å¤šç»´é«˜æ–¯åˆ†å¸ƒä½œä¸ºå…ˆéªŒï¼Œè®¤ä¸ºæ‰€æœ‰çš„yï¼Œæœä»ä¸€ä¸ªå¤šç»´çš„è”åˆé«˜æ–¯åˆ†å¸ƒï¼Œåªéœ€è¦æ ¹æ®$Xå’ŒY$æ¥å°†åæ–¹å·®çŸ©é˜µè®¡ç®—å¥½ï¼Œæœ€åæŒ‰ç…§å…¬å¼è®¡ç®—$Y_{test}$çš„è¾¹ç¼˜åˆ†å¸ƒå°±å¯ä»¥äº†ã€‚</p><p>ä¸Šé¢è§£å†³äº†$Y$ä¹‹é—´â€œè¿‘â€çš„åº¦é‡ï¼Œé‚£ä¹ˆ$X$ä¹‹é—´è¿‘æ€ä¹ˆåº¦é‡å‘¢ï¼Ÿé‚£ä¹ˆæ ¸ï¼ˆkernelï¼‰å°±åº”è¯¥å‡ºç°äº†ï¼Œæ ¸ä¸ä»…èƒ½åˆ»ç”»çº¿æ€§ï¼Œè€Œä¸”èƒ½åˆ»ç”»éçº¿æ€§ã€‚ç›®å‰æ•´ä¸ªé—®é¢˜å°±è§£å†³äº†ï¼š<strong>ç”¨$X$ä¹‹é—´åŠ kernelï¼Œæ¥å¡«å……$Y$ä¹‹é—´çš„åæ–¹å·®çŸ©é˜µï¼Œç„¶åè®¡ç®—$Y_{test}$çš„è¾¹ç¼˜åˆ†å¸ƒã€‚é€šè¿‡$X$å’Œ$Y$ï¼Œç»™å®š$X_{test}$è®¡ç®—$Y_{test}$</strong>ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬å¯¹é«˜æ–¯è¿‡ç¨‹æœ‰äº†ä¸€ä¸ªæ€»ä½“è®¤è¯†åï¼Œä¸‹é¢æˆ‘ä»¬å°±ç»“åˆç†è®ºæ¥è¿›è¡Œç†è§£ï¼ŒçŸ¥é“ç†è®ºç§æ¯ä¸€æ­¥çš„å…·ä½“ä½œç”¨ï¼Œå¸®åŠ©æˆ‘ä»¬ç†è§£é«˜æ–¯è¿‡ç¨‹ã€‚</p><h2 id="2-å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ"><a href="#2-å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ" class="headerlink" title="2. å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ"></a>2. å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ</h2><p>åœ¨ç†è§£é«˜æ–¯è¿‡ç¨‹ä¹‹å‰éœ€è¦å¯¹å¤šå…ƒé«˜æ–¯åˆ†å¸ƒæœ‰åˆæ­¥çš„è®¤è¯†ï¼Œé«˜æ–¯åˆ†å¸ƒæ˜¯é«˜æ–¯è¿‡ç¨‹çš„åŸºç¡€éƒ¨ä»¶ï¼Œè€Œå¤šå…ƒé«˜æ–¯åˆ†å¸ƒæ˜¯é«˜æ–¯åˆ†å¸ƒçš„åŸºç¡€ã€‚å¤šå…ƒé«˜æ–¯åˆ†å¸ƒå®šä¹‰ï¼š</p><blockquote><p>å¤šå˜é‡æ­£æ€åˆ†å¸ƒäº¦ç§°ä¸ºå¤šå…ƒé«˜æ–¯åˆ†å¸ƒã€‚å®ƒæ˜¯å•ç»´é«˜æ–¯åˆ†å¸ƒå‘å¤šç»´çš„æ¨å¹¿ã€‚å®ƒåŒ<a href="https://zh.wikipedia.org/wiki/çŸ©é˜µæ­£æ€åˆ†å¸ƒ" target="_blank" rel="noopener">çŸ©é˜µæ­£æ€åˆ†å¸ƒ</a>æœ‰ç´§å¯†çš„è”ç³»ã€‚ ä¸€èˆ¬å½¢å¼ï¼š<br>$$<br>X = N(\mu, \Sigma) \tag{1}<br>$$<br>å…¶ä¸­ï¼Œ$\mu$ä¸ºå‘é‡ï¼Œ$\Sigma$ä¸ºåæ–¹å·®çŸ©é˜µï¼Œè¯¥åˆ†å¸ƒä¸ºå‘é‡$\mu$ä¸ºä¸­å¿ƒï¼Œåæ–¹å·®çŸ©é˜µ$\Sigma$å†³å®šå…¶å½¢çŠ¶ã€‚Nç»´éšæœºå‘é‡ $X=[X_{1},\dots ,X_{N}]^{T}$å¦‚æœæœä»å¤šå˜é‡æ­£æ€åˆ†å¸ƒï¼Œå¿…é¡»æ»¡è¶³ä¸‹é¢çš„ä¸‰ä¸ªç­‰ä»·æ¡ä»¶ï¼š </p><ol><li>ä»»ä½•çº¿æ€§ç»„åˆ$Y=a_{1}X_{1}+\cdots +a_{N}X_{N}$æœä»æ­£æ€åˆ†å¸ƒã€‚ </li><li>å­˜åœ¨éšæœºå‘é‡ $Z=[Z_{1},\dots ,Z_{M}]^{T}$( å®ƒçš„æ¯ä¸ªå…ƒç´ æœä»ç‹¬ç«‹æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼‰ï¼Œå‘é‡ $\mu =[\mu _{1},\dots ,\mu _{N}]^{T}$åŠ$N\times M$çŸ©é˜µ$A$æ»¡è¶³$X=AZ+\mu $. </li><li>å­˜åœ¨$\mu$ å’Œä¸€ä¸ªå¯¹ç§°æ­£å®šé˜µ $\Sigma$ï¼Œæ»¡è¶³$X$çš„ç‰¹å¾å‡½æ•°$\phi <em>{X}\left(u;\mu ,\Sigma \right)=\exp \left(i\mu ^{T}u-{\frac  {1}{2}}u^{T}\Sigma u\right)$ï¼Œå¦‚æœ$\Sigma$æ˜¯éå¥‡å¼‚çš„ï¼Œé‚£ä¹ˆè¯¥åˆ†å¸ƒå¯ä»¥ç”±ä»¥ä¸‹çš„PDFæ¥æè¿°ï¼š$f</em>{\mathbf {x} }(x_{1},\ldots ,x_{k})={\frac {1}{\sqrt {(2\pi )^{k}|{\boldsymbol {\Sigma }}|}}}\exp \left(-{\frac {1}{2}}({\mathbf {x} }-{\boldsymbol {\mu }})^{\mathrm {T} }{\boldsymbol {\Sigma }}^{-1}({\mathbf {x} }-{\boldsymbol {\mu }})\right)$ï¼Œæ³¨æ„è¿™é‡Œçš„$|\Sigma |$æ˜¯åæ–¹å·®çŸ©é˜µçš„è¡Œåˆ—å¼ã€‚<a id="more"></a></li></ol></blockquote><p>ä¸‹é¢æ˜¯ä¸€ä¸ªäºŒç»´é«˜æ–¯åˆ†å¸ƒçš„å›¾åƒï¼Œå¯ä»¥çœ‹å‡ºæ˜¯ä»¥ï¼ˆ0ï¼Œ 0ï¼‰ä¸ºä¸­å¿ƒï¼Œ1ä¸ºå³°å€¼ï¼Œå›¾å½¢çš„å®½åº¦ï¼Œæ˜¯é€šè¿‡$|\Sigma |$çŸ©é˜µæ¥å®šä¹‰çš„ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/uploads/20180516094227255.jpg" srcset="/img/loading.gif" alt="gaussian curve with a 2-dimensional domain"></p><h2 id="3-é«˜æ–¯è¿‡ç¨‹ï¼ˆGaussian-Processï¼‰"><a href="#3-é«˜æ–¯è¿‡ç¨‹ï¼ˆGaussian-Processï¼‰" class="headerlink" title="3. é«˜æ–¯è¿‡ç¨‹ï¼ˆGaussian Processï¼‰"></a>3. é«˜æ–¯è¿‡ç¨‹ï¼ˆGaussian Processï¼‰</h2><p><code>Gaussian Process</code>å³é«˜æ–¯å’Œè¿‡ç¨‹ï¼Œé«˜æ–¯ä¸€èˆ¬æŒ‡é«˜æ–¯åˆ†å¸ƒï¼Œå¤šå…ƒé«˜æ–¯åˆ†å¸ƒï¼›è¿‡ç¨‹ï¼Œè¿™é‡Œä¸»è¦æ˜¯æŒ‡éšæœºè¿‡ç¨‹ï¼ˆwikiä¸Šçš„éšæœºè¿‡ç¨‹<strong>å®šä¹‰</strong>ï¼šåœ¨æ¦‚ç‡è®ºæ¦‚å¿µä¸­ï¼Œ<strong>éšæœºè¿‡ç¨‹</strong>æ˜¯<strong>éšæœº</strong>å˜é‡çš„é›†åˆã€‚ è‹¥ä¸€<strong>éšæœº</strong>ç³»ç»Ÿçš„æ ·æœ¬ç‚¹æ˜¯<strong>éšæœº</strong>å‡½æ•°ï¼Œåˆ™ç§°æ­¤å‡½æ•°ä¸ºæ ·æœ¬å‡½æ•°ï¼Œè¿™ä¸€<strong>éšæœº</strong>ç³»ç»Ÿå…¨éƒ¨æ ·æœ¬å‡½æ•°çš„é›†åˆæ˜¯ä¸€ä¸ª<strong>éšæœºè¿‡ç¨‹</strong>ï¼‰ã€‚</p><p>æœ¬æ–‡è¿˜æ˜¯åŸºäºå›å½’çš„ç¤ºä¾‹æ¥ç†è§£é«˜æ–¯è¿‡ç¨‹ï¼Œå‡è®¾ï¼šæœ‰$N$å¯¹æ ·æœ¬$(x_i, y_i)<em>1^n$ï¼Œä¸€èˆ¬æ˜¯æ ·æœ¬æ¥æ‹Ÿåˆ$xå’Œy$ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æ ¹æ®æ–°çš„è‡ªå˜é‡$x$æ¥é¢„æµ‹$y$ã€‚ä½†æ˜¯é«˜æ–¯è¿‡ç¨‹å¹¶éå¦‚æ­¤ï¼Œè€Œæ˜¯åˆ©ç”¨å…ˆéªŒçŸ¥è¯†ï¼Œæ¥æ‹Ÿåˆå‡½æ•°$f$çš„æ¦‚ç‡åˆ†å¸ƒï¼š<br>$$<br>f: R \rightarrow R = p(f | x, X, y) \tag{2}<br>$$<br>é¦–å…ˆè¿›è¡Œå‡è®¾ï¼Œå‡è®¾ç»™å®šä¸€äº›$X$çš„å€¼ï¼Œæˆ‘ä»¬å¯¹$Y$å»ºæ¨¡ï¼Œå¹¶å‡è®¾å¯¹åº”çš„è¿™äº›$Y$å€¼ æœä»è”åˆé«˜æ–¯åˆ†å¸ƒã€‚ä¸€ä¸ªé«˜æ–¯è¿‡ç¨‹æ˜¯ç”±å‡å€¼å‡½æ•°$m(x)$å’Œåæ–¹å·®å‡½æ•°$k(x, x^â€)$ï¼ˆ<strong>æ­£å› ä¸ºæœ‰å‡å€¼å‡½æ•°æ ¸åæ–¹å·®å‡½æ•°ç¡®å®šï¼Œæ‰€ä»¥é«˜æ–¯è¿‡ç¨‹ä¸ºéå‚æ•°æ¨¡å‹</strong>ï¼‰ç¡®å®šçš„ã€‚å®ƒå¯ç†è§£æˆè”åˆé«˜æ–¯åˆ†å¸ƒçš„ä¸€ä¸ªç”Ÿæˆè¿‡ç¨‹ï¼Œé‚£ä¹ˆè”åˆé«˜æ–¯åˆ†å¸ƒå¯ä»¥é€šè¿‡å¦‚ä¸‹è¡¨ç¤ºï¼š<br>$$<br>\left[\begin{array}{ccc}<br>Y</em>{1} \<br>\vdots \<br>Y_{n}<br>\end{array}\right] = N(\left[\begin{array}{ccc}<br>0 \<br>\vdots \<br>0<br>\end{array}\right], \left[\begin{array}{ccc}<br>K_{11} &amp; \cdots &amp; K_{1n} \<br>\vdots &amp; \ddots &amp; \vdots \<br>K_{n1} &amp; \cdots &amp; K_{nn}<br>\end{array}\right]) \tag{3}<br>$$<br>ä¸Šé¢çš„å½¢å¼å°±æ˜¯å¤šå…ƒé«˜æ–¯åˆ†å¸ƒå½¢å¼ï¼š$X = N(\mu, \Sigma)$ï¼Œå…¶ä¸­å‡å€¼$\mu$ä¸ç”¨æ‹…å¿ƒï¼Œå¯ä»¥å…ˆå‡è®¾ä¸º0ï¼ˆå³ä½¿ $\muâ‰ 0$ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é¢„æµ‹ç»“æŸåæŠŠ$\mu$åŠ å›åˆ°ç»“æœå‡½æ•°å€¼ä¸­ã€‚æ‰€ä»¥é…ç½®$ \mu $éå¸¸ç®€å•ï¼‰ï¼Œå¦‚ä¸Šé¢çš„(3)æ‰€ç¤ºã€‚é‚£ä¹ˆåæ–¹å·®çŸ©é˜µæ€ä¹ˆå¾—åˆ°å‘¢ï¼Ÿ</p><p>åœ¨ä¸Šé¢é€šä¿—ç†è§£çš„æ®µè½ä¸­æåˆ°äº†ï¼Œ$X$æ¯”è¾ƒç›¸ä¼¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„$y$å€¼çš„ç›¸å…³æ€§ä¹Ÿå°±è¾ƒé«˜ã€‚æ¢è¨€ä¹‹ï¼Œåæ–¹å·®çŸ©é˜µæ˜¯<strong>$X$çš„å‡½æ•°</strong>ã€‚ï¼ˆè€Œä¸æ˜¯$y$çš„å‡½æ•°ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å‡è®¾åæ–¹å·®çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ ä¸ºå¯¹åº”çš„ä¸¤ä¸ª$x$å€¼çš„ä¸€ä¸ªç›¸ä¼¼æ€§åº¦é‡ï¼Œç›¸ä¼¼æ€§åº¦é‡å‡½æ•°æ˜¯<strong>æ ¸å‡½æ•°(Kernel Functions</strong>ï¼Œé«˜æ–¯è¿‡ç¨‹å›å½’ä¸­å¸¸ç”¨çš„Kernelæ˜¯<code>squared exponential kernel</code>ï¼Œåœ¨<code>scikit-learn</code>ä¸­GPæ¥å£ä¸­é»˜è®¤ä½¿ç”¨çš„<code>kernel</code>å°±æ˜¯è¯¥æ ¸å‡½æ•°)ã€‚</p><p>åæ–¹å·®çŸ©é˜µä¸ä»…ä»…æè¿°äº†è¿™ä¸ªåˆ†å¸ƒçš„å½¢çŠ¶ï¼Œä¹Ÿæœ€ç»ˆå†³å®šäº†æˆ‘ä»¬æƒ³è¦é¢„æµ‹çš„å‡½æ•°æ‰€å…·æœ‰çš„ç‰¹æ€§ã€‚æˆ‘ä»¬é€šè¿‡æ±‚æ ¸å‡½æ•°$K$çš„å€¼æ¥ç”Ÿæˆåæ–¹å·®çŸ©é˜µï¼Œè¿™ä¸ªæ ¸å‡½æ•°é€šå¸¸ä¹Ÿè¢«ç§°ä¸ºåæ–¹å·®å‡½æ•°ï¼Œä½œç”¨åœ¨<strong>ä¸¤ä¸¤æˆå¯¹çš„æ‰€æœ‰æµ‹è¯•ç‚¹</strong>ä¸Šã€‚æ ¸å‡½æ•°æ¥æ”¶åˆ°çš„<strong>è¾“å…¥æ˜¯ä¸¤ä¸ªç‚¹</strong>ï¼Œï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª<strong>æ ‡é‡</strong>ï¼Œè¡¨è¾¾äº†è¿™<strong>ä¸¤ä¸ªç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦</strong>ï¼š<br>$$<br>K = \mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}, \Sigma = Cov(X, X^â€)=k(x, x^â€) \tag{4}<br>$$<br>åæ–¹å·®çŸ©é˜µ$\Sigma_{ij}$ æè¿°çš„æ˜¯ç¬¬ $i$ä¸ªç‚¹å’Œç¬¬$j$ä¸ªç‚¹ä¹‹é—´çš„ç›¸äº’å½±å“ï¼Œè¿™å’Œå¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„å®šä¹‰ä¸€è‡´ã€‚åœ¨å¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„å®šä¹‰ä¸­ï¼Œ$\Sigma_{ij}$ å®šä¹‰äº†ç¬¬$i$ä¸ªéšæœºå˜é‡å’Œç¬¬$j$ä¸ªéšæœºå˜é‡ä¹‹é—´çš„ç›¸å…³æ€§ã€‚ç”±äºæ ¸å‡½æ•°æè¿°çš„è¾“å…¥å€¼ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå®ƒä¾¿æ§åˆ¶äº†è¿™ä¸ªæ‹Ÿåˆå‡½æ•°å¯èƒ½æ‹¥æœ‰çš„å½¢çŠ¶ã€‚</p><h3 id="3-1-é«˜æ–¯è¿‡ç¨‹å›å½’ï¼ˆGPRï¼‰"><a href="#3-1-é«˜æ–¯è¿‡ç¨‹å›å½’ï¼ˆGPRï¼‰" class="headerlink" title="3.1 é«˜æ–¯è¿‡ç¨‹å›å½’ï¼ˆGPRï¼‰"></a>3.1 é«˜æ–¯è¿‡ç¨‹å›å½’ï¼ˆGPRï¼‰</h3><p>å‡è®¾å¯¹è¾“å…¥çš„$x^â€$å¯¹åº”çš„$y^â€$è¿›è¡Œé¢„æµ‹ï¼Œé‚£ä¹ˆå¯ä»¥ç®€è¿°å¦‚ä¸‹ï¼š</p><h4 id="3-1-1-å…ˆéªŒåˆ†å¸ƒï¼ˆPrior-Distributionï¼‰"><a href="#3-1-1-å…ˆéªŒåˆ†å¸ƒï¼ˆPrior-Distributionï¼‰" class="headerlink" title="3.1.1 å…ˆéªŒåˆ†å¸ƒï¼ˆPrior Distributionï¼‰"></a>3.1.1 å…ˆéªŒåˆ†å¸ƒï¼ˆPrior Distributionï¼‰</h4><p>è®­ç»ƒæ ·æœ¬ï¼š$x=[x_1, x_2, x_3, â€¦, x_n], y=[y_1, y_2, y_3, â€¦, y_n]$ï¼Œæµ‹è¯•æ ·æœ¬ï¼š$x^â€$,$y^â€$ã€‚å…ˆéªŒå°±æ˜¯æ‰€æœ‰çš„éšæœºå˜é‡éµå¾ªä¸€ä¸ªå‡å€¼çš„å¤šå…ƒé«˜æ–¯åˆ†å¸ƒï¼ˆå‡è®¾éšæœºå˜é‡å·²ç»é›¶å‡å€¼åŒ–ï¼Œå‡å€¼ä¸º0ï¼‰ï¼š<br>$$<br>\left[\begin{array}{ccc}<br>y \<br>y^{â€œ}<br>\end{array}\right] \sim N(0, \left[\begin{array}{ccc}<br>K &amp; K_{â€œ}^T \<br>K_{â€œ} &amp; K^{â€œâ€}<br>\end{array}\right] ) \tag{5}<br>$$<br>å…¶ä¸­ï¼ŒGPå®šä¹‰äº†æ ¸å‡½æ•°$k$ï¼Œå°±å¯ä»¥çŸ¥é“ï¼š<br>$$<br>K=\left[\begin{array}{ccc}<br>k(x_1, x_1) &amp; k(x_1, x_2) &amp; \cdots &amp; k(x_1, x_n)\<br>k(x_2, x_1) &amp; k(x_2, x_2) &amp; \cdots &amp; k(x_2, x_n)\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots\<br>k(x_n, x_1) &amp; k(x_n, x_2) &amp; \cdots &amp; k(x_n, x_n)\<br>\end{array}\right]  \tag{6}<br>$$</p><p>$$<br>K_{â€œ} = [k(x^â€, x_1), k(x^â€, x_2), \cdots, k(x^â€, x_n)]\<br>k^{â€œâ€} = k(x^â€, x^â€) \tag{7}<br>$$</p><p>é€šè¿‡è®­ç»ƒæ ·æœ¬å°±ç¡®å®šäº†å…ˆéªŒåˆ†å¸ƒã€‚å¦‚æœå°†$x^â€$,$y^â€$æ‹“å±•åˆ°$n^â€$ç»´ï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ° ä¸€ä¸ª $n^â€$ ç»´çš„é¢„æµ‹å‘é‡ $f^â€$:<br>$$<br>\left[\begin{array}{ccc}<br>y \<br>y^{â€œ}<br>\end{array}\right] \sim N(\left(\begin{array}{ccc}<br>\mu\<br>\mu^{â€œ}\end{array}\right), \left[\begin{array}{ccc}<br>K &amp; K_{â€œ}^T \<br>K_{â€œ} &amp; K^{â€œâ€}<br>\end{array}\right] ) \tag{8}<br>$$<br>å…¶ä¸­ï¼Œ$K_{n \times n}=K(x, x)$ï¼Œ$K_{â€œ n^â€ \times n}$ï¼Œ $K^{â€œâ€}_{n^â€ \times n^â€}$ã€‚</p><h4 id="3-1-2-åéªŒåˆ†å¸ƒï¼ˆPosterior-Distribution-ï¼‰"><a href="#3-1-2-åéªŒåˆ†å¸ƒï¼ˆPosterior-Distribution-ï¼‰" class="headerlink" title="3.1.2 åéªŒåˆ†å¸ƒï¼ˆPosterior Distribution ï¼‰"></a>3.1.2 åéªŒåˆ†å¸ƒï¼ˆPosterior Distribution ï¼‰</h4><p>åéªŒåˆ†å¸ƒåˆ©ç”¨äº†è®­ç»ƒæ ·æœ¬çš„é›†ä¸­ä¿¡æ¯ï¼Œå› ä¸ºè®­ç»ƒæ ·æœ¬å’Œæµ‹è¯•æ ·æœ¬éƒ½ä½¿ç”¨çš„åŒä¸€é«˜æ–¯è¿‡ç¨‹ï¼Œæ‰€ä»¥è®­ç»ƒæ ·æœ¬$x$å’Œæµ‹è¯•æ ·æœ¬çš„$x^â€$æ¯”è¾ƒæ¥è¿‘ï¼Œé‚£ä¹ˆå¯¹åº”çš„$y$ä¹Ÿæ˜¯æ¯”è¾ƒæ¥è¿‘ï¼Œæ ¹æ®å¤šå…ƒé«˜æ–¯åˆ†å¸ƒå¼çš„æ¡ä»¶åˆ†å¸ƒï¼Œå°±å¯ä»¥å¾—åˆ°ï¼š<br>$$<br>y^â€|y = N(K_â€K^{-1}y, K^{â€œâ€}-K_â€K^{-1}K_â€^T) \tag{9}<br>$$<br>æ ¹æ®ä¸Šè¿°å…¬å¼å¯çŸ¥ï¼Œæµ‹è¯•é›†åéªŒåˆ†å¸ƒçš„æœŸæœ›å€¼å°±æ˜¯è®­ç»ƒæ ·æœ¬$y$çš„çº¿æ€§ç»„åˆï¼Œè€Œæ–¹å·®å’Œè®­ç»ƒæ ·æœ¬çš„$y$æ— å…³ï¼Œåªä¸$x$æœ‰å…³ã€‚å¦‚æœåœ¨æ‹“å±•åˆ°å¤šç»´æ—¶ä¸”å‡å€¼ä¸ä¸º0(åŸºäº3.1.1ä¸­çš„å…¬å¼ï¼ˆ8ï¼‰çš„æƒ…å†µ)ï¼Œåˆ™æ ¹æ®è´å¶æ–¯å›å½’å¾—åˆ°ï¼š<br>$$<br>\begin{align<em>}<br>&amp;y^â€|x^â€, x, y = N(\mu ^ {â€œ}, z^â€)\<br>&amp;\mu ^ {â€œ} = \mu(x^â€) + K_â€K^{-1}(y-u(x))\<br>&amp;z^â€ = K^{â€œâ€}-K_â€K^{-1}K_â€^T<br>\end{align</em>}<br>$$</p><h4 id="3-1-3-GPRè®­ç»ƒ"><a href="#3-1-3-GPRè®­ç»ƒ" class="headerlink" title="3.1.3 GPRè®­ç»ƒ"></a>3.1.3 GPRè®­ç»ƒ</h4><p>åœ¨GPRä¸­è®­ç»ƒé›†ç»™å®šäº†ï¼Œæ ¸å‡½æ•°(ä¹Ÿå«åæ–¹å·®å‡½æ•°)ç»™å®šäº†ï¼ŒåŸºæœ¬éƒ½ç»™å®šäº†ï¼Œé‚£ç»“æœä¹Ÿåº”è¯¥å®šäº†ï¼Ÿè™½ç„¶éƒ½ç»™å®šäº†ï¼Œä½†æ˜¯<code>kernel</code>ä¸­çš„<strong>è¶…å‚æ•°</strong>å¹¶æ²¡æœ‰ç»™å®šã€‚æ‰€è°“çš„è®­ç»ƒå°±æ˜¯è®­ç»ƒå¾—åˆ°è¿™ä¸ªè¶…å‚æ•°ã€‚åªæœ‰å½“è¶…å‚æ•°ç¡®å®šåæˆ‘ä»¬æ‰ç¡®å®šäº†é«˜æ–¯è¿‡ç¨‹å¾—åˆ°çš„åˆ†å¸ƒã€‚å› æ­¤ï¼ŒGPRçš„è®­ç»ƒæ ¸å¿ƒæ˜¯å­¦ä¹ <code>kernel</code>çš„è¶…å‚æ•°ã€‚</p><h3 id="3-2-å°ç»“"><a href="#3-2-å°ç»“" class="headerlink" title="3.2 å°ç»“"></a>3.2 å°ç»“</h3><ul><li>é«˜æ–¯è¿‡ç¨‹å¯ä»¥çœ‹åšæ˜¯å¤šç»´é«˜æ–¯åˆ†å¸ƒå‘æ— é™ç»´çš„æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥å°†$y=y_1,y_2,â€¦,y_n$çœ‹ä½œæ˜¯ä»$n$ç»´é«˜æ–¯åˆ†å¸ƒä¸­éšæœºæŠ½å–çš„ä¸€ä¸ªç‚¹</li><li>å¯¹é«˜æ–¯è¿‡ç¨‹çš„åˆ»ç”»ï¼Œå¦‚åŒé«˜æ–¯åˆ†å¸ƒä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨å‡å€¼å’Œæ–¹å·®æ¥åˆ»ç”»ã€‚é€šå¸¸åœ¨åº”ç”¨é«˜æ–¯è¿‡ç¨‹ $fâˆ¼GP(\mu,K)$çš„æ–¹æ³•ä¸­ï¼Œéƒ½æ˜¯å‡è®¾å‡å€¼$m\muä¸ºé›¶ï¼Œè€Œåæ–¹å·®å‡½æ•°$$K$åˆ™æ˜¯æ ¹æ®å…·ä½“åº”ç”¨è€Œå®šã€‚</li><li>é«˜æ–¯å›å½’çš„æœ¬è´¨å…¶å®å°±æ˜¯é€šè¿‡ä¸€ä¸ªæ˜ å°„æŠŠè‡ªå˜é‡ä»ä½ç»´ç©ºé—´æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ï¼ˆç±»ä¼¼äºæ”¯æŒå‘é‡æœºä¸­çš„æ ¸å‡½æ•°å°†ä½ç»´çº¿æ€§ä¸å¯åˆ†æ˜ å°„ä¸ºé«˜ç»´çº¿æ€§å¯åˆ†ï¼‰ï¼Œåªéœ€æ‰¾åˆ°åˆé€‚çš„æ ¸å‡½æ•°ï¼Œå°±å¯ä»¥çŸ¥é“ $p(f|x,X,y)$çš„åˆ†å¸ƒï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯é«˜æ–¯æ ¸å‡½æ•°</li></ul><h2 id="4-æœºå™¨å­¦ä¹ ä¸­çš„é«˜æ–¯è¿‡ç¨‹"><a href="#4-æœºå™¨å­¦ä¹ ä¸­çš„é«˜æ–¯è¿‡ç¨‹" class="headerlink" title="4. æœºå™¨å­¦ä¹ ä¸­çš„é«˜æ–¯è¿‡ç¨‹"></a>4. æœºå™¨å­¦ä¹ ä¸­çš„é«˜æ–¯è¿‡ç¨‹</h2><p><strong>é’ˆå¯¹æœºå™¨å­¦ä¹ çš„é«˜æ–¯è¿‡ç¨‹(Gaussian Processes for Machine Learning,å³ GPML)</strong> æ˜¯ä¸€ä¸ªé€šç”¨çš„ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼Œä¸»è¦è¢«è®¾è®¡ç”¨æ¥è§£å†³<em>å›å½’</em>é—®é¢˜ã€‚ å®ƒä¹Ÿå¯ä»¥æ‰©å±•ä¸º<em>æ¦‚ç‡åˆ†ç±»(probabilistic classification)</em>ï¼Œä½†æ˜¯åœ¨å½“å‰çš„å®ç°ä¸­ï¼Œè¿™åªæ˜¯<em>å›å½’</em>å­¦ä¹ çš„ä¸€ä¸ªåç»­å¤„ç†ã€‚</p><p>GPMLçš„ä¼˜åŠ¿å¦‚ä¸‹:</p><blockquote><ul><li>é¢„æµ‹æ˜¯å¯¹è§‚å¯Ÿå€¼çš„æ’å€¼ï¼ˆè‡³å°‘åœ¨æ™®é€šç›¸å…³æ¨¡å‹ä¸Šæ˜¯çš„ï¼‰.</li><li>é¢„æµ‹æ˜¯å¸¦æœ‰æ¦‚ç‡çš„(Gaussian)ã€‚æ‰€ä»¥å¯ä»¥ç”¨æ¥è®¡ç®—ç»éªŒç½®ä¿¡åŒºé—´å’Œè¶…è¶Šæ¦‚ç‡ ä»¥ä¾¿å¯¹æ„Ÿå…´è¶£çš„åŒºåŸŸé‡æ–°æ‹Ÿåˆï¼ˆåœ¨çº¿æ‹Ÿåˆï¼Œè‡ªé€‚åº”æ‹Ÿåˆï¼‰é¢„æµ‹ã€‚</li><li>å¤šæ ·æ€§: å¯ä»¥æŒ‡å®šä¸åŒçš„çº¿æ€§å›å½’æ¨¡å‹ <a href="http://sklearn.lzjqsdd.com/modules/linear_model.html#linear-model" target="_blank" rel="noopener">linear regression models</a> å’Œç›¸å…³æ¨¡å‹ <a href="http://sklearn.lzjqsdd.com/modules/gaussian_process.html#correlation-models" target="_blank" rel="noopener">correlation models</a> ã€‚ å®ƒæä¾›äº†æ™®é€šæ¨¡å‹ï¼Œä½†ä¹Ÿèƒ½æŒ‡å®šå…¶å®ƒé™æ€çš„è‡ªå®šä¹‰æ¨¡å‹</li></ul></blockquote><p>GPMLçš„ç¼ºç‚¹å¦‚ä¸‹:</p><blockquote><ul><li>ä¸æ˜¯ç¨€ç–çš„ï¼Œå®ƒä½¿ç”¨å…¨éƒ¨çš„æ ·æœ¬/ç‰¹å¾ä¿¡æ¯æ¥åšé¢„æµ‹ã€‚</li><li>å¤šç»´ç©ºé—´ä¸‹ä¼šå˜å¾—ä½æ•ˆ â€“ å³å½“ç‰¹å¾çš„æ•°é‡è¶…è¿‡å‡ åä¸ª,å®ƒå¯èƒ½ç¡®å®ä¼šè¡¨ç°å¾ˆå·®ï¼Œè€Œä¸”è®¡ç®—æ•ˆç‡ä¸‹é™ã€‚</li><li>åˆ†ç±»åªæ˜¯ä¸€ä¸ªåå¤„ç†è¿‡ç¨‹, æ„å‘³ç€è¦å»ºæ¨¡ï¼Œé¦–å…ˆéœ€è¦æä¾›è¯•éªŒçš„å®Œæ•´æµ®ç‚¹ç²¾åº¦æ ‡é‡è¾“å‡º <img src="http://sklearn.lzjqsdd.com/_images/math/276f7e256cbddeb81eee42e1efc348f3cb4ab5f8.png" srcset="/img/loading.gif" alt="y"> æ¥è§£å†³å›å½’é—®é¢˜ã€‚</li></ul></blockquote><h2 id="5-GPå»ºæ¨¡æ—¶çš„é—®é¢˜"><a href="#5-GPå»ºæ¨¡æ—¶çš„é—®é¢˜" class="headerlink" title="5. GPå»ºæ¨¡æ—¶çš„é—®é¢˜"></a>5. GPå»ºæ¨¡æ—¶çš„é—®é¢˜</h2><p>ç”¨GPå¯¹æ•°æ®å»ºæ¨¡ï¼Œé¦–å…ˆå¾—è€ƒè™‘ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š<br>ï¼ˆ1ï¼‰å¦‚ä½•é€‰æ‹©<strong>æ ¸å‡½æ•°</strong>ï¼Ÿ<br>        é€‰ä»€ä¹ˆæ ¸å‡½æ•°ï¼ˆè¿™ç‚¹éå¸¸é‡è¦ï¼‰ï¼Ÿé€‰æœ€å¸¸ç”¨çš„SEè¿˜æ˜¯SMPè¿˜æ˜¯æ··åˆï¼ˆåŸºäºå¯¹æ•°æ®çš„ç†è§£ï¼‰ï¼Ÿ<br>ï¼ˆ2ï¼‰è¶…å‚æ•°<strong>ç‰©ç†å«ä¹‰</strong>æ˜¯ä»€ä¹ˆï¼Ÿ<br>       è®­ç»ƒå®Œæ¨¡å‹åï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æµ‹è¯•æ•ˆæœä¸ä¼šå¾ˆå¥½ï¼Œå†å›å¤´çœ‹çœ‹å­¦åˆ°çš„è¶…å‚æ•°å˜åŒ–å¦‚ä½•ï¼Ÿé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™äº›è¶…å‚æ•°åˆä»£è¡¨ä»€ä¹ˆç‰©ç†å«ä¹‰å‘¢ï¼ˆåŸºäºå¯¹æ ¸å‡½æ•°çš„ç†è§£ï¼‰ï¼Ÿ<br>ï¼ˆ3ï¼‰<strong>éé«˜æ–¯ä¼¼ç„¶</strong>å‡½æ•°<br>       å¯¹å¸¸è§çš„åˆ†ç±»ä»»åŠ¡æ¥è¯´ï¼Œä¼¼ç„¶éé«˜æ–¯åˆ†å¸ƒï¼Œæ­¤æ—¶å…±è½­ä¼˜åŠ¿ä¸å¤å­˜åœ¨ï¼Œå¦‚ä½•æ‰¾åˆ°æœ€æœ‰æ•ˆé€¼è¿‘åéªŒçš„æ–¹æ³•ï¼ˆEPï¼ŸVIï¼Ÿï¼‰<br>ï¼ˆ4ï¼‰<strong>å¼‚æ–¹å·®</strong><br>       äº‹å®ä¸Šï¼Œå¾ˆå¤šæ ‡ç­¾éƒ½ä¸æ˜¯ç®€å•çš„é«˜æ–¯åˆ†å¸ƒï¼Œç”šè‡³æ ‡ç­¾å™ªå£°éƒ½æ˜¯å¼‚æ–¹å·®åˆ†å¸ƒï¼ˆæ¯”å¦‚æ ‡ç­¾å€¼è·¨åº¦è¶…å¤šå‡ ä¸ªæ•°é‡çº§ï¼‰ï¼Œåˆè¯¥å¦‚ä½•è§£å†³ï¼ˆå¯å‚è€ƒwarped GPsï¼‰ï¼Ÿ</p><ol><li><a href="https://blog.csdn.net/paulfeng20171114/article/details/80276061" target="_blank" rel="noopener">é€å½»ç†è§£é«˜æ–¯è¿‡ç¨‹Gaussian Process (GP)</a></li><li><a href="https://cloud.tencent.com/developer/article/1353538" target="_blank" rel="noopener">[é‡ç‚¹]æœºå™¨å­¦ä¹ -é«˜æ–¯è¿‡ç¨‹å’Œéšæœºè¿‡ç¨‹å›å½’</a></li><li><a href="https://blog.csdn.net/lj6052317/article/details/78772494" target="_blank" rel="noopener">æœºå™¨å­¦ä¹ ä¸­çš„é«˜æ–¯è¿‡ç¨‹</a></li><li><a href="https://www.bilibili.com/video/av35626047/" target="_blank" rel="noopener">é«˜æ–¯è¿‡ç¨‹è§†é¢‘è®²è§£</a></li><li><a href="https://www.youtube.com/watch?v=vU6AiEYED9E&list=PLD0F06AA0D2E8FFBA&index=151&t=0s" target="_blank" rel="noopener">[è§†é¢‘]Gaussian processes - definition and first examples</a></li><li><a href="https://www.youtube.com/watch?v=4vGiHC35j9s" target="_blank" rel="noopener">[è§†é¢‘]Machine learning - Introduction to Gaussian processes</a></li><li><a href="https://www.zhihu.com/question/46631426" target="_blank" rel="noopener">å¦‚ä½•é€šä¿—æ˜“æ‡‚çš„ç†è§£é«˜æ–¯è¿‡ç¨‹</a></li><li><a href="[https://zh.wikipedia.org/zh/%E9%AB%98%E6%96%AF%E8%BF%87%E7%A8%8B](https://zh.wikipedia.org/zh/é«˜æ–¯è¿‡ç¨‹)">é«˜æ–¯è¿‡ç¨‹-ç»´åŸºç™¾ç§‘</a></li><li><a href="https://www.jgoertler.com/visual-exploration-gaussian-processes/" target="_blank" rel="noopener">å¯è§†åŒ–ç†è§£é«˜æ–¯è¿‡ç¨‹</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>kernel</tag>
      
      <tag>bayes</tag>
      
      <tag>gaussian</tag>
      
      <tag>å›å½’</tag>
      
      <tag>regression</tag>
      
      <tag>GPR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonä¸‹çš„c/c++æ‰©å±•æ–¹å¼è¯¦è§£</title>
    <link href="/2019/04/18/%E5%9C%A8python%E4%B8%8B%E7%9A%84c%E6%88%96c++%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/"/>
    <url>/2019/04/18/%E5%9C%A8python%E4%B8%8B%E7%9A%84c%E6%88%96c++%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p><code>python</code>ä½œä¸ºä¸€ç§èƒ¶æ°´è¯­è¨€ï¼Œæœ€é‡è¦çš„æ˜¯éå¸¸å®¹æ˜“çš„å’Œ<code>shell</code>ï¼Œ<code>c/c++</code>ä¹‹é—´è¿›è¡Œç›¸äº’æ‰©å±•ï¼Œè€Œæœ¬æ–‡ä¸»è¦æ˜¯å¯¹<code>python</code>çš„<code>c/c++</code>æ‰©å±•è¿›è¡Œè¯¦ç»†è®²è§£ï¼Œå¹¶ä½œä¸ºç¬”è®°ä¾¿äºä»¥åçš„ä½¿ç”¨ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦è¿›è¡Œc-c-æ‰©å±•"><a href="#ä¸ºä»€ä¹ˆè¦è¿›è¡Œc-c-æ‰©å±•" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿›è¡Œc/c++æ‰©å±•"></a>ä¸ºä»€ä¹ˆè¦è¿›è¡Œc/c++æ‰©å±•</h2><p><code>python</code>ä¹‹æ‰€ä»¥ä½¿ç”¨å¹¿æ³›ï¼Œä¸»è¦æ˜¯å› ä¸ºä½¿ç”¨ç®€å•ï¼Œç¬¬ä¸‰æ–¹æ‰©å±•åº“å¼ºå¤§ï¼Œå¯¹äºæŸä¸ªé—®é¢˜ï¼Œèƒ½è¿…é€Ÿçš„éªŒè¯è‡ªå·±çš„æ€è·¯æˆ–æŸä¸ªåŸå‹ã€‚ä½†æ˜¯ï¼Œ<code>python</code>çš„æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œå› æ­¤å¾ˆå¤šæ¶‰åŠåˆ°æ•ˆç‡çš„æ—¶å€™éœ€è¦ä½¿ç”¨<code>c/c++</code>æ¥å®ç°ï¼Œä¸º<code>python</code>æä¾›æ¥å£å³å¯ã€‚è¿™æ ·æ··åˆç¼–ç¨‹åï¼Œèƒ½è¾¾åˆ°å¿«é€Ÿ+æ•ˆç‡çš„åŒé‡ç›®çš„ã€‚</p><h2 id="pythonçš„c-c-æ‰©å±•"><a href="#pythonçš„c-c-æ‰©å±•" class="headerlink" title="pythonçš„c/c++æ‰©å±•"></a>pythonçš„c/c++æ‰©å±•</h2><p>åœ¨<code>python</code>ä¸‹çš„<code>c/c+</code>æ‰©å±•æœ‰å¾ˆå¤šæ–¹å¼ï¼Œä¸»è¦æœ‰<code>cffi/ctypes</code>ï¼Œ<code>cpython</code>å’Œ<code>cython</code>è¿™å‡ ç§æ–¹å¼ï¼Œå„ä¸ªæ–¹å¼éƒ½æœ‰ä¼˜åŠ¿ã€‚ä¸‹é¢å¯¹è¿™å‡ ä¸ªæ–¹å¼è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ã€‚</p><h3 id="cffiæ¥è¿›è¡Œcæ‰©å±•"><a href="#cffiæ¥è¿›è¡Œcæ‰©å±•" class="headerlink" title="cffiæ¥è¿›è¡Œcæ‰©å±•"></a>cffiæ¥è¿›è¡Œcæ‰©å±•</h3><p><code>cffi</code>æ˜¯è¿æ¥<code>c</code>å’Œ<code>python</code>çš„æ¡¥æ¢ï¼Œæ˜¯åœ¨<code>pypy</code>ä¸­åˆ†ç¦»å‡ºæ¥çš„ä¸€ä¸ªåº“ï¼Œè¿™ä¸ªå’Œ<code>python</code>è‡ªå¸¦çš„<code>ctypes</code>æ¨¡å—å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯<code>cffi</code>æ›´åŠ é€šç”¨ã€‚ä¸‹é¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>pi.h</code>å’Œ<code>pi.c</code>æ–‡ä»¶ï¼š</p><pre><code class="c">// file: pi.h#ifndef C_EXTEND_PYTHON_PI_H#define C_EXTEND_PYTHON_PI_Hfloat pi_approx(float n);#endif *//C_EXTEND_PYTHON_PI_H*</code></pre><pre><code class="c">// file: pi.cfloat pi_approx(float n){    return 3.1415926 * n * n;}</code></pre><p>ä½¿ç”¨cffiæ¨¡å—æ¥å¯¹è¿™ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œä¼šç”Ÿæˆä¸€ä¸ª<code>c source</code>æ–‡ä»¶å’Œ<code>.so</code>æˆ–<code>.pyd</code>æ–‡ä»¶ï¼Œå¯ä»¥åœ¨pythonä¸‹ç›´æ¥å¼•ç”¨ï¼Œè¿›è¡Œä½¿ç”¨ï¼Œç¼–è¯‘æ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre><code class="python">from cffi import FFIffi_builder = FFI()ffi_builder.cdef(&quot;&quot;&quot;    float pi_approx(float n);&quot;&quot;&quot;)# This describes the extension module &quot;_pi_cffi&quot; to produce.ffi_builder.set_source(&quot;_pi_cffi&quot;,                       &quot;&quot;&quot;                           #include &quot;pi.c&quot;   // the C header of the library                       &quot;&quot;&quot;,                       libraries=[])  # library name, for the linkerif *__name__ == &quot;__main__&quot;:    ffi_builder.compile(verbose=True )</code></pre><p>ç›´æ¥è¿è¡Œè¯¥ç¼–è¯‘æ–‡ä»¶åˆ™å¯åˆ›å»ºpythonçš„cæ‰©å±•åº“ï¼š<code>.so</code>æˆ–<code>.pyd</code>æ–‡ä»¶ï¼›å¦å¤–ä¹Ÿä¼šç”Ÿæˆ<code>_pi_cffi.c</code>çš„æºç ã€‚å°†<code>.so</code>æˆ–<code>.pyd</code>æ–‡ä»¶æ”¾å¦‚å¯¹åº”çš„ç›®å½•å³å¯å®ç°å¼•ç”¨ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒæ–¹ä¾¿ï¼Œèƒ½è¿…é€Ÿæ„å»ºcæ‰©å±•ã€‚</p><a id="more"></a><h3 id="cpythonçš„æ–¹å¼"><a href="#cpythonçš„æ–¹å¼" class="headerlink" title="cpythonçš„æ–¹å¼"></a>cpythonçš„æ–¹å¼</h3><p>è¿™ç§æ–¹å¼ï¼Œæ˜¯åˆ©ç”¨Pythonçš„C-APIæ¥å£æ¥æ„å»ºpythonæ¨¡å—ã€‚Pythonçš„æ¯ä¸ªç‰ˆæœ¬å®˜æ–¹éƒ½æœ‰ç›¸åº”çš„C-APIæ–‡æ¡£ï¼Œæ¯ä¸ªç‰ˆæœ¬APIå¯èƒ½å­˜åœ¨ä¸€äº›ä¸åŒã€‚ç‰¹åˆ«æ˜¯Python2å’ŒPython3ï¼ˆæœ¬æ–‡æ˜¯åŸºäºPython3çš„ç‰ˆæœ¬ï¼‰ä¹‹é—´ã€‚ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡ä»£ç æ¥è¿›è¡Œè¯´æ˜ã€‚ä¸»è¦å®ç°ä¸€ä¸ªåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="c">/* * #include &quot;/opt/anaconda3/include/python3.6m/Python.h&quot; * Python.h has all the required function definitions to manipulate the Python objects */#include &quot;D:\Anaconda3\include\Python.h&quot;//This is the function that is called from your python codestatic PyObject* addList_add(PyObject* self, PyObject* args){    PyObject * listObj; // ç”³è¯·ä¸€ä¸ªpythonå¯¹è±¡æ¥å­˜list    // argså‚æ•°è§£æ, å¹¶å°†å€¼å­˜å…¥åˆ°listObjå˜é‡    if (! PyArg_ParseTuple( args, &quot;O&quot;, &amp;listObj ))        return NULL;    // è·å–listçš„é•¿åº¦    long length = PyList_Size(listObj);    // å¾ªç¯è·å–listä¸­çš„å€¼, å¹¶æ±‚å’Œ    long i, sum =0;    for (i = 0; i &lt; length; i++) {        //get an element out of the list - the element is also a python objects        PyObject* temp = PyList_GetItem(listObj, i);         //we know that object represents an integer - so convert it into C long        long elem = PyLong_AsLong(temp);        sum += elem;    }    //value returned back to python code - another python object    //build value here converts the C long to a python integer    return Py_BuildValue(&quot;l&quot;, sum);}// è¿™é‡Œæ˜¯ä¸ºä¸Šé¢çš„å‡½æ•°å®šä¹‰ä¸€ä¸ªdocstringstatic char addList_docs[] =&quot;add(  ): add all elements of the list\n&quot;;/* * This table contains the relavent info mapping -&lt;function-name in python module&gt;, &lt; * actual-function&gt;,&lt;type-of-args the function expects&gt;, &lt;docstring associated with the function&gt; */static PyMethodDef addList_funcs[] = {    {&quot;add&quot;, (PyCFunction)addList_add, METH_VARARGS, addList_docs},    {NULL, NULL, 0, NULL}};/*defined PyModuleDef struct*/static struct PyModuleDef moduledef = {        PyModuleDef_HEAD_INIT,        &quot;addList&quot;,  // module name        NULL,        -1,        addList_funcs, // functions        NULL,        NULL,        NULL,        NULL};/* * addList is the module name, and this is the initialization block of the module. * &lt;desired module name&gt;, &lt;the-info-table&gt;, &lt;module&#39;s-docstring&gt; */static PyObject *SpamError = NULL;// åˆ›å»ºæ¨¡å—PyMODINIT_FUNC PyInit_addList(void){    PyObject *m;    m = PyModule_Create(&amp;moduledef);    if (m == NULL)        return NULL;    SpamError = PyErr_NewException(&quot;addList.error&quot;, NULL, NULL);    Py_INCREF(SpamError);    PyModule_AddObject(m, &quot;error&quot;, SpamError);    return m;}</code></pre><p>å®Œæˆä¸Šé¢åŠŸèƒ½åï¼Œç¼–å†™ä¸€ä¸ªsetup.pyå³å¯ï¼š</p><pre><code class="python">from distutils.core import setup, Extensionsetup(name=&#39;addList&#39;, version=&#39;1.0&#39;, ext_modules=[Extension(&#39;addList&#39;, [&#39;addList.c&#39;])])</code></pre><p>è¿è¡Œ<code>python setup.py build</code>å³å¯è¿›è¡Œç¼–è¯‘ã€‚ç¼–è¯‘åæ‚”ç”Ÿæˆç›¸åº”çš„<code>.so</code>æˆ–<code>.pyd</code>æ–‡ä»¶æ–‡ä»¶ï¼šæ¨¡å—åç§°ä¸ºaddListã€‚pythonå¯ä»¥ç›´æ¥è¿›è¡Œå¼•ç”¨è¯¥æ–‡ä»¶å³å¯ã€‚<br>è¿™ç§æ–¹æ³•æ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯éœ€è¦å¯¹pythonçš„C-APIç›¸å¯¹æœ‰äº†è§£ã€‚å®˜æ–¹æ˜¯æ¨èè¿™ç§æ–¹æ³•æ¥è¿›è¡Œæ‰©å±•çš„ï¼Œæ¯”å…¶ä»–æ–¹æ³•éƒ½è¦åŸç”Ÿï¼Œå¯¹c++ä¹Ÿæ”¯æŒçš„éå¸¸å¥½ã€‚</p><h3 id="CYTHONçš„æ–¹å¼è¿›è¡Œæ‰©å±•"><a href="#CYTHONçš„æ–¹å¼è¿›è¡Œæ‰©å±•" class="headerlink" title="CYTHONçš„æ–¹å¼è¿›è¡Œæ‰©å±•"></a>CYTHONçš„æ–¹å¼è¿›è¡Œæ‰©å±•</h3><p><code>cython</code>å¯ä»¥çœ‹æˆä¸€ä¸ªpythonçš„è¶…é›†ï¼Œä¸ä»…ç»“åˆäº†cçš„è¯­æ³•ï¼ŒåŒæ—¶èƒ½ä½¿ç”¨cçš„ä¸œè¥¿ã€‚å®ƒçš„è¿è¡Œè¿‡ç¨‹ä¸»è¦æ˜¯å°†<code>cython</code>å®ç°çš„ä»£ç è½¬æˆcä»£ç ï¼Œå¹¶è¿›è¡Œç¼–è¯‘å½¢æˆPythonçš„æ‰©å±•åº“ã€‚<code>cython</code>ä¸ä»…ä»…è¿›è¡Œäº†Pythonä¸Cä¹‹é—´çš„è½¬æ¢ï¼Œè¿˜å¯¹éƒ¨åˆ†æ“ä½œè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨<code>cython</code>å¯ä»¥ä½¿ç”¨cçš„ä»»ä½•ä¸œè¥¿, åŒæ—¶æ”¯æŒPythonçš„å‡½æ•°å’Œç±»çš„æ–¹å¼ç¼–ç¨‹ã€‚ç›®å‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“éƒ½æœ‰ä½¿ç”¨å®ƒï¼Œæ¯”å¦‚<code>scikit-learn</code>ï¼Œ<code>scipy</code>ç­‰ç­‰å¾ˆå¤šã€‚å…·ä½“çš„ä¸€äº›ç”¨æ³•å¯ä»¥å‚è€ƒå®ƒçš„å®˜æ–¹æ–‡æ¡£ã€‚ä¸‹é¢æˆ‘é€šè¿‡<code>cython</code>ä»ä¸åŒçš„è§’åº¦æ¥å±•ç¤ºå®ƒçš„ç”¨æ³•ã€‚</p><h4 id="ä½¿ç”¨cythonè¿æ¥cæ–‡ä»¶å’Œpython"><a href="#ä½¿ç”¨cythonè¿æ¥cæ–‡ä»¶å’Œpython" class="headerlink" title="ä½¿ç”¨cythonè¿æ¥cæ–‡ä»¶å’Œpython"></a>ä½¿ç”¨cythonè¿æ¥cæ–‡ä»¶å’Œpython</h4><p>å‡è®¾ç°åœ¨æˆ‘å†™ä¸€ä¸ª<code>c</code>çš„ä¸€äº›æ–¹æ³•ï¼ŒåŒ…æ‹¬äº†å¤´æ–‡ä»¶å’Œæºæ–‡ä»¶ï¼š</p><pre><code>// file: csample.h#include &lt;stdio.h&gt;#include &lt;math.h&gt;int add(int x, int y);int sub(int x, int y);</code></pre><pre><code class="c">// file: csample.cint add(int x, int y){    return x + y;}int sub(int x, int y){    return x - y;}</code></pre><p>ç°åœ¨æˆ‘è¦ç”¨<code>cython</code>æ¥ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„cæ–¹æ³•ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>cython</code>çš„å¤´æ–‡ä»¶<code>csample.pxd</code>æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­å¼•ç”¨<code>csample.h</code>çš„æ–¹æ³•,ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª<code>Point</code>ç»“æ„ä½“ï¼š</p><pre><code class="c">// file csample.pxdcdef extern from &quot;csample.h&quot;:    int add(int x, int y)    int sub(int x, int y)ctypedef struct Point:    double x    double y</code></pre><p>å†æ–°å»ºä¸€ä¸ª<code>pyx</code>çš„æ–‡ä»¶ï¼Œé€šè¿‡<code>cython</code>æ¥å®šä¹‰<code>python</code>çš„æ¥å£ï¼š</p><pre><code class="python">// file: sample.pyxcimport csamplefrom cpython.pycapsule cimport *from libc.stdlib cimport malloc, freedef add(x, y):    return csample.add(x, y)def sub(x, y):    return csample.sub(x, y)cdef delPoint(object obj):    pt = &lt;csample.Point *&gt; PyCapsule_GetPointer(obj, &quot;Point&quot;)    free(&lt;void *&gt; pt)def Point(x, y):    cdef csample.Point *p    p = &lt;csample.Point *&gt; malloc(sizeof(csample.Point))    if p == NULL:        raise MemoryError(&quot;No memoery to make a point!&quot;)    p.x = x    p.y = y    return PyCapsule_New(&lt;void *&gt; p, &quot;Point&quot;, &lt;PyCapsule_Destructor&gt;delPoint)</code></pre><p>è¿™æ ·æ•´ä¸ªè¿‡ç¨‹å°±å®ç°äº†ï¼ŒåŸºæœ¬å’Œä¸Šé¢<code>cpython</code>çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯é‡‡ç”¨çš„æ–¹å¼ä¸åŒã€‚ä¸‹é¢ç¼–å†™ä¸€ä¸ª<code>setup.py</code>çš„æ–‡ä»¶å³å¯è¿›è¡Œç¼–è¯‘<code>python setup.py build</code>ã€‚ç”Ÿæˆå¯¹ä¸€ä¸ªçš„æ‰©å±•åŒ…ã€‚</p><pre><code class="python"># file: setup.pyfrom distutils.core import setupfrom distutils.extension import Extensionfrom Cython.Distutils import build_extext_modules = [    Extension(&#39;sample&#39;,  # æ‰©å±•åŒ…åç§°              [&#39;sample.pyx&#39;, &#39;E:\\WorkSpace\\2019\CythonExample\\c_mix_cython\\csample.c&#39;], # ç”¨åˆ°çš„æºæ–‡ä»¶              libraries=[],  # ä¾èµ–çš„åº“              library_dirs=[&#39;.&#39;])]setup(    name=&#39;Sample extension module&#39;,    cmdclass={&#39;build_ext&#39;: build_ext},    ext_modules=ext_modules)</code></pre><h4 id="åœ¨cythonä¸­ä½¿ç”¨å¤´æ–‡ä»¶-pxd"><a href="#åœ¨cythonä¸­ä½¿ç”¨å¤´æ–‡ä»¶-pxd" class="headerlink" title="åœ¨cythonä¸­ä½¿ç”¨å¤´æ–‡ä»¶(pxd)"></a>åœ¨cythonä¸­ä½¿ç”¨å¤´æ–‡ä»¶(pxd)</h4><p>å¤´æ–‡ä»¶çš„ä½¿ç”¨å…·æœ‰ä¸€å®šçš„å¥½å¤„ï¼Œæ–¹ä¾¿å¤§é‡ä»£ç çš„ç»´æŠ¤ç­‰ç­‰ã€‚åœ¨<code>cython</code>ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å¤´æ–‡ä»¶ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å·²ç»åº”ç”¨åˆ°äº†ã€‚ä¸‹é¢å†è¿›è¡Œè¯´æ˜ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œ å®šä¹‰ç›¸åº”çš„æ–¹æ³•ï¼Œç»“æ„ç­‰ï¼š</p><pre><code class="python"># sample.pxdcdef int function1(int a, int b=*)cdef double add_one(double x)cdef class A:    cdef public int a, b    cpdef void foo(self, double x)</code></pre><p>å†æ ¹æ®å¤´æ–‡ä»¶å®ç°å¯¹åº”çš„æ–¹æ³•ï¼š</p><pre><code class="python"># file: sample.pyxcdef int function1(int a, int b=10):    cdef int x = a - b    return x + a * bcdef double add_one(double x):    return x + 1cdef class A:    def __init__(self, int b=0):        self.a = 13        self.b = b    cpdef void foo(self, double x):        print(x + add_one(10.25))</code></pre><p>ä¸‹é¢ç¼–å†™<code>setup.py</code>è¿›è¡Œç¼–è¯‘å³å¯ï¼š</p><pre><code class="python"># setup.pyfrom distutils.core import setupfrom distutils.extension import Extensionfrom Cython.Distutils import build_extext_modules = [    Extension(&#39;sample&#39;,              [&#39;sample.pyx&#39;],              libraries=[],              library_dirs=[&#39;.&#39;])]setup(    name=&#39;Sample extension module&#39;,    cmdclass={&#39;build_ext&#39;: build_ext},    ext_modules=ext_modules)</code></pre><h4 id="åœ¨cythonä¸­ä½¿ç”¨æŒ‡é’ˆï¼ˆpointerï¼‰"><a href="#åœ¨cythonä¸­ä½¿ç”¨æŒ‡é’ˆï¼ˆpointerï¼‰" class="headerlink" title="åœ¨cythonä¸­ä½¿ç”¨æŒ‡é’ˆï¼ˆpointerï¼‰"></a>åœ¨cythonä¸­ä½¿ç”¨æŒ‡é’ˆï¼ˆ<code>pointer</code>ï¼‰</h4><p>åœ¨cythonä¸­ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨æŒ‡é’ˆçš„ï¼Œå¯ä»¥å°†pythonå¯¹è±¡è½¬åŒ–ä¸ºæŒ‡é’ˆåœ¨<code>cython</code>ä¸­ä½¿ç”¨ï¼Œä¸‹é¢æ˜¯å…·ä½“çš„ç¤ºä¾‹ï¼Œä»£ç ä¸­ç»™äº†æ³¨é‡Šè¯´æ˜ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚</p><pre><code class="python">from cpython cimport arrayfrom cython.parallel import prangecimport numpy as npimport cythonimport numpy as npctypedef unsigned long long ullongcdef inline ullong add_list(unsigned long *array, unsigned long size):    &quot;&quot;&quot;æ³¨æ„æ•°æ®ç±»å‹,åœ¨cä¸­, int, long, long longç­‰ä¸åŒçš„æ•°æ®ç±»å‹, è¾¹ç•Œä¸åŒ, å› æ­¤å¿…é¡»è¦æ»¡è¶³æ‰€æœ‰çš„æ•°æ®åœ¨æœ€å¤§è¾¹ç•Œå†…, å¦åˆ™ç»“æœæ˜¯ä¸æ­£ç¡®çš„&quot;&quot;&quot;    cdef ullong i = 0    cdef ullong sum_v = 0    for i in prange(size, nogil=True):        sum_v += array[i]    return sum_vdef addList(list_array, long s):    &quot;&quot;&quot;å°†ä¸€ä¸ªpythonå¯¹è±¡listä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°, è¯¥å‡½æ•°çš„æ¥æ”¶å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆ(int *)ç±»å‹, é€šè¿‡æŒ‡é’ˆæ¥æ“ä½œpythonçš„listå¯¹è±¡.    reference: Cython: can&#39;t convert Python object to &#39;double *&#39;:        https://stackoverflow.com/questions/17014379/cython-cant-convert-python-object-to-double    &quot;&quot;&quot;    cdef array.array p_array =array.array(&#39;L&#39;, list_array)  # transform c array    return add_list(p_array.data.as_ulongs, s)def addList_numpy(list_array, long s):    &quot;&quot;&quot;é€šè¿‡numpyçš„ndarrayå°†listå¯¹è±¡è½¬æ¢ä¸ºcçš„æŒ‡é’ˆç±»å‹    reference: tutorials Numpy Pointer To C with Cython        https://github.com/cython/cython/wiki/tutorials-NumpyPointerToC    &quot;&quot;&quot;    cdef np.ndarray[long, ndim=1, mode=&#39;c&#39;] p_array = np.array(list_array)  # transform c memory type    return add_list(&lt;unsigned long *&gt; &amp;p_array[0], s)  # &amp;p_array[0] or &lt;int*&gt; p_array.data</code></pre><h4 id="åœ¨cythonä¸­ä½¿ç”¨ç»“æ„ä½“ï¼ˆstructï¼‰"><a href="#åœ¨cythonä¸­ä½¿ç”¨ç»“æ„ä½“ï¼ˆstructï¼‰" class="headerlink" title="åœ¨cythonä¸­ä½¿ç”¨ç»“æ„ä½“ï¼ˆstructï¼‰"></a>åœ¨cythonä¸­ä½¿ç”¨ç»“æ„ä½“ï¼ˆstructï¼‰</h4><p><code>cython</code>å¯ä»¥ä½¿ç”¨cçš„ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤ç»“æ„ä½“ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªå°çš„ä¾‹å­æ¥è¯´æ˜åœ¨<code>cython</code>ä¸­çš„ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœåœ¨<code>cython</code>ä¸­è¿”å›ç»“æ„ä½“ï¼Œå¯¹åº”åˆ°<code>python</code>ä¸­å°±æ˜¯ä¸€ä¸ªå­—å…¸çš„å¯¹è±¡ã€‚</p><pre><code class="python">ctypedef struct Node:    double x    double ycdef Node nodedef setNode(double x, double y):    cdef Node *p_node = &amp;node    p_node.x = x    p_node.y = y    return p_node[0]  # è¿”å›äº†å­—å…¸</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸Šé¢ä¸»è¦å¯¹<code>cffi</code>, <code>cpython</code>å’Œ<code>cython</code>çš„ä¸‰ç§æ–¹å¼è¿›è¡Œäº†è¯¦è§£ã€‚è¿™ä¸‰ç§æ–¹å¼ä¹Ÿæ˜¯ä¸»æµçš„æ–¹å¼ï¼Œå…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„åº”è¯¥æ˜¯<code>cython</code>çš„æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å’Œ<code>numpy</code>çš„ç»“åˆã€‚å…¶æ¬¡æ˜¯<code>cffi</code>çš„æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯æ¨è<code>cpython</code>çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æ›´åŠ åŸç”Ÿï¼Œå’Œpythonç»“åˆçš„æ›´å¥½ï¼Œä½†æ˜¯ï¼Œéš¾åº¦ä¹Ÿæ˜¯æœ€é«˜çš„ã€‚åœ¨å·¥ä½œåº”ç”¨ä¸­å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©ä¸åŒçš„æ–¹å¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>c/c++</tag>
      
      <tag>numpy</tag>
      
      <tag>cython</tag>
      
      <tag>ä¼˜åŒ–</tag>
      
      <tag>compile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šçº§ç½‘ç»œä¼˜åŒ–çš„è§„åˆ’é—®é¢˜ç®€åŒ–-Pythoné¢„æ¼”</title>
    <link href="/2019/04/11/%E5%A4%9A%E7%BA%A7%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98%E4%B8%AD%E7%9A%84%E8%A7%84%E5%88%92%E9%97%AE%E9%A2%98%E7%AE%80%E5%8C%96/"/>
    <url>/2019/04/11/%E5%A4%9A%E7%BA%A7%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98%E4%B8%AD%E7%9A%84%E8%A7%84%E5%88%92%E9%97%AE%E9%A2%98%E7%AE%80%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯å’Œç›®æ ‡"><a href="#èƒŒæ™¯å’Œç›®æ ‡" class="headerlink" title="èƒŒæ™¯å’Œç›®æ ‡"></a>èƒŒæ™¯å’Œç›®æ ‡</h2><p>åœ¨ç‰©æµç½‘ç»œä¸­ï¼Œç»å¸¸å­˜åœ¨éœ€è¦ä¼˜åŒ–çš„ç½‘ç»œç»“æ„ï¼Œæ¯”å¦‚ä»ç”Ÿäº§ä¸­å¿ƒåˆ°ä¸€çº§ä»“åº“ ï¼Œåˆ°äºŒçº§ä»“åº“å†åˆ°é…é€ä¸­å¿ƒï¼Œè¿™æ ·å½¢æˆä¸€ä¸ªå¤šçº§çš„åˆ†ä»“ä½“ç³»ã€‚åœ¨å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šé‡åˆ°DCå±‚æˆ–TCå±‚çš„é€‰å€é—®é¢˜ï¼Œä¸€èˆ¬ä¼šé‡åˆ°ä¼˜åŒ–é—®é¢˜ï¼Œä¼˜åŒ–çš„ç›®æ ‡ä¸»è¦è€ƒè™‘å¤šä¸ªæ–¹é¢çš„æˆæœ¬ï¼Œå¦‚è¿è¾“æˆæœ¬ï¼Œä»“åº“æˆæœ¬ï¼Œè½¬è¿æˆæœ¬ç­‰ç­‰ã€‚å¦‚æœæŒ‰ç…§å¤šçº§ç½‘ç»œçš„æ¨¡å¼è¿›è¡Œè€ƒè™‘ï¼Œä¸€èˆ¬è§„åˆ’é—®é¢˜ä¼šæˆä¸ºéçº¿æ€§çš„æ•´æ•°è§„åˆ’é—®é¢˜ï¼Œåœ¨æ±‚è§£ä¸Šæ˜¯éå¸¸éš¾ä¸”å»ºæ¨¡ä¹Ÿæ¯”è¾ƒéš¾ã€‚</p><p>ç°åœ¨å¯¹äºè¿™æ ·çš„å…¶ä¸­é€‰å€çš„é—®é¢˜è¿›è¡Œæ€è€ƒï¼šå‡è®¾æˆ‘ä»¬åªæ˜¯è€ƒè™‘è¿è¾“æˆæœ¬æˆ–è·ç¦»ä¸Šçš„æˆæœ¬ï¼ŒDCå±‚çš„ä»“åº“å¯ä»¥å‘å‘¨è¾¹çš„ä»“åº“è¿›è¡Œä¾›è´§ï¼Œè€Œä¸”ä¿è¯TCå±‚çš„ä¸€ä¸ªä»“åº“åªèƒ½å”¯ä¸€çš„DCå±‚ä»“åº“ä¾›è´§ã€‚ä»å¸¸è§„çš„å»ºæ¨¡ä¸€èˆ¬éƒ½æ˜¯åœ¨DCå±‚è®¾ç½®ä¸€ä¸ªå˜é‡Xï¼Œ TCå±‚è®¾ç½®ä¸€ä¸ªå˜é‡Yï¼Œæ¥è®¡ç®—ç›®æ ‡ï¼Œå¹¶è®¾ç½®çº¦æŸï¼Œæœ€ç»ˆæ¥è¿›è¡Œæ±‚è§£ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜èƒ½ç®€åŒ–ä¹ˆï¼Ÿ</p><p>å¦‚æœèƒ½ç®€åŒ–é‚£ä¹ˆè¿™ä¸ªé—®é¢˜å°±èƒ½æ¨å¹¿åˆ°å¤šå±‚çš„é€‰å€é—®é¢˜ï¼Œä¸éœ€è¦éçº¿æ€§æ•´æ•°è§„åˆ’çš„æ–¹å¼è¿›è¡Œæ±‚è§£ã€‚èƒ½å¤§å¤§çš„ç®€åŒ–æ•´ä¸ªæ±‚è§£ï¼Œå¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„è§£ï¼Œä½†æ˜¯èƒ½å¾—åˆ°è¾ƒä¼˜çš„è§£ã€‚ç»è¿‡ä»”ç»†çš„å®éªŒå’Œæ€è€ƒï¼Œæ˜¯èƒ½è¿›è¡Œç®€åŒ–çš„ã€‚å°†DCå±‚å’ŒTCå±‚çš„åœ°å€çœ‹ä¸ºä¸€ä¸ªå˜é‡ï¼Œè¿™æ ·å°±å‡å°‘ä¸€ä¸ªå˜é‡ï¼Œè½¬åŒ–ä¸ºäº†çº¿æ€§è§„åˆ’çš„é—®é¢˜ï¼ˆLPï¼‰ã€‚DCå±‚å¯¹TCå±‚ä¸º1å¯¹Nçš„æ–¹å¼ï¼Œä½†æ˜¯TCåªèƒ½å±äºä¸€ä¸ªDCã€‚è€Œä¸”å¯ä»¥æ§åˆ¶DCå±‚çš„åœ°ç‚¹æˆ–TCå±‚çš„åœ°ç‚¹çš„ä¸ªæ•°ã€‚è§£å†³äº†é€‰å€ä¸­é‡åˆ°çš„æ‰€æœ‰é—®é¢˜ã€‚<br><img src="/uploads/wuliufencangtixi.jpg" srcset="/img/loading.gif" alt="ç‰©æµçš„å¤šçº§åˆ†ä»“ä½“ç³»"> </p><h2 id="æ•°æ®çš„å‡†å¤‡"><a href="#æ•°æ®çš„å‡†å¤‡" class="headerlink" title="æ•°æ®çš„å‡†å¤‡"></a>æ•°æ®çš„å‡†å¤‡</h2><p>è¿™é‡Œæˆ‘ä»¬å‡†å¤‡äº†ä¸€äº›åŸå¸‚çš„æ•°æ®ï¼Œå…¶ä¸­æœ‰DCï¼ŒTCå±‚å’Œæœ€ç»ˆçš„åœ°ç‚¹ã€‚æ•°æ®å­˜å‚¨äºmysqlæ•°æ®åº“ä¸­ï¼Œä¸‹é¢å®šä¹‰ä¸€ä¸ªæ•°æ®æŠ½å–çš„classï¼Œæ¥è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œå¹¶ç”Ÿæˆéœ€è¦çš„è·ç¦»çŸ©é˜µã€‚ä¾¿äºåç»­ä½¿ç”¨è¯¥çŸ©é˜µæ¥è¿›è¡Œä¼˜åŒ–ç›®æ ‡å€¼çš„è®¡ç®—ã€‚</p><a id="more"></a><pre><code class="python"># import packagesimport pymprogimport pymysqlimport pandas as pdimport numpy as npfrom collections import defaultdictclass MysqlClient(object):    &quot;&quot;&quot;    create mysql connect client    &quot;&quot;&quot;    def __init__(self, host, user, password, database=&quot;glc_lpp_dev&quot;, port=3306):        self.host = host or &quot;127.0.0.1&quot;        self.user = user        self.passwd = password        self.database = database        self.port = port        self.connection = self._get_connection()    def _get_connection(self):        &quot;&quot;&quot;get mysql connection client&quot;&quot;&quot;        try:            _connection = pymysql.connect(host=self.host, user=self.user, password=self.passwd, port=self.port,                                          database=self.database, charset=&quot;utf8&quot;)        except Exception as error:            print(&quot;Connect mysql server:%s has error, the error is: %s&quot; % (self.host, error))            _connection = None        return _connection    def query(self, sql_scripts):        &quot;&quot;&quot;        :param sql_scripts: string, use this sql scripts get data.        :return: tuple        &quot;&quot;&quot;        if self.connection is None:            raise Exception(&quot;Get mysql connection failed. The connection is NoneType object.&quot;)        cursor = self.connection.cursor()        cursor.execute(sql_scripts)        fetch_data = cursor.fetchall()        cursor.close()        return fetch_data    def close(self):        if self.connection is not None:            self.connection.commit()            self.connection.close()</code></pre><h2 id="è§„åˆ’é—®é¢˜çš„ç®€åŒ–æ–¹æ¡ˆ"><a href="#è§„åˆ’é—®é¢˜çš„ç®€åŒ–æ–¹æ¡ˆ" class="headerlink" title="è§„åˆ’é—®é¢˜çš„ç®€åŒ–æ–¹æ¡ˆ"></a>è§„åˆ’é—®é¢˜çš„ç®€åŒ–æ–¹æ¡ˆ</h2><p>åœ¨æœ¬æ¬¡çš„å®éªŒè¿‡ç¨‹ä¸­ä½¿ç”¨pymprogæ¥è¿›è¡ŒLPæ±‚è§£ï¼Œå¹¶å®šä¹‰æ•´ä¸ªç½‘ç»œæ¨¡å‹ï¼Œé€šè¿‡è·ç¦»çŸ©é˜µæ¥å®šä¹‰ç›®æ ‡å’Œçº¦æŸï¼Œå…·ä½“å¦‚ä¸‹é¢ä»£ç ä¸­çš„è¯´æ˜ï¼Œå…ˆå®šä¹‰å†³ç­–å˜é‡ï¼ˆè¿™é‡Œå®šä¹‰ä¸ºäº†0-1æ•´æ•°å˜é‡ï¼‰ï¼Œå†å®šä¹‰ç›®æ ‡å‡½æ•°ï¼ˆæœ¬ç¤ºä¾‹ä¸­ä¸»è¦å®šä¹‰äº†ä¸€ä¸ªè·ç¦»ç›¸å…³çš„ä¼˜åŒ–ç›®æ ‡ï¼‰ï¼Œå†å®šä¹‰çº¦æŸæ¡ä»¶ï¼Œæœ€ç»ˆæ±‚è§£ï¼Œå¹¶æ ¼å¼åŒ–è¾“å‡ºã€‚å…¶ä¸­çº¦æŸæ¡ä»¶å®šä¹‰éå¸¸çµæ´»ï¼š</p><ol><li>ä¸€ä¸ªTCåªèƒ½å±äºä¸€ä¸ªDC</li><li>ä¸€ä¸ªDCå¯ä»¥æœ‰å¤šä¸ªTCï¼Œè¿™å„¿å¹¶å®šä¹‰äº†è¾“å…¥çš„DCéƒ½å¿…é¡»è¢«é€‰åˆ°</li></ol><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="python">def solve_link(distance_matrix_frame, flag=1):    &quot;&quot;&quot;Find the link matrix by linear programming slove    parameters    ----------    distance_matrix_frame:         pandas.DataFrame, src positions to dst positions, index is src position.    return    ------        DataFrame, the link dataframe, the index is src positions and the columns is dst positions.    &quot;&quot;&quot;    t_frame = distance_matrix_frame.T.to_dict()    src_pos_, dst_pos_ = distance_matrix_frame.index, distance_matrix_frame.columns    constant = []    for s in src_pos_:        s_list = []        for d_ in dst_pos_:            s_list.append(t_frame[s][d_])        constant.append(s_list)     pymprog.begin(&#39;link&#39;)    index, columns = range(len(src_pos_)), range(len(dst_pos_))  # the number of variable    x = pymprog.var(&#39;x&#39;, pymprog.iprod(index, columns), bool)  # defined variable    min_value = sum([x[(i, j)] * constant[i][j] for i in index  for j in columns])    pymprog.minimize(min_value, &quot;min_distance&quot;)  # optimizer target: minimize    # ------------  defined constraints -------------- #    # defined next layer map one city    for j in columns:        st_init = 0        for i in index:            st_init += x[(i, j)]        pymprog.st(1 &lt;= st_init &lt;= 2)    # defined current layer at least one    if flag:        for i in index:            ct_init = 0            for j in columns:                ct_init += x[(i, j)]            pymprog.st(1 &lt;= ct_init)    # ------------  defined constraints -------------- #    # soleve linear programing    pymprog.solve()    # build up result by dataframe    output_dict = defaultdict(dict)    for i in index:        for j in columns:            output_dict[dst_pos_[j]][src_pos_[i]] = x[(i, j)].primal    # pymprog.sensitivity()    pymprog.end()    return pd.DataFrame(data=output_dict)</code></pre><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><p>é€šè¿‡ä¸€äº›æ•°æ®è¿›è¡Œè¯•éªŒä¸Šé¢çš„æ€è·¯ï¼Œä¸‹é¢ç”Ÿäº§ä¸­å¿ƒé€‰å–äº†ä¸¤ä¸ªï¼šå¤©æ´¥å’Œé‡åº†ï¼ŒDCå±‚æœ‰4ä¸ªç‚¹ï¼ŒTCå±‚ æœ‰7ä¸ªç‚¹ï¼Œé…é€ä¸­å¿ƒæœ‰å¾ˆå¤šä¸ªåŸå¸‚ï¼Œå¦‚ä¸‹è®¾ç½®æ‰€ç¤ºã€‚é€šè¿‡sqlæŸ¥è¯¢å¾—åˆ°æ•°æ®åº“ä¸­çš„è·ç¦»çŸ©é˜µã€‚åé¢å°†æ‰€æœ‰çš„ä¸­æ–‡åœ°å€è½¬æ¢ä¸ºè‹±æ–‡ï¼Œä¸»è¦ä¾¿äºåé¢çš„å¯è§†åŒ–ã€‚</p><pre><code class="python"># built the network struct, src position, depot and dst positiondst_position = [&quot;å®œæ˜Œ&quot;, &quot;é•¿æ²™&quot;, &quot;å²³é˜³&quot;, &quot;æ— é”¡&quot;, &quot;åˆè‚¥&quot;, &quot;å¾å·&quot;, &quot;å¸¸å·&quot;,&quot;å“ˆå°”æ»¨&quot;, &quot;é•¿æ˜¥&quot;, &quot;ç§¦çš‡å²›&quot;, &quot;å‘¼å’Œæµ©ç‰¹&quot;, &quot;é“¶å·&quot;, &quot;è¥¿å®&quot;,                 &quot;é…’æ³‰&quot;, &quot;åº†é˜³&quot;, &quot;è®¸æ˜Œ&quot;, &quot;å´å¿ &quot;, &quot;é„‚å°”å¤šæ–¯&quot;, &quot;å¹¿å…ƒ&quot;, &quot;å·´ä¸­&quot;, &quot;éƒ½æ±Ÿå °&quot;, &quot;å—å……&quot;, &quot;å¹¿å®‰&quot;, &quot;ä¹å±±&quot;, &quot;å®œå®¾&quot;, &quot;å—é˜³&quot;,                &quot;è¡¡é˜³&quot;, &quot;å¤§åŒ&quot;, &quot;ä¸½æ±Ÿ&quot;, &quot;æ”€æèŠ±&quot;, &quot;ç‰æ—&quot;, &quot;æŸ³å·&quot;, &quot;æ¡‚æ—&quot;, &quot;ä¸­å±±&quot;, &quot;å—å¹³&quot;, &quot;æ³‰å·&quot;, &quot;é›…å®‰&quot;, &quot;æ€€åŒ–&quot;, &quot;è†å·&quot;, &quot;é»„å±±&quot;               ]src_position = [&quot;é‡åº†&quot;, &quot;å¤©æ´¥&quot;]depot_position = {    &quot;level_1&quot;: [&quot;åŒ—äº¬&quot;, &quot;æˆéƒ½&quot;, &quot;è¥¿å®‰&quot;, &quot;æ­¦æ±‰&quot;],     &quot;level_2&quot;: [&quot;ç»µé˜³&quot;, &quot;æ²ˆé˜³&quot;, &quot;å…°å·&quot;, &quot;å—æ˜Œ&quot;, &quot;æ­å·&quot;, &quot;å—å®&quot;, &quot;æ˜†æ˜&quot;]}</code></pre><pre><code class="python">middle_layer = []for k, v in depot_position.items():    middle_layer.extend(v)node_list = dst_position + src_positionimport picklewith open(&quot;/opt/notebook/distance.pkl&quot;, &quot;rb&quot;) as picker:    data = pickle.load(picker)with open(&quot;/opt/notebook/layer_distance.pkl&quot;, &quot;rb&quot;) as layer:    layer_dist = pickle.load(layer)layer_dist</code></pre><table><thead><tr><th align="left"></th><th align="right">ç»µé˜³</th><th align="right">æ²ˆé˜³</th><th align="right">å…°å·</th><th align="right">å—æ˜Œ</th><th align="right">æ­å·</th><th align="right">å—å®</th><th align="right">æ˜†æ˜</th></tr></thead><tbody><tr><td align="left">åŒ—äº¬</td><td align="right">1691</td><td align="right">685</td><td align="right">1617</td><td align="right">1470</td><td align="right">1329</td><td align="right">2426</td><td align="right">2834</td></tr><tr><td align="left">æˆéƒ½</td><td align="right">120</td><td align="right">2474</td><td align="right">1039</td><td align="right">1496</td><td align="right">1857</td><td align="right">1325</td><td align="right">1068</td></tr><tr><td align="left">è¥¿å®‰</td><td align="right">606</td><td align="right">1775</td><td align="right">647</td><td align="right">1197</td><td align="right">1417</td><td align="right">1932</td><td align="right">1561</td></tr><tr><td align="left">æ­¦æ±‰</td><td align="right">921</td><td align="right">1845</td><td align="right">1368</td><td align="right">370</td><td align="right">859</td><td align="right">1294</td><td align="right">1815</td></tr></tbody></table><p>é€šè¿‡çº¿æ€§è§„åˆ’æ±‚è§£å¾—åˆ°äº†è¿æ¥çŸ©é˜µå¦‚ä¸‹é¢ç»“æœæ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºDCå±‚ä¸‹æœ‰å¤šä¸ªTCå±‚ï¼Œä½†æ˜¯TCåªå±äºä¸€ä¸ªDCã€‚<strong>æœ¬æ–‡ä¸­æ²¡æœ‰æ§åˆ¶DCå’ŒTCçš„æ•°é‡ã€‚å®é™…æ˜¯å¯ä»¥åŠ å…¥è¿›å»çš„</strong>ã€‚åç»­å¯¹å¾—åˆ°ç»“æœé€šè¿‡networkxè¿›è¡Œå¯è§†åŒ–ã€‚</p><pre><code class="python">nodes_res = solve_link(data, flag=0)layer_res = solve_link(layer_dist)def cn2pingyin(s: str)-&gt;str:    from pypinyin import lazy_pinyin    return &quot;&quot;.join(lazy_pinyin(s))nodes_res.index = nodes_res.index.map(cn2pingyin)nodes_res.columns = nodes_res.columns.map(cn2pingyin)layer_res.index = layer_res.index.map(cn2pingyin)layer_res.columns = layer_res.columns.map(cn2pingyin)layer_res</code></pre><table><thead><tr><th align="left"></th><th align="right">lanzhou</th><th align="right">nanning</th><th align="right">nanchang</th><th align="right">kunming</th><th align="right">hangzhou</th><th align="right">shenyang</th><th align="right">mianyang</th></tr></thead><tbody><tr><td align="left">beijing</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">1.0</td><td align="right">0.0</td></tr><tr><td align="left">chengdu</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">1.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">1.0</td></tr><tr><td align="left">wuhan</td><td align="right">0.0</td><td align="right">1.0</td><td align="right">1.0</td><td align="right">0.0</td><td align="right">1.0</td><td align="right">0.0</td><td align="right">0.0</td></tr><tr><td align="left">xian</td><td align="right">1.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td><td align="right">0.0</td></tr></tbody></table><pre><code class="python"># !pip install matplotlib netowrkx%matplotlib inlineimport networkx as nxfrom matplotlib import pyplot as pltimport matplotlib.font_manager as fmfp1 = fm.FontProperties(fname=&quot;/usr/share/fonts/adobe-source-han-sans-cn/SourceHanSansCN-Medium.otf&quot;)# nx.setitem(fp1)plt.figure(figsize=(16, 9))G = nx.Graph()colors = [&quot;blue&quot;, &quot;gray&quot;]i = 0for res in [layer_res, nodes_res]:    c = np.where(res==1)    index = res.index    columns = res.columns    pos1_list, pos2_list = [], []    for x, y in zip(c[0], c[1]):        G.add_edge(index[x], columns[y], weight=0.1)        pos1_list.append(index[x])        pos2_list.append(columns[y])    esmall = [(u, v) for (u, v, d) in G.edges(data=True) if d[&#39;weight&#39;] &gt;= 0.0]    if i &gt;= 1:        pos = nx.spring_layout(G)        nx.draw_networkx_nodes(G, pos, node_size=100)        nx.draw_networkx_edges(G, pos, edgelist=esmall, width=6, alpha=0.5, edge_color=&#39;b&#39;, style=&#39;solid&#39;)        nx.draw_networkx_nodes(G, pos,                               nodelist=set(pos1_list),                               node_color=colors[i],                               node_size=500,                               alpha=0.8)        nx.draw_networkx_labels(G, pos, font_size=12, font_family=&#39;DejaVu Sans&#39;)    if i &gt;= 1:        nx.draw_networkx_nodes(G, pos,                               nodelist2=set(pos1_list),                               node_color=colors[i],                               node_size=100,                               alpha=0.8)    i += 1plt.axis(&#39;off&#39;)plt.show()</code></pre><p><img src="/uploads/output_6_0.png" srcset="/img/loading.gif" alt="ç»“æœå¯è§†åŒ–"></p>]]></content>
    
    
    <categories>
      
      <category>æ€è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python3</tag>
      
      <tag>æ€è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonä¸­çš„å…ƒç±»ç¼–ç¨‹è¯¦è§£</title>
    <link href="/2019/04/09/python%E4%B8%AD%E7%9A%84%E5%85%83%E7%B1%BB%E7%BC%96%E7%A8%8B%E8%AF%A6%E8%A7%A3/"/>
    <url>/2019/04/09/python%E4%B8%AD%E7%9A%84%E5%85%83%E7%B1%BB%E7%BC%96%E7%A8%8B%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="ç±»æ˜¯åŠ¨æ€åˆ›å»ºçš„"><a href="#ç±»æ˜¯åŠ¨æ€åˆ›å»ºçš„" class="headerlink" title="ç±»æ˜¯åŠ¨æ€åˆ›å»ºçš„"></a>ç±»æ˜¯åŠ¨æ€åˆ›å»ºçš„</h2><p>æˆ‘ä»¬çŸ¥é“Python é‡Œä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆæ˜¯å¯¹è±¡å°±æœ‰å¯¹åº”çš„â€œç±»(Class)â€ï¼Œæˆ–ç§°â€œç±»å‹(type)â€ã€‚ Python ä¸­å¯ä»¥ç”¨ type(obj) æ¥å¾—åˆ°å¯¹è±¡çš„â€œç±»â€ã€‚æ—¢ç„¶ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œä¸€ä¸ªâ€œç±»(class)â€ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç±»çš„â€œç±»å‹(type)â€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿâ€œç±»(class)â€çš„ç±»å‹(type) éƒ½æ˜¯ typeã€‚é‚£ type çš„ç±»å‹åˆæ˜¯ä»€ä¹ˆå‘¢ï¼ŸæŠ±æ­‰ï¼Œtype çš„ç±»å‹è¿˜æ˜¯ typeï¼Œæ˜¯ä¸€ä¸ªé€’å½’çš„ç±»å‹ã€‚â€œæ™®é€šç±»(class)â€å¯ä»¥ç”¨æ¥ç”Ÿæˆå®ä¾‹(instance)ï¼ŒåŒæ ·çš„ï¼Œå…ƒç±» (meta-class)ä¹Ÿå¯ä»¥ç”Ÿæˆå®ä¾‹ï¼Œç”Ÿæˆçš„å®ä¾‹å°±æ˜¯â€œæ™®é€šç±»â€äº†ã€‚ç±»(class)å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹(instance)ã€‚è€Œåˆ›å»ºå®ä¾‹çš„æ–¹æ³•å°±æ˜¯è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°(constructor)ï¼š</p><pre><code class="python">class Spam(object):    def __init__(self, name):        self.name = name        spam = Spam(&#39;name&#39;)</code></pre><p>ä¸Šä¾‹æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»ï¼Œå¹¶è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°åˆ›å»ºäº†è¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æˆ‘ä»¬çŸ¥é“ç±»ä¹Ÿå¯ä»¥çœ‹ä½œç±» type çš„ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå¦‚ä½•ç”¨ type çš„æ„é€ å‡½æ•°æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹çœ‹typeçš„æ„é€ å‡½æ•°ï¼š<code>class type(name, bases, dict)</code></p><ul><li><code>name</code>: å­—ç¬¦ä¸²ç±»å‹ï¼Œå­˜æ”¾æ–°ç±»çš„åå­—</li><li><code>bases</code>: å…ƒç»„(tuple)ç±»å‹ï¼ŒæŒ‡å®šç±»çš„åŸºç±»/çˆ¶ç±»</li><li><code>dict</code>: å­—å…¸ç±»å‹ï¼Œå­˜æ”¾è¯¥ç±»çš„æ‰€æœ‰å±æ€§(attributes)å’Œæ–¹æ³•(method)</li></ul><pre><code class="python">&gt;&gt;&gt; class X:        a = 1&gt;&gt;&gt; X = type(&#39;X&#39;, (object,), dict(a=1))</code></pre><a id="more"></a><h2 id="ç±»çš„åˆ›å»ºè¿‡ç¨‹"><a href="#ç±»çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="ç±»çš„åˆ›å»ºè¿‡ç¨‹"></a>ç±»çš„åˆ›å»ºè¿‡ç¨‹</h2><p>è¦äº†è§£å…ƒç±»(meta-class)çš„ä½œç”¨ï¼Œæˆ‘ä»¬å°±éœ€è¦äº†è§£ Python é‡Œç±»çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š<br><img src="https://lotabout.me/2018/Understanding-Python-MetaClass/class-creation.svg" srcset="/img/loading.gif" alt="ç±»classçš„åˆ›å»ºè¿‡ç¨‹"></p><ol><li>å½“ Python è§åˆ° class å…³é”®å­—æ—¶ï¼Œä¼šé¦–å…ˆè§£æ class ä¸­çš„å†…å®¹ã€‚ä¾‹å¦‚è§£æåŸºç±»ä¿¡æ¯ï¼Œæœ€é‡è¦çš„æ˜¯æ‰¾åˆ°å¯¹åº”çš„å…ƒç±»ä¿¡æ¯ï¼ˆé»˜è®¤æ˜¯ type)ã€‚</li><li>å…ƒç±»æ‰¾åˆ°åï¼ŒPython éœ€è¦å‡†å¤‡ namespace ï¼ˆä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸ŠèŠ‚ä¸­ type çš„ dict å‚æ•°ï¼‰ã€‚å¦‚æœå…ƒç±»å®ç°äº† <strong>prepare</strong> å‡½æ•°ï¼Œåˆ™ä¼šè°ƒç”¨å®ƒæ¥å¾—åˆ°é»˜è®¤çš„ namespace ã€‚</li><li>ä¹‹åæ˜¯è°ƒç”¨ exec æ¥æ‰§è¡Œç±»çš„ bodyï¼ŒåŒ…æ‹¬å±æ€§å’Œæ–¹æ³•çš„å®šä¹‰ï¼Œæœ€åè¿™äº›å®šä¹‰ä¼šè¢«ä¿å­˜è¿› namespaceã€‚</li><li>ä¸Šè¿°æ­¥éª¤ç»“æŸåï¼Œå°±å¾—åˆ°äº†åˆ›å»ºç±»éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¿™æ—¶ Python ä¼šè°ƒç”¨å…ƒç±»çš„æ„é€ å‡½æ•°æ¥çœŸæ­£åˆ›å»ºç±»ã€‚å¦‚æœä½ æƒ³åœ¨ç±»çš„åˆ›å»ºè¿‡ç¨‹ä¸­åšä¸€äº›å®šåˆ¶(customization)çš„è¯ï¼Œåˆ›å»ºè¿‡ç¨‹ä¸­ä»»ä½•ç”¨åˆ°äº†å…ƒç±»çš„åœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½èƒ½é€šè¿‡è¦†ç›–å…ƒç±»çš„é»˜è®¤æ–¹æ³•æ¥å®ç°å®šåˆ¶ã€‚è¿™ä¹Ÿæ˜¯å…ƒç±»â€œæ— æ‰€ä¸èƒ½â€çš„æ‰€åœ¨ï¼Œå®ƒæ·±æ·±åœ°åµŒå…¥äº†ç±»çš„åˆ›å»ºè¿‡ç¨‹ã€‚</li></ol><h2 id="è‡ªå®šä¹‰å…ƒç±»"><a href="#è‡ªå®šä¹‰å…ƒç±»" class="headerlink" title="è‡ªå®šä¹‰å…ƒç±»"></a>è‡ªå®šä¹‰å…ƒç±»</h2><p>å…ƒç±»çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å½“åˆ›å»ºç±»æ—¶èƒ½å¤Ÿè‡ªåŠ¨åœ°æ”¹å˜ç±»ã€‚é€šå¸¸ï¼Œä½ ä¼šä¸ºAPIåšè¿™æ ·çš„äº‹æƒ…ï¼Œä½ å¸Œæœ›å¯ä»¥åˆ›å»ºç¬¦åˆå½“å‰ä¸Šä¸‹æ–‡çš„ç±»ã€‚å‡æƒ³ä¸€ä¸ªå¾ˆå‚»çš„ä¾‹å­ï¼Œä½ å†³å®šåœ¨ä½ çš„æ¨¡å—é‡Œæ‰€æœ‰çš„ç±»çš„å±æ€§éƒ½åº”è¯¥æ˜¯å¤§å†™å½¢å¼ã€‚æœ‰å¥½å‡ ç§æ–¹æ³•å¯ä»¥åŠåˆ°ï¼Œä½†å…¶ä¸­ä¸€ç§å°±æ˜¯é€šè¿‡è®¾å®š<strong>metaclass</strong>ã€‚é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œè¿™ä¸ªæ¨¡å—ä¸­çš„æ‰€æœ‰ç±»éƒ½ä¼šé€šè¿‡è¿™ä¸ªå…ƒç±»æ¥åˆ›å»ºï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å…ƒç±»æŠŠæ‰€æœ‰çš„å±æ€§éƒ½æ”¹æˆå¤§å†™å½¢å¼å°±ä¸‡äº‹å¤§å‰äº†ã€‚</p><pre><code class="python"># å…ƒç±»ä¼šè‡ªåŠ¨å°†ä½ é€šå¸¸ä¼ ç»™â€˜typeâ€™çš„å‚æ•°ä½œä¸ºè‡ªå·±çš„å‚æ•°ä¼ å…¥def upper_attr(future_class_name, future_class_parents, future_class_attr):    &#39;&#39;&#39;è¿”å›ä¸€ä¸ªç±»å¯¹è±¡ï¼Œå°†å±æ€§éƒ½è½¬ä¸ºå¤§å†™å½¢å¼&#39;&#39;&#39;    #é€‰æ‹©æ‰€æœ‰ä¸ä»¥&#39;__&#39;å¼€å¤´çš„å±æ€§     attrs = ((name, value) for name, value in future_class_attr.items() if not name.startswith(&#39;__&#39;))    # å°†å®ƒä»¬è½¬ä¸ºå¤§å†™å½¢å¼    uppercase_attr = dict((name.upper(), value) for name, value in attrs)    #é€šè¿‡&#39;type&#39;æ¥åšç±»å¯¹è±¡çš„åˆ›å»º    return type(future_class_name, future_class_parents, uppercase_attr) #è¿”å›ä¸€ä¸ªç±»class Foo(object):    __metaclass__ = upper_attr    bar = &#39;bip&#39;</code></pre><p>ä½¿ç”¨classæ¥åˆ›å»ºå…ƒç±»ï¼š</p><pre><code class="python">class UpperAttrMetaclass(type):    def __new__(cls, name, bases, dct):        attrs = ((name, value) for name, value in dct.items() if not name.startswith(&#39;__&#39;))        uppercase_attr = dict((name.upper(), value) for name, value in attrs)        return super(UpperAttrMetaclass, cls).__new__(cls, name, bases, uppercase_attr)</code></pre><h2 id="å…ƒç±»ä¸­çš„ç‰¹æ®Šæ–¹æ³•"><a href="#å…ƒç±»ä¸­çš„ç‰¹æ®Šæ–¹æ³•" class="headerlink" title="å…ƒç±»ä¸­çš„ç‰¹æ®Šæ–¹æ³•"></a>å…ƒç±»ä¸­çš„ç‰¹æ®Šæ–¹æ³•</h2><p>type ç±»ï¼Œä½œä¸ºPythonä¸­æ‰€æœ‰ç±»ï¼ˆåŒ…æ‹¬typeæœ¬èº«ï¼‰çš„é»˜è®¤å…ƒç±»ï¼Œå®šä¹‰äº†ä¸€äº›ç‰¹æ®Šæ–¹æ³•ï¼Œå¯ä¾›è‡ªå®šä¹‰çš„å…ƒç±»è¦†ç›–ï¼Œä»¥å®Œæˆç‰¹å®šçš„è¡Œä¸ºã€‚å¸¸è§çš„å‡ ä¸ªç‰¹æ®Šæ–¹æ³•æœ‰:</p><ul><li><code>__new__(cls,name,base,attr)</code>: å…ƒç±»ä¸­, <strong>new</strong> ä¼šåœ¨ä½ å®šä¹‰ç±»çš„æ—¶å€™æ‰§è¡Œ, åªæ‰§è¡Œä¸€æ¬¡.</li><li><code>__init__(self, name, *args, **kwargs)</code>: è¯¥å…ƒç±»çš„å®ä¾‹(ä¹Ÿå°±æ˜¯æ™®é€šç±»)åˆ›å»ºåè¢«è°ƒç”¨ï¼Œç”¨äºä¸ºåˆå§‹åŒ–å®ä¾‹çš„.</li><li><code>__call__(self, *args, **kwargs)</code>: å…ƒç±»åˆ›å»ºçš„å®ä¾‹(ä¹Ÿå°±æ˜¯æ™®é€šç±»),æ„é€ æ™®é€šç±»çš„å¯¹è±¡æ—¶è°ƒç”¨</li></ul><pre><code class="python">class NewMeta(type):    def __new__(*args, **kwargs):        print(&#39;__new__() from NewMeta&#39;,args,kwargs)        return type.__new__(*args, **kwargs)    def __init__(self,name,*args,**kwargs):        print(&#39;__init__() from NewMeta&#39;,args,kwargs)        return type.__init__(self,name,*args,**kwargs)    def __call__(self, *args, **kwargs):        print(&#39;__call__() from NewMeta&#39;,args,kwargs)        return type.__call__(self, *args, **kwargs)class Test(object,metaclass=NewMeta):    passprint(&#39;---------------------------------&#39;)Test()</code></pre><p>ç»“æœä¸ºï¼š</p><pre><code class="text">__new__() from NewMeta (&lt;class &#39;__main__.NewMeta&#39;&gt;, &#39;Test&#39;, (&lt;class &#39;object&#39;&gt;,), {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Test&#39;}) {}__init__() from NewMeta ((&lt;class &#39;object&#39;&gt;,), {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Test&#39;}) {}---------------------------------__call__() from NewMeta () {}</code></pre><p>ç±»åœ¨åˆ›å»ºç±»çš„æ—¶å€™<strong>new</strong>åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚è€Œè¿™ä¸ª<strong>new</strong>å°±æ˜¯ç”¨æ¥åˆ›å»ºå‡ºæˆ‘ä»¬çš„ç±»ã€‚å› ä¸ºæ™®é€šç±»æ˜¯å…ƒç±»åˆ›å»ºå‡ºæ¥çš„ç±»ï¼Œå¯ä»¥è®¤ä¸ºæ™®é€šç±»æ˜¯å…ƒç±»çš„å®ä¾‹å¯¹è±¡ã€‚æ‰€ä»¥æ¯æ¬¡è¿è¡Œæ™®é€šç±»çš„æ—¶å€™éƒ½ä¼šå»è°ƒç”¨å…ƒç±»çš„<strong>call</strong>ã€‚è€Œåœ¨<strong>call</strong>ä¸­æˆ‘ä»¬æ‹¿åˆ°å·²ç»åˆ›å»ºå¥½çš„å®ä¾‹å¯¹è±¡ã€‚</p><h2 id="é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼"><a href="#é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼" class="headerlink" title="é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼"></a>é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼</h2><p>å½“åˆæˆ‘ä¹Ÿå¾ˆç–‘æƒ‘ä¸ºä»€ä¹ˆæˆ‘ä»¬æ˜¯ä»å†™ä½¿ç”¨å…ƒç±»çš„<strong>init</strong>æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨<strong>new</strong>æ–¹æ³•æ¥åˆä¸ºå…ƒç±»å¢åŠ ä¸€ä¸ªå±æ€§ã€‚å…¶å®æˆ‘åªæ˜¯ä¸Šé¢é‚£ä¸€æ®µå…³äºå…ƒç±»ä¸­<strong>new</strong>æ–¹æ³•è¿·æƒ‘äº†ï¼Œå®ƒä¸»è¦ç”¨äºæˆ‘ä»¬éœ€è¦å¯¹ç±»çš„ç»“æ„è¿›è¡Œæ”¹å˜çš„æ—¶å€™æˆ‘ä»¬æ‰è¦é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚</p><pre><code class="python">class Singleton(type):    def __init__(self, *args, **kwargs):        print &quot;__init__&quot;        self.__instance = None        super(Singleton,self).__init__(*args, **kwargs)    def __call__(self, *args, **kwargs):        print &quot;__call__&quot;        if self.__instance is None:            self.__instance = super(Singleton,self).__call__(*args, **kwargs)        return self.__instanceclass Foo(object):    __metaclass__ = Singleton    #åœ¨ä»£ç æ‰§è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œå…ƒç±»ä¸­çš„__new__æ–¹æ³•å’Œ__init__æ–¹æ³•å…¶å®å·²ç»è¢«æ‰§è¡Œäº†ï¼Œè€Œä¸æ˜¯åœ¨Fooå®ä¾‹åŒ–çš„æ—¶å€™æ‰§è¡Œã€‚ä¸”ä»…ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚foo1 = Foo()foo2 = Foo()print Foo.__dict__  # _Singleton__instance&#39;: &lt;__main__.Foo object at 0x100c52f10&gt;# å­˜åœ¨ä¸€ä¸ªç§æœ‰å±æ€§æ¥ä¿å­˜å±æ€§ï¼Œè€Œä¸ä¼šæ±¡æŸ“Fooç±»ï¼ˆå…¶å®è¿˜æ˜¯ä¼šæ±¡æŸ“ï¼Œåªæ˜¯æ— æ³•ç›´æ¥é€šè¿‡__instanceå±æ€§è®¿é—®ï¼‰print foo1 is foo2  # True# è¾“å‡º# __init__# __call__# __call__# {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__metaclass__&#39;: &lt;class &#39;__main__.Singleton&#39;&gt;, &#39;_Singleton__instance&#39;: &lt;__main__.Foo object at 0x100c52f10&gt;, &#39;__dict__&#39;: &lt;attribute &#39;__dict__&#39; of &#39;Foo&#39; objects&gt;, &#39;__weakref__&#39;: &lt;attribute &#39;__weakref__&#39; of &#39;Foo&#39; objects&gt;, &#39;__doc__&#39;: None}# True</code></pre><p>åŸºäºè¿™ä¸ªä¾‹å­ï¼š</p><ul><li>æˆ‘ä»¬çŸ¥é“å…ƒç±»(Singleton)ç”Ÿæˆçš„å®ä¾‹æ˜¯ä¸€ä¸ªç±»(Foo),è€Œè¿™é‡Œæˆ‘ä»¬ä»…ä»…éœ€è¦å¯¹è¿™ä¸ªå®ä¾‹(Foo)å¢åŠ ä¸€ä¸ªå±æ€§(<strong>instance)æ¥åˆ¤æ–­å’Œä¿å­˜ç”Ÿæˆçš„å•ä¾‹ã€‚æƒ³æƒ³ä¹ŸçŸ¥é“ä¸ºä¸€ä¸ªç±»æ·»åŠ ä¸€ä¸ªå±æ€§å½“ç„¶æ˜¯åœ¨</strong>init__ä¸­å®ç°äº†ã€‚</li><li>å…³äº<strong>call</strong>æ–¹æ³•çš„è°ƒç”¨ï¼Œå› ä¸ºFooæ˜¯Singletonçš„ä¸€ä¸ªå®ä¾‹ã€‚æ‰€ä»¥Foo()è¿™æ ·çš„æ–¹å¼å°±è°ƒç”¨äº†Singletonçš„<strong>call</strong>æ–¹æ³•ã€‚ä¸æ˜ç™½å°±å›å¤´çœ‹çœ‹ä¸Šä¸€èŠ‚ä¸­çš„<strong>call</strong>æ–¹æ³•ä»‹ç»ã€‚å‡å¦‚æˆ‘ä»¬é€šè¿‡å…ƒç±»çš„<strong>new</strong>æ–¹æ³•æ¥ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¾ç„¶æ²¡æœ‰é€šè¿‡<strong>init</strong>æ¥å®ç°ä¼˜é›…ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šä¸ºäº†ä¸ºå®ä¾‹å¢åŠ ä¸€ä¸ªå±æ€§è€Œé‡å†™<strong>new</strong>æ–¹æ³•ã€‚æ‰€ä»¥è¿™ä¸ªå½¢å¼ä¸æ¨èã€‚</li></ul><pre><code class="python">class Singleton(type):    def __new__(cls, name,bases,attrs):        print &quot;__new__&quot;         attrs[&quot;_instance&quot;] = None        return  super(Singleton,cls).__new__(cls,name,bases,attrs)    def __call__(self, *args, **kwargs):        print &quot;__call__&quot;        if self._instance is None:            self._instance = super(Singleton,self).__call__(*args, **kwargs)        return self._instanceclass Foo(object):    __metaclass__ = Singletonfoo1 = Foo()foo2 = Foo()print Foo.__dict__print foo1 is foo2  # True# è¾“å‡º# __new__# __call__# __call__# {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__metaclass__&#39;: &lt;class &#39;__main__.Singleton&#39;&gt;, &#39;_instance&#39;: &lt;__main__.Foo object at 0x103e07ed0&gt;, &#39;__dict__&#39;: &lt;attribute &#39;__dict__&#39; of &#39;Foo&#39; objects&gt;, &#39;__weakref__&#39;: &lt;attribute &#39;__weakref__&#39; of &#39;Foo&#39; objects&gt;, &#39;__doc__&#39;: None}# True</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li>æ·±åˆ»ç†è§£Pythonä¸­çš„å…ƒç±»(metaclass):<a href="http://blog.jobbole.com/21351/" target="_blank" rel="noopener">http://blog.jobbole.com/21351/</a></li><li>Python å…ƒç±» (MetaClass) å°æ•™ç¨‹: <a href="https://lotabout.me/2018/Understanding-Python-MetaClass/" target="_blank" rel="noopener">https://lotabout.me/2018/Understanding-Python-MetaClass/</a></li><li>æ·±åˆ»ç†è§£Pythonä¸­çš„å…ƒç±»(metaclass)ä»¥åŠå…ƒç±»å®ç°å•ä¾‹æ¨¡å¼: <a href="https://www.cnblogs.com/tkqasn/p/6524879.html" target="_blank" rel="noopener">https://www.cnblogs.com/tkqasn/p/6524879.html</a></li><li>python3ä¸­çš„å…ƒç±»: <a href="http://blog.lujun9972.win/blog/2018/02/23/python3%E4%B8%AD%E7%9A%84%E5%85%83%E7%B1%BB/" target="_blank" rel="noopener">http://blog.lujun9972.win/blog/2018/02/23/python3%E4%B8%AD%E7%9A%84%E5%85%83%E7%B1%BB/</a></li><li>å®šä¹‰å¯é€‰å‚æ•°çš„å…ƒç±»: <a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c09/p15_define_metaclass_that_takes_optional_arguments.html" target="_blank" rel="noopener">https://python3-cookbook.readthedocs.io/zh_CN/latest/c09/p15_define_metaclass_that_takes_optional_arguments.html</a></li><li>Pythonä¸­çš„ç±»å…ƒç¼–ç¨‹: <a href="https://segmentfault.com/a/1190000014323911" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014323911</a></li><li>Python ç±»ä¸å…ƒç±»çš„æ·±åº¦æŒ–æ˜: <a href="http://python.jobbole.com/84986/" target="_blank" rel="noopener">http://python.jobbole.com/84986/</a></li><li>å¦‚ä½•ä»Python 3.xä¸­çš„ç±»å®šä¹‰ä¼ é€’å‚æ•°åˆ°å…ƒç±»ï¼Ÿ</li></ol>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>metaclass</tag>
      
      <tag>python3</tag>
      
      <tag>å…ƒç±»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>arrowçš„æ€§èƒ½åˆ†æåŠåœ¨pythonä¸­çš„ä½¿ç”¨</title>
    <link href="/2019/01/21/pyarrow%E5%88%9D%E6%8E%A2/"/>
    <url>/2019/01/21/pyarrow%E5%88%9D%E6%8E%A2/</url>
    
    <content type="html"><![CDATA[<p>Apache Arrow æ˜¯ Apache åŸºé‡‘ä¼šå…¨æ–°å­µåŒ–çš„ä¸€ä¸ªé¡¶çº§é¡¹ç›®ã€‚å®ƒè®¾è®¡çš„ç›®çš„åœ¨äºä½œä¸ºä¸€ä¸ªè·¨å¹³å°çš„æ•°æ®å±‚ï¼Œæ¥åŠ å¿«å¤§æ•°æ®åˆ†æé¡¹ç›®çš„è¿è¡Œé€Ÿåº¦ã€‚</p><p>ç°åœ¨å¤§æ•°æ®å¤„ç†æ¨¡å‹å¾ˆå¤šï¼Œç”¨æˆ·åœ¨åº”ç”¨å¤§æ•°æ®åˆ†ææ—¶ï¼Œé™¤äº†å°† Hadoop ç­‰å¤§æ•°æ®å¹³å°ä½œä¸ºä¸€ä¸ªå­˜å‚¨å’Œæ‰¹å¤„ç†å¹³å°ä¹‹å¤–ï¼ŒåŒæ ·ä¹Ÿå¾—å…³æ³¨ç³»ç»Ÿçš„æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚è¿‡å»å¼€æºç¤¾åŒºå·²ç»å‘å¸ƒäº†å¾ˆå¤šå·¥å…·æ¥å®Œå–„å¤§æ•°æ®åˆ†æçš„ç”Ÿæ€ç³»ç»Ÿï¼Œè¿™äº›å·¥å…·åŒ…å«äº†æ•°æ®åˆ†æçš„å„ä¸ªå±‚é¢ï¼Œä¾‹å¦‚åˆ—å¼å­˜å‚¨æ ¼å¼ï¼ˆParquetï¼ŒORCï¼‰ï¼Œå†…å­˜è®¡ç®—æ¨¡å‹ï¼ˆDrillï¼ŒSparkï¼ŒImpala å’Œ Stormï¼‰ä»¥åŠå…¶å¼ºå¤§çš„ API æ¥å£ã€‚è€Œ Arrow åˆ™æ˜¯æœ€æ–°åŠ å…¥çš„ä¸€å‘˜ï¼Œå®ƒæä¾›äº†ä¸€ç§è·¨å¹³å°åº”ç”¨çš„å†…å­˜æ•°æ®äº¤æ¢æ ¼å¼ã€‚<br><img src="/uploads/arrow_f.png" srcset="/img/loading.gif" alt="ä½¿ç”¨arrowä¹‹å‰"><br><img src="/uploads/arrow_b.png" srcset="/img/loading.gif" alt="ä½¿ç”¨arrowä¹‹å"><a id="more"></a></p><h2 id="arrowçš„pythonç‰ˆæœ¬å®‰è£…"><a href="#arrowçš„pythonç‰ˆæœ¬å®‰è£…" class="headerlink" title="arrowçš„pythonç‰ˆæœ¬å®‰è£…"></a>arrowçš„pythonç‰ˆæœ¬å®‰è£…</h2><p>arrowæ˜¯apacheä¸‹çš„ä¸€ä¸ªé¡¶çº§é¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å†…å­˜æ•°æ®äº¤æ¢æ ¼å¼ã€‚é€šè¿‡condaæ¥è¿›è¡Œå®‰è£…ï¼š<code>conda install -c conda-forge pyarrow</code>ï¼Œå®˜æ–¹çš„å®‰è£…æ¨èä½¿ç”¨condaï¼Œå…·ä½“å¯ä»¥è§<a href="https://arrow.apache.org/docs/python/install.html" target="_blank" rel="noopener">apache arrow documentation</a>.</p><pre><code class="python">import pyarrow as padata = b&#39;ddgkdfkgfdlgl8439495435043050883483495&#39;buf = pa.py_buffer(data)buf</code></pre><pre><code>&lt;pyarrow.lib.Buffer at 0x7f46706d0ab0&gt;</code></pre><pre><code class="python">buf.size  # 38</code></pre><h3 id="ç»“åˆnumpyä½¿ç”¨"><a href="#ç»“åˆnumpyä½¿ç”¨" class="headerlink" title="ç»“åˆnumpyä½¿ç”¨"></a>ç»“åˆnumpyä½¿ç”¨</h3><pre><code class="python">import numpy as npdata = np.random.random((100, 10)).reshape(-1)pa_array = pa.array(data)pa_array</code></pre><pre><code>&lt;pyarrow.lib.DoubleArray object at 0x7f467b68aea8&gt;[  0.688175,  0.979032,  0.91343,  0.725985,  0.469235,  0.373089,  0.792048,  0.472252,  0.615361,  0.693604,  ...  0.240511,  0.162609,  0.518071,  0.816558,  0.736163,  0.509702,  0.914533,  0.879404,  0.979877,  0.883003]</code></pre><pre><code class="python">np_array = pa_array.to_numpy().reshape((100, 10))np_array</code></pre><h3 id="ç»“åˆpandasä½¿ç”¨"><a href="#ç»“åˆpandasä½¿ç”¨" class="headerlink" title="ç»“åˆpandasä½¿ç”¨"></a>ç»“åˆpandasä½¿ç”¨</h3><pre><code class="python">import pandas as pddf = pd.DataFrame(data=np.random.randint(1, 10, (10, 4)), columns=[&quot;column_a&quot;, &quot;column_b&quot;, &quot;column_c&quot;, &quot;column_d&quot;])pa_df = pa.Table.from_pandas(df)[m for m in dir(pa_df) if not m.startswith(&#39;__&#39;)]</code></pre><pre><code>[&#39;_column&#39;, &#39;_validate&#39;, &#39;add_column&#39;, &#39;append_column&#39;, &#39;cast&#39;, &#39;column&#39;, &#39;columns&#39;, &#39;drop&#39;, &#39;equals&#39;, &#39;flatten&#39;, &#39;from_arrays&#39;, &#39;from_batches&#39;, &#39;from_pandas&#39;, &#39;itercolumns&#39;, &#39;num_columns&#39;, &#39;num_rows&#39;, &#39;remove_column&#39;, &#39;replace_schema_metadata&#39;, &#39;schema&#39;, &#39;set_column&#39;, &#39;shape&#39;, &#39;to_batches&#39;, &#39;to_pandas&#39;, &#39;to_pydict&#39;]</code></pre><pre><code class="python">pa_df.to_pandas()</code></pre><h3 id="å¯¼å…¥csvæ ¼å¼çš„æ•°æ®"><a href="#å¯¼å…¥csvæ ¼å¼çš„æ•°æ®" class="headerlink" title="å¯¼å…¥csvæ ¼å¼çš„æ•°æ®"></a>å¯¼å…¥csvæ ¼å¼çš„æ•°æ®</h3><pre><code class="python">from pyarrow import csvcsv_file_path = &#39;/opt/workspace/project/ModisResistModule/data/FirmsPoint/fire_nrt_V1_21640.csv&#39;def to_df_arrow(file_path):    table = csv.read_csv(file_path)%timeit df_pa = to_df_arrow(csv_file_path)</code></pre><pre><code>26 ms Â± 97.9 Âµs per loop (mean Â± std. dev. of 7 runs, 10 loops each)</code></pre><pre><code class="python">%timeit df = pd.read_csv(csv_file_path)</code></pre><pre><code>164 ms Â± 1.18 ms per loop (mean Â± std. dev. of 7 runs, 10 loops each)</code></pre><h2 id="arrowçš„IOæ“ä½œ"><a href="#arrowçš„IOæ“ä½œ" class="headerlink" title="arrowçš„IOæ“ä½œ"></a>arrowçš„IOæ“ä½œ</h2><pre><code class="python">def py_write(string):    with open(&quot;./test_py_string.dat&quot;, &quot;wb&quot;) as writer:        writer.write(string)def pa_write(string):    with pa.OSFile(&quot;./test_pa_string.dat&quot;, &quot;wb&quot;) as writer:        writer.write(string)s = b&quot;abvndjfklfljklluuillllldjdsfhdsfjhdskf2r73564385435934953475742742&quot;        %timeit py_write(s)%timeit pa_write(s)</code></pre><pre><code>934 Âµs Â± 23.3 Âµs per loop (mean Â± std. dev. of 7 runs, 1000 loops each)969 Âµs Â± 88 Âµs per loop (mean Â± std. dev. of 7 runs, 1000 loops each)</code></pre><pre><code class="python">def py_reader():    with open(&quot;./test_py_string.dat&quot;, &quot;rb&quot;) as reader:        reader.read()def pa_reader1():    with pa.OSFile(&quot;./test_pa_string.dat&quot;, &quot;rb&quot;) as writer:        writer.read()def pa_reader2():    with pa.memory_map(&quot;./test_pa_string.dat&quot;, &quot;rb&quot;) as writer:        buf = writer.read_buffer()  # writer.read()        buf.to_pybytes()%timeit py_reader()%timeit pa_reader1()%timeit pa_reader2()</code></pre><pre><code>8.76 Âµs Â± 24.3 ns per loop (mean Â± std. dev. of 7 runs, 100000 loops each)5.73 Âµs Â± 9.02 ns per loop (mean Â± std. dev. of 7 runs, 100000 loops each)8.26 Âµs Â± 28.8 ns per loop (mean Â± std. dev. of 7 runs, 100000 loops each)</code></pre><h2 id="pickleå’Œarrowçš„å¯¹æ¯”"><a href="#pickleå’Œarrowçš„å¯¹æ¯”" class="headerlink" title="pickleå’Œarrowçš„å¯¹æ¯”"></a>pickleå’Œarrowçš„å¯¹æ¯”</h2><p>è¿™å„¿æœ‰pickleï¼Œmsgpackå’Œpyarrowçš„å¯¹æ¯”æµ‹è¯•ï¼š<a href="http://satoru.rocks/2018/08/fastest-way-to-serialize-array/" target="_blank" rel="noopener">http://satoru.rocks/2018/08/fastest-way-to-serialize-array/</a></p><pre><code class="python">import pickledata = {    i: np.random.randn(500, 500) for i in range(100)}buf = pa.serialize(data).to_buffer()%timeit restored_data = pa.deserialize(buf)</code></pre><pre><code>207 Âµs Â± 1.78 Âµs per loop (mean Â± std. dev. of 7 runs, 1000 loops each)</code></pre><pre><code class="python">pickled = pickle.dumps(data)%timeit unpickled_data = pickle.loads(pickled)</code></pre><pre><code class="python">56.6 ms Â± 165 Âµs per loop (mean Â± std. dev. of 7 runs, 10 loops each)</code></pre><pre><code class="python">from pyarrow.feather import write_feather, read_featherimport pandas as pdimport numpy as npdf = pd.DataFrame(data=np.random.randint(1, 100, (1000000, 4)), columns=list(&#39;abcd&#39;))</code></pre><pre><code class="python">save_file = &quot;./tmp_frame.feather&quot;%timeit write_feather(df, save_file)%timeit df.to_pickle(&quot;./tmp_frame.pickle&quot;)</code></pre><pre><code>200 ms Â± 5.59 ms per loop (mean Â± std. dev. of 7 runs, 10 loops each)206 ms Â± 7.8 ms per loop (mean Â± std. dev. of 7 runs, 10 loops each)</code></pre><pre><code class="python">%timeit read_feather(save_file)%timeit pd.read_pickle(&quot;./tmp_frame.pickle&quot;)</code></pre><pre><code>4.72 ms Â± 18.9 Âµs per loop (mean Â± std. dev. of 7 runs, 100 loops each)12.4 ms Â± 42.2 Âµs per loop (mean Â± std. dev. of 7 runs, 100 loops each)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>arrow</tag>
      
      <tag>ray</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KLæ•£åº¦,JSæ•£åº¦å’Œwassersteinè·ç¦»</title>
    <link href="/2018/11/24/KL%E6%95%A3%E5%BA%A6,JS%E6%95%A3%E5%BA%A6%E5%92%8Cwasserstein%E8%B7%9D%E7%A6%BB/"/>
    <url>/2018/11/24/KL%E6%95%A3%E5%BA%A6,JS%E6%95%A3%E5%BA%A6%E5%92%8Cwasserstein%E8%B7%9D%E7%A6%BB/</url>
    
    <content type="html"><![CDATA[<p>æœ€åˆäº†è§£ä¿¡æ¯åº¦é‡æ˜¯é€šè¿‡ç†µçš„æ¦‚å¿µï¼Œæ¯”å¦‚ä¿¡æ¯å¢ç›Šï¼ŒGINIç­‰éƒ½æ˜¯åŸºäºç†µã€‚è€Œè¿™ä¸‰è€…ä¹Ÿæ˜¯åŸºäºä¿¡æ¯ç†µï¼Œåœ¨ä¿¡æ¯è®ºä¸­ä¸»è¦å¯¹åˆ†å¸ƒçš„ç›¸ä¼¼åº¦ï¼ˆè·ç¦»çš„åº¦é‡ï¼‰ï¼Œä½†æ˜¯ä¸‰è€…å·®å¼‚æ€§ä¹Ÿæ˜¯å¾ˆå¼ºçš„ï¼›å¯¹è¿™ä¸‰ç§ä¿¡æ¯åº¦é‡çš„æ–¹å¼è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ã€‚</p><h2 id="1-KLæ•£åº¦"><a href="#1-KLæ•£åº¦" class="headerlink" title="1.KLæ•£åº¦"></a>1.KLæ•£åº¦</h2><p>KLæ•£åº¦åˆç§°ä¸ºç›¸å¯¹ç†µï¼Œä¿¡æ¯æ•£åº¦ï¼Œä¿¡æ¯å¢ç›Šã€‚KLæ•£åº¦æ˜¯æ˜¯ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒPå’ŒQ å·®åˆ«çš„éå¯¹ç§°æ€§çš„åº¦é‡ã€‚ KLæ•£åº¦æ˜¯ç”¨æ¥ åº¦é‡ä½¿ç”¨åŸºäºQçš„ç¼–ç æ¥ç¼–ç æ¥è‡ªPçš„æ ·æœ¬å¹³å‡æ‰€éœ€çš„é¢å¤–çš„ä½å…ƒæ•°ã€‚ å…¸å‹æƒ…å†µä¸‹ï¼ŒPè¡¨ç¤ºæ•°æ®çš„çœŸå®åˆ†å¸ƒï¼ŒQè¡¨ç¤ºæ•°æ®çš„ç†è®ºåˆ†å¸ƒï¼Œæ¨¡å‹åˆ†å¸ƒï¼Œæˆ–Pçš„è¿‘ä¼¼åˆ†å¸ƒã€‚åœ¨ä¹‹å‰äº†è§£KLæ•£åº¦çš„æ—¶å€™ä¹Ÿå†™è¿‡<a href="http://www.idataskys.com/2017/07/26/%E4%BF%A1%E6%81%AF%E8%AE%BA%E4%B8%ADKL%E6%95%A3%E5%BA%A6%E8%AF%A6%E8%A7%A3/">KLæ•£åº¦çš„åšæ–‡</a>.<br>$$<br>DL(p||q)=\sum_{i=1}^{n} p(x) \log{\frac{p(x)}{q(x)}}<br>$$<br><strong>KLæ•£åº¦æ€§è´¨</strong>ï¼š</p><ol><li>å› ä¸ºå¯¹æ•°å‡½æ•°æ˜¯å‡¸å‡½æ•°ï¼Œæ‰€ä»¥KLæ•£åº¦çš„å€¼ä¸ºéè´Ÿæ•°ã€‚</li><li>KLæ•£åº¦ä¸æ˜¯å¯¹ç§°çš„ã€‚</li><li>KLæ•£åº¦ä¸æ»¡è¶³ä¸‰è§’ä¸ç­‰å¼ã€‚</li></ol><h2 id="2-JSï¼ˆJensen-Shannonï¼‰æ•£åº¦"><a href="#2-JSï¼ˆJensen-Shannonï¼‰æ•£åº¦" class="headerlink" title="2.JSï¼ˆJensen-Shannonï¼‰æ•£åº¦"></a>2.JSï¼ˆJensen-Shannonï¼‰æ•£åº¦</h2><p>JSæ•£åº¦åº¦é‡äº†ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒçš„ç›¸ä¼¼åº¦ï¼ŒåŸºäºKLæ•£åº¦çš„å˜ä½“ï¼Œè§£å†³äº†KLæ•£åº¦éå¯¹ç§°çš„é—®é¢˜ã€‚ä¸€èˆ¬åœ°ï¼ŒJSæ•£åº¦æ˜¯å¯¹ç§°çš„ï¼Œå…¶å–å€¼æ˜¯0åˆ°1ä¹‹é—´ã€‚å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>JS(P_1||P_2)={\frac {1} {2}} KL(P_1 || \frac {P_1+P_2} {2})+{\frac {1} {2}} KL(P_2 || \frac {P_1+P_2} {2}ï¼‰<br>$$<br>å¦‚æœP1ï¼ŒP2å®Œå…¨ç›¸åŒé‚£ä¹ˆJSæ•£åº¦çš„å€¼ä¸º0ï¼Œå¦åˆ™ä¸º1. JSæ•£åº¦çš„æ—¶å¯¹ç§°çš„è€Œä¸”æ˜¯æœ‰ç•Œçš„[0, 1]ã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„GANç½‘ç»œä¸­ä¼šæœ‰JSæ•£åº¦çš„æ¦‚å¿µã€‚</p><p><strong>KLæ•£åº¦å’ŒJSæ•£åº¦åº¦é‡çš„æ—¶å€™æœ‰ä¸€ä¸ªé—®é¢˜</strong>ï¼š<br>å¦‚æœä¸¤ä¸ªåˆ†é…P,Qç¦»å¾—å¾ˆè¿œï¼Œå®Œå…¨æ²¡æœ‰é‡å çš„æ—¶å€™ï¼Œé‚£ä¹ˆKLæ•£åº¦å€¼æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œè€ŒJSæ•£åº¦å€¼æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚è¿™åœ¨å­¦ä¹ ç®—æ³•ä¸­æ˜¯æ¯”è¾ƒè‡´å‘½çš„ï¼Œè¿™å°±æ„å‘³è¿™è¿™ä¸€ç‚¹çš„æ¢¯åº¦ä¸º0ã€‚æ¢¯åº¦æ¶ˆå¤±äº†ã€‚<a id="more"></a></p><h2 id="3-Wassersteinè·ç¦»"><a href="#3-Wassersteinè·ç¦»" class="headerlink" title="3.Wassersteinè·ç¦»"></a>3.Wassersteinè·ç¦»</h2><p>Wassersteinè·ç¦»åˆå«Earth-Moverè·ç¦»(EMè·ç¦»)ï¼Œç”¨äºè¡¡é‡ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„è·ç¦»ï¼Œ æ•°å­¦å®šä¹‰å¦‚ä¸‹ï¼š<br>$$<br>W(P_1, P_2)=\inf_{\gamma \sim\Pi(P_1,P_2)} \mathbb E_{(x,y) \sim \gamma}[||x-y||]<br>$$<br>$\Pi(P_1,P_2)$æ˜¯$P_1$å’Œ$P_2$åˆ†å¸ƒç»„åˆèµ·æ¥çš„æ‰€æœ‰å¯èƒ½çš„è”åˆåˆ†å¸ƒçš„é›†åˆã€‚å¯¹äºæ¯ä¸€ä¸ªå¯èƒ½çš„è”åˆåˆ†å¸ƒ$\gamma$ï¼Œå¯ä»¥ä»ä¸­é‡‡æ ·$(x,y)âˆ¼Î³$å¾—åˆ°ä¸€ä¸ªæ ·æœ¬$x$å’Œ$y$ï¼Œå¹¶è®¡ç®—å‡ºè¿™å¯¹æ ·æœ¬çš„è·ç¦»$||xâˆ’y||$ï¼Œæ‰€ä»¥å¯ä»¥è®¡ç®—è¯¥è”åˆåˆ†å¸ƒ$\gamma$ä¸‹ï¼Œæ ·æœ¬å¯¹è·ç¦»çš„æœŸæœ›å€¼$\mathbb E_{(x,y) \sim \gamma}[||x-y||]$ï¼Œåœ¨æ‰€æœ‰å¯èƒ½çš„è”åˆåˆ†å¸ƒä¸­èƒ½å¤Ÿå¯¹è¿™ä¸ªæœŸæœ›å€¼å–åˆ°çš„ä¸‹ç•Œ$\inf_{\gamma \sim\Pi(P_1,P_2)} \mathbb E_{(x,y) \sim \gamma}[||x-y||] $å°±æ˜¯Wassersteinè·ç¦»ã€‚ </p><p>ç›´è§‚ä¸Šå¯ä»¥æŠŠ$\mathbb E_{(x,y) \sim \gamma}[||x-y||]$ç†è§£ä¸ºåœ¨$\gamma$è¿™ä¸ªè·¯å¾„è§„åˆ’ä¸‹æŠŠåœŸå †$P_1$æŒªåˆ°åœŸå †$P_2$æ‰€éœ€è¦çš„æ¶ˆè€—ã€‚è€Œ<code>Wasserstein</code>è·ç¦»å°±æ˜¯åœ¨æœ€ä¼˜è·¯å¾„è§„åˆ’ä¸‹çš„æœ€å°æ¶ˆè€—ã€‚æ‰€ä»¥<code>Wesserstein</code>è·ç¦»åˆå«<code>Earth-Mover</code>è·ç¦»ã€‚ </p><p><code>Wessertein</code>è·ç¦»ç›¸æ¯”KLæ•£åº¦å’ŒJSæ•£åº¦çš„ä¼˜åŠ¿åœ¨äºï¼šå³ä½¿ä¸¤ä¸ªåˆ†å¸ƒçš„æ”¯æ’‘é›†æ²¡æœ‰é‡å æˆ–è€…é‡å éå¸¸å°‘ï¼Œä»ç„¶èƒ½åæ˜ ä¸¤ä¸ªåˆ†å¸ƒçš„è¿œè¿‘ã€‚è€ŒJSæ•£åº¦åœ¨æ­¤æƒ…å†µä¸‹æ˜¯å¸¸é‡ï¼ŒKLæ•£åº¦å¯èƒ½æ— æ„ä¹‰ã€‚</p><p>åœ¨GANç½‘ç»œçš„ä¼˜åŒ–ç½‘ç»œWGANç½‘ç»œå°±æ˜¯åŸºäºWassersteinè·ç¦»è¿›è¡Œçš„ä¼˜åŒ–ã€‚æœ€ç»ˆæ‰å¾—åˆ°è¦ä¸€ä¸ªèƒ½å¤Ÿè®­ç»ƒï¼Œä¸”å¿«é€Ÿçš„GANç½‘ç»œï¼Œç®€ç§°WGANç½‘ç»œã€‚</p><h2 id="Refrence"><a href="#Refrence" class="headerlink" title="Refrence"></a>Refrence</h2><ol><li><a href="https://en.wikipedia.org/wiki/Wasserstein_metric" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘-Wasserstein metric</a></li><li><a href="https://www.cnblogs.com/smuxiaolei/p/7400923.html" target="_blank" rel="noopener">JSæ•£åº¦ï¼ˆJensen-Shannon divergence)</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>GNN</tag>
      
      <tag>KLæ•£åº¦</tag>
      
      <tag>deep learning</tag>
      
      <tag>JSæ•£åº¦</tag>
      
      <tag>Wasserstein</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ -GANç½‘ç»œè¯¦è§£åŠTensorFlowå®ç°</title>
    <link href="/2018/11/06/GAN%E7%BD%91%E7%BB%9C%E8%AF%A6%E8%A7%A3%E5%8F%8ATensorFlow%E5%AE%9E%E7%8E%B0/"/>
    <url>/2018/11/06/GAN%E7%BD%91%E7%BB%9C%E8%AF%A6%E8%A7%A3%E5%8F%8ATensorFlow%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="GANçš„åŸºæœ¬ä»‹ç»"><a href="#GANçš„åŸºæœ¬ä»‹ç»" class="headerlink" title="GANçš„åŸºæœ¬ä»‹ç»"></a>GANçš„åŸºæœ¬ä»‹ç»</h2><p>2014 å¹´ï¼ŒIan Goodfellow åŠå…¶è’™ç‰¹åˆ©å°”å¤§å­¦çš„åŒäº‹å¼•å…¥äº†ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰ã€‚è¿™æ˜¯ä¸€ç§å­¦ä¹ æ•°æ®çš„åŸºæœ¬åˆ†å¸ƒçš„å…¨æ–°æ–¹æ³•ï¼Œè®©ç”Ÿæˆå‡ºçš„äººå·¥å¯¹è±¡å¯ä»¥å’ŒçœŸå®å¯¹è±¡ä¹‹é—´è¾¾åˆ°æƒŠäººçš„ç›¸ä¼¼åº¦ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>GANï¼ˆGenerative Adversarial Networksï¼‰ï¼Œæ˜¯ä¸€ç§ç”Ÿæˆå¼çš„ï¼Œå¯¹æŠ—ç½‘ç»œã€‚å†å…·ä½“ä¸€ç‚¹ï¼Œå°±æ˜¯é€šè¿‡å¯¹æŠ—çš„æ–¹å¼ï¼Œå»å­¦ä¹ æ•°æ®åˆ†å¸ƒçš„ç”Ÿæˆå¼æ¨¡å‹ã€‚æ‰€è°“çš„å¯¹æŠ—ï¼ŒæŒ‡çš„æ˜¯ç”Ÿæˆç½‘ç»œå’Œåˆ¤åˆ«ç½‘ç»œçš„äº’ç›¸å¯¹æŠ—ã€‚ç”Ÿæˆç½‘ç»œå°½å¯èƒ½ç”Ÿæˆé€¼çœŸæ ·æœ¬ï¼Œåˆ¤åˆ«ç½‘ç»œåˆ™å°½å¯èƒ½å»åˆ¤åˆ«è¯¥æ ·æœ¬æ˜¯çœŸå®æ ·æœ¬ï¼Œè¿˜æ˜¯ç”Ÿæˆçš„å‡æ ·æœ¬ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="/uploads/640.png" srcset="/img/loading.gif" alt="img"></p><h3 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h3><p>ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ä¸¤ä¸ªç½‘ç»œå½¼æ­¤åšå¼ˆï¼Œç›®æ ‡æ˜¯ç”Ÿæˆå™¨ç”Ÿæˆä¸çœŸå®æ•°æ®å‡ ä¹æ²¡æœ‰åŒºåˆ«çš„æ ·æœ¬ã€‚ç”Ÿæˆå™¨$G$çš„ç›®æ ‡æ˜¯åŸºäºå™ªå£°å˜é‡$z$ç”Ÿæˆä¸€ä¸ªå¯¹è±¡$x^{â€˜}$ï¼Œå¹¶ä½¿å…¶çœ‹èµ·æ¥å’ŒçœŸçš„$x$ä¸€æ ·ã€‚è€Œåˆ¤åˆ«å™¨$D$çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°ç”Ÿæˆå‡ºçš„ç»“æœå’ŒçœŸå®$x$ä¹‹é—´çš„å·®å¼‚ï¼Œå·®å¼‚è¶Šå°è¶Šå¥½ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚éšå˜é‡$ z $ï¼ˆé€šå¸¸ä¸ºæœä»é«˜æ–¯åˆ†å¸ƒçš„éšæœºå™ªå£°ï¼‰é€šè¿‡ Generator ç”Ÿæˆ $X_{fake}$, åˆ¤åˆ«å™¨è´Ÿè´£åˆ¤åˆ«è¾“å…¥çš„ data æ˜¯ç”Ÿæˆçš„æ ·æœ¬ $X_{fake}$è¿˜æ˜¯çœŸå®æ ·æœ¬ $X_{real}$ã€‚é€šè¿‡å…¬å¼æè¿°å¦‚ä¸‹æ‰€ç¤ºï¼š<br>$$<br>\min <em>{G} \max _{D} V(D, G)=\mathbb{E}</em>{\boldsymbol{x} \sim p_{\operatorname{tat}}(\boldsymbol{x})}[\log D(\boldsymbol{x})]+\mathbb{E}<em>{\boldsymbol{z} \sim p</em>{\boldsymbol{z}}(\boldsymbol{z})}[\log (1-D(G(\boldsymbol{z})))]<br>$$<br>å¯¹äºåˆ¤åˆ«å™¨ $D$ æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼Œ$V(D,G)$ ä¸ºäºŒåˆ†ç±»é—®é¢˜ä¸­å¸¸è§çš„äº¤å‰ç†µæŸå¤±ã€‚å¯¹äºç”Ÿæˆå™¨ $G$ æ¥è¯´ï¼Œä¸ºäº†å°½å¯èƒ½æ¬ºéª— $D$ï¼Œæ‰€ä»¥éœ€è¦æœ€å¤§åŒ–ç”Ÿæˆæ ·æœ¬çš„åˆ¤åˆ«æ¦‚ç‡ $D(G(z))$ï¼Œå³æœ€å°åŒ– $log(1-D(G(z)))$ï¼Œæ³¨æ„ï¼š$log(D(x))$ ä¸€é¡¹ä¸ç”Ÿæˆå™¨ $G$ æ— å…³ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ã€‚</p><p>å®é™…è®­ç»ƒæ—¶ï¼Œç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨é‡‡å–äº¤æ›¿è®­ç»ƒï¼Œå³å…ˆè®­ç»ƒ $D$ï¼Œç„¶åè®­ç»ƒ $G$ï¼Œä¸æ–­å¾€å¤ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºç”Ÿæˆå™¨ï¼Œå…¶æœ€å°åŒ–çš„æ˜¯$\max _{D} V(D, G)$ï¼Œå³æœ€å°åŒ–$V(D,G)$ çš„æœ€å¤§å€¼ï¼Œè¿™æ ·å½¢æˆä¸€ä¸ªå¯¹æŠ—çš„è¿‡ç¨‹ã€‚<a id="more"></a></p><h3 id="ç›®æ ‡å‡½æ•°"><a href="#ç›®æ ‡å‡½æ•°" class="headerlink" title="ç›®æ ‡å‡½æ•°"></a>ç›®æ ‡å‡½æ•°</h3><p>GANç½‘ç»œçš„æå‡ºè€…Ian Goodfellowè¯æ˜äº†ï¼Œå½“ç»å…¸GANåœ¨æœ€ä¼˜åŒ–æ—¶å°±æ˜¯æœ€å°åŒ–ä¸¤ä¸ªåˆ†å¸ƒçš„JSæ•£åº¦ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¡¡é‡ä¸¤ä¸ªåˆ†å¸ƒçš„ç›¸ä¼¼æ€§æœ‰å¾ˆå¤šæ–¹å¼ï¼Œå¦‚KLæ•£åº¦ï¼ŒJSæ•£åº¦ï¼ŒFæ•£åº¦ï¼ŒBregmanæ•£åº¦ï¼ŒWassersteinè·ç¦»ç­‰ã€‚å› æ­¤å¯ä»¥å®šä¹‰ä¸åŒçš„è·ç¦»åº¦é‡æ–¹å¼æ¥å®šä¹‰ç›®æ ‡å‡½æ•°ã€‚Wassersteinè·ç¦»å¦‚ä¸‹ï¼š<br>$$<br>W(p, q)=\inf <em>{\gamma \sim \Pi(p, q)} \mathbb{E}</em>{(x, y) \sim \gamma}[|x-y|]<br>$$</p><h2 id="GANçš„è®­ç»ƒè¿‡ç¨‹"><a href="#GANçš„è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="GANçš„è®­ç»ƒè¿‡ç¨‹"></a>GANçš„è®­ç»ƒè¿‡ç¨‹</h2><p>å‰é¢è¯´è¿‡GANåŒ…å«äº†ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ï¼Œå®é™…ä¸Šæ˜¯ä¸¤ä¸ªç½‘ç»œï¼šç”Ÿæˆç½‘ç»œå’Œåˆ¤åˆ«ç½‘ç»œã€‚é‚£ä¹ˆåœ¨æ•´ä¸ªç½‘ç»œä¸­ï¼Œæ€ä¹ˆæ¥å¯¹ç½‘ç»œè¿›è¡Œè®­ç»ƒå‘¢ï¼Ÿ</p><h3 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h3><p>å¯¹äºç”Ÿæˆå™¨ï¼ˆç”Ÿæˆç½‘ç»œï¼‰æ¥è¯´ï¼Œè¾“å…¥ä¸€ä¸ª$n$ç»´å‘é‡ï¼Œè¾“å‡ºç›®æ ‡å¤§å°çš„æ ·æœ¬ï¼Œå› æ­¤é¦–å…ˆéœ€è¦å¾—åˆ°ä¸€ä¸ªè¾“å…¥å‘é‡ã€‚ä»¥å›¾ç‰‡ä¸ºä¾‹ï¼Œå¯ä»¥è¾“å…¥ä¸€ä¸ªåˆ†å¸ƒçš„å‘é‡ï¼Œè¾“å‡ºå›¾ç‰‡åƒç´ å¤§å°çš„å›¾ç‰‡ã€‚</p><blockquote><p>è¿™é‡Œçš„ç”Ÿæˆå™¨å¯ä»¥æ˜¯ä»»æ„å¯ä»¥è¾“å‡ºå›¾ç‰‡çš„æ¨¡å‹ï¼Œæ¯”å¦‚æœ€ç®€å•çš„å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œåˆæˆ–è€…æ˜¯åå·ç§¯ç½‘ç»œç­‰ã€‚</p></blockquote><p>ä¸€èˆ¬è¾“å…¥å‘é‡ç”¨éšæœºè¾“å…¥å³å¯ï¼Œéšæœºè¾“å…¥æœ€å¥½æ»¡è¶³å¸¸è§çš„åˆ†å¸ƒï¼Œå¦‚é«˜æ–¯åˆ†å¸ƒï¼Œå‡å€¼åˆ†å¸ƒç­‰ã€‚è¾“å…¥å‘é‡ç»è¿‡ç”Ÿæˆç½‘ç»œåè¾“å‡ºä¸€ä¸ªç›®æ ‡æ ·æœ¬ã€‚</p><h3 id="åˆ¤åˆ«å™¨"><a href="#åˆ¤åˆ«å™¨" class="headerlink" title="åˆ¤åˆ«å™¨"></a>åˆ¤åˆ«å™¨</h3><p>åˆ¤åˆ«å™¨ä¸€èˆ¬é‡‡ç”¨å¸¸ç”¨çš„åˆ¤åˆ«å™¨ï¼Œè¾“å…¥çœŸå®å›¾ç‰‡å’Œç”Ÿæˆçš„å›¾ç‰‡ï¼Œè¾¨åˆ«å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚åˆ¤åˆ«å™¨å¯ä»¥ä¸ºä»»æ„çš„åˆ¤åˆ«å™¨æ¨¡å‹ï¼Œå¦‚å…¨è¿æ¥ç½‘ç»œï¼ŒCNNç½‘ç»œç­‰ã€‚</p><h3 id="è®­ç»ƒè¿‡ç¨‹"><a href="#è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="è®­ç»ƒè¿‡ç¨‹"></a>è®­ç»ƒè¿‡ç¨‹</h3><p>ä¸Šé¢å¯¹ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨è¿›è¡Œäº†è¯´æ˜ï¼Œä¸‹é¢å¯ä»¥è¯´æ˜å¦‚ä½•è®­ç»ƒï¼Œå¯¹åŸºæœ¬æµç¨‹è¿›è¡Œç®€è¦çš„è¯´æ˜ã€‚åŸºæœ¬è®­ç»ƒæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åˆå§‹åŒ–åˆ¤åˆ«å™¨çš„å‚æ•°$\theta_{D}$å’Œç”Ÿæˆå™¨$G$çš„å‚æ•°$\theta_{G}$</li><li>ä»çœŸå®æ ·æœ¬ä¸­é‡‡æ · $m$ä¸ªæ ·æœ¬$\left{x^{1}, x^{2}, \ldots x^{m}\right}$ï¼Œä»å…ˆéªŒåˆ†å¸ƒå™ªå£°ä¸­é‡‡æ ·$m$ä¸ªå™ªå£°æ ·æœ¬${z^{1}, z^{2}, \ldots, z^{m}}$å¹¶é€šè¿‡ç”Ÿæˆå™¨è·å– $m$ä¸ªç”Ÿæˆæ ·æœ¬$\left{\tilde{x}^{1}, \tilde{x}^{2}, \ldots, \tilde{x}^{m}\right}$å›ºå®šç”Ÿæˆå™¨$G$ï¼Œè®­ç»ƒåˆ¤åˆ«å™¨$D$å°½å¯èƒ½å¥½åœ°å‡†ç¡®åˆ¤åˆ«çœŸå®æ ·æœ¬å’Œç”Ÿæˆæ ·æœ¬ï¼Œå°½å¯èƒ½å¤§åœ°åŒºåˆ†æ­£ç¡®æ ·æœ¬å’Œç”Ÿæˆçš„æ ·æœ¬ã€‚</li><li><strong>å¾ªç¯$k$æ¬¡æ›´æ–°åˆ¤åˆ«å™¨ä¹‹åï¼Œä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡æ¥æ›´æ–°ä¸€æ¬¡ç”Ÿæˆå™¨çš„å‚æ•°</strong>ï¼Œè®­ç»ƒç”Ÿæˆå™¨ä½¿å…¶å°½å¯èƒ½èƒ½å¤Ÿå‡å°ç”Ÿæˆæ ·æœ¬ä¸çœŸå®æ ·æœ¬ä¹‹é—´çš„å·®è·ï¼Œä¹Ÿç›¸å½“äºå°½é‡ä½¿å¾—åˆ¤åˆ«å™¨åˆ¤åˆ«é”™è¯¯ã€‚</li><li>å¤šæ¬¡æ›´æ–°è¿­ä»£ä¹‹åï¼Œæœ€ç»ˆç†æƒ³æƒ…å†µæ˜¯ä½¿å¾—åˆ¤åˆ«å™¨åˆ¤åˆ«ä¸å‡ºæ ·æœ¬æ¥è‡ªäºç”Ÿæˆå™¨çš„è¾“å‡ºè¿˜æ˜¯çœŸå®çš„è¾“å‡ºã€‚äº¦å³æœ€ç»ˆæ ·æœ¬åˆ¤åˆ«æ¦‚ç‡å‡ä¸º0.5ã€‚ä½¿å¾—ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ä¹‹é—´è¾¾åˆ°å¹³è¡¡ï¼ˆè¿™ç‚¹ä¹Ÿè¢«Ian Goodfellowè¯æ˜ä¼šè¾¾åˆ°<a href="[https://zh.wikipedia.org/zh-hans/%E7%B4%8D%E4%BB%80%E5%9D%87%E8%A1%A1%E9%BB%9E](https://zh.wikipedia.org/zh-hans/ç´ä»€å‡è¡¡é»)">çº³ä»€å‡è¡¡</a>ï¼‰ã€‚</li></ul><blockquote><p>ä¹‹æ‰€ä»¥è¦è®­ç»ƒkæ¬¡åˆ¤åˆ«å™¨ï¼Œå†è®­ç»ƒç”Ÿæˆå™¨ï¼Œæ˜¯å› ä¸ºè¦å…ˆæ‹¥æœ‰ä¸€ä¸ªå¥½çš„åˆ¤åˆ«å™¨ï¼Œä½¿å¾—èƒ½å¤Ÿæ•™å¥½åœ°åŒºåˆ†å‡ºçœŸå®æ ·æœ¬å’Œç”Ÿæˆæ ·æœ¬ä¹‹åï¼Œæ‰å¥½æ›´ä¸ºå‡†ç¡®åœ°å¯¹ç”Ÿæˆå™¨è¿›è¡Œæ›´æ–°ã€‚ä¸‹é¢æ˜¯GANçš„è®ºæ–‡ä¸­å¯¹è®­ç»ƒè¿‡ç¨‹çš„æè¿°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p></blockquote><p><img src="/uploads/gan_train_p.jpg" srcset="/img/loading.gif" alt="img"></p><blockquote><p>æ³¨ï¼šå›¾ä¸­çš„<strong>é»‘è‰²è™šçº¿</strong>è¡¨ç¤ºçœŸå®çš„æ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µï¼Œ<strong>è“è‰²è™šçº¿</strong>è¡¨ç¤ºåˆ¤åˆ«å™¨åˆ¤åˆ«æ¦‚ç‡çš„åˆ†å¸ƒæƒ…å†µï¼Œ<strong>ç»¿è‰²å®çº¿</strong>è¡¨ç¤ºç”Ÿæˆæ ·æœ¬çš„åˆ†å¸ƒã€‚ $Z$ è¡¨ç¤ºå™ªå£°ï¼Œ $Z$åˆ° $x$è¡¨ç¤ºé€šè¿‡ç”Ÿæˆå™¨ä¹‹åçš„åˆ†å¸ƒçš„æ˜ å°„æƒ…å†µã€‚</p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨ç”Ÿæˆæ ·æœ¬åˆ†å¸ƒï¼ˆç»¿è‰²å®çº¿ï¼‰å»æ‹ŸåˆçœŸå®çš„æ ·æœ¬åˆ†å¸ƒï¼ˆé»‘è‰²è™šçº¿ï¼‰ï¼Œæ¥è¾¾åˆ°ç”Ÿæˆä»¥å‡ä¹±çœŸæ ·æœ¬çš„ç›®çš„ã€‚</p><p>å¯ä»¥çœ‹åˆ°åœ¨<strong>ï¼ˆaï¼‰</strong>çŠ¶æ€å¤„äºæœ€åˆå§‹çš„çŠ¶æ€çš„æ—¶å€™ï¼Œç”Ÿæˆå™¨ç”Ÿæˆçš„åˆ†å¸ƒå’ŒçœŸå®åˆ†å¸ƒåŒºåˆ«è¾ƒå¤§ï¼Œå¹¶ä¸”åˆ¤åˆ«å™¨åˆ¤åˆ«å‡ºæ ·æœ¬çš„æ¦‚ç‡ä¸æ˜¯å¾ˆç¨³å®šï¼Œå› æ­¤ä¼šå…ˆè®­ç»ƒåˆ¤åˆ«å™¨æ¥æ›´å¥½åœ°åˆ†è¾¨æ ·æœ¬ã€‚<br>é€šè¿‡å¤šæ¬¡è®­ç»ƒåˆ¤åˆ«å™¨æ¥è¾¾åˆ°<strong>ï¼ˆbï¼‰</strong>æ ·æœ¬çŠ¶æ€ï¼Œæ­¤æ—¶åˆ¤åˆ«æ ·æœ¬åŒºåˆ†å¾—éå¸¸æ˜¾è‘—å’Œè‰¯å¥½ã€‚ç„¶åå†å¯¹ç”Ÿæˆå™¨è¿›è¡Œè®­ç»ƒã€‚è®­ç»ƒç”Ÿæˆå™¨ä¹‹åè¾¾åˆ°<strong>ï¼ˆcï¼‰</strong>æ ·æœ¬çŠ¶æ€ï¼Œæ­¤æ—¶ç”Ÿæˆå™¨åˆ†å¸ƒç›¸æ¯”ä¹‹å‰ï¼Œé€¼è¿‘äº†çœŸå®æ ·æœ¬åˆ†å¸ƒã€‚<br>ç»è¿‡å¤šæ¬¡åå¤è®­ç»ƒè¿­ä»£ä¹‹åï¼Œæœ€ç»ˆå¸Œæœ›èƒ½å¤Ÿè¾¾åˆ°<strong>ï¼ˆdï¼‰</strong>çŠ¶æ€ï¼Œç”Ÿæˆæ ·æœ¬åˆ†å¸ƒæ‹ŸåˆäºçœŸå®æ ·æœ¬åˆ†å¸ƒï¼Œå¹¶ä¸”åˆ¤åˆ«å™¨åˆ†è¾¨ä¸å‡ºæ ·æœ¬æ˜¯ç”Ÿæˆçš„è¿˜æ˜¯çœŸå®çš„ï¼ˆåˆ¤åˆ«æ¦‚ç‡å‡ä¸º0.5ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”Ÿæˆå‡ºéå¸¸çœŸå®çš„æ ·æœ¬å•¦ï¼Œç›®çš„è¾¾åˆ°ã€‚  </p></blockquote><h2 id="GANå­˜åœ¨çš„é—®é¢˜"><a href="#GANå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="GANå­˜åœ¨çš„é—®é¢˜"></a>GANå­˜åœ¨çš„é—®é¢˜</h2><p>GANç½‘ç»œåœ¨ç†è®ºä¸Šåäºå®Œç¾ï¼Œä½†æ˜¯åœ¨å®è·µè¿‡ç¨‹ä¸­è¿˜æ˜¯å­˜åœ¨è¾ƒå¤šçš„é—®é¢˜ï¼Œä¸»è¦å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><p>GAN æå‡ºè€… Ian Goodfellow åœ¨ç†è®ºä¸­è™½ç„¶è¯æ˜äº† GAN æ˜¯å¯ä»¥è¾¾åˆ°çº³ä»€å‡è¡¡çš„ã€‚å¯æ˜¯æˆ‘ä»¬åœ¨å®é™…å®ç°ä¸­ï¼Œæˆ‘ä»¬æ˜¯åœ¨å‚æ•°ç©ºé—´ä¼˜åŒ–ï¼Œè€Œéå‡½æ•°ç©ºé—´ï¼Œè¿™å¯¼è‡´ç†è®ºä¸Šçš„ä¿è¯åœ¨å®è·µä¸­æ˜¯ä¸æˆç«‹çš„ã€‚ </p></li><li><p>ä¸æ”¶æ•›ï¼ˆnon-convergenceï¼‰çš„é—®é¢˜ï¼Œæ‰€æœ‰çš„ç†è®ºéƒ½è®¤ä¸º GAN åº”è¯¥åœ¨çº³ä»€å‡è¡¡ï¼ˆNash equilibriumï¼‰ä¸Šæœ‰å“è¶Šçš„è¡¨ç°ï¼Œä½†æ¢¯åº¦ä¸‹é™åªæœ‰åœ¨å‡¸å‡½æ•°çš„æƒ…å†µä¸‹æ‰èƒ½ä¿è¯å®ç°çº³ä»€å‡è¡¡ã€‚å½“åšå¼ˆåŒæ–¹éƒ½ç”±ç¥ç»ç½‘ç»œè¡¨ç¤ºæ—¶ï¼Œåœ¨æ²¡æœ‰å®é™…è¾¾åˆ°å‡è¡¡çš„æƒ…å†µä¸‹ï¼Œè®©å®ƒä»¬æ°¸è¿œä¿æŒå¯¹è‡ªå·±ç­–ç•¥çš„è°ƒæ•´æ˜¯å¯èƒ½çš„ã€‚</p></li><li><p>GAN çš„ä¼˜åŒ–ç›®æ ‡æ˜¯ä¸€ä¸ªæå°æå¤§ï¼ˆminmaxï¼‰é—®é¢˜ï¼Œå³$\min _{G} \max _{D} V(G, D)$ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼˜åŒ–ç”Ÿæˆå™¨çš„æ—¶å€™ï¼Œæœ€å°åŒ–çš„æ˜¯$\max _{D} V(G, D)$ã€‚å¯æ˜¯æˆ‘ä»¬æ˜¯è¿­ä»£ä¼˜åŒ–çš„ï¼Œè¦ä¿è¯ $V(G,D)$ æœ€å¤§åŒ–ï¼Œå°±éœ€è¦è¿­ä»£éå¸¸å¤šæ¬¡ï¼Œè¿™å°±å¯¼è‡´è®­ç»ƒæ—¶é—´å¾ˆé•¿ã€‚å¦‚æœæˆ‘ä»¬åªè¿­ä»£ä¸€æ¬¡åˆ¤åˆ«å™¨ï¼Œç„¶åè¿­ä»£ä¸€æ¬¡ç”Ÿæˆå™¨ï¼Œä¸æ–­å¾ªç¯è¿­ä»£ã€‚è¿™æ ·åŸå…ˆçš„æå°æå¤§é—®é¢˜ï¼Œå°±å®¹æ˜“å˜æˆæå¤§æå°ï¼ˆmaxminï¼‰é—®é¢˜ï¼Œå¯äºŒè€…æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¼šå‡ºç°mode collapseï¼ˆæ¨¡å‹å´©æºƒï¼‰ã€‚å³ï¼š<br>$$<br>\min _{G} \max _{D} V(G, D) \neq \max _{D} \min _{G} V(G, D)<br>$$</p></li></ol><p>é’ˆå¯¹ä¸Šé¢çš„ä¸»è¦é—®é¢˜ï¼Œå¾ˆå¤šå…¶ä»–GANç½‘ç»œå¯¹ç»å…¸çš„GANç½‘ç»œè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¦‚WGANï¼ŒStackGANç­‰ï¼Œéƒ½æ˜¯åœ¨GANçš„åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œæ‰©å±•ï¼Œæ—¶æœŸåº”ç”¨æ›´å¹¿æ³›ã€‚</p><h2 id="GANå¸¸è§çš„æ¨¡å‹ç»“æ„"><a href="#GANå¸¸è§çš„æ¨¡å‹ç»“æ„" class="headerlink" title="GANå¸¸è§çš„æ¨¡å‹ç»“æ„"></a>GANå¸¸è§çš„æ¨¡å‹ç»“æ„</h2><h3 id="DCGAN"><a href="#DCGAN" class="headerlink" title="DCGAN"></a>DCGAN</h3><p>DCGAN æå‡ºä½¿ç”¨ CNN ç»“æ„æ¥ç¨³å®š GAN çš„è®­ç»ƒï¼Œå¹¶ä½¿ç”¨äº†ä»¥ä¸‹ä¸€äº› trickï¼š </p><ul><li>Batch Normalization</li><li>ä½¿ç”¨ Transpose convlution è¿›è¡Œä¸Šé‡‡æ · </li><li>ä½¿ç”¨ Leaky ReLu ä½œä¸ºæ¿€æ´»å‡½æ•°</li></ul><h3 id="StackGAN"><a href="#StackGAN" class="headerlink" title="StackGAN"></a><a href="https://arxiv.org/abs/1612.03242" target="_blank" rel="noopener">StackGAN</a></h3><p>StackGANâ€”æ„å»ºä¸¤ä¸ªGANï¼Œç¬¬ä¸€ä¸ªGANï¼ˆStage-IGANï¼‰ç”¨äºæ ¹æ®æ–‡æœ¬æè¿°ç”Ÿæˆä¸€å¼ åˆ†è¾¨ç‡ä½çš„å›¾åƒï¼ŒåŒ…æ‹¬ç›®æ ‡ç‰©ä½“çš„å¤§è‡´å½¢çŠ¶å’Œé¢œè‰²ã€‚ ç¬¬äºŒä¸ªGAN å°†Stage-I ç”Ÿæˆçš„ä½åˆ†è¾¨ç‡å›¾ç‰‡å’Œtextä½œä¸ºè¾“å…¥, ä¿®æ­£ä¹‹å‰ç”Ÿæˆçš„å›¾å¹¶æ·»åŠ ç»†èŠ‚ç”Ÿæˆé«˜åˆ†è¾¨ç‡çš„æ›´åŠ ç»†è‡´çš„å›¾ç‰‡ã€‚</p><p><img src="/uploads/stack_gan_struct.png" srcset="/img/loading.gif" alt="stackgan"></p><h3 id="WGAN"><a href="#WGAN" class="headerlink" title="WGAN"></a><a href="https://arxiv.org/abs/1701.07875" target="_blank" rel="noopener">WGAN</a></h3><p>WGAN æå‡ºäº†ä¸€ç§å…¨æ–°çš„è·ç¦»åº¦é‡æ–¹å¼â€”â€”åœ°çƒç§»åŠ¨è·ç¦»ï¼ˆEM, Earth-mover distanceï¼‰ï¼Œä¹Ÿå« <code>Wasserstein</code> è·ç¦»ã€‚å³æ•£åº¦å®šä¹‰å…¶ä¸­æ–¹å¼ä¹‹ä¸€ã€‚<code>Wessertein</code>è·ç¦»ç›¸æ¯”KLæ•£åº¦å’ŒJSæ•£åº¦çš„ä¼˜åŠ¿åœ¨äºï¼šå³ä½¿ä¸¤ä¸ªåˆ†å¸ƒçš„æ”¯æ’‘é›†æ²¡æœ‰é‡å æˆ–è€…é‡å éå¸¸å°‘ï¼Œä»ç„¶èƒ½åæ˜ ä¸¤ä¸ªåˆ†å¸ƒçš„è¿œè¿‘ã€‚è€ŒJSæ•£åº¦åœ¨æ­¤æƒ…å†µä¸‹æ˜¯å¸¸é‡ï¼ŒKLæ•£åº¦å¯èƒ½æ— æ„ä¹‰ã€‚WGANä¹Ÿæ˜¯åŸºäºè¿™ä¸ªå¯¹ç»å…¸GANè¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šGANçš„ç»“æ„ï¼Œè¿™å„¿åªæ˜¯åˆ—å‡ºäº†å†°å±±ä¸€è§’ï¼Œé’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯æœ‰ä¸åŒçš„ç½‘ç»œç»“æ„ã€‚ä½†éƒ½æ˜¯åŸºäºç»å…¸çš„GANæ¨¡å‹åŸºç¡€ä¸Šè¿›è¡Œçš„ç»“æ„ä¼˜åŒ–ï¼Œä¼˜åŒ–trickç­‰ã€‚</p><h2 id="GANçš„åº”ç”¨"><a href="#GANçš„åº”ç”¨" class="headerlink" title="GANçš„åº”ç”¨"></a>GANçš„åº”ç”¨</h2><p>GAN åœ¨ç”Ÿæˆæ ·æœ¬è¿‡ç¨‹æˆä¸éœ€è¦æ˜¾å¼å»ºæ¨¡ä»»ä½•æ•°æ®åˆ†å¸ƒå°±å¯ä»¥ç”Ÿæˆ<code>real-like</code> çš„æ ·æœ¬ï¼Œæ‰€ä»¥ GAN åœ¨å›¾åƒï¼Œæ–‡æœ¬ï¼Œè¯­éŸ³ç­‰è¯¸å¤šé¢†åŸŸéƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚</p><p>åœ¨å›¾åƒé¢†åŸŸï¼Œåœ¨å›¾åƒç¿»è¯‘ï¼Œè¶…åˆ†è¾¨ç‡ï¼Œç›®æ ‡ç›‘æµ‹ï¼Œå›¾åƒè”åˆåˆ†å¸ƒå­¦ä¹ ï¼Œè§†é¢‘ç”Ÿæˆç­‰ã€‚ä¹Ÿå¯ä»¥åšåºåˆ—ç”Ÿæˆï¼ŒéŸ³ä¹ç”Ÿæˆï¼›è¯­è¨€å’Œè¯­éŸ³è½¬æ¢ç­‰ã€‚ä¸‹é¢å¯¹å„ä¸ªé¢†åŸŸçš„åº”ç”¨è¿›è¡Œäº†æ€»ç»“ï¼š</p><p><img src="/uploads/1558418520398.png" srcset="/img/loading.gif" alt="1558418520398"></p><h2 id="GANçš„TensorFlowå®ç°"><a href="#GANçš„TensorFlowå®ç°" class="headerlink" title="GANçš„TensorFlowå®ç°"></a>GANçš„TensorFlowå®ç°</h2><p>ä¸‹é¢æ—¶å¯¹GANç½‘ç»œçš„åŸºç¡€å®ç°ï¼Œç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨å‡æ˜¯ä½¿ç”¨2å±‚å…¨è¿æ¥çš„ç½‘ç»œç»“æ„ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å…ˆè®­ç»ƒåˆ¤åˆ«å™¨å†è®­ç»ƒç”Ÿæˆå™¨ï¼Œ1-1çš„è®­ç»ƒï¼ˆå³è®­ç»ƒä¸€æ¬¡åˆ¤åˆ«å™¨åè®­ç»ƒä¸€æ¬¡ç”Ÿæˆå™¨ï¼‰ï¼Œåœ¨æ¯è¿­ä»£10000æ­¥å°±ç”Ÿæˆä¸€æ‰¹å›¾ç‰‡ã€‚æŸå¤±å‡½æ•°ä¹Ÿæ˜¯ä½¿ç”¨åŸå§‹è®ºæ–‡ä¸­çš„å½¢å¼ã€‚å…·ä½“ä»£ç å‚è€ƒå¦‚ä¸‹ï¼š</p><pre><code class="python">import tensorflow as tfimport numpy as npimport matplotlib.gridspec as gridspecfrom typing import Listfrom matplotlib import pyplot as pltfrom tensorflow.examples.tutorials.mnist import input_dataweight_std = 0.1  # å‚æ•°åˆå§‹åŒ–åˆ†å¸ƒå‚æ•°def variable_init(size: List):    return tf.truncated_normal(shape=size, stddev=weight_std)X = tf.placeholder(tf.float32, shape=[None, 784])# å®šä¹‰åˆ¤åˆ«å™¨çš„æƒé‡çŸ©é˜µå’Œåç½®é¡¹å‘é‡, ç”±æ­¤å¯çŸ¥åˆ¤åˆ«ç½‘ç»œä¸ºä¸‰å±‚å…¨è¿æ¥ç½‘ç»œd_w1 = tf.Variable(variable_init([784, 128]))d_b1 = tf.Variable(variable_init([128]))d_w2 = tf.Variable(variable_init([128, 1]))d_b2 = tf.Variable(variable_init([1]))theta_d = [d_w1, d_w2, d_b1, d_b2]# å®šä¹‰ç”Ÿæˆå™¨çš„è¾“å…¥å™ªå£°ä¸º100ç»´åº¦çš„å‘é‡ç»„ï¼ŒNoneæ ¹æ®æ‰¹é‡å¤§å°ç¡®å®šZ = tf.placeholder(tf.float32, shape=[None, 100])def sample_z(m, n):    return np.random.normal(0, 1, size=(m, n)).astype(np.float32)def generator(z):    &quot;&quot;&quot;ç”Ÿæˆå™¨:è¾“å‡ºå±‚ä¸º784ä¸ªç¥ç»å…ƒ, å¹¶è¾“å‡ºæ‰‹å†™å­—ä½“å›¾ç‰‡&quot;&quot;&quot;    g_w1 = tf.Variable(variable_init([100, 128]))    g_b1 = tf.Variable(variable_init([128]))    g_h1 = tf.nn.relu(tf.matmul(z, g_w1)+g_b1)    g_w2 = tf.Variable(variable_init([128, 784]))    g_b2 = tf.Variable(tf.zeros(shape=[784]))    g_h2 = tf.matmul(g_h1, g_w2) + g_b2    theta_g = [g_w1, g_w2, g_b1, g_b2]    return tf.nn.tanh(g_h2), theta_g  # None, 784def discriminator(x):    &quot;&quot;&quot;åˆ¤åˆ«å™¨&quot;&quot;&quot;    d_h1 = tf.nn.relu(tf.matmul(x, d_w1)+d_b1)    d_h2 = tf.matmul(d_h1, d_w2) + d_b2    return tf.nn.sigmoid(d_h2), d_h2  # (batch_size, 1)def plot(samples):    fig = plt.figure(figsize=(4, 4))    gs = gridspec.GridSpec(4, 4)    gs.update(wspace=0.05, hspace=0.05)    for i, sample in enumerate(samples):        ax = plt.subplot(gs[i])        plt.axis(&#39;off&#39;)        ax.set_xticklabels([])        ax.set_yticklabels([])        ax.set_aspect(&#39;equal&#39;)        plt.imshow(sample.reshape(28, 28), cmap=&#39;Greys_r&#39;)    return figg_sample, theta_g = generator(Z)  # batch_size, 784d_real, d_logit_real = discriminator(X)d_fake, d_logit_fake = discriminator(g_sample)# ä»¥ä¸‹ä¸ºåŸè®ºæ–‡çš„åˆ¤åˆ«å™¨æŸå¤±å’Œç”Ÿæˆå™¨æŸå¤±d_loss = -(tf.log(d_real) + tf.log(1. - d_fake))g_loss = -tf.log(d_fake)D_solver = tf.train.AdamOptimizer(learning_rate=0.0001).minimize(d_loss, var_list=theta_d)G_solver = tf.train.AdamOptimizer(learning_rate=0.0001).minimize(g_loss, var_list=theta_g)batch_size = 128z_dims = 100mnist = input_data.read_data_sets(&quot;../../data/mnist&quot;, one_hot=True)with tf.Session() as sess:    sess.run(tf.global_variables_initializer())    i = 0    for it in range(100000):        if it % 10000 == 0:            samples = sess.run(g_sample, feed_dict={Z: sample_z(16, z_dims)})            fig = plot(samples)            plt.savefig(&#39;./out/{}.png&#39;.format(str(i).zfill(3)), bbox_inches=&#39;tight&#39;)            i += 1            plt.close(fig)        X_mb, _ = mnist.train.next_batch(batch_size)        _, D_loss_curr = sess.run([D_solver, d_loss], feed_dict={X: X_mb, Z: sample_z(batch_size, z_dims)})        _, G_loss_curr = sess.run([G_solver, g_loss], feed_dict={Z: sample_z(batch_size, z_dims)})        if it % 2000 == 0:            print(&#39;Iter: {}&#39;.format(it))            print()</code></pre><p>æœ€ç»ˆè®­ç»ƒåï¼Œç”Ÿæˆçš„å›¾ç‰‡å¦‚ä¸‹:</p><p><img src="/uploads/reult009.png" srcset="/img/loading.gif" alt=""></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li>åˆ°åº•ä»€ä¹ˆæ˜¯ç”Ÿæˆå¯¹æŠ—ç½‘ç»œGANï¼Ÿï¼š <a href="https://www.msra.cn/zh-cn/news/features/gan-20170511" target="_blank" rel="noopener">https://www.msra.cn/zh-cn/news/features/gan-20170511</a></li><li>é€šä¿—ç†è§£ç”Ÿæˆå¯¹æŠ—ç½‘ç»œGANï¼š <a href="https://zhuanlan.zhihu.com/p/33752313" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/33752313</a></li><li>ç®€å•ç†è§£å’Œè¯•éªŒç”Ÿæˆå¯¹æŠ—ç½‘ç»œGANï¼š <a href="https://blog.csdn.net/on2way/article/details/72773771" target="_blank" rel="noopener">https://blog.csdn.net/on2way/article/details/72773771</a></li><li>GANå…¥é—¨åŠTFæºç å®ç°ï¼š <a href="https://blog.csdn.net/qq_31456593/article/details/71113926" target="_blank" rel="noopener">https://blog.csdn.net/qq_31456593/article/details/71113926</a></li><li>GANå®Œæ•´ç†è®ºæ¨å¯¼ä¸å®ç°ï¼š <a href="https://www.jiqizhixin.com/articles/2017-10-1-1" target="_blank" rel="noopener">https://www.jiqizhixin.com/articles/2017-10-1-1</a></li><li>CNNåå‘ä¼ æ’­è¿‡ç¨‹è¯¦è§£ï¼š <a href="https://zhuanlan.zhihu.com/p/40951745" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/40951745</a></li><li>GANå®Œæ•´ç†è®ºæ¨å¯¼å’Œå®ç°ï¼š <a href="https://www.jiqizhixin.com/articles/2017-10-1-1" target="_blank" rel="noopener">https://www.jiqizhixin.com/articles/2017-10-1-1</a></li><li>GANå­¦ä¹ æŒ‡å—ï¼šä»åŸç†å…¥é—¨åˆ°åˆ¶ä½œç”ŸæˆDemoï¼š <a href="https://zhuanlan.zhihu.com/p/24767059" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/24767059</a></li><li>Generative Adversarial Netsï¼ˆè¯‘ï¼‰ï¼š <a href="https://blog.csdn.net/wspba/article/details/54577236" target="_blank" rel="noopener">https://blog.csdn.net/wspba/article/details/54577236</a></li><li>2018 å¹´æœ€æ£’çš„ä¸‰ç¯‡ GAN è®ºæ–‡ï¼š<a href="https://www.leiphone.com/news/201901/k1ogqdXFO6arLA5L.html" target="_blank" rel="noopener">https://www.leiphone.com/news/201901/k1ogqdXFO6arLA5L.html</a></li><li>GANè®ºæ–‡ç»¼è¿°ï¼š <a href="https://www.jiqizhixin.com/articles/2019-03-19-12" target="_blank" rel="noopener">https://www.jiqizhixin.com/articles/2019-03-19-12</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>deep learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GNN</tag>
      
      <tag>deep learning</tag>
      
      <tag>tensorflow</tag>
      
      <tag>generator</tag>
      
      <tag>discriminator</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TensorFlowä¸­çš„KeyPoint</title>
    <link href="/2018/10/26/TensorFlow%E4%B8%AD%E7%9A%84KeyPoint/"/>
    <url>/2018/10/26/TensorFlow%E4%B8%AD%E7%9A%84KeyPoint/</url>
    
    <content type="html"><![CDATA[<h2 id="1-çº¿ç¨‹ï¼Œé˜Ÿåˆ—å’Œæµæ°´çº¿"><a href="#1-çº¿ç¨‹ï¼Œé˜Ÿåˆ—å’Œæµæ°´çº¿" class="headerlink" title="1.çº¿ç¨‹ï¼Œé˜Ÿåˆ—å’Œæµæ°´çº¿"></a>1.çº¿ç¨‹ï¼Œé˜Ÿåˆ—å’Œæµæ°´çº¿</h2><p>åœ¨TensorFlowä¸­ä¹Ÿä¼šä½¿ç”¨çº¿ç¨‹å’Œé˜Ÿåˆ—ï¼Œä¸»è¦åœ¨æ¨¡å‹å¼€å§‹è®­ç»ƒæ—¶å¯¹æ•°æ®çš„å¤„ç†æ—¶ï¼Œé€šè¿‡å¤šçº¿ç¨‹æ¥è¯»å–æ•°æ®ï¼Œä¸€ä¸ªçº¿ç¨‹æ¥æ¶ˆè´¹æ•°æ®(æ¨¡å‹è®­ç»ƒ)ã€‚åœ¨TensorFlowä¸­çš„çº¿ç¨‹ä¸»è¦é€šè¿‡Coordinatorå’ŒQueueRunneræ¥è¿›è¡Œé…åˆç®¡ç†ï¼Œé˜Ÿåˆ—Queueä¸»è¦æœ‰å››ç§é˜Ÿåˆ—ã€‚</p><p>ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼š<code>Queue</code>-&gt;ï¼ˆæ„å»ºå›¾é˜¶æ®µï¼‰åˆ›å»ºé˜Ÿåˆ—ï¼›<code>QueueRunner</code>-&gt;ï¼ˆæ„å»ºå›¾é˜¶æ®µï¼‰åˆ›å»ºçº¿ç¨‹è¿›è¡Œå…¥é˜Ÿæ“ä½œï¼›<code>f.train.start_queue_runners()</code>-&gt;ï¼ˆæ‰§è¡Œå›¾é˜¶æ®µï¼‰å¡«å……é˜Ÿåˆ—ï¼›<code>tf.train.Coordinator()</code> åœ¨çº¿ç¨‹å‡ºé”™æ—¶å…³é—­ä¹‹ã€‚ </p><h3 id="1-1-çº¿ç¨‹ç®¡ç†-Coordinator"><a href="#1-1-çº¿ç¨‹ç®¡ç†-Coordinator" class="headerlink" title="1.1 çº¿ç¨‹ç®¡ç†-Coordinator"></a>1.1 çº¿ç¨‹ç®¡ç†-Coordinator</h3><p><code>Coordinator</code>ç±»ä¸»è¦å¯¹å¤šçº¿ç¨‹è¿›è¡ŒåŒæ­¥åœæ­¢ã€‚å®ƒå’ŒTensorFlowå†…çš„é˜Ÿåˆ—æ²¡æœ‰å¿…ç„¶å…³ç³»ï¼Œå¯ä»¥å’Œpythonçš„çº¿ç¨‹(threading)é…åˆä½¿ç”¨ã€‚<code>Coordinator</code>ç±»ä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><a href="https://www.tensorflow.org/api_docs/python/tf/train/Coordinator#should_stop" target="_blank" rel="noopener"><code>tf.train.Coordinator.should_stop</code></a>ï¼šå¦‚æœçº¿ç¨‹åœæ­¢ï¼Œåˆ™è¿”å›Trueã€‚</li><li><a href="https://www.tensorflow.org/api_docs/python/tf/train/Coordinator#request_stop" target="_blank" rel="noopener"><code>tf.train.Coordinator.request_stop</code></a>ï¼šè¯·æ±‚çº¿ç¨‹åœæ­¢ã€‚</li><li><a href="https://www.tensorflow.org/api_docs/python/tf/train/Coordinator#join" target="_blank" rel="noopener"><code>tf.train.Coordinator.join</code></a>ï¼šç­‰å¾…ç›´åˆ°æŒ‡å®šçš„çº¿ç¨‹åœæ­¢ã€‚</li></ul><p>åœ¨ä½¿ç”¨Coordinatoræ—¶ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªCoordinatorå¯¹è±¡ï¼Œå†åˆ›å»ºä¸€äº›Coordinatorä½¿ç”¨çš„çº¿ç¨‹ã€‚çº¿ç¨‹é€šå¸¸ä¸€ç›´å¾ªç¯è¿è¡Œï¼Œç›´åˆ°should_stop()è¿”å›Trueæ—¶åœæ­¢ã€‚ä»»ä½•çº¿ç¨‹ä¹Ÿå¯ä»¥è¢«è¯·æ±‚åœæ­¢ï¼Œåªéœ€è¦Coordinatorå¯¹è±¡è°ƒç”¨<code>request_stop</code>æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸‹çš„<code>should_stop</code>éƒ½è¢«è¿”å›ä¸ºTrueï¼Œå…¶ä»–çº¿ç¨‹åœæ­¢ã€‚å¦‚ä¸‹ï¼Œé€šè¿‡Coordinatorç®¡ç†pythonçš„çº¿ç¨‹ï¼š</p><pre><code class="python"># -*- coding: utf-8 -*-import tensorflow as tfimport threadingdef thread_func(coord, id_num):    &quot;&quot;&quot;    :param coord: tensorflow Coordinator object.    :param id_num: int, the constant number    :return:        id_num, int    &quot;&quot;&quot;    while not coord.should_stop():        print(&quot;This thread id is %d&quot; % id_num)        if id_num &gt;= 9:            print(&quot;Stop thread id is %d&quot; % id_num)            coord.request_stop()# init coord objectcoord_object = tf.train.Coordinator()# create 10 threads and run thread functionthreads = [threading.Thread(target=thread_func, args=(coord_object, num)) for num in range(10)]for t in threads:    t.start()coord_object.join()</code></pre><p>Coordinatorè¿˜æ”¯æŒæ•è·å’ŒæŠ¥å‘Šå¼‚å¸¸ï¼Œå¦‚<code>try:.......except Exception as error: coord.request_stop(errr) finally: coord.request_stop()</code>ã€‚</p><a id="more"></a><h3 id="1-2-é˜Ÿåˆ—-Queue"><a href="#1-2-é˜Ÿåˆ—-Queue" class="headerlink" title="1.2 é˜Ÿåˆ—-Queue"></a>1.2 é˜Ÿåˆ—-Queue</h3><p>åƒTensorFlowä¸­çš„æ‰€æœ‰ç»„ä»¶ä¸€æ ·ï¼Œé˜Ÿåˆ—æ˜¯TensorFlowå›¾ä¸­çš„ä¸€ä¸ª<strong>èŠ‚ç‚¹</strong>ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>æœ‰çŠ¶æ€</strong>çš„èŠ‚ç‚¹ï¼Œåƒå˜é‡ä¸€æ ·ï¼š<strong>å…¶ä»–èŠ‚ç‚¹å¯ä»¥ä¿®æ”¹å…¶å†…å®¹</strong>ã€‚ç‰¹åˆ«åœ°ï¼ŒèŠ‚ç‚¹å¯ä»¥å°†æ–°å…ƒç´ æ’å…¥é˜Ÿåˆ—ï¼Œæˆ–è€…ä»ç°æœ‰é˜Ÿåˆ—ä¸­å–å‡ºé˜Ÿåˆ—ã€‚åœ¨TensorFlowä¸­ï¼Œé˜Ÿåˆ—ä¸»è¦æœ‰å››ç§ç±»å‹ï¼š</p><ul><li><code>tf.FIFOQueue</code> ï¼šæŒ‰å…¥åˆ—é¡ºåºå‡ºåˆ—çš„é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—</li><li><code>tf.RandomShuffleQueue</code>ï¼š éšæœºé¡ºåºå‡ºåˆ—çš„é˜Ÿåˆ—</li><li><code>tf.PaddingFIFOQueue</code> ï¼šä»¥å›ºå®šé•¿åº¦æ‰¹é‡å‡ºåˆ—çš„é˜Ÿåˆ—</li><li><code>tf.PriorityQueue</code> ï¼šå¸¦ä¼˜å…ˆçº§å‡ºåˆ—çš„é˜Ÿåˆ—</li></ul><p>è¿™äº›é˜Ÿåˆ—çš„ä½¿ç”¨æ–¹æ³•éƒ½æ˜¯ä¸€æ ·ï¼Œä¸»è¦æœ‰ï¼š<code>dequeue</code>ï¼Œ<code>enqueue</code>ï¼Œ<code>enqueue_many</code>ï¼Œ<code>dequeue_many</code>ç­‰æ–¹æ³•ã€‚enqueueæ“ä½œè¿”å›è®¡ç®—å›¾ä¸­çš„ä¸€ä¸ªOperationèŠ‚ç‚¹ï¼Œdequeueæ“ä½œè¿”å›ä¸€ä¸ªTensorå€¼ï¼Œé˜Ÿåˆ—æ“ä½œåŒæ ·åªæ˜¯å£°æ˜æˆ–å®šä¹‰ï¼Œè¦é€šè¿‡sessionæ¥è¿è¡Œï¼Œæ‰èƒ½è·å–è¿™ä¸ªå€¼ã€‚ä¸‹é¢æ—¶æ“ä½œqueueï¼š</p><pre><code class="python">queue = tf.FIFOQueue(10, tf.int32)# å¦‚æœé˜Ÿåˆ—ä¸­çš„å€¼è¶…è¿‡äº†queue size, åœ¨enqueueä¼šå¡ä¸»,ç›´åˆ°queueä¸­çš„å€¼è¢«æ¶ˆè´¹queue_init = queue.enqueue_many(([0],), name=&quot;init_queue&quot;)  x = queue.dequeue()with tf.Session() as sess:    sess.run(queue_init)    for i in range(9):        print(&quot;--- the %d times enqueue ---&quot; % (i+1))        sess.run(queue.enqueue([i+1]))    for j in range(10):        # å¯¹ä¸€ä¸ªå·²ç»å–ç©ºçš„é˜Ÿåˆ—ä½¿ç”¨dequeueæ“ä½œä¹Ÿä¼šå¡ä½,ç›´åˆ°æœ‰æ–°çš„æ•°æ®å†™å…¥        print(&quot;Get value from queue:&quot;, sess.run(x), &quot;The queue size:&quot;, sess.run(queue.size()))</code></pre><p>è¿˜å¯ä»¥å°†ä¸Šé¢çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼š</p><pre><code class="python">index = tf.placeholder(tf.int32)queue = tf.FIFOQueue(10, tf.int32)queue_init = queue.enqueue_many(([0],), name=&quot;init_queue&quot;)x = queue.dequeue()enqueue_op = queue.enqueue([index+1], name=&quot;enqueue&quot;)with tf.Session() as sess:    sess.run(queue_init)    for i in range(9):        print(&quot;--- the %d times enqueue ---&quot; % (i+1))        sess.run(enqueue_op, feed_dict={index: i})    for j in range(10):        print(&quot;Get value from queue:&quot;, sess.run(x), &quot;The queue size:&quot;, sess.run(queue.size()))</code></pre><h3 id="1-3-QueueRunner"><a href="#1-3-QueueRunner" class="headerlink" title="1.3 QueueRunner"></a>1.3 QueueRunner</h3><p>Tensorflowçš„è®¡ç®—ä¸»è¦åœ¨ä½¿ç”¨CPU/GPUå’Œå†…å­˜ï¼Œè€Œæ•°æ®è¯»å–æ¶‰åŠç£ç›˜æ“ä½œï¼Œé€Ÿåº¦è¿œä½äºå‰è€…æ“ä½œã€‚å› æ­¤é€šå¸¸ä¼šä½¿ç”¨å¤šä¸ªçº¿ç¨‹è¯»å–æ•°æ®ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¶ˆè´¹æ•°æ®ã€‚QueueRunnerå°±æ˜¯æ¥ç®¡ç†è¿™äº›è¯»å†™é˜Ÿåˆ—çš„çº¿ç¨‹çš„ï¼ˆåˆ›å»ºçº¿ç¨‹ï¼Œå¯¹é˜Ÿåˆ—è¿›è¡Œenqueueæˆ–dequeueæ“ä½œï¼‰ï¼ŒQueueRunneræ˜¯ä¸€ä¸ªä¸å­˜åœ¨äºä»£ç ä¸­çš„ä¸œè¥¿ï¼Œè€Œæ˜¯åå°è¿ä½œçš„ä¸€ä¸ªæ¦‚å¿µï¼›å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥ä½¿ç”¨QueueRunnerï¼›ä¸€ç§æ˜¯æ˜¾ç¤ºçš„ä½¿ç”¨QueueRunnerï¼Œå¦å¤–ä¸€ç§æ˜¯éšå¼ä½¿ç”¨ï¼š<code>tf.train.start_queue_runners</code>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹è¯»å–æ–‡ä»¶çš„ä¾‹å­ï¼š</p><p><img src="http://wiki.jikexueyuan.com/project/tensorflow-zh/images/AnimatedFileQueues.gif" srcset="/img/loading.gif" alt="img"></p><p>QueueRunnerçš„APIå’Œå…³é”®æ–¹æ³•create_threadsçš„apiè¯´æ˜ï¼š</p><pre><code class="python">def __init__(self, queue=None, enqueue_ops=None, close_op=None, cancel_op=None,              queue_closed_exception_types=None, queue_runner_def=None, import_scope=None):    &quot;&quot;&quot;    queueï¼šä¸ºtensorflowçš„é˜Ÿåˆ—å¯¹è±¡,å¦‚FIFOQueue, RandomShuffleQueueç­‰    enqueue_ops: ä¸ºå…¥é˜Ÿæ“ä½œ(enqueue ops)çš„åˆ—è¡¨ï¼Œåˆ—è¡¨çš„é•¿åº¦ä¸ºå®šä¹‰çš„çº¿ç¨‹æ•°    &quot;&quot;&quot;def create_threads(self, sess, coord=None, daemon=False, start=False):    &quot;&quot;&quot;    parameters    ----------    sess: A session    coord: Optional `Coordinator` object     start: Boolean.  If `True` starts the threads.  If `False` the caller must call the `start()` method of the returned threads.    return    ------    A list of threads.    &quot;&quot;&quot;</code></pre><p>ä¸‹é¢ä½¿ç”¨é˜Ÿåˆ—å’ŒQueueRunnerï¼š</p><pre><code class="python">q = tf.FIFOQueue(10, &quot;float&quot;)counter = tf.Variable(0.0)  # å®šä¹‰è®¡æ•°å™¨increment_op = tf.assign_add(counter, 1.0)  # ç»™è®¡æ•°å™¨åŠ ä¸€enqueue_op = q.enqueue(counter)  # å°†è®¡æ•°å™¨åŠ å…¥é˜Ÿåˆ—# åˆ›å»ºQueueRunner, ç”¨å¤šä¸ªçº¿ç¨‹å‘é˜Ÿåˆ—æ·»åŠ æ•°æ®, è¿™é‡Œå®é™…ä¸Šå®šä¹‰äº†4ä¸ªçº¿ç¨‹, ä¸¤ä¸ªå¢åŠ è®¡æ•°, ä¸¤ä¸ªæ‰§è¡Œå…¥é˜Ÿ, ä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œqr = tf.train.QueueRunner(q, enqueue_ops=[increment_op, enqueue_op] * 2)with tf.Session() as sess:    tf.global_variables_initializer().run()    qr.create_threads(sess, start=True)  # å¯åŠ¨å…¥é˜Ÿçº¿ç¨‹,å¼€å§‹æ‰§è¡Œ    for i in range(20):        print(sess.run(q.dequeue()))</code></pre><p>ä¸Šé¢çš„è¿è¡Œç»“æŸä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œä½†æ˜¯æ•´ä¸ªè¿è¡Œè¿‡ç¨‹æ˜¯æ­£ç¡®çš„ã€‚å› æ­¤ï¼ŒQueueRunnerå’ŒCoordinatorä¼šé…åˆä½¿ç”¨ï¼Œé¿å…è¿™ç§æƒ…å†µã€‚ä¸‹é¢ä¸€èµ·åˆä½¿ç”¨ã€‚</p><h3 id="1-4-è¾“å…¥æµæ°´çº¿ï¼ˆçº¿ç¨‹é˜Ÿåˆ—é…åˆä½¿ç”¨ï¼‰"><a href="#1-4-è¾“å…¥æµæ°´çº¿ï¼ˆçº¿ç¨‹é˜Ÿåˆ—é…åˆä½¿ç”¨ï¼‰" class="headerlink" title="1.4 è¾“å…¥æµæ°´çº¿ï¼ˆçº¿ç¨‹é˜Ÿåˆ—é…åˆä½¿ç”¨ï¼‰"></a>1.4 è¾“å…¥æµæ°´çº¿ï¼ˆçº¿ç¨‹é˜Ÿåˆ—é…åˆä½¿ç”¨ï¼‰</h3><p>ä¸‹é¢å°†1.3ä¸­çš„ç¤ºä¾‹ç¨åŠ ä¿®æ”¹å°±å¯ä»¥é¿å…åé¢å¼‚å¸¸çš„æƒ…å†µã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚é€šè¿‡Coordinatoræ¥å¯¹æ‰€æœ‰çº¿ç¨‹è¿›è¡ŒåŒæ­¥å’Œåœæ­¢ã€‚</p><h4 id="1-4-1-Coordinatorå’ŒQueueRunneré…åˆä½¿ç”¨"><a href="#1-4-1-Coordinatorå’ŒQueueRunneré…åˆä½¿ç”¨" class="headerlink" title="1.4.1 Coordinatorå’ŒQueueRunneré…åˆä½¿ç”¨"></a>1.4.1 Coordinatorå’ŒQueueRunneré…åˆä½¿ç”¨</h4><pre><code class="python">q = tf.FIFOQueue(10, &quot;float&quot;)counter = tf.Variable(0.0)  # å®šä¹‰è®¡æ•°å™¨increment_op = tf.assign_add(counter, 1.0)  # ç»™è®¡æ•°å™¨åŠ ä¸€enqueue_op = q.enqueue(counter)  # å°†è®¡æ•°å™¨åŠ å…¥é˜Ÿåˆ—qr = tf.train.QueueRunner(q, enqueue_ops=[increment_op, enqueue_op] * 2)  # åˆ›å»ºå¤šä¸ªçº¿ç¨‹with tf.Session() as sess:    tf.global_variables_initializer().run()    coord = tf.train.Coordinator()    enqueue_threads = qr.create_threads(sess, coord=coord, start=True)  # å¯åŠ¨å…¥é˜Ÿçº¿ç¨‹    for i in range(20):        print(sess.run(q.dequeue()))    coord.request_stop()    coord.join(enqueue_threads)</code></pre><p>ä½¿ç”¨QueueRunneræœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æ˜¾ç¤ºçš„ä½¿ç”¨QueueRunnerï¼Œå¦‚ä¸Šé¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼Œå¦å¤–ä¸€ç§å°±æ˜¯éšå¼çš„ä½¿ç”¨ï¼Œåé¢çš„ä¾‹å­ä¸­éƒ½æ˜¯é€šè¿‡éšå¼ï¼ˆ<code>tf.train.start_queue_runners</code>ï¼‰çš„ä½¿ç”¨ï¼Œåœ¨éšå¼çš„ä½¿ç”¨ä¸­ä¹Ÿæ˜¯è°ƒç”¨çš„<code>QueueRunner.create_threads</code>çš„æ–¹æ³•ã€‚ä¸‹é¢å°†mnistçš„æ•°æ®è¿›è¡Œæµæ°´çº¿æ“ä½œï¼š</p><pre><code class="python">from tensorflow.examples.tutorials.mnist import input_dataimport tensorflow as tfimport numpy as npmnist = input_data.read_data_sets(&quot;/opt/workspace/project/deep-st-nn/data/MNIST_DATA&quot;, one_hot=True)all_data = mnist.train.imagesall_target = mnist.train.labelsqueue = tf.FIFOQueue(capacity=50, dtypes=[tf.float32, tf.float32], shapes=[[784], [10]])enqueue_op = queue.enqueue_many([all_data, all_target])data_sample, label_sample = queue.dequeue()qr = tf.train.QueueRunner(queue, [enqueue_op] * 4)with tf.Session() as sess:    # create a coordinator, launch the queue runner threads.    coord = tf.train.Coordinator()    enqueue_threads = qr.create_threads(sess, coord=coord, start=True)    for step in range(100):        # do to 100 iterations        if coord.should_stop():            break        one_data, one_label = sess.run([data_sample, label_sample])        print(one_data.shape, one_label.shape)    coord.request_stop()    coord.join(enqueue_threads)</code></pre><h4 id="1-4-2-æµæ°´çº¿"><a href="#1-4-2-æµæ°´çº¿" class="headerlink" title="1.4.2 æµæ°´çº¿"></a>1.4.2 æµæ°´çº¿</h4><p>tensorflowçš„è¾“å…¥æµæ°´çº¿ï¼š<strong>å‡†å¤‡æ–‡ä»¶å -&gt; åˆ›å»ºä¸€ä¸ª<code>Reader</code>ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ® -&gt; å®šä¹‰æ–‡ä»¶ä¸­æ•°æ®çš„è§£ç è§„åˆ™ -&gt; è§£ææ•°æ®</strong>ã€‚ä¸‹é¢æ˜¯å®˜æ–¹ç»™çš„ä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç ä¸­å¯¹å…³é”®éƒ¨åˆ†è¿›è¡Œäº†æ³¨é‡Š</p><pre><code class="python">import tensorflow as tf# ä¸€ä¸ªQueue,ç”¨æ¥ä¿å­˜æ–‡ä»¶åå­—.å¯¹æ­¤Queue,åªè¯»å–,ä¸dequeuefilename_queue = tf.train.string_input_producer([&quot;/opt/workspace/project/deep-st-nn/data/file0.csv&quot;,                                                 &quot;/opt/workspace/project/deep-st-nn/data/file1.csv&quot;])reader = tf.TextLineReader()  # ç”¨æ¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®, LineReader, æ¯æ¬¡è¯»ä¸€è¡Œkey, value = reader.read(filename_queue)# Default values, in case of empty columns. Also specifies the type of therecord_defaults = [[1.0], [1.0], [1.0], [1.0], [1.0]]col1, col2, col3, col4, col5 = tf.decode_csv(value, record_defaults=record_defaults)  # å¦‚æœæœ‰æ§åˆ¶å°±ä¼šç”¨record_defaultså¡«å……ç¼ºå¤±å€¼features = tf.stack([col1, col2, col3, col4])with tf.Session() as sess:    coord = tf.train.Coordinator()    threads = tf.train.start_queue_runners(coord=coord)  # å¯åŠ¨çº¿ç¨‹, è¿”å›æ‰€æœ‰çš„çº¿ç¨‹    for i in range(10):        # Retrieve a single instance:        example, label = sess.run([features, col5])        print(&quot;The times: %d\n&quot; % i, example, label)    coord.request_stop()    coord.join(threads)</code></pre><p>å†å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œè§£æï¼š</p><p>ï¼ˆ1ï¼‰<code>tf.train.string_input_producer([&#39;file0.csv&#39;, &#39;file1.csv&#39;])</code>ï¼Œä¸‹é¢æ˜¯è¯¥å‡½æ•°çš„å…³é”®ä»£ç ï¼š</p><pre><code class="python">q = data_flow_ops.FIFOQueue(capacity=capacity,                                dtypes=[input_tensor.dtype.base_dtype],                                shapes=[element_shape],                                shared_name=shared_name, name=name)    enq = q.enqueue_many([input_tensor])    queue_runner.add_queue_runner(        queue_runner.QueueRunner(            q, [enq], cancel_op=cancel_op))    if summary_name is not None:      summary.scalar(summary_name,                     math_ops.to_float(q.size()) * (1. / capacity))    return q</code></pre><p>ä¸Šé¢ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªqueueï¼Œè¿›è¡Œäº†å…¥é˜Ÿ(enqueue)æ“ä½œï¼›é€šè¿‡QueueRunneråˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œenqueue_opï¼Œå¹¶å°†QueueRunneræ”¾å…¥äº†ä¸€ä¸ªcollectionsä¸­ã€‚å¹¶è¿”å›queueã€‚</p><p>ï¼ˆ2ï¼‰å®šä¹‰äº†æ•°æ®è§£æçš„OPï¼Œä¸»è¦é€šè¿‡TextLineReaderæ¥æŒ‰è¡Œè¿›è¡Œè§£æã€‚è§£æå®Œæˆåè¿”å›äº†ä¸€ä¸ªTensorçš„labelå’Œdataã€‚<code>TextLineReader.read()</code>æ–¹æ³•ç›´æ¥æ¥æ”¶ä¸€ä¸ªQueueå¯¹è±¡ã€‚</p><p>ï¼ˆ3ï¼‰é€šè¿‡sessionæ¥è·å–åˆ°çœŸå®çš„æ•°æ®ï¼Œå¹¶è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚åœ¨sessionä¸­é€šè¿‡<code>start_queue_runners</code>æ–¹æ³•å¯åŠ¨æ‰€æœ‰çš„çº¿ç¨‹ï¼Œå¹¶è¿”å›æ‰€æœ‰çº¿ç¨‹ã€‚è·å–è‡ªå·±éœ€è¦çš„å€¼ã€‚</p><h4 id="1-4-3-æµæ°´çº¿çš„è¿‡ç¨‹ä¸­å‡†å¤‡minibatchæ•°æ®"><a href="#1-4-3-æµæ°´çº¿çš„è¿‡ç¨‹ä¸­å‡†å¤‡minibatchæ•°æ®" class="headerlink" title="1.4.3 æµæ°´çº¿çš„è¿‡ç¨‹ä¸­å‡†å¤‡minibatchæ•°æ®"></a>1.4.3 æµæ°´çº¿çš„è¿‡ç¨‹ä¸­å‡†å¤‡minibatchæ•°æ®</h4><p>åœ¨æ•°æ®è¾“å…¥æµæ°´çº¿çš„è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹æ¥å‡†å¤‡å¥½batchæ•°æ®ï¼Œå¹¶é€šè¿‡dequeueçš„æ–¹å¼æ¥è·å–ä¸€ä¸ªminibatchçš„æ•°æ®é›†ï¼Œåœ¨TensorFlowä¸­ä¹Ÿå®ç°äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºå°†ä¸Šé¢çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼š</p><pre><code class="python"># -*- coding: utf-8 -*-import tensorflow as tfdef read_my_file_format(filename_queue):    &quot;&quot;&quot;å®šä¹‰æ•°æ®çš„è¯»å–ä¸è§£æè§„åˆ™&quot;&quot;&quot;    reader = tf.TextLineReader()    key, record_string = reader.read(filename_queue)    col1, col2, col3, col4, label = tf.decode_csv(record_string,                                                   record_defaults=[[1.0], [1.0], [1.0], [1.0], [1.0]])    processed_example = tf.stack([col1, col2, col3, col4])    return processed_example, labeldef input_pipeline(filenames, batch_size, num_epochs=None):    filename_queue = tf.train.string_input_producer(filenames, num_epochs=num_epochs, shuffle=True)    example, label = read_my_file_format(filename_queue)    min_after_dequeue = 10000    capacity = min_after_dequeue + 3 * batch_size  # queue size    example_batch, label_batch = tf.train.shuffle_batch([example, label], batch_size=batch_size,                                                        capacity=capacity,                                                        min_after_dequeue=min_after_dequeue)    return example_batch, label_batchfiles = [&quot;/opt/workspace/project/deep-st-nn/data/file0.csv&quot;,          &quot;/opt/workspace/project/deep-st-nn/data/file1.csv&quot;]x, y = input_pipeline(files, 5)with tf.Session() as sess:    coord = tf.train.Coordinator()    threads = tf.train.start_queue_runners(sess=sess, coord=coord, start=True)    for num_step in range(10):        data, label = sess.run([x, y])        print(data, label)    coord.request_stop()    coord.join(threads)</code></pre><p>ä¸Šé¢ä»£ç ä¸­æœ€å…³é”®çš„éƒ¨åˆ†ä¸º<code>shuffle_batch</code>æ–¹æ³•ï¼Œshuffle_batchæ¥å—çš„å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼Œè¯¥æ–¹æ³•æ‰€åšçš„äº‹æƒ…ä¸»è¦æœ‰ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ª<code>RandomShuffleQueue</code>ç”¨æ¥ä¿å­˜æ ·æœ¬ã€‚</li><li>ä½¿ç”¨<code>QueueRunner</code>åˆ›å»ºå¤šä¸ª<code>enqueue</code>çº¿ç¨‹å‘<code>Queue</code>ä¸­æ”¾æ•°æ®ã€‚</li><li>åˆ›å»ºä¸€ä¸ª<code>dequeue_many</code> OPã€‚</li><li>è¿”å›<code>dequeue_many</code> OPã€‚</li></ol><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>dequeue</code>å‡ºæ¥çš„<code>mini-batch</code>æ¥è®­ç»ƒç½‘ç»œäº†ã€‚</p><pre><code class="python">def shuffle_batch(tensors, batch_size, capacity, min_after_dequeue, num_threads=1, seed=None,                   enqueue_many=False, shapes=None, allow_smaller_final_batch=False, shared_name=None,                   name=None):    &quot;&quot;&quot;    parameters    ----------        tensors: The list of tensors, this tensor will to enqueue.        batch_size: The new batch size pulled from the queue.        capacity: An integer. The maximum number of elements in the queue.         min_after_dequeue: Minimum number elements in the queue after a dequeue, used to ensure a level of mixing of elements.        num_threads: The number of threads enqueuing `tensor_list`.    return    ------    Returns:    A list or dictionary of tensors with the types as `tensors`.    &quot;&quot;&quot;</code></pre><p>é€šè¿‡<code>shuff_batch</code>æ¥å®ç°mnistæ•°æ®çš„é˜Ÿåˆ—å°±æ›´åŠ æ–¹ä¾¿äº†ï¼š</p><pre><code class="python">mnist = input_data.read_data_sets(&quot;/opt/workspace/project/deep-st-nn/data/MNIST_DATA&quot;, one_hot=True)all_data = mnist.train.imagesall_target = mnist.train.labelswith tf.Session() as sess:    batch_x, batch_y = tf.train.shuffle_batch([all_data, all_target], batch_size=100, capacity=300+1000,                                              min_after_dequeue=1000)    coord = tf.train.Coordinator()    threads = tf.train.start_queue_runners(sess=sess, coord=coord, start=True)    for i in range(21):        print(batch_x.shape, batch_y.shape)    coord.request_stop()    coord.join(threads)</code></pre><p>å¦å¤–å†ä»‹ç»ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œå†åç»­å¯èƒ½ä¼šç»å¸¸ç”¨åˆ°ã€‚<code>tf.train.slice_input_producer</code>ï¼Œè¯¥æ–¹æ³•çš„APIä¸ºï¼šÂ·<code>slice_input_producer(tensor_list, num_epochs=None, shuffle=True, seed=None, capacity=32, shared_name=None, name=None)</code>ï¼Œæ¥æ”¶ä¸€ä¸ªtensorçš„listï¼Œå†çœ‹ä»–çš„æºç ï¼š</p><pre><code class="python">with ops.name_scope(name, &quot;input_producer&quot;, tensor_list):    tensor_list = ops.convert_n_to_tensor_or_indexed_slices(tensor_list)    if not tensor_list:      raise ValueError(          &quot;Expected at least one tensor in slice_input_producer().&quot;)    range_size = array_ops.shape(tensor_list[0])[0]    # TODO(josh11b): Add an assertion that the first dimension of    # everything in TensorList matches. Maybe just check the inferred shapes?    queue = range_input_producer(range_size, num_epochs=num_epochs,                                 shuffle=shuffle, seed=seed, capacity=capacity,                                 shared_name=shared_name)    index = queue.dequeue()    output = [array_ops.gather(t, index) for t in tensor_list]    return output</code></pre><p>è¯¥æ–¹æ³•å†å†…éƒ¨è°ƒç”¨<code>range_input_producer</code>æ–¹æ³•ï¼Œç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶å°†å‡ºé˜Ÿçš„ç»“æœè¿›è¡Œç»„åˆï¼Œå½¢æˆä¸€ä¸ªlistï¼Œè¿”å›ï¼ˆ<code>A list of tensors, one for each element of tensor_list.  If the tensor n tensor_list has shape [N, a, b, .., z], then the corresponding outputtensor will have shape [a, b, ..., z].</code>ï¼‰ã€‚è¿”å›çš„æ˜¯ä¸€ä¸ªå‡ºé˜Ÿåçš„å…ƒç´ ã€‚</p><h3 id="1-5-Refrence"><a href="#1-5-Refrence" class="headerlink" title="1. 5 Refrence"></a>1. 5 Refrence</h3><p>[1].<a href="https://blog.csdn.net/rockingdingo/article/details/55652662" target="_blank" rel="noopener">Tensorflowå¹¶è¡Œè®¡ç®—ï¼šå¤šæ ¸(multicore)ï¼Œå¤šçº¿ç¨‹(multi-thread)ï¼Œå›¾åˆ†å‰²(Graph Partition)</a></p><p>[2].<a href="https://www.jianshu.com/p/c29965e6c40c" target="_blank" rel="noopener">TensorFlowä¸­çš„å¤šçº¿ç¨‹ä½¿ç”¨</a></p><p>[3].<a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029441" target="_blank" rel="noopener">TensorFlowçš„çº¿ç¨‹å’Œé˜Ÿåˆ—</a></p><p>[4].<a href="https://blog.csdn.net/u012436149/article/details/72353313" target="_blank" rel="noopener">è¾“å…¥æµæ°´çº¿</a></p><p>[5].<a href="https://ischlag.github.io/2016/06/19/tensorflow-input-pipeline-example/" target="_blank" rel="noopener">TENSORFLOW INPUT PIPELINE EXAMPLE</a></p><p>[6].<a href="http://www.enpeizhao.com/?p=514" target="_blank" rel="noopener">tensorflow ç®¡é“é˜Ÿåˆ—æ¨¡å¼ï¼ˆpipelineï¼‰è¯»å–æ–‡ä»¶</a></p><p>[7].<a href="http://wiki.jikexueyuan.com/project/tensorflow-zh/how_tos/reading_data.html" target="_blank" rel="noopener">æ•°æ®è¯»å–</a></p><p>[8].<a href="https://www.jianshu.com/p/f1aeb7ef75ca" target="_blank" rel="noopener">TensorFlow-input pipeline</a></p><h2 id="2-å…±äº«å˜é‡"><a href="#2-å…±äº«å˜é‡" class="headerlink" title="2.å…±äº«å˜é‡"></a>2.å…±äº«å˜é‡</h2><p>åœ¨æ·±åº¦å­¦ä¹ ç½‘ç»œä¸­ï¼Œéšæ¨¡å‹å¤æ‚ç¨‹åº¦å¢åŠ ï¼Œæ¨¡å‹çš„å‚æ•°ä¼šä¸æ–­çš„å¢åŠ ï¼Œå› æ­¤è®­ç»ƒæ¨¡å‹è¿‡ç¨‹ä¸­ä¼šæ¶‰åŠåˆ°<strong>å˜é‡å…±äº«</strong>ã€‚è¿™æ ·å‡å°æ¨¡å‹ä¸­å‚æ•°çš„é‡ï¼Œç”šè‡³åœ¨éƒ¨åˆ†æ¨¡å‹ä¸­éœ€è¦å…±äº«å˜é‡ï¼Œæ‰èƒ½è¾¾åˆ°å¥½çš„æ•ˆæœã€‚</p><h3 id="2-1-é—®é¢˜çš„æå‡º"><a href="#2-1-é—®é¢˜çš„æå‡º" class="headerlink" title="2.1 é—®é¢˜çš„æå‡º"></a>2.1 é—®é¢˜çš„æå‡º</h3><p>å‡è®¾ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå›¾åƒè¿‡æ»¤æ¨¡å‹ï¼Œè®¾ç½®æ¨¡å‹ä¸­ä¸º2ä¸ªå·ç§¯ï¼Œç°åœ¨è¦å°†åŒä¸€ä¸ªæ¨¡å‹(ç›¸åŒå‚æ•°çš„æ¨¡å‹)åº”ç”¨åˆ°ä¸åŒçš„å›¾ç‰‡ä¸‹ï¼Œå®ç°å¤§é‡å›¾ç‰‡çš„è¿‡æ»¤ã€‚å¦‚æœé€šè¿‡<code>tf.Variable()</code>å®ç°å¦‚ä¸‹ï¼š</p><pre><code class="python">def my_image_filter(input_images):    conv1_weights = tf.Variable(tf.random_normal([5, 5, 32, 32]), name=&quot;conv1_weights&quot;)    conv1_biases = tf.Variable(tf.zeros([32]), name=&quot;conv1_biases&quot;)    conv1 = tf.nn.conv2d(input_images, conv1_weights, strides=[1, 1, 1, 1], padding=&#39;SAME&#39;)    relu1 = tf.nn.relu(conv1 + conv1_biases)    conv2_weights = tf.Variable(tf.random_normal([5, 5, 32, 32]), name=&quot;conv2_weights&quot;)    conv2_biases = tf.Variable(tf.zeros([32]), name=&quot;conv2_biases&quot;)    conv2 = tf.nn.conv2d(relu1, conv2_weights, strides=[1, 1, 1, 1], padding=&#39;SAME&#39;)    return tf.nn.relu(conv2 + conv2_biases)</code></pre><p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬æœ‰å››ä¸ªå˜é‡ï¼š<code>conv1_weight,conv1_biases,conv2_weights,conv2_biases</code>ï¼Œå½“æˆ‘ä»¬åº”ç”¨åœ¨æ¯ä¸ªå›¾ç‰‡ä¸Šæ—¶ï¼Œå¦‚ä¸‹ï¼Œæˆ‘ä»¬åº”ç”¨åœ¨2ä¸ªå›¾ç‰‡ä¸Šï¼š</p><pre><code class="python">result1 = my_image_filter(image1)  # First call creates one set of 4 variables.result2 = my_image_filter(image2)  # Another set of 4 variables is created in the second call.</code></pre><p>è¿™æ ·è°ƒç”¨2æ¬¡ï¼Œé‚£ä¹ˆä¼šåˆ›å»º2ç»„å˜é‡ï¼Œæ¯ç»„4ä¸ªå˜é‡ï¼Œç”Ÿæˆ8ä¸ªå˜é‡ã€‚è¿™æ ·å°±å‡ºç°äº†é—®é¢˜ï¼Œæ¯å¼ å›¾ç‰‡åº”ç”¨çš„æ¨¡å‹æ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤éœ€è¦é€šè¿‡å…±äº«å˜é‡çš„æ¨¡å¼ã€‚é‚£ä¹ˆæ€ä¹ˆæ¥å®ç°å‘¢ï¼Ÿ</p><h3 id="2-2-pythonå®ç°å…±äº«å˜é‡"><a href="#2-2-pythonå®ç°å…±äº«å˜é‡" class="headerlink" title="2.2 pythonå®ç°å…±äº«å˜é‡"></a>2.2 pythonå®ç°å…±äº«å˜é‡</h3><p>åœ¨pythonä¸­ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œé€šè¿‡å­—å…¸æå‰å°†å˜é‡è¿›è¡Œå®šä¹‰ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="python">parameters_dict = {&quot;conv1_weights&quot;: tf.Variable(tf.random_normal([5, 5, 32, 32]), name=&quot;conv1_weights&quot;),                  &quot;conv1_biases&quot;: tf.Variable(tf.zeros([32]), name=&quot;conv1_biases&quot;),                  &quot;conv2_weights&quot;: tf.Variable(tf.random_normal([5, 5, 32, 32]), name=&quot;conv2_weights&quot;),                  &quot;conv2_biases&quot;: tf.Variable(tf.zeros([32]), name=&quot;conv2_biases&quot;)}def my_image_filter(input_images, variables_dict):    conv1 = tf.nn.conv2d(input_images, variables_dict[&quot;conv1_weights&quot;], strides=[1, 1, 1, 1], padding=&#39;SAME&#39;)    relu1 = tf.nn.relu(conv1 + variables_dict[&quot;conv1_biases&quot;])    conv2 = tf.nn.conv2d(relu1, variables_dict[&quot;conv2_weights&quot;], strides=[1, 1, 1, 1], padding=&#39;SAME&#39;)    return tf.nn.relu(conv2 + variables_dict[&quot;conv2_biases&quot;])# Both calls to my_image_filter() now use the same variablesresult1 = my_image_filter(image1, variables_dict)result2 = my_image_filter(image2, variables_dict)</code></pre><p>è¿™æ ·æ˜¯å¯ä»¥å®ç°å…±äº«å˜é‡ï¼Œä½†æ˜¯å¯¹ä»£ç çš„<strong>å°è£…ä¸å¥½</strong>ï¼Œåœ¨æ„å»ºæ¨¡å‹æ—¶ï¼Œ<strong>éœ€è¦æå‰åˆ›å»ºå¥½å˜é‡</strong>çš„åç§°ï¼Œå¤§å°ï¼Œç±»å‹ç­‰ï¼Œå½“ç½‘ç»œéå¸¸å¤§æ—¶ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªéå¸¸é•¿çš„å‚æ•°åˆ—è¡¨ï¼Œè¿™æ ·ä»£ç æ˜¾å¾—éå¸¸å†—ä½™ï¼›åŒæ—¶ï¼Œè¿™æ ·ä»£ç æ˜¾å¾—æ¯”è¾ƒæ­»æ¿ï¼Œä¸çµæ´»ï¼Œæ‰©å±•æ€§å¾ˆå¼±ã€‚å› æ­¤TensorFlowæä¾›äº†æ›´åŠ è½»ä¾¿çš„æ–¹å¼æ¥å®ç°å…±äº«å˜é‡ã€‚</p><h3 id="2-3-åœ¨TensorFlowä¸­å®ç°å…±äº«å˜é‡"><a href="#2-3-åœ¨TensorFlowä¸­å®ç°å…±äº«å˜é‡" class="headerlink" title="2.3 åœ¨TensorFlowä¸­å®ç°å…±äº«å˜é‡"></a>2.3 åœ¨TensorFlowä¸­å®ç°å…±äº«å˜é‡</h3><p>åœ¨TensorFlowä¸­é€šè¿‡<code>tf.get_variable()</code>å’Œ``tf.variable_scope()`é…åˆä½¿ç”¨ï¼Œå®ç°å˜é‡å…±äº«ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨ä¸»è¦å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹é¢é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•æ¥å®ç°å˜é‡å…±äº«ã€‚</p><pre><code class="python">tf.get_variable(&lt;name&gt;, &lt;shape&gt;, &lt;initializer&gt;)  # åˆ›å»ºæˆ–è¿”å›å…·æœ‰ç»™å®šåç§°çš„å˜é‡tf.variable_scope(&lt;scope_name&gt;)  # ç®¡ç†ä¼ é€’ç»™çš„åç§°çš„åç§°ç©ºé—´tf.get_variable()</code></pre><p>å¯¹ä¸Šé¢çš„è¿‡æ»¤æ¨¡å‹è¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="python">def conv_relu(input_tensor, kernel_shape, bias_shape):    # Create variable named &quot;weights&quot;.    weights = tf.get_variable(&quot;weights&quot;, kernel_shape, initializer=tf.random_normal_initializer())    # Create variable named &quot;biases&quot;.    biases = tf.get_variable(&quot;biases&quot;, bias_shape, initializer=tf.constant_initializer(0.0))    conv = tf.nn.conv2d(input, weights, strides=[1, 1, 1, 1], padding=&#39;SAME&#39;)    return tf.nn.relu(conv + biases)def my_image_filter(input_images):    with tf.variable_scope(&quot;conv1&quot;):        # Variables created here will be named &quot;conv1/weights&quot;, &quot;conv1/biases&quot;.        relu1 = conv_relu(input_images, [5, 5, 32, 32], [32])    with tf.variable_scope(&quot;conv2&quot;):        # Variables created here will be named &quot;conv2/weights&quot;, &quot;conv2/biases&quot;.        return conv_relu(relu1, [5, 5, 32, 32], [32])result1 = my_image_filter(image1)result2 = my_image_filter(image2)</code></pre><p>ä¸Šé¢å¯¹æ¨¡å‹åº”ç”¨åˆ°ä¸¤ä¸ªå›¾ç‰‡ä¸Šé¢ï¼Œä¼šæç¤ºä¸€ä¸ªé”™è¯¯ï¼š<code>Raises ValueError(... conv1/weights already exists ...)</code>ï¼›åœ¨conv2ä¸­ä¼šå¼•å‘é”™è¯¯ï¼Œä¸»è¦å› ä¸º<code>tf.get_variable()</code>é»˜è®¤å˜é‡æ˜¯ä¸å…±äº«çš„ï¼Œåªæ˜¯æ£€æŸ¥å˜é‡åï¼Œé˜²æ­¢é‡å¤ï¼Œå› æ­¤åœ¨conv2ä¸­è°ƒç”¨çš„æ—¶å€™ï¼Œå‘ç°å·²ç»å­˜åœ¨äº†å˜é‡ã€‚éœ€è¦å…±äº«å˜é‡ï¼Œå¿…é¡»æŒ‡å®šæŸä¸ªå˜é‡åŸŸå†…è¿›è¡Œå…±äº«å˜é‡ï¼š</p><pre><code class="python">with tf.variable_scope(&quot;image_filters&quot;) as scope:    result1 = my_image_filter(image1)    scope.reuse_variables()    result2 = my_image_filter(image2)</code></pre><p>ç»è¿‡ä¸Šé¢çš„ä¿®æ”¹ï¼Œå˜é‡å…±äº«å°±å·²ç»å®Œæˆäº†ã€‚ä¸éœ€è¦åœ¨å‡½æ•°å¤–å®šä¹‰å˜é‡ï¼Œåªéœ€è¦æ·»åŠ å˜é‡åŸŸï¼Œtensorflowå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ç®¡ç†å˜é‡ã€‚ä»£ç ä¹Ÿéå¸¸ç›´è§‚ã€‚</p><h3 id="2-4-å…±äº«å˜é‡çš„æ–¹å¼"><a href="#2-4-å…±äº«å˜é‡çš„æ–¹å¼" class="headerlink" title="2.4 å…±äº«å˜é‡çš„æ–¹å¼"></a>2.4 å…±äº«å˜é‡çš„æ–¹å¼</h3><p>é€šè¿‡<code>tf.get_variable()</code>å’Œ``tf.variable_scope()<code>æœ‰ä¸¤ç§æ–¹å¼æ¥è¿›è¡Œå…±äº«å˜é‡ã€‚ç¬¬ä¸€ç§å°±æ˜¯ä¸Šè¿°æ‰€ç¤ºçš„ï¼Œé€šè¿‡è®¾ç½®åŸŸä¸‹é¢çš„å…±äº«ï¼š</code>scope.reuse_variables()`ï¼›è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="python">with tf.variable_scope(&quot;image_filters&quot;, reuse=tf.AUTO_REUSE) as scope:    result1 = my_image_filter(image1)    result2 = my_image_filter(image2)</code></pre><p>è¿™ç§æ–¹å¼ä¼šè‡ªåŠ¨å»å…±äº«å˜é‡ï¼Œå½“ç³»ç»Ÿæ£€æµ‹åˆ°å½“æœŸå˜é‡åŸŸä¸‹ä¹‹å‰å®šä¹‰äº†ä¸€ä¸ªé‡åçš„å˜é‡ï¼Œé‚£ä¹ˆè¯¥å˜é‡å°±å…±äº«ï¼Œå¦åˆ™å°±åˆ›å»ºæ–°çš„å˜é‡ã€‚è¿™æ˜¯éå¸¸æ™ºèƒ½çš„å†™æ³•ã€‚è¿™ç§æ–¹å¼ä¹Ÿè§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚éƒ¨åˆ†æ¨¡å‹ï¼Œå‰åŠéƒ¨åˆ†éœ€è¦å…±äº«å˜é‡ï¼ŒååŠéƒ¨åˆ†ä¸éœ€è¦å…±äº«å˜é‡ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°ã€‚</p><h3 id="2-5-å˜é‡åŸŸï¼ˆvariable-scopeï¼‰çš„å·¥ä½œæœºåˆ¶"><a href="#2-5-å˜é‡åŸŸï¼ˆvariable-scopeï¼‰çš„å·¥ä½œæœºåˆ¶" class="headerlink" title="2.5 å˜é‡åŸŸï¼ˆvariable_scopeï¼‰çš„å·¥ä½œæœºåˆ¶"></a>2.5 å˜é‡åŸŸï¼ˆvariable_scopeï¼‰çš„å·¥ä½œæœºåˆ¶</h3><h4 id="2-5-1-get-variableçš„ç†è§£"><a href="#2-5-1-get-variableçš„ç†è§£" class="headerlink" title="2.5.1 get_variableçš„ç†è§£"></a>2.5.1 get_variableçš„ç†è§£</h4><p>é¦–å…ˆï¼Œå¯¹<code>tf.get_variable()</code>è¿›è¡Œç†è§£ï¼Œè¯¥æ–¹æ³•çš„ä½¿ç”¨ä¸»è¦å–å†³äºè°ƒç”¨çš„åŸŸçš„è®¾ç½®ï¼š<code>tf.get_variable_scope().reuse == False or tf.get_variable_scope().reuse == True</code>ã€‚å½“ç»“æœå€¼ ä¸ºFalseæ—¶ï¼Œè¿™æ˜¯<code>tf.get_variable()</code>å°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”ä¼šåˆ¤æ–­è¿™ä¸ªå˜é‡åœ¨è¿™ä¸ªåŸŸä¸‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±ä¼šå¼•å‘<code>ValueError</code>ï¼Œå¦åˆ™å°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªå˜é‡å‡ºæ¥ï¼š</p><pre><code class="python">with tf.variable_scope(&quot;foo&quot;):    v = tf.get_variable(&quot;v&quot;, [1])assert v.name == &quot;foo/v:0&quot;</code></pre><p>è€Œå¦‚æœ <code>tf.get_variable_scope().reuse == True</code>ï¼Œé‚£ä¹ˆ TensorFlow ä¼šæ‰§è¡Œç›¸åçš„åŠ¨ä½œï¼Œå°±æ˜¯åˆ°ç¨‹åºé‡Œé¢å¯»æ‰¾å˜é‡åä¸º <code>scope name + name</code> çš„å˜é‡ï¼Œå¦‚æœå˜é‡ä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡º <code>ValueError</code> å¼‚å¸¸ï¼Œå¦åˆ™ï¼Œå°±è¿”å›æ‰¾åˆ°çš„å˜é‡ï¼š</p><pre><code class="python">with tf.variable_scope(&quot;foo&quot;):    v = tf.get_variable(&quot;v&quot;, [1])with tf.variable_scope(&quot;foo&quot;, reuse=True):    v1 = tf.get_variable(&quot;v&quot;, [1])assert v1 is v</code></pre><h4 id="2-5-2-variable-scopeçš„åŸºæœ¬ä½¿ç”¨"><a href="#2-5-2-variable-scopeçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.5.2 variable_scopeçš„åŸºæœ¬ä½¿ç”¨"></a>2.5.2 variable_scopeçš„åŸºæœ¬ä½¿ç”¨</h4><p>å˜é‡åŸŸæ—¶å¯ä»¥åµŒå¥—ä½¿ç”¨çš„ï¼ŒåµŒå¥—åï¼Œå˜é‡åä¼šä»¥æ­¤åŠ ä¸Šå˜é‡åŸŸä½œä¸ºè·¯å¾„ã€‚å¦‚ä¸‹ä»£ç ï¼š</p><pre><code class="python">with tf.variable_scope(&quot;foo&quot;):    with tf.variable_scope(&quot;bar&quot;):        v = tf.get_variable(&quot;v&quot;, [1])assert v.name == &quot;foo/bar/v:0&quot;</code></pre><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>tf.get_variable_scope()</code> æ¥è·å¾—å½“å‰çš„å˜é‡åŸŸå¯¹è±¡ï¼Œå¹¶é€šè¿‡ <code>reuse_variables()</code> æ–¹æ³•æ¥è®¾ç½®æ˜¯å¦å…±äº«å˜é‡ã€‚ä¸è¿‡ï¼ŒTensorFlow å¹¶ä¸æ”¯æŒå°† <code>reuse</code> å€¼è®¾ä¸º <code>False</code>ï¼Œå¦‚æœä½ è¦åœæ­¢å…±äº«å˜é‡ï¼Œå¯ä»¥é€‰æ‹©ç¦»å¼€å½“å‰æ‰€åœ¨çš„å˜é‡åŸŸï¼Œæˆ–è€…å†è¿›å…¥ä¸€ä¸ªæ–°çš„å˜é‡åŸŸï¼ˆæ¯”å¦‚ï¼Œå†è¿›å…¥ä¸€ä¸ª <code>with</code> è¯­å¥ï¼Œç„¶åæŒ‡å®šæ–°çš„åŸŸåï¼‰ã€‚</p><p>è¿˜éœ€æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œä¸€æ—¦åœ¨ä¸€ä¸ªå˜é‡åŸŸå†…å°† <code>reuse</code> è®¾ä¸º <code>True</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡åŸŸçš„å­å˜é‡åŸŸä¹Ÿä¼šç»§æ‰¿è¿™ä¸ª <code>reuse</code> å€¼ï¼Œè‡ªåŠ¨å¼€å¯å…±äº«å˜é‡ï¼š</p><pre><code class="python">with tf.variable_scope(&quot;root&quot;):    # At start, the scope is not reusing.    assert tf.get_variable_scope().reuse == False    with tf.variable_scope(&quot;foo&quot;):        assert tf.get_variable_scope().reuse == False    with tf.variable_scope(&quot;foo&quot;, reuse=True):        assert tf.get_variable_scope().reuse == True        with tf.variable_scope(&quot;bar&quot;):            assert tf.get_variable_scope().reuse == True    assert tf.get_variable_scope().reuse == False</code></pre><p>å˜é‡åŸŸä¹Ÿå¯ä»¥ ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·æ–¹ä¾¿ä½¿ç”¨å˜é‡åŸŸï¼Œè·³å‡ºå½“å‰å˜é‡åŸŸç­‰ã€‚å¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p><pre><code class="python">with tf.variable_scope(&quot;foo&quot;) as foo_scope:    assert foo_scope.name == &quot;foo&quot;with tf.variable_scope(&quot;bar&quot;)    with tf.variable_scope(&quot;baz&quot;) as other_scope:        assert other_scope.name == &quot;bar/baz&quot;        with tf.variable_scope(foo_scope) as foo_scope2:            assert foo_scope2.name == &quot;foo&quot;  # Not changed.</code></pre><h4 id="2-5-3-åœ¨å˜é‡åŸŸå†…åˆå§‹åŒ–å˜é‡"><a href="#2-5-3-åœ¨å˜é‡åŸŸå†…åˆå§‹åŒ–å˜é‡" class="headerlink" title="2.5.3 åœ¨å˜é‡åŸŸå†…åˆå§‹åŒ–å˜é‡"></a>2.5.3 åœ¨å˜é‡åŸŸå†…åˆå§‹åŒ–å˜é‡</h4><p>æ¯æ¬¡åˆå§‹åŒ–å˜é‡æ—¶éƒ½è¦ä¼ å…¥ä¸€ä¸ª <code>initializer</code>ï¼Œè¿™å®åœ¨æ˜¯éº»çƒ¦ï¼Œè€Œå¦‚æœä½¿ç”¨å˜é‡åŸŸçš„è¯ï¼Œå°±å¯ä»¥æ‰¹é‡åˆå§‹åŒ–å‚æ•°äº†ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><pre><code class="python">with tf.variable_scope(&quot;foo&quot;, initializer=tf.constant_initializer(0.4)):    v = tf.get_variable(&quot;v&quot;, [1])    assert v.eval() == 0.4  # Default initializer as set above.    w = tf.get_variable(&quot;w&quot;, [1], initializer=tf.constant_initializer(0.3)):    assert w.eval() == 0.3  # Specific initializer overrides the default.    with tf.variable_scope(&quot;bar&quot;):        v = tf.get_variable(&quot;v&quot;, [1])        assert v.eval() == 0.4  # Inherited default initializer.    with tf.variable_scope(&quot;baz&quot;, initializer=tf.constant_initializer(0.2)):        v = tf.get_variable(&quot;v&quot;, [1])        assert v.eval() == 0.2  # Changed default initializer.</code></pre><h2 id="3-æœ€æ–°çš„æ•°æ®å¤„ç†ç±»â€”data-Dataset"><a href="#3-æœ€æ–°çš„æ•°æ®å¤„ç†ç±»â€”data-Dataset" class="headerlink" title="3. æœ€æ–°çš„æ•°æ®å¤„ç†ç±»â€”data.Dataset"></a>3. æœ€æ–°çš„æ•°æ®å¤„ç†ç±»â€”data.Dataset</h2><p>è¿™éƒ¨åˆ†å’Œ1ä¸­å¯¹çº¿ç¨‹å’Œé˜Ÿåˆ—çš„åŠŸèƒ½æœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†æ›´å¤šåœ¨æ•°æ®è¾“å…¥éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸­çš„è¿˜æœ‰åœ¨å…¶ä»–æ–¹é¢ä½¿ç”¨ã€‚<code>Dataset</code>APIæ˜¯TensorFlowåœ¨ç‰ˆæœ¬1.3ä¸­å¼•å…¥çš„æ¨¡å—ï¼Œ1.4ç‰ˆæœ¬ä¸­å·²ç»ä½œä¸ºä¸€ä¸ªæ ¸å¿ƒçš„æ¨¡å—ã€‚ä¸»è¦æœåŠ¡äºæ•°æ®è¯»å–ï¼Œæ„å»ºæ•°æ®çš„pipelineã€‚å‰é¢è¯´äº†å¯ä»¥é€šè¿‡é˜Ÿåˆ—å’Œçº¿ç¨‹æ„å»ºï¼Œä½†æ˜¯æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç¹çï¼ŒTensorFlowä¾¿å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æ„å»ºã€‚ä¸»è¦æ”¯æŒä»å†…å­˜å’Œç¡¬ç›˜è¯»å–æ•°ã€‚</p><h3 id="3-1-ä½¿ç”¨Datasetçš„æ­¥éª¤"><a href="#3-1-ä½¿ç”¨Datasetçš„æ­¥éª¤" class="headerlink" title="3.1 ä½¿ç”¨Datasetçš„æ­¥éª¤"></a>3.1 ä½¿ç”¨<code>Dataset</code>çš„æ­¥éª¤</h3><p>åœ¨æ•°æ®è¾“å…¥ä¸­ç”¨<code>Dataset</code>æ¨¡å—ï¼Œéœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>å¯¼å…¥æ•°æ®ï¼Œä»ä¸€äº›æ•°æ®æ¥æ„å»ºdatasetï¼Œåˆ›å»ºdatasetå¯¹è±¡ï¼Œ å¯ä»¥é€šè¿‡<code>from_tensors</code>ï¼Œ<code>from_tensors_slice</code></li><li>å®ä¾‹åŒ–ï¼Œå°†datasetå®ä¾‹åŒ–ä¸º<strong>Iterator</strong>ï¼Œä¸‹å›¾ä¸­ä¸ºdatasetä¸‹å‡ ä¸ªå®ä¾‹çš„å…³ç³»ï¼š</li></ol><p><img src="http://img.blog.csdn.net/20171114112942700" srcset="/img/loading.gif" alt="Dataset API ä¸‹çš„ç±»å›¾"></p><ol start="3"><li>æ¶ˆè´¹æ•°æ®ï¼Œåœ¨Iteratorçš„åŸºç¡€ä¸Šå¯¹æ•°æ®è¿›è¡Œæ¶ˆè´¹ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„è®¡ç®—æˆ–è®­ç»ƒ</li></ol><h3 id="3-2-åŸºæœ¬ä½¿ç”¨"><a href="#3-2-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.2 åŸºæœ¬ä½¿ç”¨"></a>3.2 åŸºæœ¬ä½¿ç”¨</h3><p>åœ¨æœ€å¼€å§‹ä½¿ç”¨æ—¶å¯ä»¥åªå…³æ³¨Datasetå’ŒIteratorè¿™ä¸¤ä¸ªç±»ï¼Œå†è¿›è¡Œé€æ­¥çš„æ‰©å±•åˆ°å…¶ä»–ç±»çš„ä½¿ç”¨ã€‚Datasetå¯ä»¥çœ‹ä½œæ˜¯ç›¸åŒç±»å‹â€œå…ƒç´ â€çš„æœ‰åºåˆ—è¡¨ã€‚åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå•ä¸ªâ€œå…ƒç´ â€å¯ä»¥æ˜¯å‘é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å›¾ç‰‡ï¼Œç”šè‡³æ˜¯tupleæˆ–è€…dictã€‚</p><p>åœ¨æ¶ˆè´¹æ•°æ®çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡get_nextæ–¹æ³•è·å–æ•°æ®ã€‚ä¸è®ºé€šè¿‡ä»€ä¹ˆæ–¹å¼åˆ›å»ºæ•°æ®é›†ï¼Œåœ¨è¿”å›æ•°æ®æ—¶éƒ½æ˜¯è¿”å›ä¸€è¡Œæˆ–å¤šè¡Œæ•°æ®ã€‚ä¸‹é¢çš„å‡ ä¸ªdatasetå°±å¯ä»¥çœ‹å‡ºè¿”å›æ•°æ®çš„è§„å¾‹ã€‚</p><h4 id="3-2-1-from-numpyçš„æ•°æ®"><a href="#3-2-1-from-numpyçš„æ•°æ®" class="headerlink" title="3.2.1 from numpyçš„æ•°æ®"></a>3.2.1 from numpyçš„æ•°æ®</h4><p>ä»numpyä¸‹çš„arrayè¯»å–æ•°æ®åˆ°datasetï¼š</p><pre><code class="python">dataset = tf.data.Dataset.from_tensor_slices(np.random.uniform(size=(5, 3)))  # 1.import dataiterator = dataset.make_one_shot_iterator()  # 2.ä»datasetå®ä¾‹åŒ–ä¸€ä¸ªiteratorone_element = iterator.get_next()  # 3.æ¶ˆè´¹æ•°æ®with tf.Session() as sess:    try:        for i in range(6):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)# ---------------------- output ----------------------# æ¯æ¬¡è¿”å›ä¸€è¡Œæ•°æ®, å…±è¿”å›5æ¬¡, ç›¸å½“äº5ä¸ªæ ·æœ¬ï¼Œ3ä¸ªç‰¹å¾</code></pre><h4 id="3-2-2-ä»å­—å…¸ä¸­åˆ›å»ºdataset"><a href="#3-2-2-ä»å­—å…¸ä¸­åˆ›å»ºdataset" class="headerlink" title="3.2.2 ä»å­—å…¸ä¸­åˆ›å»ºdataset"></a>3.2.2 ä»å­—å…¸ä¸­åˆ›å»ºdataset</h4><pre><code class="python">dataset = tf.data.Dataset.from_tensor_slices(    {        &quot;a&quot;: np.array([1.0, 2.0, 3.0, 4.0, 5.0]),  # &quot;å¯ä»¥å°†key-aå½“åšlabelçš„åºåˆ—&quot;        &quot;b&quot;: np.random.uniform(size=(5, 2))    })dataset = dataset.map(lambda x: {&quot;a&quot;: x[&quot;a&quot;], &quot;b&quot;: 10 * x[&quot;b&quot;]})iterator = dataset.make_one_shot_iterator()  # ä»datasetå®ä¾‹åŒ–ä¸€ä¸ªiteratorone_element = iterator.get_next()with tf.Session() as sess:    try:        for i in range(6):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)# ------------------ output -----------------------{&#39;a&#39;: 1.0, &#39;b&#39;: array([4.18069729, 3.36752717])}  # æ¯æ¬¡ä¼šä¸€ä¸ªlableæ‰€å¯¹åº”çš„sampleï¼Œå…±è¿”å›5æ¬¡{&#39;a&#39;: 2.0, &#39;b&#39;: array([7.37556694, 1.79710602])}{&#39;a&#39;: 3.0, &#39;b&#39;: array([1.76684338, 0.48396737])}{&#39;a&#39;: 4.0, &#39;b&#39;: array([6.21267904, 5.28298128])}{&#39;a&#39;: 5.0, &#39;b&#39;: array([8.36019678, 2.08220728])}</code></pre><h4 id="3-2-3-ä»tupleä¸­åˆ›å»ºdataset"><a href="#3-2-3-ä»tupleä¸­åˆ›å»ºdataset" class="headerlink" title="3.2.3 ä»tupleä¸­åˆ›å»ºdataset"></a>3.2.3 ä»tupleä¸­åˆ›å»ºdataset</h4><pre><code class="python">dataset = tf.data.Dataset.from_tensor_slices(  (np.array([1.0, 2.0, 3.0, 4.0, 5.0]), np.random.uniform(size=(5, 2))))dataset = dataset.map(lambda x, y: (x, y*10))iterator = dataset.make_one_shot_iterator()  # ä»datasetå®ä¾‹åŒ–ä¸€ä¸ªiteratorone_element = iterator.get_next()with tf.Session() as sess:    try:        for i in range(6):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)# ---------------------- output ------------------------(1.0, array([2.45236335, 9.04392201]))  # è¿™ä¸ªè¿”å›æ–¹å¼å’Œå­—å…¸ç±»ä¼¼(2.0, array([5.16675082, 4.89549424]))(3.0, array([3.66104816, 3.01531896]))(4.0, array([8.56580726, 3.77034437]))(5.0, array([8.18391386, 6.2216879 ]))</code></pre><h4 id="3-2-4-ä»ç”Ÿæˆå™¨åˆ›å»ºdataset"><a href="#3-2-4-ä»ç”Ÿæˆå™¨åˆ›å»ºdataset" class="headerlink" title="3.2.4 ä»ç”Ÿæˆå™¨åˆ›å»ºdataset"></a>3.2.4 ä»ç”Ÿæˆå™¨åˆ›å»ºdataset</h4><pre><code class="python">sequence = np.array([[1, 2, 2.3464],[2, 3, 45.253],[3, 4, 455.22]])def generator():    for el in sequence:        yield eldataset = tf.data.Dataset().from_generator(generator,                                           output_types=tf.float32)iterator = dataset.make_one_shot_iterator()  # ä»datasetå®ä¾‹åŒ–ä¸€ä¸ªiteratorone_element = iterator.get_next()with tf.Session() as sess:    try:        for i in range(6):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)# ---------------------- output ---------------------[1.     2.     2.3464]  # è¿™ä¸ªè¿”å›æ–¹å¼å’Œç¬¬ä¸€ç§æ–¹å¼ç±»ä¼¼[ 2.     3.    45.253][  3.     4.   455.22]</code></pre><h3 id="3-3-åœ¨datasetä¸­è¿›è¡Œæ•°æ®å¤„ç†"><a href="#3-3-åœ¨datasetä¸­è¿›è¡Œæ•°æ®å¤„ç†" class="headerlink" title="3.3 åœ¨datasetä¸­è¿›è¡Œæ•°æ®å¤„ç†"></a>3.3 åœ¨datasetä¸­è¿›è¡Œæ•°æ®å¤„ç†</h3><p>datasetä¸­ä¹Ÿå¯ä»¥å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå˜æ¢ç­‰ã€‚ä¸»è¦æœ‰çš„æ–¹æ³•ï¼šmapï¼Œcacheï¼Œshuffleï¼Œrepeatï¼Œbatchï¼Œprefetchï¼Œfileterï¼Œflat_mapç­‰ã€‚è¿™äº›æ–¹æ³•åœ¨å¤„ç†æ•°æ®æ—¶ä¼šç»å¸¸ç”¨å¤§ã€‚</p><h4 id="3-3-1-mapçš„ä½¿ç”¨"><a href="#3-3-1-mapçš„ä½¿ç”¨" class="headerlink" title="3.3.1 mapçš„ä½¿ç”¨"></a>3.3.1 mapçš„ä½¿ç”¨</h4><p>datasetä¸­çš„mapå’Œpythonçš„mapç”¨æ³•ä¸€è‡´ï¼Œæ¥å—ä¸€ä¸ªå¤„ç†å‡½æ•°ã€‚å†è¿”å›å¤„ç†åçš„æ•°æ®ã€‚mapä¸»è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå®ƒçš„çš„apiæ˜¯ï¼š<code>map(map_func, num_parallel_calls=None)</code>ï¼Œç¬¬ä¸€å‚æ•°ä¸ºmapå‡½æ•°ï¼Œç”¨æ¥å˜æ¢æ•°æ®ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºå¹¶å‘æ•°ï¼Œä¸€èˆ¬ä¸ºcpuçš„çº¿ç¨‹æ•°ã€‚å¦‚ï¼š</p><pre><code class="python">dataset = tf.data.Dataset.from_tensor_slices(  (np.array([1.0, 2.0, 3.0, 4.0, 5.0]), np.random.uniform(size=(5, 2))))dataset = dataset.map(lambda x, y: (x, y*10), num_parallel_calls=4)  # mapçš„ä½¿ç”¨ï¼Œçº¿ç¨‹æ•°ä¸º4iterator = dataset.make_one_shot_iterator() one_element = iterator.get_next()with tf.Session() as sess:    try:        for i in range(6):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdatasetæœ‰<strong>mapå’Œapply</strong>ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬æ˜¯æœ‰ä¸€å®š<strong>åŒºåˆ«</strong>çš„ï¼Œmapæ˜¯å°†map_functionåº”ç”¨åˆ°æ¯ä¸€ä¸ªå‡½æ•°ã€‚è€Œapplyæ˜¯å°†functionåº”ç”¨åˆ°æ•´ä¸ªdatasetã€‚mapçš„å‚æ•°æ˜¯ä¸€ä¸ªelement ï¼Œè€Œapplyçš„å‡½æ•°å‚æ•°æ˜¯datasetï¼Œapplyå¯ç”¨çš„æ–¹æ³•<a href="https://www.tensorflow.org/versions/master/api_guides/python/input_dataset#Transformations_on_existing_datasets" target="_blank" rel="noopener">åœ¨è¿™å„¿</a>ã€‚å¦‚ä¸‹ï¼š</p><pre><code class="python">dataset = tf.data.Dataset.from_tensor_slices(  (np.array([1.0, 2.0, 3.0, 4.0, 5.0]), np.random.uniform(size=(5, 2))))dataset = dataset.apply(tf.contrib.data.map_and_batch(lambda x, y: (x, y * 100), 2))iterator = dataset.make_one_shot_iterator() one_element = iterator.get_next()with tf.Session() as sess:    try:        for i in range(5):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)</code></pre><h4 id="3-3-2-cacheçš„ä½¿ç”¨"><a href="#3-3-2-cacheçš„ä½¿ç”¨" class="headerlink" title="3.3.2 cacheçš„ä½¿ç”¨"></a>3.3.2 cacheçš„ä½¿ç”¨</h4><p>cacheä¸»è¦æ˜¯å°†æ•°æ®è¿›è¡Œç¼“å­˜ï¼Œå¯ä»¥ç¼“å­˜åˆ°å†…å­˜ï¼Œä¹Ÿå¯ä»¥ç¼“å­˜åˆ°ç£ç›˜ã€‚é»˜è®¤ä¸ºç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚æ¯”è¾ƒå¥½ç†è§£ï¼Œå…·ä½“å°±ä¸ä»‹ç»äº†ã€‚</p><h4 id="3-3-3-shuffleçš„ä½¿ç”¨"><a href="#3-3-3-shuffleçš„ä½¿ç”¨" class="headerlink" title="3.3.3 shuffleçš„ä½¿ç”¨"></a>3.3.3 shuffleçš„ä½¿ç”¨</h4><p>shuffleçš„åŠŸèƒ½ä¸ºæ‰“ä¹±datasetä¸­çš„å…ƒç´ ï¼Œå®ƒæœ‰ä¸€ä¸ªå‚æ•°buffersizeï¼Œè¡¨ç¤ºæ‰“ä¹±æ—¶ä½¿ç”¨çš„bufferçš„å¤§å°ï¼Œå»ºè®®èˆçš„ä¸è¦å¤ªå°ï¼Œä¸€èˆ¬å»ºè®®æ˜¯datasetçš„size+1ï¼Œå³æ ·æœ¬æ•°+1ã€‚å¦‚ä¸‹ä»£ç ï¼Œè¾“å‡ºçš„é¡ºåºè¢«æ‰“ä¹±äº†ã€‚</p><pre><code class="python">dataset = tf.data.Dataset.from_tensor_slices(  (np.array([1.0, 2.0, 3.0, 4.0, 5.0]), np.random.uniform(size=(5, 2))))dataset = dataset.map(lambda x, y: (x, y*10), num_parallel_calls=4).shuffle(buffer_size=6)iterator = dataset.make_one_shot_iterator()  # ä»datasetå®ä¾‹åŒ–ä¸€ä¸ªiteratorone_element = iterator.get_next()with tf.Session() as sess:    try:        for i in range(5):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)# --------------------- output ------------------------(4.0, array([2.57439552, 3.38879843]))(2.0, array([7.25460172, 3.86126726]))(1.0, array([9.08901095, 1.75219504]))(5.0, array([5.04888193, 3.89428254]))(3.0, array([9.78304135, 3.44271984]))</code></pre><h4 id="3-3-4-repeatçš„ä½¿ç”¨"><a href="#3-3-4-repeatçš„ä½¿ç”¨" class="headerlink" title="3.3.4 repeatçš„ä½¿ç”¨"></a>3.3.4 repeatçš„ä½¿ç”¨</h4><p>repeatçš„åŠŸèƒ½å°±æ˜¯å°†æ•´ä¸ªåºåˆ—é‡å¤å¤šæ¬¡ï¼Œä¸»è¦ç”¨æ¥å¤„ç†æœºå™¨å­¦ä¹ ä¸­çš„epochï¼Œå‡è®¾åŸå…ˆçš„æ•°æ®æ˜¯ä¸€ä¸ªepochï¼Œä½¿ç”¨repeat(2)å°±å¯ä»¥å°†ä¹‹å˜æˆ2ä¸ªepochï¼š</p><pre><code class="python">dataset = tf.data.Dataset.from_tensor_slices({&quot;a&quot;: np.array([1.0, 2.0, 3.0, 4.0, 5.0]),                                               &quot;b&quot;: np.random.uniform(size=(5, 2))})dataset = dataset.repeat(2) # repeatiterator = dataset.make_one_shot_iterator()one_element = iterator.get_next()with tf.Session() as sess:    try:        while True:            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end!&quot;)# --------------------- output --------------------{&#39;a&#39;: 1.0, &#39;b&#39;: array([0.13072499, 0.81223459])}{&#39;a&#39;: 2.0, &#39;b&#39;: array([0.67836451, 0.02996121])}{&#39;a&#39;: 3.0, &#39;b&#39;: array([0.17338524, 0.73540362])}{&#39;a&#39;: 4.0, &#39;b&#39;: array([0.57598212, 0.11428893])}{&#39;a&#39;: 5.0, &#39;b&#39;: array([0.55184749, 0.8721738 ])}{&#39;a&#39;: 1.0, &#39;b&#39;: array([0.13072499, 0.81223459])}{&#39;a&#39;: 2.0, &#39;b&#39;: array([0.67836451, 0.02996121])}{&#39;a&#39;: 3.0, &#39;b&#39;: array([0.17338524, 0.73540362])}{&#39;a&#39;: 4.0, &#39;b&#39;: array([0.57598212, 0.11428893])}{&#39;a&#39;: 5.0, &#39;b&#39;: array([0.55184749, 0.8721738 ])}</code></pre><h4 id="3-3-5-batchçš„ä½¿ç”¨"><a href="#3-3-5-batchçš„ä½¿ç”¨" class="headerlink" title="3.3.5 batchçš„ä½¿ç”¨"></a>3.3.5 batchçš„ä½¿ç”¨</h4><p>batchå°±æ˜¯å°†å¤šä¸ªæ ·æœ¬ç»„åˆæˆbatchï¼Œå¦‚APIæ‰€è¯´ï¼ŒæŒ‰ç…§è¾“å…¥å…ƒç´ ç¬¬ä¸€ä¸ªç»´åº¦è¿›è¡Œç»„åˆæˆä¸€ä¸ªbatchï¼š</p><pre><code class="python"># batchçš„ä½¿ç”¨dataset = tf.data.Dataset.from_tensor_slices(  (np.array([1.0, 2.0, 3.0, 4.0, 5.0]), np.random.uniform(size=(5, 2))))dataset = dataset.map(lambda x, y: (x, y*10), num_parallel_calls=4).shuffle(buffer_size=6).batch(3)iterator = dataset.make_one_shot_iterator()  # ä»datasetå®ä¾‹åŒ–ä¸€ä¸ªiteratorone_element = iterator.get_next()with tf.Session() as sess:    try:        for i in range(5):            print(sess.run(one_element))    except tf.errors.OutOfRangeError:        print(&quot;end&quot;)# ------------------------- output ------------------------(array([4., 3., 5.]),  array([[6.32798625, 3.34494733],       [8.6747479 , 6.6041502 ],       [2.96699653, 9.73854298]]))(array([1., 2.]),  array([[4.75347977, 5.51553647],       [4.12808918, 6.81227941]]))</code></pre><p>è¿™äº›æ“ä½œéƒ½å¯ä»¥ç»„åˆèµ·æ¥ä½¿ç”¨ã€‚å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå°†mapï¼Œshuffleï¼Œbatchè¿›è¡Œç»„åˆä½¿ç”¨ã€‚</p><h3 id="3-4-æ¨¡æ‹Ÿè¯»å–æ–‡ä»¶å¹¶é€šè¿‡datasetè¿›è¡Œå¤„ç†"><a href="#3-4-æ¨¡æ‹Ÿè¯»å–æ–‡ä»¶å¹¶é€šè¿‡datasetè¿›è¡Œå¤„ç†" class="headerlink" title="3.4 æ¨¡æ‹Ÿè¯»å–æ–‡ä»¶å¹¶é€šè¿‡datasetè¿›è¡Œå¤„ç†"></a>3.4 æ¨¡æ‹Ÿè¯»å–æ–‡ä»¶å¹¶é€šè¿‡datasetè¿›è¡Œå¤„ç†</h3><p>å¯ä»¥å°†ç¬¬ä¸€éƒ¨åˆ†ä¸­è¯»å–æ–‡ä»¶æ•°æ®çš„ä¾‹å­è¿‘ä¿®æ”¹ï¼Œé€šè¿‡datasetçš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚ä¸‹é¢å†datasetä¸­å­˜å…¥çš„æ˜¯æ¯å¼ å›¾ç‰‡çš„è·¯å¾„ï¼Œåé¢é€šè¿‡mapè¯»å–æ•°æ®ï¼Œå¹¶åç»­ç»§ç»­ä½¿ç”¨ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="python">def _parse_function(filename, label):    image_string = tf.read_file(filename)    image_decoded = tf.image.decode_image(image_string)    image_resized = tf.image.resize_images(image_decoded, [28, 28])    return image_resized, labelfilenames = tf.constant([&quot;/var/data/image1.jpg&quot;, &quot;/var/data/image2.jpg&quot;, ...])labels = tf.constant([0, 37, ...])dataset = tf.data.Dataset.from_tensor_slices((filenames, labels))dataset = dataset.map(_parse_function)dataset = dataset.shuffle(buffersize=1000).batch(32).repeat(10)</code></pre><h3 id="3-5-åˆ›å»ºdatasetçš„å…¶ä»–æ–¹æ³•"><a href="#3-5-åˆ›å»ºdatasetçš„å…¶ä»–æ–¹æ³•" class="headerlink" title="3.5 åˆ›å»ºdatasetçš„å…¶ä»–æ–¹æ³•"></a>3.5 åˆ›å»ºdatasetçš„å…¶ä»–æ–¹æ³•</h3><p>é™¤äº†<code>tf.data.Dataset.from_tensor_slices</code>å¤–ï¼Œç›®å‰Dataset APIè¿˜æä¾›äº†å¦å¤–ä¸‰ç§åˆ›å»ºDatasetçš„æ–¹å¼ï¼š</p><ul><li>tf.data.TextLineDataset()ï¼šè¿™ä¸ªå‡½æ•°çš„è¾“å…¥æ˜¯ä¸€ä¸ªæ–‡ä»¶çš„åˆ—è¡¨ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªdatasetã€‚datasetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å°±å¯¹åº”äº†æ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è¯»å…¥CSVæ–‡ä»¶ã€‚</li><li>tf.data.FixedLengthRecordDataset()ï¼šè¿™ä¸ªå‡½æ•°çš„è¾“å…¥æ˜¯ä¸€ä¸ªæ–‡ä»¶çš„åˆ—è¡¨å’Œä¸€ä¸ªrecord_bytesï¼Œä¹‹ådatasetçš„æ¯ä¸€ä¸ªå…ƒç´ å°±æ˜¯æ–‡ä»¶ä¸­å›ºå®šå­—èŠ‚æ•°record_bytesçš„å†…å®¹ã€‚é€šå¸¸ç”¨æ¥è¯»å–ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜çš„æ–‡ä»¶ï¼Œå¦‚CIFAR10æ•°æ®é›†å°±æ˜¯è¿™ç§å½¢å¼ã€‚</li><li>tf.data.TFRecordDataset()ï¼šé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥è¯»TFRecordæ–‡ä»¶çš„ï¼Œdatasetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å°±æ˜¯ä¸€ä¸ªTFExampleã€‚</li></ul><h3 id="3-6-å°†datasetå®ä¾‹åŒ–ä¸ºiteratorçš„å…¶ä»–æ–¹æ³•"><a href="#3-6-å°†datasetå®ä¾‹åŒ–ä¸ºiteratorçš„å…¶ä»–æ–¹æ³•" class="headerlink" title="3.6 å°†datasetå®ä¾‹åŒ–ä¸ºiteratorçš„å…¶ä»–æ–¹æ³•"></a>3.6 å°†datasetå®ä¾‹åŒ–ä¸ºiteratorçš„å…¶ä»–æ–¹æ³•</h3><p>é™¤äº†è¿™ç§one shot iteratorå¤–ï¼Œè¿˜æœ‰ä¸‰ä¸ªæ›´å¤æ‚çš„Iteratorï¼Œå³ï¼š<code>initializable iterator, reinitializable iterator, feedable iterator</code>.</p><h4 id="3-6-1-initializable-iteratorå®ä¾‹åŒ–"><a href="#3-6-1-initializable-iteratorå®ä¾‹åŒ–" class="headerlink" title="3.6.1 initializable iteratorå®ä¾‹åŒ–"></a>3.6.1 initializable iteratorå®ä¾‹åŒ–</h4><p><code>initializable iterator</code>æ–¹æ³•è¦åœ¨ä½¿ç”¨å‰é€šè¿‡<code>sess.run()</code>æ¥åˆå§‹åŒ–ï¼Œä½¿ç”¨initializable iteratorï¼Œå¯ä»¥å°†placeholderä»£å…¥Iteratorä¸­ï¼Œå®ç°æ›´ä¸ºçµæ´»çš„æ•°æ®è½½å…¥ï¼Œå®é™…ä¸Šå ä½ç¬¦å¼•å…¥äº†datasetå¯¹è±¡åˆ›å»ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡feedæ¥æ§åˆ¶æ•°æ®é›†åˆçš„å®é™…æƒ…å†µã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="python">limit = tf.placeholder(dtype=tf.int32, shape=[])dataset = tf.data.Dataset.from_tensor_slices(tf.range(start=0, limit=limit))iterator = dataset.make_initializable_iterator()next_element = iterator.get_next()with tf.Session() as sess:    sess.run(iterator.initializer, feed_dict={limit: 10})    for i in range(10):      value = sess.run(next_element)      print(value)      assert i == value# output:0 1 2 3 4 5 6 7 8 9</code></pre><p><code>initializable iterator</code>è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼šè¯»å…¥è¾ƒå¤§çš„æ•°ç»„ã€‚åœ¨ä½¿ç”¨<code>tf.data.Dataset.from_tensor_slices(array)</code>æ—¶ï¼Œå®é™…ä¸Šå‘ç”Ÿçš„äº‹æƒ…æ˜¯å°†<code>array</code>ä½œä¸ºä¸€ä¸ª<code>tf.constants</code>ä¿å­˜åˆ°äº†è®¡ç®—å›¾ä¸­ã€‚å½“<code>array</code>å¾ˆå¤§æ—¶ï¼Œä¼šå¯¼è‡´è®¡ç®—å›¾å˜å¾—å¾ˆå¤§ï¼Œç»™ä¼ è¾“ã€ä¿å­˜å¸¦æ¥ä¸ä¾¿ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª<code>placeholder</code>å–ä»£è¿™é‡Œçš„<code>array</code>ï¼Œå¹¶ä½¿ç”¨<code>initializable iterator</code>ï¼Œåªåœ¨éœ€è¦æ—¶å°†<code>array</code>ä¼ è¿›å»ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æŠŠå¤§æ•°ç»„ä¿å­˜åœ¨å›¾é‡Œï¼Œç¤ºä¾‹ä»£ç ä¸ºï¼ˆæ¥è‡ªå®˜æ–¹ä¾‹ç¨‹ï¼‰ï¼š</p><pre><code class="python">with np.load(&quot;/var/data/training_data.npy&quot;) as data:    features = data[&quot;features&quot;]    labels = data[&quot;labels&quot;]features_placeholder = tf.placeholder(features.dtype, features.shape)labels_placeholder = tf.placeholder(labels.dtype, labels.shape)dataset = tf.data.Dataset.from_tensor_slices((features_placeholder, labels_placeholder))iterator = dataset.make_initializable_iterator()sess.run(iterator.initializer, feed_dict={features_placeholder: features, labels_placeholder: labels})</code></pre><p>å¯è§ï¼Œåœ¨ä¸Šé¢ç¨‹åºä¸­ï¼Œfeedä¹Ÿéµå¾ªç€ç±»ä¼¼å­—å…¸ä¸€æ ·çš„è§„åˆ™ï¼Œåˆ›å»ºä¸¤ä¸ªå ä½ç¬¦(keys)ï¼Œç»™<code>data_holder</code>å»feedæ•°æ®æ–‡ä»¶ï¼Œç»™<code>label_holder</code>å»feedæ ‡ç­¾æ–‡ä»¶ã€‚</p><h4 id="3-6-2-reinitializable-iteratorå®ä¾‹åŒ–"><a href="#3-6-2-reinitializable-iteratorå®ä¾‹åŒ–" class="headerlink" title="3.6.2 reinitializable iteratorå®ä¾‹åŒ–"></a>3.6.2 reinitializable iteratorå®ä¾‹åŒ–</h4><p><code>reinitializable iterator</code>å¯ä»¥ä»å¤šä¸ªä¸åŒçš„Datasetå¯¹è±¡å¤„åˆå§‹åŒ–ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªtraining input pipelineï¼ˆå®ƒå¯¹è¾“å…¥å›¾ç‰‡åšéšæœºæ‰°åŠ¨æ¥æé«˜æ³›åŒ–èƒ½åŠ›ï¼‰ï¼›ä»¥åŠä¸€ä¸ªvalidation input pipelineï¼ˆå®ƒä¼šåœ¨æœªä¿®æ”¹è¿‡çš„æ•°æ®ä¸Šè¿›è¡Œé¢„æµ‹çš„è¯„ä¼°ï¼‰ã€‚è¿™äº›pipelineé€šå¸¸ä½¿ç”¨ä¸åŒçš„Datasetå¯¹è±¡ï¼Œä½†å®ƒä»¬å…·æœ‰ç›¸åŒçš„ç»“æ„ï¼ˆä¾‹å¦‚ï¼šå¯¹æ¯ä¸ªcomponentç›¸åŒçš„typeså’Œshapesï¼‰ã€‚</p><pre><code class="python"># Define training and validation datasets with the same structure.training_dataset = tf.data.Dataset.range(100).map(lambda x: x + tf.random_uniform([], -10, 10, tf.int64))validation_dataset = tf.data.Dataset.range(50)# A reinitializable iterator is defined by its structure. We could use the# `output_types` and `output_shapes` properties of either `training_dataset`# or `validation_dataset` here, because they are compatible.iterator = tf.data.Iterator.from_structure(training_dataset.output_types, training_dataset.output_shapes)next_element = iterator.get_next()training_init_op = iterator.make_initializer(training_dataset)validation_init_op = iterator.make_initializer(validation_dataset)# Run 20 epochs in which the training dataset is traversed, followed by the# validation dataset.for _ in range(20):    # Initialize an iterator over the training dataset.    sess.run(training_init_op)    for _ in range(100):        sess.run(next_element)        # Initialize an iterator over the validation dataset.        sess.run(validation_init_op)        for _ in range(50):            sess.run(next_element)</code></pre><h3 id="3-7-Refrence"><a href="#3-7-Refrence" class="headerlink" title="3.7 Refrence"></a>3.7 Refrence</h3><p>[1].<a href="http://d0evi1.com/tensorflow/datasets/" target="_blank" rel="noopener">tensorflowä¸­çš„dataset</a></p><p>[2].<a href="https://towardsdatascience.com/how-to-use-dataset-in-tensorflow-c758ef9e4428" target="_blank" rel="noopener">How to use Dataset in TensorFlow</a></p><p>[3].<a href="https://www.cnblogs.com/hellcat/p/8569651.html" target="_blank" rel="noopener">TensorFlowã€æ•°æ®è¯»å–ç±»_data.Dataset</a></p><h2 id="4-collection"><a href="#4-collection" class="headerlink" title="4.collection"></a>4.collection</h2><p>TensorFlowä¸­æœ‰ä¸€ä¸ªé›†åˆå«collectionï¼Œcollectionä¸»è¦æ˜¯æä¾›tensorflowå…¨å±€å­˜å‚¨çš„æœºåˆ¶ï¼Œä¸ä¼šå—åˆ°å˜é‡åç©ºé—´çš„å½±å“ï¼Œåœ¨ä¸€ä¸ªåœ°æ–¹ä¿å­˜ï¼Œä»»ä½•åœ°æ–¹å¯ç”¨ã€‚</p><p>TensorFlowè‡ªèº«ä¼šç»´æŠ¤ä¸€äº›è‡ªå·±çš„collectionï¼Œå¦‚<code>tf.GraphKeys.SUMMARIES</code>ï¼Œ<code>ops.GraphKeys.QUEUE_RUNNERS</code>(<code>from tensorflow.python.framework import ops</code>)ï¼Œ<code>GLOBAL_VARIABLES</code>ï¼Œ<code>ops.GraphKyes.LOCAL_VARIABLES</code>ç­‰ç­‰ã€‚åœ¨ä½¿ç”¨TensorFlowçš„è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥è·å–è¿™äº›collectionã€‚</p><h3 id="4-1-å‘collectionä¸­å­˜å…¥æ•°æ®"><a href="#4-1-å‘collectionä¸­å­˜å…¥æ•°æ®" class="headerlink" title="4.1 å‘collectionä¸­å­˜å…¥æ•°æ®"></a>4.1 å‘collectionä¸­å­˜å…¥æ•°æ®</h3><p>åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­å¯ä»¥å‘collectionå­˜å…¥æ•°æ®ï¼Œä¸»è¦é€šè¿‡<code>add_to_collection</code>æ–¹æ³•å°†æ•°æ®åŠ å…¥collectionä¸­ã€‚è¯¥æ–¹æ³•æ˜¯<code>tf.add_to_collection(name, value)</code>ã€‚è¯¥æ–¹æ³•``tf.add_to_collection<code>çš„ä½œç”¨æ˜¯å°†valueä»¥nameçš„åç§°å­˜å‚¨åœ¨æ”¶é›†å™¨(</code>self._collections<code>)ä¸­ã€‚å¦å¤–è¿˜å¯ä»¥åŒæ—¶å°†ä¸€ä¸ªvalueå¢åŠ åˆ°å¤šä¸ªcollectionä¸­ï¼Œé€šè¿‡æ–¹æ³•</code>tf.add_to_collections(names, value)`ã€‚</p><h3 id="4-2-ä»collectionä¸­è·å–æ•°æ®"><a href="#4-2-ä»collectionä¸­è·å–æ•°æ®" class="headerlink" title="4.2 ä»collectionä¸­è·å–æ•°æ®"></a>4.2 ä»collectionä¸­è·å–æ•°æ®</h3><p>å¦‚æœè¦ä»collectionä¸­è·å–æ•°æ®ï¼Œéœ€è¦é€šè¿‡<code>tf.get_collection(name, scope=None)</code>æ¥è·å–é›†åˆä¸­çš„å˜é‡å€¼ã€‚å°†è¿”å›ä¸€ä¸ªlistï¼Œlistä¸­çš„å€¼éƒ½æ˜¯ä¹‹å‰å­˜å…¥çš„ï¼ˆå¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„listï¼‰ã€‚å¿…é¡»ç»™å®šä¸€ä¸ªnameå‚æ•°ï¼Œæ¥æŒ‡å®šè·å–collectionä¸‹æŸä¸ªnameä¸‹çš„å€¼ã€‚scopeå‚æ•°ç”¨æ¥è¿‡æ»¤æŸä¸ªscopeä¸‹çš„å€¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼š</p><pre><code class="python">import numpy as npimport tensorflow as tfx = tf.constant(np.random.random(10) * 10, dtype=tf.float32, name=&quot;const&quot;)with tf.name_scope(&quot;scope_y&quot;):    z = tf.constant(np.random.random(5) * 100, dtype=tf.float32, name=&quot;const&quot;)x_ = x * 10tf.add_to_collection(&quot;x&quot;, x_)tf.add_to_collection(&quot;x&quot;, x)  # å‘ä¸€ä¸ªnameå¢åŠ å¤šä¸ªå€¼, å¦‚æœå¢åŠ [x, x_], é‚£ä¹ˆè¾“å‡ºçš„æ˜¯[[x, x_]]with tf.Session() as sess:    print(sess.run(x_))    # tf.graph.add_to_collection(&quot;x&quot;, x_)    print(sess.run(tf.get_collection(&quot;x&quot;)))    print(sess.run(tf.get_collection(&quot;y&quot;)))    print(sess.run(tf.get_collection(&quot;x&quot;, scope=&quot;scope_y&quot;)))  # åªè¿”å›è¿™ä¸ªscopeä¸‹çš„å€¼</code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class="python"># --------------------------- x_ --------------------------------[22.296236  89.52586   94.95532   82.79374    4.5324626 99.39854  54.841103  50.33739   95.65411  95.163025 ]# ------------------------ collection ---------------------------[    array([22.296236 , 89.52586  , 94.95532  , 82.79374  ,  4.5324626,       99.39854  , 54.841103 , 50.33739  , 95.65411  , 95.163025 ], dtype=float32),     array([2.2296236 , 8.952586  , 9.495532  , 8.279374  , 0.45324627,       9.939854  , 5.4841104 , 5.033739  , 9.565412  , 9.516302  ], dtype=float32),    array([19.762728, 97.20074 , 35.839146, 82.53057 , 63.590633], dtype=float32)]# ----------------------- name is not exists ---------------------[]# ----------------------- scope is used --------------------------[array([19.762728, 97.20074 , 35.839146, 82.53057 , 63.590633], dtype=float32)]</code></pre>]]></content>
    
    
    <categories>
      
      <category>tensorflow</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tensorflow</tag>
      
      <tag>Queue</tag>
      
      <tag>Coordinator</tag>
      
      <tag>Dataset</tag>
      
      <tag>collection</tag>
      
      <tag>å…±äº«å˜é‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ -è¯¦è§£CNNç½‘ç»œå’ŒTensorFlowå®ç°</title>
    <link href="/2018/07/03/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E8%AF%A6%E8%A7%A3CNN%E7%BD%91%E7%BB%9C%E5%8F%8ATensorFlow%E5%AE%9E%E7%8E%B0/"/>
    <url>/2018/07/03/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E8%AF%A6%E8%A7%A3CNN%E7%BD%91%E7%BB%9C%E5%8F%8ATensorFlow%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="1-å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°"><a href="#1-å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°" class="headerlink" title="1. å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°"></a>1. å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°</h2><p>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Network, CNNï¼‰ ä¹Ÿæ˜¯ç¥ç»ç½‘ç»œä¸­çš„ä¸€ç§ç»“æ„ï¼Œä¸»è¦é’ˆå¯¹å›¾åƒï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ç­‰æ–¹é¢åº”ç”¨ã€‚å·ç§¯ç¥ç»ç½‘ç»œè¾ƒæ—©çš„æ¶æ„æ˜¯<code>LeNet</code>ï¼Œè¢«è®¤ä¸ºæ˜¯CNNçš„å¼€ç«¯ï¼Œå½“æ—¶ä¸»è¦å°†<code>LeNet</code>åº”ç”¨äºå­—ç¬¦è¯†åˆ«ä»»åŠ¡ï¼Œå¦‚æ‰‹å†™æ•°å­—çš„è¯†åˆ«ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª<code>LeNet</code>çš„ç½‘ç»œç»“æ„ï¼š</p><p><img src="%5Cuploads%5CLeNet-2.jpg" srcset="/img/loading.gif" alt="LeNetç½‘ç»œç»“æ„"></p><h3 id="1-1-CNNçš„ä¸€èˆ¬ç»“æ„"><a href="#1-1-CNNçš„ä¸€èˆ¬ç»“æ„" class="headerlink" title="1.1 CNNçš„ä¸€èˆ¬ç»“æ„"></a>1.1 CNNçš„ä¸€èˆ¬ç»“æ„</h3><p>ä»ä¸Šé¢<code>LeNet</code>çš„ç»“æ„ä¸­åŸºæœ¬å¯ä»¥çœ‹å‡ºï¼ŒCNNçš„å¤§ä½“ç»“æ„ï¼š<strong>å·ç§¯å±‚</strong>(ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œ<strong>åŒ…æ‹¬<code>ReLU</code></strong>æ“ä½œç­‰)ï¼Œ<strong>æ± åŒ–æˆ–è€…äºšé‡‡æ ·</strong>ï¼Œ<strong>åˆ†ç±»</strong>(å…¨è¿æ¥å±‚)å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚æ¯ä¸ªéƒ¨åˆ†å½“ç„¶æœ‰å¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹ã€‚æ¯”å¦‚å·ç§¯æ˜¯å¦‚ä½•è®¡ç®—ï¼Œå·ç§¯æ ¸çš„å®šä¹‰ç­‰ï¼›æ± åŒ–æ“ä½œçš„æ–¹å¼ï¼Œè®¡ç®—æ–¹å¼ç­‰ã€‚ä½†CNNæ¨¡å‹ä¸€èˆ¬éƒ½ä¼šå­˜åœ¨è¿™å‡ ä¸ªç»„ä»¶ã€‚ä¸‹é¢å¯¹ä¸€äº›åè¯è¿›è¡Œè§£é‡Šï¼Œä¾¿äºåé¢çš„ç†è§£ï¼š</p><blockquote><p><strong>é€šé“ï¼š</strong>å¸¸ç”¨äºè¡¨ç¤ºå›¾åƒçš„æŸç§ç»„æˆã€‚ä¸€ä¸ªæ ‡å‡†æ•°å­—ç›¸æœºæ‹æ‘„çš„å›¾åƒä¼šæœ‰ä¸‰é€šé“ - çº¢ã€ç»¿å’Œè“ï¼›ä½ å¯ä»¥æŠŠå®ƒä»¬çœ‹ä½œæ˜¯äº’ç›¸å †å åœ¨ä¸€èµ·çš„äºŒç»´çŸ©é˜µï¼ˆæ¯ä¸€ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªé¢œè‰²ï¼‰ï¼Œæ¯ä¸ªé€šé“çš„åƒç´ å€¼åœ¨ 0 åˆ° 255 çš„èŒƒå›´å†…ã€‚</p><p><a href="https://en.wikipedia.org/wiki/Grayscale" target="_blank" rel="noopener">ç°åº¦</a>å›¾åƒï¼Œä»…ä»…åªæœ‰ä¸€ä¸ªé€šé“ã€‚åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»…è€ƒè™‘ç°åº¦å›¾åƒï¼Œè¿™æ ·æˆ‘ä»¬å°±åªæœ‰ä¸€ä¸ªäºŒç»´çš„çŸ©é˜µæ¥è¡¨ç¤ºå›¾åƒã€‚çŸ©é˜µä¸­å„ä¸ªåƒç´ çš„å€¼åœ¨ 0 åˆ° 255 çš„èŒƒå›´å†…â€”â€”é›¶è¡¨ç¤ºé»‘è‰²ï¼Œ255 è¡¨ç¤ºç™½è‰²ã€‚ </p></blockquote><h2 id="2-å·ç§¯å±‚"><a href="#2-å·ç§¯å±‚" class="headerlink" title="2.å·ç§¯å±‚"></a>2.å·ç§¯å±‚</h2><h3 id="2-1-å·ç§¯çš„æ•°å­¦å®šä¹‰"><a href="#2-1-å·ç§¯çš„æ•°å­¦å®šä¹‰" class="headerlink" title="2.1 å·ç§¯çš„æ•°å­¦å®šä¹‰"></a>2.1 å·ç§¯çš„æ•°å­¦å®šä¹‰</h3><p>å·ç§¯ç¥ç»ç½‘ç»œä¸­å¾ˆé‡è¦çš„å°±æ˜¯å·ç§¯çš„æ¦‚å¿µï¼Œ<a href="https://zh.wikipedia.org/zh/%E5%8D%B7%E7%A7%AF" target="_blank" rel="noopener">å·ç§¯</a>æœ¬èº«æ˜¯åœ¨æ³›å‡½åˆ†æä¸­çš„å®šä¹‰ï¼š<strong>å·ç§¯ã€æ—‹ç§¯æˆ–æ‘ºç§¯(Convolution)æ˜¯é€šè¿‡ä¸¤ä¸ªå‡½æ•°f å’Œg ç”Ÿæˆç¬¬ä¸‰ä¸ªå‡½æ•°çš„ä¸€ç§æ•°å­¦ç®—å­ï¼Œè¡¨å¾å‡½æ•°f ä¸gç»è¿‡ç¿»è½¬å’Œå¹³ç§»çš„é‡å éƒ¨åˆ†çš„é¢ç§¯</strong>ã€‚ </p><p>ä»å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œå·ç§¯æ˜¯ä¸€ç§è¿ç®—ï¼Œå› ä¸ºä»å®šä¹‰ä¸Šå¾—å‡ºçš„é¢ç§¯ï¼ŒåŸºæœ¬å¯ä»¥çœ‹å‡ºå¯ä»¥é€šè¿‡ç§¯åˆ†æ¥å®šä¹‰ï¼Œè¿™ä¸ªç§¯åˆ†å°±å®šä¹‰ äº†ä¸€ä¸ªæ–°çš„å‡½æ•°,å¦‚ä¸‹ï¼Œå°±ä¸ç”¨æ•°å­¦å…¬å¼æ¥è¯¦ç»†å±•å¼€äº†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://zh.wikipedia.org/zh/%E5%8D%B7%E7%A7%AF" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a>ä¸Šçš„å®šä¹‰ï¼ˆå¦‚ï¼šè¿ç»­å®šä¹‰(ç§¯åˆ†)å’Œç¦»æ•£å®šä¹‰(æ±‚å’Œ)ï¼‰ã€‚<br>$$<br>h(x)=f(x)<em>g(x)=(f</em>g)(x)<br>$$</p><h3 id="2-2-å·ç§¯çš„ç‰©ç†æ„ä¹‰"><a href="#2-2-å·ç§¯çš„ç‰©ç†æ„ä¹‰" class="headerlink" title="2.2 å·ç§¯çš„ç‰©ç†æ„ä¹‰"></a>2.2 å·ç§¯çš„ç‰©ç†æ„ä¹‰</h3><p>ä»å·ç§¯çš„å®šä¹‰ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå·ç§¯ä¸»è¦æ˜¯è¿›è¡Œåè½¬ï¼Œå¹³ç§»ï¼ŒåŠ æƒæ±‚å’Œ(ç§¯åˆ†)ï¼›ä»å®šä¹‰ä¸Šæ¯”è¾ƒæŠ½è±¡ï¼Œä¸æ˜“ç†è§£ï¼Œä»ç‰©ç†æ„ä¹‰ä¸Šè¿›è¡Œè§£é‡Šä¾¿äºç†è§£ï¼Œé‚£ä¹ˆå·ç§¯è®¡ç®—çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ol><li>å¹³æ»‘ï¼šå·ç§¯è¿ç®—æ˜¯ä¸€ç§çº¿æ€§è¿ç®—ï¼Œæ¯”å¦‚åœ¨å›¾åƒä¸­ï¼Œå°†æŸä¸ªåƒç´ ç‚¹ç”¨å‘¨å›´æ‰€æœ‰ç‚¹è¿›è¡ŒåŠ æƒæ±‚å’Œå€¼ä»£æ›¿ã€‚</li><li>æ¶ˆé™¤â€å™ªå£°â€ï¼šåœ¨1ä¸­çš„å¹³æ»‘å’Œå™ªå£°æ¶ˆé™¤ç›¸ä¼¼ï¼Œå› ä¸ºå·ç§¯æœ¬èº«å°±æ˜¯è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œå› æ­¤å·ç§¯åçš„å€¼ä¼šè¿‡æ»¤éƒ¨åˆ†â€å™ªå£°â€ã€‚</li><li>ç©ºé—´æ˜¾è‘—æ€§ï¼šå·ç§¯æ˜¯å¯¹æŸä¸€éƒ¨åˆ†å€¼è¿›è¡Œæ“ä½œï¼Œä½“ç°äº†ç©ºé—´çš„ç‰¹æ€§ï¼Œèƒ½å¯¹ç©ºé—´ä¸­çš„ç‰¹å¾è¿›è¡Œå¢å¼ºã€‚</li><li>ç©ºé—´å˜æ¢ï¼šå·ç§¯åœ¨ç©ºé—´ä¸Šæœ‰æ˜¾è‘—æ€§ï¼Œä½†æ˜¯å·ç§¯æœ¬èº«æ˜¯åè½¬å¹³ç§»ç­‰æ“ä½œï¼Œç›¸å½“äºè¿›è¡Œäº†ç©ºé—´å˜æ¢ï¼›æ¯”å¦‚æŸä¸ªç‰©ä½“ï¼Œæ— è®ºåœ¨ç©ºé—´çš„æŸä¸ªä½ç½®ï¼Œå·ç§¯æ“ä½œéƒ½å¯ä»¥å°†å…¶ç‰¹å¾æŠ½å–å‡ºæ¥ã€‚</li></ol><p>å·ç§¯åœ¨å…¶ä»–é¢†åŸŸä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨ï¼Œæ¯”å¦‚é¢‘è°±åˆ†æï¼Œä¿¡å·å¤„ç†ç­‰ï¼›ä¹Ÿæœ‰å¾ˆå¤šå…¶ä»–ç‰©ç†æ„ä¹‰ï¼Œåœ¨è¿™å„¿åªæ˜¯åˆ—ä¸¾äº†éƒ¨åˆ†å…·æœ‰ä»£è¡¨æ€§çš„ç‰©ç†æ„ä¹‰ã€‚<a id="more"></a></p><h3 id="2-3-å·ç§¯çš„å®ç°"><a href="#2-3-å·ç§¯çš„å®ç°" class="headerlink" title="2.3 å·ç§¯çš„å®ç°"></a>2.3 å·ç§¯çš„å®ç°</h3><p>é¦–å…ˆçœ‹ä¸‹å·ç§¯çš„è®¡ç®—è¿‡ç¨‹ï¼Œæ ¹æ®ä¸Šé¢å·ç§¯çš„å®šä¹‰ï¼Œæ¥å±•ç¤ºä¸‹å·ç§¯çš„è®¡ç®—è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ª$3 <em>4$çš„çŸ©é˜µ$f$å’Œ$3</em>3$çš„çŸ©$g$ï¼Œå·ç§¯æ ¸ä¸€èˆ¬ä¸ºå¥‡æ•°ï¼š<br>$$<br>f=\left[\begin{array}{ccc}<br>0 &amp; 1 &amp; 2 &amp; 3 \<br>2 &amp; 3 &amp; 4 &amp; 5\<br>4 &amp; 3 &amp; 2 &amp; 1<br>\end{array}\right], g=\left[\begin{array}{ccc}<br>-1 &amp; 0 &amp; 1 \<br>0 &amp; 1 &amp; 0 \<br>-1 &amp; 0 &amp; 1<br>\end{array}\right]<br>$$<br>ç¬¬ä¸€æ­¥æ˜¯å°†$g$è¿›è¡Œç¿»è½¬180åº¦ï¼Œå¾—åˆ°ï¼š<br>$$<br>g=\left[\begin{array}{ccc}<br>1 &amp; 0  &amp; -1 \<br>0 &amp; 1 &amp; 0 \<br>1 &amp; 0 &amp; -1<br>\end{array}\right]<br>$$<br>å†ä½¿ç”¨$g$çš„ä¸­å¿ƒå’Œfçš„æ¯ä¸ªå…ƒç´ å¯¹é½ï¼Œå¹¶å¯¹åº”å…ƒç´ ç›¸ä¹˜ï¼Œåœ¨è¾¹ç¼˜å¤–çš„å…ƒç´ ç”¨0æ¥å¡«å……ï¼ˆåœ¨å®é™…ä½¿ç”¨ä¸­ä¸ä¸€å®šç”¨0å¡«å……ï¼Œä¹Ÿå¯ä»¥ç”¨è¾¹ç¼˜æ‹·è´çš„æ–¹å¼ï¼‰ï¼š</p><p><img src="%5Cuploads%5Cconv_dym.png" srcset="/img/loading.gif" alt="å·ç§¯è®¡ç®—è¿‡ç¨‹"></p><p>æœ€åå¾—åˆ°äº†ä¸€ä¸ªå·ç§¯åçš„çŸ©é˜µï¼š<br>$$<br>h=\left[\begin{array}{ccc}<br>-3 &amp;- 1 &amp; 0 &amp; 7 \<br>-1 &amp; 3 &amp; 4 &amp; 9\<br>1 &amp; 5 &amp; 1 &amp; 5<br>\end{array}\right]<br>$$<br>æ•´ä¸ªè®¡ç®—è¿‡ç¨‹å¦‚ä¸Šæ‰€ç¤ºã€‚ä¸Šé¢çš„è®¡ç®—è¿‡ç¨‹ä¸ºä¸€èˆ¬çš„è®¡ç®—è¿‡ç¨‹ï¼Œå¯¹äºç»†èŠ‚è¿˜æœ‰å…¶ä»–æ–¹å¼ï¼Œæ¯”å¦‚å­˜åœ¨è¾¹é™…æ•ˆåº”ï¼Œå®Œå…¨é‡å è®¡ç®—ç­‰ç­‰ï¼Œåœ¨<code>python</code>çš„<code>numpy</code>å’Œ<code>sicpy</code>ä¸­å°±å®ç°äº†å·ç§¯è¿ç®—ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä½¿ç”¨ï¼š</p><pre><code class="python">import numpy as npfrom scipy.signal import convolve2dx = np.random.randint(0, 10, (4, 4))g = np.array([[1, 0, -1], [0, 1, 0], [1, 0, -1]])h1 = np.convolve(x.ravel(), g.ravel(), mode=&#39;full&#39;)print(h1)h_same = convolve2d(x, g, mode=&#39;same&#39;)print(h_same)</code></pre><p><code>numpy</code>ä¸­çš„<code>convolve</code>åªæ˜¯æ”¯æŒ<code>1-dim</code>çš„æ•°æ®ã€‚ä½†<code>scipy</code>ä¸­å®ç°äº†<code>2-dim</code>çš„å·ç§¯è¿ç®—ã€‚åœ¨è¿™ä¸¤ä¸ªæ¨¡å—ä¸­å·ç§¯è¿ç®—éƒ½æœ‰ä¸‰ç§æ¨¡å¼ï¼Œå³<code>mode</code> é€‰é¡¹ï¼š<code>{&#39;full&#39;, &#39;valid&#39;, &#39;same&#39;}</code>ï¼Œä¸åŒçš„æ¨¡å¼å¾—åˆ°å·ç§¯é¢„ç®—çš„ç»“æœä¸åŒï¼Œä¸»è¦æ˜¯å¯¹è¾¹ç¼˜çš„å¤„ç†æ–¹å¼ä¸åŒã€‚</p><h3 id="2-4-CNNä¸­çš„å·ç§¯"><a href="#2-4-CNNä¸­çš„å·ç§¯" class="headerlink" title="2.4 CNNä¸­çš„å·ç§¯"></a>2.4 CNNä¸­çš„å·ç§¯</h3><p>åœ¨ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„å·ç§¯è¿ç®—ä¸­ä½¿ç”¨çš„å·ç§¯æ ¸($g$)ï¼Œç»è¿‡äº†ç¿»è½¬å†è¿›è¡Œè®¡ç®—ã€‚åœ¨CNNç½‘ç»œä¸­çš„å·ç§¯å’Œä¸Šé¢çš„å·ç§¯åŸºæœ¬ç›¸ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨çš„ç®—å­(<strong>ç›¸å…³æ ¸</strong>-<code>Kernel</code>ï¼Œä¹Ÿç§°ä¸º<strong>ç›¸å…³ç®—å­</strong>)ä¸ä¼šè¿›è¡Œç¿»è½¬ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç¿»è½¬ï¼Œç¿»è½¬çš„ç®—å­å«<strong>å·ç§¯æ ¸</strong>æˆ–<strong>å·ç§¯ç®—å­</strong>ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å·ç§¯æ ¸ã€‚ä¸‹é¢æ˜¯å…¶ä»–æ–‡çŒ®ä¸­çš„è¯´æ³•ï¼š</p><blockquote><p>å¯¹å›¾åƒå¤§çŸ©é˜µå’Œæ»¤æ³¢å°çŸ©é˜µå¯¹åº”ä½ç½®å…ƒç´ ç›¸ä¹˜å†æ±‚å’Œçš„æ“ä½œå«<strong>å·ç§¯</strong>(<code>Convolution</code>)æˆ–<strong>åç›¸å…³</strong>(<code>Correlation</code>).åç›¸å…³(<code>Correlation</code>)å’Œå·ç§¯(<code>Convolution</code>)å¾ˆç±»ä¼¼, ä¸¤è€…å”¯ä¸€çš„å·®åˆ«å°±æ˜¯å·ç§¯åœ¨è®¡ç®—å‰éœ€è¦ç¿»è½¬<strong>å·ç§¯æ ¸</strong>, è€Œ<strong>åç›¸å…³</strong>åˆ™ä¸éœ€è¦ç¿»è½¬.</p></blockquote><p>ç›¸å…³æ ¸æˆ–å·ç§¯æ ¸ä¸€èˆ¬éƒ½ä¸ºä¸€ä¸ªæ–¹æ­£ï¼Œå¦‚3*3çš„çŸ©é˜µï¼Œ5*5çš„çŸ©é˜µï¼Œæ–¹æ­£ä¸­æ¯ä¸ªå…ƒç´ éƒ½å¯ä»¥çœ‹æˆä¸€ä¸ªæƒé‡ç³»æ•°ï¼›ä½¿ç”¨å·ç§¯è¿›è¡Œè®¡ç®—æ—¶ï¼Œéœ€è¦å°†å·ç§¯æ ¸çš„ä¸­å¿ƒæ”¾ç½®åœ¨è¦è®¡ç®—çš„åƒç´ ä¸Šï¼Œä¸€æ¬¡è®¡ç®—æ ¸ä¸­æ¯ä¸ªå…ƒç´ å’Œå…¶è¦†ç›–çš„å›¾åƒåƒç´ å€¼çš„ä¹˜ç§¯å¹¶æ±‚å’Œï¼Œå¾—åˆ°çš„ç»“æ„å°±æ˜¯è¯¥ä½ç½®çš„æ–°åƒç´ å€¼ã€‚ä¸‹é¢ä¸»è¦æ¼”ç¤ºäº†ç›¸å…³æ ¸ï¼ˆç›¸å…³ç®—å­ï¼‰çš„å·ç§¯è®¡ç®—è¿‡ç¨‹ï¼š</p><p><img src="%5Cuploads%5Cconv_dym.gif" srcset="/img/loading.gif" alt=""></p><p>æ­¥éª¤ï¼š</p><p>(1).æ»‘åŠ¨æ ¸ï¼Œä½¿å¾—æ ¸ä¸­å¿ƒä½ç½®ä½äºè¦è®¡ç®—çš„åƒç´ ç‚¹ä¸Š</p><p>(2).é‡å çš„ä½ç½®è¿›è¡Œå¯¹äºå…ƒç´ ä¹˜ç§¯å¹¶æ±‚å’Œï¼Œå¾—åˆ°è¯¥åƒç´ ç‚¹æ–°çš„åƒç´ å€¼</p><p>(3).é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œè¾“å‡ºæ•´ä¸ªå›¾çš„æ‰€æœ‰æ–°çš„åƒç´ å€¼</p><p><img src="%5Cuploads%5Ccenter.png" srcset="/img/loading.gif" alt=""></p><p>ä¸Šé¢çš„æ­¥éª¤ä¹Ÿå¯ç±»ä¼¼çœ‹ä½œï¼šéšè—å±‚ä¸­çš„<strong>ç¥ç»å…ƒ</strong> å…·æœ‰ä¸€ä¸ª<strong>å›ºå®šå¤§å°</strong>çš„<strong>æ„Ÿå—è§†é‡</strong>å»æ„Ÿå—ä¸Šä¸€å±‚çš„<strong>éƒ¨åˆ†ç‰¹å¾</strong>ã€‚åœ¨å…¨è¿æ¥ç¥ç»ç½‘ç»œä¸­ï¼Œéšè—å±‚ä¸­çš„ç¥ç»å…ƒçš„æ„Ÿå—è§†é‡è¶³å¤Ÿå¤§ä¹ƒè‡³å¯ä»¥çœ‹åˆ°ä¸Šä¸€å±‚çš„æ‰€æœ‰ç‰¹å¾ã€‚ è€Œåœ¨CNNï¼ˆå·ç§¯ç¥ç»ç½‘ç»œï¼‰ä¸­ï¼Œéšè—å±‚ä¸­çš„ç¥ç»å…ƒçš„æ„Ÿå—è§†é‡æ¯”è¾ƒå°ï¼Œåªèƒ½çœ‹åˆ°<strong>ä¸Šä¸€æ¬¡çš„éƒ¨åˆ†ç‰¹å¾</strong>ï¼Œä¸Šä¸€å±‚çš„å…¶ä»–ç‰¹å¾å¯ä»¥é€šè¿‡å¹³ç§»<strong>æ„Ÿå—è§†é‡</strong>æ¥å¾—åˆ°åŒä¸€å±‚çš„å…¶ä»–ç¥ç»å…ƒï¼Œç”±åŒä¸€å±‚å…¶ä»–ç¥ç»å…ƒæ¥çœ‹ã€‚</p><h3 id="2-5-å¸¸ç”¨çš„å·ç§¯æ ¸"><a href="#2-5-å¸¸ç”¨çš„å·ç§¯æ ¸" class="headerlink" title="2.5 å¸¸ç”¨çš„å·ç§¯æ ¸"></a>2.5 å¸¸ç”¨çš„å·ç§¯æ ¸</h3><ol><li>ä½é€šæ»¤æ³¢å™¨ï¼ˆå¸¸ç”¨äºè®¡ç®—æ¨¡ç³Šåçš„æ•ˆæœï¼‰</li></ol><p>$$<br>\begin{bmatrix}<br>     1/9 &amp; 1/9  &amp; 1/9  \<br>     1/9  &amp; 1/9  &amp; 1/9   \<br>     1/9  &amp; 1/9  &amp; 1/9<br>\end{bmatrix},\begin{bmatrix}<br>     1/10 &amp; 1/10  &amp; 1/10 \<br>     1/10  &amp; 2/10  &amp; 1/10   \<br>     1/10  &amp; 1/10  &amp; 1/10<br>\end{bmatrix},\begin{bmatrix}<br>     1/16 &amp; 2/16  &amp; 1/16 \<br>     2/16  &amp; 4/16  &amp; 2/16   \<br>     1/16  &amp; 2/16  &amp; 1/16<br>\end{bmatrix}<br>$$</p><ol start="2"><li><p>é«˜æ–¯æ»¤æ³¢å™¨ï¼ˆå¸¸ç”¨äºè®¡ç®—é«˜æ–¯æ¨¡ç³Šåçš„æ•ˆæœï¼‰        é«˜æ–¯æ¨¡ç³Šçš„å·ç§¯æ ¸ä¹Ÿæ˜¯ä¸€ä¸ªæ­£æ–¹å½¢çš„æ»¤æ³¢æ ¸ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—å¾—å‡ºï¼š<br>$$<br>G(x,y)=\frac{1}{2Ï€Ïƒ^{2}}Â·e^{\frac{x^{2}+y^{2}}{2Ïƒ^{2}}}<br>$$<br>è¯¥å…¬å¼ä¸­$\sigma$æ˜¯æ ‡å‡†æ–¹å·®ï¼ˆä¸€èˆ¬å–å€¼ä¸º1ï¼‰ï¼Œ$x$å’Œ$y$åˆ†åˆ«å¯¹åº”äº†å½“å‰ä½ç½®åˆ°å·ç§¯æ ¸ä¸­å¿ƒçš„æ•´æ•°è·ç¦»ã€‚é€šè¿‡è¿™ä¸ªå…¬å¼ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºé«˜æ–¯æ ¸ä¸­æ¯ä¸ªä½ç½®å¯¹åº”çš„å€¼ã€‚ä¸ºäº†ä¿è¯æ»¤æ³¢åçš„å›¾åƒä¸ä¼šå˜æš—ï¼Œéœ€è¦å¯¹é«˜æ–¯æ ¸ä¸­çš„æƒé‡è¿›è¡Œå½’ä¸€åŒ–ã€‚ </p></li><li><p>è¾¹ç¼˜æ£€æµ‹ï¼ˆå¸¸ç”¨äºè®¡ç®—å›¾åƒè¾¹ç¼˜æˆ–è€…è¯´æ¢¯åº¦å€¼ï¼‰ ï¼š</p></li></ol><p>$$<br>\begin{bmatrix}<br>     -1 &amp; 0  &amp; -1 \<br>     0  &amp; 4  &amp; 0   \<br>     -1  &amp; 0  &amp; -1<br>\end{bmatrix}<br>$$</p><h3 id="2-6-TensorFlowä¸­å·ç§¯çš„å®ç°"><a href="#2-6-TensorFlowä¸­å·ç§¯çš„å®ç°" class="headerlink" title="2.6 TensorFlowä¸­å·ç§¯çš„å®ç°"></a>2.6 <code>TensorFlow</code>ä¸­å·ç§¯çš„å®ç°</h3><p>åœ¨<code>TensorFlow</code>ä¸­å®ç°äº†å·ç§¯è¿ç®—ï¼Œæœ¬æ–‡ä¸­ä¸»è¦é’ˆå¯¹2ç»´å·ç§¯è¿ç®—è¯´æ˜ï¼Œ<code>conv2d</code>å’Œ<code>depthwise_conv2d</code>è¿™ä¸¤ä¸ªå®ç°ï¼Œé¦–å…ˆå¯¹conv2dè¿›è¡Œè¯´æ˜ã€‚</p><h4 id="2-6-1-conv2d"><a href="#2-6-1-conv2d" class="headerlink" title="2.6.1 conv2d"></a>2.6.1 conv2d</h4><p><code>tf.nn.conv2d(input, filter, strides, padding, use_cudnn_on_gpu=None, name=None)</code>ï¼Œä¸‹é¢å¯¹<strong>å‚æ•°</strong>è¿›è¡Œè¯´æ˜ï¼š</p><p><code>input</code>ï¼šéœ€è¦å·ç§¯è¿ç®—çš„<code>tensor</code>ï¼Œè¾“å…¥çš„<code>shape</code>ä¸º[<code>batch_size, height, width, n_channels</code>]ï¼Œå³çŸ©é˜µæ„ä¹‰[æ‰¹æ¬¡çš„æ ·æœ¬æ•°ï¼Œè¡Œï¼Œåˆ—ï¼Œé€šé“æ•°]ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨äºå›¾ç‰‡ã€‚è¿™æ˜¯ä¸€ä¸ª4ç»´çš„<code>Tensor</code>ï¼Œè¦æ±‚çš„ç±»å‹ä¸º<code>float32</code>æˆ–<code>float64</code>ã€‚</p><p><code>filter</code>ï¼šç›¸å½“äºCNNä¸­çš„å·ç§¯æ ¸ï¼Œå®ƒè¦æ±‚æ˜¯ä¸€ä¸ª<code>Tensor</code>ï¼Œå…·æœ‰<code>[filter_height, filter_width, in_channels, out_channels</code>è¿™æ ·çš„<code>shape</code>ï¼Œå…·ä½“å«ä¹‰æ˜¯[å·ç§¯æ ¸çš„é«˜åº¦ï¼Œå·ç§¯æ ¸çš„å®½åº¦ï¼Œå›¾åƒé€šé“æ•°ï¼Œå·ç§¯æ ¸ä¸ªæ•°]ï¼Œè¦æ±‚ç±»å‹ä¸å‚æ•°<code>input</code>ç›¸åŒï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸‰ç»´<code>in_channel</code>sï¼Œå°±æ˜¯å‚æ•°<code>input</code>çš„ç¬¬å››ç»´ </p><p><code>strides</code>ï¼šå·ç§¯æ—¶åœ¨å›¾åƒæ¯ä¸€ç»´çš„æ­¥é•¿ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸€ç»´çš„å‘é‡ï¼Œé•¿åº¦4 </p><p><code>padding</code>ï¼š<code>string</code>ç±»å‹çš„é‡ï¼Œåªèƒ½æ˜¯<code>SAME</code>, <code>VALID</code>å…¶ä¸­ä¹‹ä¸€ï¼Œè¿™ä¸ªå€¼å†³å®šäº†ä¸åŒçš„å·ç§¯æ–¹å¼ï¼Œè¿™ä¸ªå’Œ<code>scipy</code>å’Œ<code>numpy</code>ä¸­çš„<code>mode</code>ç±»ä¼¼ã€‚</p><p><code>use_cudnn_on_gpu</code>ï¼šæ˜¯å¦ä½¿ç”¨cudnnåŠ é€Ÿï¼Œé»˜è®¤ä¸º<code>true</code>ã€‚</p><p>å·ç§¯è¿ç®—åä¼šè¾“å‡ºä¸€ä¸ªTensorï¼Œä¹Ÿå°±CNNä¸­çš„<code>feature map</code>ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨<code>tensorflow</code>ä¸­å·ç§¯è¿ç®—çš„ç¤ºä¾‹ï¼š</p><pre><code class="python">import tensorflow as tfimport numpy as npx = tf.Variable(initial_value=tf.random_normal(shape=[100, 28, 28, 3]), dtype=tf.float32)filter_kernel = tf.constant(np.random.randint(0, 2, [3, 3, 3, 5]), dtype=tf.float32)conv_tensor_same = tf.nn.conv2d(x, filter_kernel, [1, 1, 1, 1], padding=&#39;SAME&#39;)conv_tensor_valid = tf.nn.conv2d(x, filter_kernel, [1, 1, 1, 1], padding=&#39;VALID&#39;)print(conv_tensor_same)  # è¾“å‡ºå’Œè¾“å…¥çš„çŸ©é˜µå¤§å°ä¸€è‡´,é€šé“æ•°ä¸ºå·ç§¯æ ¸çš„è¾“å‡ºé€šé“æ•°,batch_sizeä¸å˜print(conv_tensor_valid)  # è¾“å‡ºå’Œè¾“å…¥çš„çŸ©é˜µå¤§å°ä¸ä¸€è‡´,é€šé“æ•°ä¸ºå·ç§¯æ ¸çš„è¾“å‡ºé€šé“æ•°,batch_sizeä¸å˜# ----------------- output -------------------Tensor(&quot;Conv2D:0&quot;, shape=(100, 28, 28, 5), dtype=float32)Tensor(&quot;Conv2D_1:0&quot;, shape=(100, 26, 26, 5), dtype=float32)</code></pre><p>ä¸Šé¢çš„ä¾‹å­ä¸­è¾“å…¥ä¸º3é€šé“çš„28<em>28çš„100å¼ å›¾ç‰‡ï¼Œç»è¿‡å·ç§¯æ ¸ï¼ˆ3\</em>3çš„å·ç§¯æ ¸ï¼Œè¾“å‡º5é€šé“ï¼‰åï¼Œå¾—åˆ°äº†æ¯å¼ å›¾ï¼ˆ100å¼ ï¼‰éƒ½æœ‰5å¼ 28*28æˆ–26*26çš„<code>feature map</code>ã€‚å½“<code>pading</code>å‚æ•°ä¸åŒæ—¶è¿”å›<code>feature map</code>çš„å¤§å°ä¸åŒï¼Œä¸‹é¢åŠ¨æ€å±•ç¤ºï¼š</p><ul><li><p><code>padding=â€™SAMEâ€™</code>æ—¶ï¼Œ<code>TensorFlow</code>ä¼šè‡ªåŠ¨å¯¹åŸå›¾åƒè¿›è¡Œè¡¥é›¶,ä»è€Œä½¿è¾“å…¥è¾“å‡ºçš„å›¾åƒçš„<a href="https://www.tensorflow.org/api_guides/python/nn#convolution" target="_blank" rel="noopener">é«˜åº¦å’Œå®½åº¦è®¡ç®—</a>å¦‚ä¸‹ï¼š</p><p><img src="%5Cuploads%5Cconv_same.gif" srcset="/img/loading.gif" alt="SAME"></p></li></ul><pre><code class="python">out_height = ceil(float(in_height) / float(strides[1]))out_width  = ceil(float(in_width) / float(strides[2]))</code></pre><ul><li><code>padding=&#39;VAILD&#39;</code>æ—¶ï¼Œåˆ™ä¼šç¼©å°åŸå›¾åƒçš„å¤§å° ï¼Œç¼©å°åçš„å›¾åƒå³ä¸º<code>feature map</code>ï¼Œå…¶<code>size</code>ä¸º<code>(W â€“ F + 1) / S</code> ï¼Œ<strong>ç»“æœå‘ä¸Šå–æ•´</strong>ï¼Œå…¶ä¸­<code>W</code>ä¸ºè¾“å…¥çŸ©é˜µçš„<code>width</code>ï¼Œ<code>F</code>ä¸ºå·ç§¯æ ¸çš„å¤§å°ï¼Œ<code>S</code>ä¸ºæ­¥é•¿ï¼ŒæŒ‰è¾“å‡ºå›¾åƒçš„é•¿åº¦å’Œå®½åº¦åˆ†é˜¶åï¼š</li></ul><pre><code class="python">out_height = ceil(float(in_height - filter_height + 1) / float(strides[1]))out_width  = ceil(float(in_width - filter_width + 1) / float(strides[2]))</code></pre><p>  <img src="%5Cuploads%5Cconv_vaild.gif" srcset="/img/loading.gif" alt="VAILD"></p><p>ä¸Šé¢çš„ä¸¤ä¸ªå…¬å¼ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªå…¬å¼ä»£æ›¿ï¼š<br>$$<br>W_1 = (W - F + 2P)/S + 1<br>$$<br>å…¶ä¸­$W$ä¸ºè¾“å…¥å›¾åƒçš„å®½åº¦ï¼Œ$F$ä¸ºå·ç§¯æ ¸çš„å®½åº¦ï¼Œ$P$ä¸º<code>padding size</code>ï¼Œ<code>padding size</code>çš„è®¡ç®—æ–¹å¼$P=\frac {F-1} 2$ï¼Œå½“paddingä¸º<code>vaild</code>æ—¶$P=0$ï¼Œ$S$ä¸ºåœ¨å½“å‰ç»´åº¦ä¸‹ç§»åŠ¨çš„æ­¥é•¿ã€‚</p><h4 id="2-6-2-depthwise-conv2d"><a href="#2-6-2-depthwise-conv2d" class="headerlink" title="2.6.2 depthwise_conv2d"></a>2.6.2 depthwise_conv2d</h4><p><code>depthwise_conv2d(input,  filter, strides, padding, rate=None, name=None, data_format=None)</code>ï¼Œå‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p><ol><li>input çš„æ•°æ®ç»´åº¦ <code>[batch ,in_height,in_wight,in_channels]</code></li><li>å·ç§¯æ ¸çš„ç»´åº¦æ˜¯<code>[filter_height,filter_heught,in_channel,channel_multiplierl]</code></li><li>å·ç§¯æ ¸<code>filter</code>å’Œç‹¬ç«‹çš„åº”ç”¨åœ¨<code>in_channels</code>çš„æ¯ä¸€ä¸ªé€šé“ä¸Š(ä»é€šé“ 1 åˆ°é€šé“<code>channel_multiplier</code>)</li><li>ç„¶åå°†æ‰€æœ‰ç»“æœè¿›è¡Œæ±‡æ€»,è¾“å‡ºé€šé“çš„æ€»æ•°æ˜¯ï¼Œ<code>in_channel * channel_multiplier</code></li></ol><pre><code class="python">input_data = tf.Variable(np.random.rand(10, 9, 9, 3), dtype=np.float32)filter_data = tf.Variable(np.random.rand(2, 2, 3, 2), dtype=np.float32)y = tf.nn.depthwise_conv2d(input_data, filter_data, strides=[1, 1, 1, 1], padding=&#39;SAME&#39;)print(&#39;tf.nn.depthwise_conv2d : &#39;, y)# -------------- output --------------# tf.nn.depthwise_conv2d :  Tensor(&quot;depthwise:0&quot;, shape=(10, 9, 9, 6), dtype=float32)</code></pre><p>å…¶æ•ˆæœç±»ä¼¼äºå¤šä¸ªå·ç§¯æ ¸è¿ç®—éƒ½æ˜¯å¼ é‡çš„ä¸€ä¸ªç»´åº¦å¢åŠ ï¼Œä¸åŒä¹‹å¤„åœ¨äºé€šé“æ•°çš„å¢åŠ æ˜¯å·ç§¯æ ¸åœ¨ä¸åŒé€šé“ä¸Šè¿ç®—çš„ç»“æœï¼Œè€Œå¤šä¸ªå·ç§¯æ ¸è¿ç®—ï¼ˆ<code>conv2d</code>è¿ç®—æ“ä½œï¼‰ç›¸å½“äºæ˜¯<code>batch</code>çš„æ•°é‡å¢åŠ  ã€‚</p><h3 id="2-7-CNNä¸­çš„Feature-Map"><a href="#2-7-CNNä¸­çš„Feature-Map" class="headerlink" title="2.7 CNNä¸­çš„Feature Map"></a>2.7 CNNä¸­çš„<code>Feature Map</code></h3><p>å·ç§¯çš„ä¸»è¦ä½œç”¨å°±æ˜¯ç”Ÿæˆ<code>feature map</code>ï¼Œä»å›¾åƒä¸­æå–ç‰¹å¾å›¾ï¼Œç‰¹å¾å›¾ä¸»è¦æ˜¯æ ¹æ®å·ç§¯æ ¸æ¥ç”Ÿæˆï¼Œä¸åŒçš„å·ç§¯æ ¸ç”Ÿæˆä¸åŒçš„ç‰¹å¾å›¾ã€‚</p><p>å‰é¢è¯´äº†å·ç§¯çš„ç‰©ç†æ„ä¹‰ï¼Œå·ç§¯åœ¨ç©ºé—´ä¸Šå¯¹ç‰¹å¾è¿›è¡Œäº†æå–ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹å±€<strong>éƒ¨è§†é‡çš„æ„Ÿå—</strong>ï¼Œå·ç§¯çš„å¤§å°ç›¸å½“äºæ„Ÿå—é‡çš„å¤§å°ï¼Œè¿™ä¸ªæ˜¯å…¶ä»–ç½‘ç»œæ— æ³•è¾¾åˆ°çš„ã€‚å› æ­¤<code>feature map</code>æ˜¯CNNä¸­éå¸¸é‡è¦çš„ä¸€ç¯ã€‚</p><h4 id="2-7-1-feature-mapçš„å¤§å°"><a href="#2-7-1-feature-mapçš„å¤§å°" class="headerlink" title="2.7.1 feature mapçš„å¤§å°"></a>2.7.1 <code>feature map</code>çš„å¤§å°</h4><p>å› ä¸º<code>feature map</code>æ˜¯ç”±å·ç§¯ç”Ÿæˆçš„ï¼Œä¸€ä¸ªå·ç§¯æ ¸ç”Ÿæˆä¸€ä¸ª<code>feature map</code>,å› æ­¤å·ç§¯å±‚è¾“å‡ºçš„å¤§å°å°±æ˜¯<code>feature map</code>çš„å¤§å°ï¼Œå…·ä½“å¤§å°çš„è®¡ç®—æ–¹å¼ä¸»è¦æ˜¯åŸºäºä¸Šå±‚è¾“å…¥çš„å¤§å°ï¼Œ<code>feature map</code>å¤§å°å’Œæ­¥é•¿æœ‰å…³ç³»ã€‚å…·ä½“å¤§å°çš„è®¡ç®—å…¬å¼åœ¨2.6ä¸­å·²ç»è¿›è¡Œäº†è¯´æ˜ã€‚</p><h4 id="2-7-2-feature-mapçš„æ•°é‡"><a href="#2-7-2-feature-mapçš„æ•°é‡" class="headerlink" title="2.7.2 feature mapçš„æ•°é‡"></a>2.7.2 <code>feature map</code>çš„æ•°é‡</h4><p><code>feature map</code>çš„æ•°é‡å’Œå·ç§¯æ ¸çš„æ•°é‡ç›¸å…³ï¼Œåœ¨<code>tensorflow</code>ä¸­çš„å·ç§¯è¿ç®—æ—¶ï¼Œæ¯”å¦‚è¾“å…¥çš„inputä¸º1*32*32*3ï¼ˆ3ä¸ºé€šé“æ•°ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºfeature mapæ•°ï¼‰ï¼Œå·ç§¯æ ¸ä¸º5*5*3*5çš„å¤§å°ï¼Œå…¶ä¸­æœ€åä¸€ä¸ª5å°±æ˜¯å·ç§¯æ ¸æ•°é‡ï¼Œå³è¾“å‡ºçš„é€šé“æ•°ï¼Œç”Ÿæˆçš„feature mapæ•°é‡ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªåŠ¨æ€å›¾æ¥å±•ç¤ºæ•´ä¸ªè¿‡ç¨‹ï¼š</p><hr><p><a href="http://cs231n.github.io/\uploads\conv-demo/index.html" target="_blank" rel="noopener">conv feature map demo</a></p><hr><h4 id="2-7-3-feature-mapçš„è®¡ç®—"><a href="#2-7-3-feature-mapçš„è®¡ç®—" class="headerlink" title="2.7.3 feature mapçš„è®¡ç®—"></a>2.7.3 <code>feature map</code>çš„è®¡ç®—</h4><p>å…¶å®<code>Feature Map</code>çš„è®¡ç®—è¿‡ç¨‹å°±æ˜¯å·ç§¯è®¡ç®—çš„è¿‡ç¨‹ï¼Œä¸‹å›¾ä¸­æ˜¯å¯¹å…¶è¿›è¡Œäº†å¯è§†åŒ–ï¼Œè¾“å…¥çš„ä¸º1*32*32*3çš„å›¾åƒï¼Œå·ç§¯æ ¸ä¸º3*3*3*5çš„å¤§å°ï¼Œå¯¹è¾“å…¥çš„<strong>å±€éƒ¨ï¼ˆä¸€ä¸ªå±€éƒ¨ï¼‰</strong>è¿›è¡Œè®¡ç®—ï¼Œå¦‚ä¸‹çš„å³å›¾æ‰€ç¤ºã€‚å…¶ä¸­<strong>$w_i$</strong>å°±æ˜¯å…¶ä¸­ä¸€ä¸ªå·ç§¯æ ¸çš„çš„æŸä¸ªå€¼ï¼Œè¿™ä¸ªå€¼ä¼šé€šè¿‡æ¨¡å‹è®­ç»ƒè¿›è¡Œ<strong>è®­ç»ƒ</strong>ã€‚</p><p><img src="\uploads\neuron_model0.jpeg" srcset="/img/loading.gif" style="zoom:60%" align = center />              |               <img src="\uploads\neuron_model.jpeg" srcset="/img/loading.gif" style="zoom:60%" align=center /> </p><h3 id="2-8-å·ç§¯çš„è®­ç»ƒå‚æ•°"><a href="#2-8-å·ç§¯çš„è®­ç»ƒå‚æ•°" class="headerlink" title="2.8 å·ç§¯çš„è®­ç»ƒå‚æ•°"></a>2.8 å·ç§¯çš„è®­ç»ƒå‚æ•°</h3><p> åœ¨å·ç§¯å±‚çš„è®­ç»ƒä¸»è¦æ˜¯å¯¹å·ç§¯æ ¸çš„è®­ç»ƒï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»æ˜ç¡®äº†åœ¨å·ç§¯è¿ç®—æ—¶æ˜¯æ€æ ·è®¡ç®—çš„ï¼Œä¸‹é¢å°±çœ‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„å‚æ•°é—®é¢˜ï¼Œé¦–å…ˆå°±å¿…é¡»äº†è§£å‚æ•°çš„å¤§å°ã€‚</p><p>å¦‚æœæ˜¯ä½¿ç”¨å…¨è¿æ¥ç½‘ç»œï¼Œå†è¾“å…¥ä¸€ä¸ª100<em>100çš„å›¾åƒï¼Œå‡è®¾æœ‰1000ä¸ªéšè—ç¥ç»å…ƒï¼Œé‚£ä¹ˆå°±ä¼šæœ‰100\</em>100*1000ä¸ªè¿æ¥ï¼Œ$10^7$ä¸ªå‚æ•°éœ€è¦è¿›è¡Œè®­ç»ƒï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å·ç§¯çš„æ–¹å¼ï¼Œé‡‡ç”¨10*10çš„å·ç§¯ï¼Œé‚£ä¹ˆå‚æ•°å°±æ˜¯100*100*10*10ï¼Œæ•°é‡çº§å‡å°‘äº†ä¸€ä¸ªï¼Œä½†æ˜¯è¿™ä¸ªæ•°é‡çº§çš„å‚æ•°è¿˜æ˜¯å¾ˆå¤šã€‚æœ‰ä»€ä¹ˆå…¶ä»–åŠæ³•ä¹ˆï¼Ÿé‚£å°±æ˜¯æƒå€¼å…±äº«ã€‚</p><h4 id="2-8-1-æƒå€¼å…±äº«"><a href="#2-8-1-æƒå€¼å…±äº«" class="headerlink" title="2.8.1 æƒå€¼å…±äº«"></a>2.8.1 æƒå€¼å…±äº«</h4><p>æˆ‘ä»¬ä»å·ç§¯è®¡ç®—è¿‡ç¨‹å°±çŸ¥é“ï¼Œæ¯æ¬¡ä¼šä»å›¾åƒçš„åŒºåŸŸå–å’Œå·ç§¯æ ¸åŒæ ·å¤§å°çš„åŒºåŸŸæ¥è¿›è¡Œè¿ç®—ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ª<strong>ç¥ç»å…ƒï¼ˆfeature mapä¸­çš„å…ƒç´ ï¼‰</strong>ä¼šè¿æ¥ä¸€ä¸ª10*10çš„åŒºåŸŸï¼Œè¿™æ ·å°±ä¼šæœ‰100ä¸ªå‚æ•°ï¼Œå¦‚æœæ¯ä¸ªç¥ç»å…ƒéƒ½ä½¿ç”¨åŒä¸€ç»„å‚æ•°ï¼Œé‚£ä¹ˆå‚æ•°è¿˜æ˜¯100ä¸ªã€‚å› æ­¤è¿™æ ·å°±æ˜¯æƒå€¼å…±äº«ã€‚</p><p>åœ¨è¿›è¡Œé€šä¿—çš„ç†è§£ï¼šåœ¨ä¸€å¼ å›¾ç‰‡ä¸Šï¼Œé€šè¿‡ä¸€ä¸ªå·ç§¯æ ¸è¿›è¡Œæ‰«ææ‰€æœ‰ç‚¹æ—¶ï¼Œä½¿ç”¨çš„ç›¸åŒçš„å·ç§¯æ ¸ï¼Œå·ç§¯æ ¸çš„å€¼å°±æ˜¯æƒé‡ã€‚è¿™æ ·æƒé‡å°±æ˜¯å…±äº«çš„ã€‚æ‰«ææ•´ä¸ªå›¾ç‰‡çš„å‚æ•°ä¹Ÿå°±åªæ˜¯å·ç§¯æ ¸çš„å¤§å°ã€‚</p><h4 id="2-8-2-å¤šé€šé“å¤šå·ç§¯æ ¸"><a href="#2-8-2-å¤šé€šé“å¤šå·ç§¯æ ¸" class="headerlink" title="2.8.2 å¤šé€šé“å¤šå·ç§¯æ ¸"></a>2.8.2 å¤šé€šé“å¤šå·ç§¯æ ¸</h4><p>å½“ä¸ºå¤šé€šé“è¿›è¡Œå¤šä¸ªå·ç§¯è®¡ç®—æ—¶ï¼Œæ¯ä¸ªé€šé“ä¸Šé¢å¯¹åº”ä¸€ä¸ªå·ç§¯æ ¸ã€‚å‡è®¾æœ‰ä¸€ä¸ªå››é€šé“çš„å›¾ç‰‡ï¼Œåˆ©ç”¨ä¸¤ä¸ªå·ç§¯æ ¸è¿›è¡Œè¿ç®—ï¼Œæœ€åç”Ÿæˆä¸¤é€šé“ï¼Œå³å¾—åˆ°ä¸¤ä¸ª<code>feature map</code>ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="%5Cuploads%5Cmul-input-mul-k.png" srcset="/img/loading.gif" alt=""></p><p>å››ä¸ªé€šé“ä¸Šæ¯ä¸ªé€šé“å¯¹åº”ä¸€ä¸ªå·ç§¯æ ¸ï¼Œå…ˆå°†$w_2$å¿½ç•¥ï¼Œåªçœ‹$w_1$ï¼Œé‚£ä¹ˆåœ¨$w_1â€‹$çš„æŸä½ç½®ï¼ˆ<code>i,j</code>ï¼‰å¤„çš„å€¼ï¼Œæ˜¯ç”±å››ä¸ªé€šé“ä¸Šï¼ˆ<code>i,j</code>ï¼‰å¤„çš„å·ç§¯ç»“æœç›¸åŠ ç„¶åå†å–æ¿€æ´»å‡½æ•°å€¼å¾—åˆ°çš„ã€‚  æ‰€ä»¥æœ€åå¾—åˆ°ä¸¤ä¸ª<code>feature map</code>ï¼Œ å³è¾“å‡ºå±‚çš„å·ç§¯æ ¸æ ¸ä¸ªæ•°ä¸º <code>feature map</code> çš„ä¸ªæ•°ã€‚å…¶è®¡ç®—å…¬å¼ï¼š<br>$$<br>h_{ij}^k = f((w^k * x)_{ij} + b^k)<br>$$<br>ä¸Šé¢çš„å‚æ•°ä¸ªæ•°å°±å˜ä¸ºï¼š$2 * 2 * 4 * 2 â€‹$ï¼Œå‰é¢çš„ä¸¤ä¸ª2æŒ‡å·ç§¯æ ¸å¤§å°ï¼Œ4ä¸ºè¾“å…¥çš„é€šé“æ•°ï¼Œæœ€åçš„2ä¸ºè¾“å‡ºçš„é€šé“æ•°ã€‚å› æ­¤å¤šé€šé“å¤šæ ¸çš„è¿ç®—æ ¸å•é€šé“å¤šæ ¸è¿ç®—ä¸åŒï¼Œå‚æ•°ä¸ªæ•°é‡çº§å·®åˆ«ä¹Ÿå¾ˆå¤§ã€‚ä¸‹é¢è¿™ä¸ªå¯è§†åŒ–ä¹Ÿå±•ç¤ºäº†å¤šé€šé“å¤šæ ¸çš„è®¡ç®—è¿‡ç¨‹ï¼š</p><p><img src="%5Cuploads%5Cmul-input-mul-conv.gif" srcset="/img/loading.gif" alt=""></p><h2 id="3-éçº¿æ€§æ“ä½œï¼ˆReLUï¼‰"><a href="#3-éçº¿æ€§æ“ä½œï¼ˆReLUï¼‰" class="headerlink" title="3.éçº¿æ€§æ“ä½œï¼ˆReLUï¼‰"></a>3.éçº¿æ€§æ“ä½œï¼ˆ<code>ReLU</code>ï¼‰</h2><p>ä¸€èˆ¬å†å·ç§¯åéƒ½ä¼šæœ‰ä¸€ä¸ªéçº¿æ€§çš„æ“ä½œï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°è¿‡å·ç§¯å…¶å®æ˜¯çº¿æ€§çš„æ“ä½œï¼Œè€Œå¯¹äºä¸€èˆ¬çš„åˆ†ç±»æ¥è¯´ï¼Œçº¿ç¨‹åˆ†ç±»ä¸èƒ½æ»¡è¶³ï¼Œå› æ­¤éœ€è¦å†å·ç§¯ä¸­åŠ å…¥éçº¿æ€§ã€‚è¿™æ ·æ‰ä¼šè¿›è¡Œæ›´å¥½çš„åˆ†ç±»ã€‚å› æ­¤è¿™ä¸€æ­¥ä¹Ÿæ˜¯éå¸¸å…³é”®çš„ã€‚</p><p>åœ¨ä½¿ç”¨éçº¿æ€§æ“ä½œå‡½æ•°æ—¶ï¼Œ<code>ReLU</code>ï¼Œ<code>sigmoid</code>ï¼Œ<code>tanh</code>ç­‰éƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ ¹æ®å†å²ç»éªŒï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨<code>ReLU</code>çš„æ•ˆæœä¼šæ›´å¥½ã€‚</p><h2 id="4-æ± åŒ–å±‚ï¼ˆPooling-Layerï¼‰"><a href="#4-æ± åŒ–å±‚ï¼ˆPooling-Layerï¼‰" class="headerlink" title="4.æ± åŒ–å±‚ï¼ˆPooling Layerï¼‰"></a>4.æ± åŒ–å±‚ï¼ˆPooling Layerï¼‰</h2><p>Poolingä¹Ÿç§°ä¸ºä¸‹é‡‡æ ·æˆ–äºšé‡‡æ ·ï¼Œä¸»è¦å¯¹ä¸Šé¢è¿‡ç¨‹è¾“å‡ºçš„ç‰¹å¾å›¾è¿›è¡Œé‡‡æ ·ï¼Œé™ä½ç‰¹å¾å›¾çš„ç»´åº¦ï¼Œä½†æ˜¯å¯ä»¥ä¿æŒéƒ¨åˆ†é‡è¦çš„ä¿¡æ¯ï¼›æ± åŒ–<strong>è§„æ¨¡</strong>ä¸€èˆ¬ä¸º<strong>2Ã—2</strong> ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„å¤§å°ï¼‰ï¼Œåœ¨feature mapä¸Š<strong>ä¸é‡åˆçš„å¹³ç§»*2Ã—2</strong>å¤§å°åŒºåŸŸï¼Œå¹¶è¿›è¡Œé‡‡ç”¨ï¼›ç©ºé—´æ± åŒ–çš„ä¸»è¦æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ã€‚</p><p>&lt;img src=â€\uploads\pooling.jpgâ€ style=â€zoom:40%â€ &gt;</p><h4 id="4-1-1-æ± åŒ–æ–¹æ³•"><a href="#4-1-1-æ± åŒ–æ–¹æ³•" class="headerlink" title="4.1.1 æ± åŒ–æ–¹æ³•"></a>4.1.1 æ± åŒ–æ–¹æ³•</h4><ol><li>æœ€å¤§åŒ–ï¼ˆ<code>max pooling</code>ï¼‰ï¼šå–4ä¸ªç‚¹çš„æœ€å¤§å€¼ </li><li>å¹³å‡åŒ–ï¼ˆ<code>average pooling</code>ï¼‰ï¼šå–4ä¸ªç‚¹çš„å¹³å‡å€¼</li><li>é«˜æ–¯æ± åŒ–ï¼ˆ<code>gauss pooling</code>ï¼‰ï¼šç±»ä¼¼é«˜æ–¯æ¨¡ç³Šï¼Œè¿™ä¸ªä¸å¤ªå¸¸ç”¨</li><li>è®­ç»ƒæ± åŒ–ï¼ˆ<code>train pooling</code>ï¼‰ï¼šä¹Ÿå¯ä»¥æ ¹æ®å››ä¸ªå€¼è®­ç»ƒä¸€ä¸ªå‡½æ•°$f$å¾—åˆ°ä¸€ä¸ªå€¼ï¼Œä¸å¸¸ç”¨</li></ol><p>ç”±äºç‰¹å¾å›¾ä¸ä¸€å®šæ˜¯2çš„å€æ•°ï¼Œå› æ­¤æ± åŒ–æ“ä½œåœ¨è¾¹ç¼˜å¤„ç†ä¸Šä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>å¿½ç•¥è¾¹ç¼˜ï¼šå¤šå‡ºæ¥çš„è¾¹ç¼˜ç›´æ¥å»æ‰</li><li>ä¿ç•™è¾¹ç¼˜ï¼šå³å°†ç‰¹å¾å›¾çš„å˜é•¿ç”¨0å¡«å……ä¸º2çš„å€æ•°ï¼Œç„¶åå†æ± åŒ–ã€‚ </li></ul><h4 id="4-1-1-æ± åŒ–çš„ä½œç”¨"><a href="#4-1-1-æ± åŒ–çš„ä½œç”¨" class="headerlink" title="4.1.1 æ± åŒ–çš„ä½œç”¨"></a>4.1.1 æ± åŒ–çš„ä½œç”¨</h4><p>æ± åŒ–åœ¨CNNä¸­ä¹Ÿæ˜¯ä¸€ä¸ªä¸å¯ç¼ºå°‘çš„éƒ¨åˆ†ï¼Œé‚£æ± åŒ–æ“ä½œçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢å¯¹æ± åŒ–çš„ä¸»è¦ä½œç”¨æˆ–æ„ä¹‰è¿›è¡Œä¸€ä¸€è¯´æ˜ï¼ŒåŠ æ·±å¯¹æ± åŒ–çš„ç†è§£ï¼š</p><ol><li>å¯¹ç‰¹å¾çš„æ¦‚è¦ç»Ÿè®¡ï¼Œå¯¹ç‰¹å¾å›¾<code>(feature map)</code>è¿›è¡Œç®€è¦çš„ç»Ÿè®¡ï¼Œå¯¹ç‰¹å¾çš„è¿›ä¸€æ­¥æŠ½è±¡ã€‚</li><li><a href="https://www.zhihu.com/question/36686900" target="_blank" rel="noopener">ä¸å˜æ€§</a>ï¼šè¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„ä½œç”¨ï¼Œè¿™ç§ä¸å˜æ€§åŒ…æ‹¬äº†å¹³ç§»ï¼Œæ—‹è½¬ï¼Œå°ºåº¦ç­‰ï¼›å› ä¸ºæ± åŒ–è¿‡ç¨‹ä¸¢æ‰äº†å±€éƒ¨ä¿¡æ¯ï¼ˆå…è®¸å±€éƒ¨æœ‰ä¸€äº›å½¢å˜ï¼‰ï¼Œå¹¶ç»Ÿè®¡äº†å±€éƒ¨çš„ä¿¡æ¯ï¼ˆä¸è®ºå±€éƒ¨åœ¨ä»€ä¹ˆä½ç½®ï¼Œåªè¦å­˜åœ¨è¿™ä¸ªç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼Œå› æ­¤å¯¹äºå¹³ç§»æˆ–ä½ç§»éƒ½èƒ½è¯†åˆ«ã€‚</li><li>è¾“å‡ºæ§åˆ¶ï¼Œæ¯”å¦‚æ§åˆ¶è¾“å‡ºçš„é•¿åº¦ï¼Œå¤§å°ï¼›æ–‡æœ¬åˆ†ç±»ä¸­çš„é•¿åº¦æ˜¯ä¸åŒçš„ï¼Œå¯ä»¥é€šè¿‡æ± åŒ–æ¥è·å¾—ç‰¹å®šçš„é•¿åº¦ã€‚</li><li>é™ç»´ï¼Œé€šè¿‡æ± åŒ–åä¼šè¿›ä¸€æ­¥é™ä½ç»´åº¦ï¼ˆç›¸æ¯”ä¸è¿›è¡Œæ± åŒ–æ“ä½œï¼‰</li><li>é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œå› ä¸ºæ± åŒ–è¿‡ç¨‹ä¸­æŠ›å¼ƒäº†éƒ¨åˆ†çš„ç‰¹å¾ï¼Œè€Œä¸”å¯¹ç‰¹å¾è¿›è¡Œäº†æ¦‚è¦ç»Ÿè®¡ï¼Œå› æ­¤å¯¹æ¨¡å‹ç»“æœä¼šè¿›è¡Œæ”¹å–„ï¼Œé˜²æ­¢äº†è¿‡æ‹Ÿåˆçš„æƒ…å†µã€‚</li></ol><h2 id="5-FCå±‚ï¼ˆFull-Connect-Layerï¼‰"><a href="#5-FCå±‚ï¼ˆFull-Connect-Layerï¼‰" class="headerlink" title="5.FCå±‚ï¼ˆFull Connect Layerï¼‰"></a>5.FCå±‚ï¼ˆFull Connect Layerï¼‰</h2><p>å…¨è¿æ¥å±‚æ˜¯CNNä¸­æœ€åä¸€ä¸ªæ­¥éª¤ï¼ˆå½“ç„¶è¿™ä¸ªæ­¥éª¤ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼‰ï¼Œåœ¨è¿™å±‚ä¸»è¦æ˜¯è§£å†³åˆ†ç±»ä»»åŠ¡ï¼Œå°†è¾“å‡ºçš„<code>feature map</code>è¿›è¡Œå‘é‡åŒ–ï¼Œå½¢æˆä¸€ä¸ªåˆ—å‘é‡ï¼Œå¹¶ä¹˜ä»¥æ¯ä¸ªå€¼å¾—æƒé‡ã€‚æ¯”å¦‚è¾“å‡ºäº†ä¸€ä¸ª3é€šé“å¾—<code>10*10</code>çš„<code>feature map</code>é‚£ä¹ˆå°±è¾“å‡ºä¸€ä¸ª300é•¿åº¦çš„åˆ—å‘é‡ã€‚å¯¹è¿™ä¸ªåˆ—å‘é‡è¿›è¡Œçº¿æ€§ç»„åˆï¼Œè¾“å‡ºåˆ°åˆ†ç±»å™¨å…¶ä¸­è¿›è¡Œåˆ†ç±»ï¼Œå¦‚<code>softmax</code>åˆ†ç±»ã€‚</p><p>è¿™ä¸€å±‚çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯å°†<code>feature map</code>çš„ç‰¹å¾è¿›è¡Œçº¿æ€§ç»„åˆï¼Œå¯¹ç›®æ ‡è¿›è¡Œåˆ†ç±»ï¼›å› ä¸ºåªæ˜¯ç”¨éƒ¨åˆ†çš„ç‰¹å¾ï¼Œå¯èƒ½å¯¹åˆ†ç±»æ•ˆæœä¸å¤ªå¥½ï¼Œå› æ­¤éœ€è¦å°†æ‰€æœ‰çš„ç‰¹å¾ç»„åˆåœ¨ä¸€èµ·æ¥è¿›è¡Œç›®æ ‡åˆ†ç±»ã€‚</p><h2 id="6-CNNä¸­çš„å…¶ä»–åŠŸèƒ½å±‚"><a href="#6-CNNä¸­çš„å…¶ä»–åŠŸèƒ½å±‚" class="headerlink" title="6.CNNä¸­çš„å…¶ä»–åŠŸèƒ½å±‚"></a>6.CNNä¸­çš„å…¶ä»–åŠŸèƒ½å±‚</h2><p>ä¸€èˆ¬çš„CNNç½‘ç»œåŸºæœ¬éƒ½ä¼šå­˜åœ¨ä¸Šé¢çš„å·ç§¯å±‚ï¼Œæ¿€åŠ±å±‚(éçº¿æ€§æ“ä½œ)ï¼Œæ± åŒ–å±‚ï¼Œå…¨è¿æ¥å±‚ï¼›ä½†æ˜¯ä¹Ÿå¯ä»¥åœ¨å…¶ä»–åŠ å…¥ä¸€äº›å…¶ä»–å±‚ï¼Œå¦‚å½’ä¸€åŒ–å±‚ç­‰ã€‚ä¸‹é¢å¯¹ä¸€äº›å…¶ä»–å±‚è¿›è¡Œç®€è¦è¯´æ˜ã€‚</p><h3 id="6-1-å½’ä¸€åŒ–å±‚"><a href="#6-1-å½’ä¸€åŒ–å±‚" class="headerlink" title="6.1 å½’ä¸€åŒ–å±‚"></a>6.1 å½’ä¸€åŒ–å±‚</h3><h4 id="6-1-1-æ‰¹é‡å½’ä¸€åŒ–ï¼ˆBatch-Normalizationï¼‰"><a href="#6-1-1-æ‰¹é‡å½’ä¸€åŒ–ï¼ˆBatch-Normalizationï¼‰" class="headerlink" title="6.1.1 æ‰¹é‡å½’ä¸€åŒ–ï¼ˆBatch Normalizationï¼‰"></a>6.1.1 æ‰¹é‡å½’ä¸€åŒ–ï¼ˆ<code>Batch Normalization</code>ï¼‰</h4><p>åœ¨å·ç§¯å±‚è¾“å‡ºåï¼Œæ¯ä¸ª<code>feature map</code>çš„ç‰¹å¾<code>scale</code>å¯èƒ½ä¸ä¸€è‡´ã€‚ç»è¿‡å½’ä¸€åŒ–ï¼ˆ<code>Batch Normalization</code>ï¼Œ<code>BN</code>ï¼‰åå¯ä»¥åŠ é€Ÿè®­ç»ƒï¼Œæé«˜ç²¾åº¦ã€‚BNç®—æ³•çš„è¿‡ç¨‹ï¼š</p><p><strong>è¾“å…¥</strong>ï¼š$x$çš„mini-batchï¼š$B=(x_1, x_2, x_3, â€¦â€¦, x_m)$</p><p><strong>è®¡ç®—</strong>ï¼š</p><ol><li>è®¡ç®—mini-batchçš„å‡å€¼ï¼š$\mu_b = \frac {1} {m} \sum_{i=1}^m x_i $</li><li>è®¡ç®—mini-batchçš„æ–¹å·®ï¼š$\sigma ^ 2_b = \frac {1} {m} \sum_{i=1}^m (x_i - \mu _b)^2$</li><li>å½’ä¸€åŒ–ï¼š$\bar{x_i} = \frac {x_i - \mu_b}{\sqrt{\sigma ^ 2_b + \epsilon }}$ï¼Œè·å¾—0-1åˆ†å¸ƒï¼Œå…¶ä¸­$\epsilon$æ˜¯ä¸ºäº†é¿å…é™¤æ•°ä¸º0æ—¶æ‰€ä½¿ç”¨çš„å¾®å°æ­£æ•°ã€‚ </li><li>å°ºåº¦å˜åŒ–åŠåç§»ï¼š$y_i = \gamma \bar{x_i} + \beta$ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éœ€è¦é€šè¿‡å­¦ä¹ å¾—åˆ°ï¼Œè¿™å„¿ä¸ª$\gamma$ä¸ºå°ºåº¦å› å­ï¼Œ$\beta$ä¸ºå¹³ç§»å› å­</li></ol><p><strong>è¾“å‡º</strong>ï¼šè§„èŒƒåŒ–åçš„$y_i$</p><h4 id="6-1-2-CNNä¸­çš„æ‰¹å½’ä¸€åŒ–ï¼ˆBNï¼‰"><a href="#6-1-2-CNNä¸­çš„æ‰¹å½’ä¸€åŒ–ï¼ˆBNï¼‰" class="headerlink" title="6.1.2 CNNä¸­çš„æ‰¹å½’ä¸€åŒ–ï¼ˆBNï¼‰"></a>6.1.2 CNNä¸­çš„æ‰¹å½’ä¸€åŒ–ï¼ˆBNï¼‰</h4><p>æ ¹æ®å‰é¢å¯¹CNNçš„äº†è§£ï¼ŒCNNä¸­å·ç§¯è¾“å‡ºçš„æ˜¯å¾ˆå¤šç‰¹å¾å›¾ï¼Œæ¯”å¦‚å·ç§¯å±‚è¾“å‡ºçš„æ˜¯<code>100*28*28*5</code>çš„å¤§å°ï¼Œå…¶ä¸­100ä¸º<code>batch size</code>ï¼Œ5ä¸ºç‰¹å¾å›¾çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆå¦‚æœå°†ç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªç¥ç»å…ƒè¿›è¡ŒBNï¼Œé‚£ä¹ˆå°±ä¼šæœ‰<code>2*28*28*5</code>ä¸ª$\gamma,\beta$å‚æ•°ï¼Œè¿™æ ·è®¡ç®—å‚æ•°å°±å¤ªå¤šäº†ã€‚å› æ­¤åœ¨å·ç§¯åè¿›è¡ŒBNä½¿ç”¨ç±»ä¼¼æƒå€¼å…±äº«çš„ç­–ç•¥ï¼Œå³æŠŠä¸€æ•´å¼ <code>feature map</code>å½“ä½œä¸€ä¸ªç¥ç»å…ƒè¿›è¡Œå¤„ç†ï¼Œç›¸å½“äºå°†<code>100*28*28</code>ä½œä¸ºBNçš„è¾“å…¥ï¼Œå³ä¸€ä¸ª<code>feature map</code>ä¸­çš„ç¥ç»å…ƒéƒ½ä½¿ç”¨åŒä¸€ç»„$\gamma,\beta$å‚æ•°ï¼Œè¿™æ ·è®¡ç®—ï¼Œ$\gamma,\beta$å‚æ•°å°±å‡å°åˆ°ï¼š<code>5*2</code>ï¼Œæ¯”ä¹‹å‰å°äº†å¾ˆå¤šçš„æ•°é‡çº§ã€‚</p><ul><li><strong>BNçš„è®­ç»ƒå’Œæµ‹è¯•ï¼ˆé¢„æµ‹ï¼‰</strong></li></ul><p>åœ¨è®­ç»ƒé˜¶æ®µï¼ŒBNçš„è¾“å…¥ä¸º<code>batch_size</code>çš„å¤§å°ï¼Œå› æ­¤å¯ä»¥ç®—å‡ºæ‰€æœ‰è®¡ç®—å‡å€¼å’Œæ–¹å·®æ—¶ï¼›ä½†æ˜¯åœ¨æµ‹è¯•æˆ–é¢„æµ‹é˜¶æ®µå¯èƒ½è¾“å…¥çš„ä¸€ä¸ªæ ·æœ¬ï¼Œé‚£ä¹ˆå‡å€¼å’Œæ–¹å·®å‡ä¸º0ï¼Œå› æ­¤éœ€è¦åœ¨è®­ç»ƒ<code>batch_num</code>æ¬¡çš„è¿‡ç¨‹ä¸­å°†å‡å€¼å’Œæ–¹å·®ç»™è®°å½•ä¸‹æ¥ï¼Œåœ¨é¢„æµ‹æˆ–æµ‹è¯•æ—¶ä½¿ç”¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„å‡å€¼å¹³å‡å€¼å’Œæ–¹å·®å¹³å‡å€¼æ¥è¿›è¡ŒBNã€‚</p><ul><li><strong>BNåœ¨CNNä¸­çš„ä½ç½®</strong></li></ul><p>ä¸€èˆ¬BNå±‚æ”¾å…¥åˆ°å·ç§¯å±‚åï¼Œæœªè¿›è¡Œéçº¿æ€§æ“ä½œï¼ˆæ¿€åŠ±å‡½æ•°ï¼‰ä¹‹å‰ã€‚è¾“å‡ºåä½œä¸ºéçº¿æ€§æ“ä½œå±‚çš„è¾“å…¥ã€‚</p><h4 id="6-1-3-BNè§£å†³çš„é—®é¢˜"><a href="#6-1-3-BNè§£å†³çš„é—®é¢˜" class="headerlink" title="6.1.3 BNè§£å†³çš„é—®é¢˜"></a>6.1.3 BNè§£å†³çš„é—®é¢˜</h4><p><img src="%5Cuploads%5Cnormazier.png" srcset="/img/loading.gif" alt=""></p><p><img src="%5Cuploads%5Cbatch_normal.png" srcset="/img/loading.gif" alt=""></p><blockquote><p>aä¸­å·¦å›¾æ˜¯æ²¡æœ‰ç»è¿‡ä»»ä½•å¤„ç†çš„è¾“å…¥æ•°æ®ï¼Œæ›²çº¿æ˜¯sigmoidå‡½æ•°ï¼Œå¦‚æœæ•°æ®åœ¨æ¢¯åº¦å¾ˆå°çš„åŒºåŸŸï¼Œé‚£ä¹ˆå­¦ä¹ ç‡å°±ä¼šå¾ˆæ…¢ç”šè‡³é™·å…¥é•¿æ—¶é—´çš„åœæ»ã€‚å‡å‡å€¼é™¤æ–¹å·®åï¼Œæ•°æ®å°±è¢«ç§»åˆ°ä¸­å¿ƒåŒºåŸŸå¦‚å³å›¾æ‰€ç¤ºï¼Œå¯¹äºå¤§å¤šæ•°æ¿€æ´»å‡½æ•°è€Œè¨€ï¼Œè¿™ä¸ªåŒºåŸŸçš„æ¢¯åº¦éƒ½æ˜¯æœ€å¤§çš„æˆ–è€…æ˜¯æœ‰æ¢¯åº¦çš„ï¼ˆæ¯”å¦‚ReLUï¼‰ï¼Œè¿™å¯ä»¥çœ‹åšæ˜¯ä¸€ç§å¯¹æŠ—æ¢¯åº¦æ¶ˆå¤±çš„æœ‰æ•ˆæ‰‹æ®µã€‚å¯¹äºä¸€å±‚å¦‚æ­¤ï¼Œå¦‚æœå¯¹äºæ¯ä¸€å±‚æ•°æ®éƒ½é‚£ä¹ˆåšçš„è¯ï¼Œæ•°æ®çš„åˆ†å¸ƒæ€»æ˜¯åœ¨éšç€å˜åŒ–æ•æ„Ÿçš„åŒºåŸŸï¼Œç›¸å½“äºä¸ç”¨è€ƒè™‘æ•°æ®åˆ†å¸ƒå˜åŒ–äº†ï¼Œè¿™æ ·è®­ç»ƒèµ·æ¥æ›´æœ‰æ•ˆç‡ã€‚</p></blockquote><blockquote><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æœ‰ç¬¬4æ­¥ï¼Œä¸æ˜¯ä»…ä½¿ç”¨å‡å‡å€¼é™¤æ–¹å·®æ“ä½œå°±èƒ½è·å¾—ç›®çš„æ•ˆæœå—ï¼Ÿæˆ‘ä»¬æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå‡å‡å€¼é™¤æ–¹å·®å¾—åˆ°çš„åˆ†å¸ƒæ˜¯æ­£æ€åˆ†å¸ƒï¼Œæˆ‘ä»¬èƒ½å¦è®¤ä¸ºæ­£æ€åˆ†å¸ƒå°±æ˜¯æœ€å¥½æˆ–æœ€èƒ½ä½“ç°æˆ‘ä»¬è®­ç»ƒæ ·æœ¬çš„ç‰¹å¾åˆ†å¸ƒå‘¢ï¼Ÿä¸èƒ½ï¼Œæ¯”å¦‚æ•°æ®æœ¬èº«å°±å¾ˆä¸å¯¹ç§°ï¼Œæˆ–è€…æ¿€æ´»å‡½æ•°æœªå¿…æ˜¯å¯¹æ–¹å·®ä¸º1çš„æ•°æ®æœ€å¥½çš„æ•ˆæœï¼Œæ¯”å¦‚Sigmoidæ¿€æ´»å‡½æ•°ï¼Œåœ¨-1~1ä¹‹é—´çš„æ¢¯åº¦å˜åŒ–ä¸å¤§ï¼Œé‚£ä¹ˆéçº¿æ€§å˜æ¢çš„ä½œç”¨å°±ä¸èƒ½å¾ˆå¥½çš„ä½“ç°ï¼Œæ¢è¨€ä¹‹å°±æ˜¯ï¼Œå‡å‡å€¼é™¤æ–¹å·®æ“ä½œåå¯èƒ½ä¼šå‰Šå¼±ç½‘ç»œçš„æ€§èƒ½ï¼é’ˆå¯¹è¯¥æƒ…å†µï¼Œåœ¨å‰é¢ä¸‰æ­¥ä¹‹ååŠ å…¥ç¬¬4æ­¥å®ŒæˆçœŸæ­£çš„batch normalizationã€‚</p></blockquote><blockquote><p>BNçš„æœ¬è´¨å°±æ˜¯åˆ©ç”¨ä¼˜åŒ–å˜ä¸€ä¸‹æ–¹å·®å¤§å°å’Œå‡å€¼ä½ç½®ï¼Œä½¿å¾—æ–°çš„åˆ†å¸ƒæ›´åˆ‡åˆæ•°æ®çš„çœŸå®åˆ†å¸ƒï¼Œä¿è¯æ¨¡å‹çš„éçº¿æ€§è¡¨è¾¾èƒ½åŠ›ã€‚BNçš„æç«¯çš„æƒ…å†µå°±æ˜¯è¿™ä¸¤ä¸ªå‚æ•°ç­‰äºmini-batchçš„å‡å€¼å’Œæ–¹å·®ï¼Œé‚£ä¹ˆç»è¿‡batch normalizationä¹‹åçš„æ•°æ®å’Œè¾“å…¥å®Œå…¨ä¸€æ ·ï¼Œå½“ç„¶ä¸€èˆ¬çš„æƒ…å†µæ˜¯ä¸åŒçš„ã€‚</p></blockquote><h3 id="6-2-åˆ‡åˆ†å±‚"><a href="#6-2-åˆ‡åˆ†å±‚" class="headerlink" title="6.2 åˆ‡åˆ†å±‚"></a>6.2 åˆ‡åˆ†å±‚</h3><p>åœ¨ä¸€äº›åº”ç”¨ä¸­,éœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œåˆ‡å‰²ï¼Œç‹¬ç«‹åœ°å¯¹æŸä¸€éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå•ç‹¬å­¦ä¹ ã€‚è¿™æ ·å¯ä»¥å¯¹ç‰¹å®šéƒ¨åˆ†è¿›è¡Œé€šè¿‡è°ƒæ•´ <strong>æ„Ÿå—è§†é‡</strong>è¿›è¡ŒåŠ›åº¦æ›´å¤§çš„å­¦ä¹ ã€‚ </p><h3 id="6-3-èåˆå±‚"><a href="#6-3-èåˆå±‚" class="headerlink" title="6.3 èåˆå±‚"></a>6.3 èåˆå±‚</h3><p>å¯¹ç‹¬ç«‹è¿›è¡Œç‰¹å¾å­¦ä¹ çš„åˆ†æ”¯è¿›è¡Œèåˆï¼Œæ¥æ„å»ºé«˜æ•ˆè€Œç²¾ç®€çš„ç‰¹å¾ç»„åˆã€‚ èåˆå±‚å¯ä»¥å¯¹åˆ‡åˆ†å±‚è¿›è¡Œèåˆï¼Œä¹Ÿå¯ä»¥å¯¹ä¸åŒå¤§å°çš„å·ç§¯æ ¸å­¦ä¹ åˆ°çš„ç‰¹å¾è¿›è¡Œèåˆã€‚ </p><p><img src="%5Cuploads%5C3.jpg" srcset="/img/loading.gif" alt=""></p><p>å¯ä»¥ç”¨ <strong>çº§è¿(concatenation)</strong> çš„æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä¸åŒè¾“å…¥ç½‘ç»œç‰¹å¾çš„ç®€å•å åŠ ï¼Œæ¯”å¦‚è¯´é¦–å°¾ç›¸æ¥ã€‚ ä¹Ÿå¯ä»¥æ˜¯åˆå¹¶ï¼Œæˆ–è€…è¯´è¿ç®—çš„èåˆï¼Œå¯¹å½¢çŠ¶ä¸€è‡´çš„ç‰¹å¾ï¼Œé€šè¿‡ <code>+, -, x, max, conv</code> ç­‰è¿ç®—ï¼Œå½¢æˆå½¢çŠ¶ç›¸åŒçš„è¾“å‡º ã€‚</p><h2 id="7-åœ¨TensorFlowä¸­å®ç°CNNï¼ˆMNIST-DataSetsï¼‰"><a href="#7-åœ¨TensorFlowä¸­å®ç°CNNï¼ˆMNIST-DataSetsï¼‰" class="headerlink" title="7.åœ¨TensorFlowä¸­å®ç°CNNï¼ˆMNIST DataSetsï¼‰"></a>7.åœ¨TensorFlowä¸­å®ç°CNNï¼ˆMNIST DataSetsï¼‰</h2><pre><code class="python">import tensorflow as tfimport tensorflow.examples.tutorials.mnist.input_data as input_datamnist = input_data.read_data_sets(&quot;/opt/workspace/project/deep-st-nn/data/MNIST_DATA&quot;, one_hot=True)  # ä¸‹è½½å¹¶åŠ è½½mnistæ•°æ®x = tf.placeholder(tf.float32, [None, 784])  # è¾“å…¥çš„æ•°æ®å ä½ç¬¦y_actual = tf.placeholder(tf.float32, shape=[None, 10])  # è¾“å…¥çš„æ ‡ç­¾å ä½ç¬¦def weight_variable(shape):    &quot;&quot;&quot;    parameter    ---------        shape: list, create variable tensor for shape.    return    ------        tensor, the variable tensor of weight.    &quot;&quot;&quot;    initial = tf.truncated_normal(shape, stddev=0.1)    return tf.Variable(initial)def bias_variable(shape):    initial = tf.constant(0.1, shape=shape)    return tf.Variable(initial)def conv2d(x, W):    return tf.nn.conv2d(x, W, strides=[1, 1, 1, 1], padding=&#39;SAME&#39;)def max_pool(x):    return tf.nn.max_pool(x, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding=&#39;SAME&#39;)# æ„å»ºç½‘ç»œx_image = tf.reshape(x, [-1, 28, 28, 1])  # è½¬æ¢è¾“å…¥æ•°æ®shape,ä»¥ä¾¿äºç”¨äºç½‘ç»œä¸­W_conv1 = weight_variable([5, 5, 1, 32])b_conv1 = bias_variable([32])h_conv1 = tf.nn.relu(conv2d(x_image, W_conv1) + b_conv1)  # ç¬¬ä¸€ä¸ªå·ç§¯å±‚h_pool1 = max_pool(h_conv1)  # ç¬¬ä¸€ä¸ªæ± åŒ–å±‚W_conv2 = weight_variable([5, 5, 32, 64])b_conv2 = bias_variable([64])h_conv2 = tf.nn.relu(conv2d(h_pool1, W_conv2) + b_conv2)  # ç¬¬äºŒä¸ªå·ç§¯å±‚h_pool2 = max_pool(h_conv2)  # ç¬¬äºŒä¸ªæ± åŒ–å±‚W_fc1 = weight_variable([7 * 7 * 64, 1024])b_fc1 = bias_variable([1024])h_pool2_flat = tf.reshape(h_pool2, [-1, 7 * 7 * 64])  # reshapeæˆå‘é‡h_fc1 = tf.nn.relu(tf.matmul(h_pool2_flat, W_fc1) + b_fc1)  # ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚keep_prob = tf.placeholder(&quot;float&quot;)h_fc1_drop = tf.nn.dropout(h_fc1, keep_prob)  # dropoutå±‚W_fc2 = weight_variable([1024, 10])b_fc2 = bias_variable([10])y_predict = tf.nn.softmax(tf.matmul(h_fc1_drop, W_fc2) + b_fc2)  # softmaxå±‚cross_entropy = -tf.reduce_sum(y_actual * tf.log(y_predict))  # äº¤å‰ç†µtrain_step = tf.train.GradientDescentOptimizer(1e-3).minimize(cross_entropy)  # æ¢¯åº¦ä¸‹é™æ³•correct_prediction = tf.equal(tf.argmax(y_predict, 1), tf.argmax(y_actual, 1))accuracy = tf.reduce_mean(tf.cast(correct_prediction, &quot;float&quot;))  # ç²¾ç¡®åº¦è®¡ç®—sess = tf.InteractiveSession()sess.run(tf.initialize_all_variables())for i in range(20000):    batch = mnist.train.next_batch(50)    if i % 100 == 0:  # è®­ç»ƒ100æ¬¡ï¼ŒéªŒè¯ä¸€æ¬¡        train_acc = accuracy.eval(feed_dict={x: batch[0], y_actual: batch[1], keep_prob: 1.0})        print(&#39;step&#39;, i, &#39;training accuracy&#39;, train_acc)    train_step.run(feed_dict={x: batch[0], y_actual: batch[1], keep_prob: 0.5})test_acc = accuracy.eval(feed_dict={x: mnist.test.images, y_actual: mnist.test.labels, keep_prob: 1.0})print(&quot;test accuracy&quot;, test_acc)</code></pre><h2 id="8-Reference"><a href="#8-Reference" class="headerlink" title="8.Reference"></a>8.Reference</h2>]]></content>
    
    
    <categories>
      
      <category>deep learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>deep learning</tag>
      
      <tag>tensorflow</tag>
      
      <tag>CNN</tag>
      
      <tag>ReLU</tag>
      
      <tag>convolution</tag>
      
      <tag>pooling</tag>
      
      <tag>BN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ -è¯¦è§£LSTMç½‘ç»œå’ŒTensorFlowå®ç°</title>
    <link href="/2018/06/21/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E8%AF%A6%E8%A7%A3LSTM%E7%BD%91%E7%BB%9C%E5%92%8CTensorFlow%E5%AE%9E%E7%8E%B0/"/>
    <url>/2018/06/21/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E8%AF%A6%E8%A7%A3LSTM%E7%BD%91%E7%BB%9C%E5%92%8CTensorFlow%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>LSTMç½‘ç»œæ˜¯RNNç½‘ç»œä¸­çš„ç‰¹æ®Šç½‘ç»œï¼Œå†RNNæ–‡ç« ä¸­å·²ç»æåˆ°ï¼ŒRNNåœ¨æ—¶é—´æ­¥è¿‡é•¿æ—¶ï¼Œå­¦ä¹ ä¸åˆ°ä¾èµ–å…³ç³»ã€‚ä¸»è¦æ˜¯RNNä¼šå¼•èµ·æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå› æ­¤ä¸ºäº†è§£å†³é—®é¢˜ï¼Œç ”ç©¶è€…ä»¬æå‡ºäº†å¾ˆå¤šæ–¹å¼ï¼Œå…¶ä¸­GRUå’ŒLSTMç½‘ç»œå°±æ˜¯è¿™æ ·è¯ç”Ÿçš„ã€‚LSTMç½‘ç»œåœ¨åº”ç”¨ä¸­ä¹Ÿå–å¾—äº†éå‡¡çš„æˆå°±ï¼Œç‰¹åˆ«æ˜¯åœ¨è¯­éŸ³è¯†åˆ«ï¼Œè¯­è¨€å»ºæ¨¡ï¼Œç¿»è¯‘ç­‰ç­‰æ–¹é¢ã€‚</p><p>##1.é•¿æœŸä¾èµ–é—®é¢˜ </p><p>RNNçš„æ ¸å¿ƒå°±æ˜¯èƒ½å°†å†å²çš„ä¿¡æ¯è¿æ¥åˆ°å½“å‰çš„åœºæ™¯ä¸‹ï¼Œå³RNNå¯¹å†å²æ˜¯æœ‰è®°å¿†åŠŸèƒ½çš„ï¼Œèƒ½å¯¹ä¸€å®šæ—¶é—´æ­¥çš„ä¿¡æ¯è¿›è¡Œè®°å¿†ã€‚ä½†æ˜¯<code>time step</code>è¿‡é•¿çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œå¯¹è¿‡ä¹…(æ—¶é—´è·¨åº¦å¤ªå¤§çš„ä¿¡æ¯)ä¿¡æ¯æ²¡æœ‰è®°å¿†ã€‚ä»ç†è®ºçš„è§’åº¦RNNæ˜¯æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼Œåœ¨åº”ç”¨ä¸­å´ä¸å°½äººæ„ã€‚ä¸ºäº†è§£å†³è¿™ç§é•¿æœŸä¾èµ–çš„é—®é¢˜ï¼Œç ”ç©¶è€…æå‡ºäº†æ–°çš„RNNæ¨¡å‹ï¼Œå¦‚GRUï¼ŒLSTMç­‰ç½‘ç»œï¼Œæ¥è§£å†³è¿™ç§é•¿æœŸä¾èµ–çš„é—®é¢˜ã€‚</p><h2 id="2-ä»€ä¹ˆæ˜¯LSTMç½‘ç»œ"><a href="#2-ä»€ä¹ˆæ˜¯LSTMç½‘ç»œ" class="headerlink" title="2.ä»€ä¹ˆæ˜¯LSTMç½‘ç»œ"></a>2.ä»€ä¹ˆæ˜¯LSTMç½‘ç»œ</h2><p>LSTMï¼Œå…¨ç§°ä¸ºé•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong Short Term Memory networksï¼‰,å®ƒä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„RNNç½‘ç»œï¼Œä½†æ˜¯å¯ä»¥å­¦ä¹ åˆ°é•¿æœŸä¾èµ–çš„å…³ç³»ã€‚é‚£ä¹ˆLSTMæ˜¯å¦‚ä½•è§£å†³é•¿æœŸä¾èµ–çš„é—®é¢˜å‘¢ï¼Ÿ</p><p>åœ¨RNNä¸­æˆ‘ä»¬ä¹Ÿæåˆ°äº†ï¼Œå¯ä»¥é€šè¿‡gateçš„æ–¹å¼æ¥è§£å†³æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œè€ŒLSTMå°±æ˜¯é€šè¿‡gateçš„æ–¹å¼æ¥å®ç°çš„ã€‚ä¸‹é¢æ˜¯LSTMçš„cellå•å…ƒå¯è§†åŒ–ç»“æ„ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨æ•´ä¸ªæ—¶é—´åºåˆ—ä¸ŠLSTMçš„æ•´ä½“ç»“æ„ï¼Œ$X_t$è¡¨ç¤ºä¸åŒæ—¶é—´ç‚¹çš„è¾“å…¥åºåˆ—ï¼Œ$h_t$ä¸ºæ¯ä¸ªæ—¶é—´ç‚¹çš„è¾“å‡ºï¼Œä»ä¸‹é¢çš„ç»“æ„å›¾ä¸­å¯ä»¥çœ‹å‡ºLSTMç½‘ç»œä¸­æ¯”RNNç½‘ç»œå¤šäº†ä¸€ä¸ªå¾ªç¯ç»“æ„ï¼Œä»ä¸Šé¢çš„ç»“æ„ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>LSTM Cell</code>ä¸­å¤šå‡ºäº†ä¸€ä¸ª$C_t$çš„çš„å˜é‡ï¼Œåœ¨LSTMä¸­è¢«ç§°ä¸ºè®°å¿†å•å…ƒï¼Œè®°å¿†å•å…ƒè´¯ç©¿æ•´ä¸ªæ—¶é—´æ­¥ï¼Œä¸ä¼šè¢«è¾“å‡ºï¼Œåªä¼šåœ¨å¾ªç¯è¿‡ç¨‹ä¸­è¿›è¡Œæ›´æ–°ï¼Œå¹¶è¾“å‡ºåˆ°ä¸‹ä¸€æ—¶é—´æ­¥ä½œä¸ºè¾“å…¥ã€‚$C_t$åœ¨æ¯ä¸ªcellä¸­ä¼šè¿›è¡Œç®€å•çš„çº¿æ€§äº¤äº’ï¼Œä¸Šé¢æ‰¿è½½äº†ä¸€äº›å†å²çš„è¾“å…¥ä¿¡æ¯ã€‚</p><img src="\uploads\LSTM.png" srcset="/img/loading.gif" style="zoom:30" /><a id="more"></a><h2 id="3-LSTMç»“æ„è¯¦è§£"><a href="#3-LSTMç»“æ„è¯¦è§£" class="headerlink" title="3.LSTMç»“æ„è¯¦è§£"></a>3.LSTMç»“æ„è¯¦è§£</h2><p>ä»ä¸Šé¢ä¸­ä¹Ÿæå‡ºäº†<code>LSTM Cell</code>ä¸­ä¸»è¦é€šè¿‡gateçš„æ–¹å¼åœ¨RNNåŸºç¡€ä¸Šè¿›è¡Œå˜æ¢çš„ã€‚å…·ä½“<code>LSTM Cell</code>çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦é€šè¿‡ä¸‰é“<code>gate</code>ï¼ˆé—¨ï¼‰æ¥æ§åˆ¶è¾“å…¥ï¼Œè¾“å‡ºç­‰ï¼Œè¿™ä¸ªé—¨æ¥é€‰æ‹©æ€§çš„æ§åˆ¶ä¿¡æ¯çš„æ˜¯å¦é€šè¿‡ã€‚ä¸»è¦æ˜¯é€šè¿‡sigmodç¥ç»ç½‘ç»œå±‚å’Œä¸€ä¸ªå…ƒç´ çš„ä¹˜ç§¯å®ç°é—¨çš„æ§åˆ¶ã€‚</p><img src="\uploads\lstm_cell.png" srcset="/img/loading.gif" style="zoom:50%" /><h3 id="3-1-LSTMåˆ†æ­¥è¯¦è§£"><a href="#3-1-LSTMåˆ†æ­¥è¯¦è§£" class="headerlink" title="3.1 LSTMåˆ†æ­¥è¯¦è§£"></a>3.1 LSTMåˆ†æ­¥è¯¦è§£</h3><p><code>LSTM Cell</code>çš„æ•´ä½“è¾“å…¥æœ‰ï¼š$X_t$ï¼Œ$h_{t-1}$ï¼Œ$c_{t-1}$ï¼Œè€Œæ•´ä½“è¾“å‡ºå’ŒRNNçš„è¾“å‡ºä¸€è‡´ï¼Œä¸»è¦æ˜¯$h_t$ï¼Œ$z_t$ï¼›è€Œ$c_t$ä¸»è¦æ˜¯åœ¨å¾ªç¯è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚è€Œ<code>LSTM Cell</code>ä¸­æœ€å…³é”®çš„å°±æ˜¯<code>gate</code>å®ç°ï¼Œè€Œ<code>LSTM</code>çš„ä¸‰é“é—¨ä¸»è¦ä½œç”¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œåˆ†åˆ«ä¸ºâ€é—å¿˜é—¨â€ï¼Œâ€è¾“å…¥é—¨â€ï¼Œâ€è¾“å‡ºé—¨â€ï¼›ä¸‹é¢åˆ†åˆ«å¯¹è¿™ä¸‰é“é—¨è¿›è¡Œåˆ†åˆ«è¯¦ç»†è¯´æ˜ã€‚</p><h4 id="3-1-1-Forget-Gate"><a href="#3-1-1-Forget-Gate" class="headerlink" title="3.1.1 Forget Gate"></a>3.1.1 Forget Gate</h4><p>é—å¿˜é—¨ä¸»è¦å¯¹$h_{t-1}$å’Œ$x_t$è¿›è¡Œè§‚å¯Ÿï¼Œå¯¹è®°å¿†å•å…ƒ$C_{t-1}$çš„å…ƒç´ é€‰æ‹©æ€§çš„é—å¿˜ï¼Œé—å¿˜é—¨è¾“å‡ºçš„æ˜¯0-1çš„æ•°ï¼Œ1è¡¨ç¤ºå®Œå…¨ä¿ç•™è¯¥æ¶ˆæ¯ï¼Œ0è¡¨ç¤ºé—å¿˜è¯¥æ¶ˆæ¯ã€‚é—å¿˜é—¨è¾“å‡ºä¸€ä¸ª$f_t$ï¼Œå…¬å¼ä¸ºï¼š<br>$$<br>f_t=\sigma(W_f \cdot [x_t, h_{t-1}] + b_f)<br>$$<br>è¾“å‡ºåçš„$f_t$å†å’Œ$c_{t-1}$ç›¸ä¹˜ï¼Œæ¥æ›´æ–°è®°å¿†å•å…ƒã€‚åœ¨åº”ç”¨è¿‡ç¨‹ä¸­çš„æ„ä¹‰æ—¶ï¼Œé€‰æ‹©æ€§çš„å¿˜è®°ä¸€äº›å†å²ä¿¡æ¯(ä¸æ˜¯æ‰€æœ‰çš„å†å²ä¿¡æ¯éƒ½æ˜¯æœ‰æ„ä¹‰çš„)ã€‚</p><h4 id="3-1-2-Input-Gate"><a href="#3-1-2-Input-Gate" class="headerlink" title="3.1.2 Input Gate"></a>3.1.2 Input Gate</h4><p>è¿™ä¸€æ­¥çš„ä¸»è¦ä½œç”¨æ˜¯å°†æ—§çš„è®°å¿†å•å…ƒ$c_{t-1}$æ›´æ–°åˆ°æ–°çš„è®°å¿†å•å…ƒ$c_t$ä¸Šã€‚è¿™ä¸€æ­¥åªéœ€è¦å°†$c_{t-1}$ä¹˜ä»¥$f_t$åœ¨åŠ ä¸Š$i_t$<em>$c_{t}^-$å³å¯ã€‚$i_t$åˆ™ä¸ºè¾“å…¥é—¨ï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹æœ¬æ¬¡çš„è¾“å…¥æ›´æ–°ç¨‹åº¦ã€‚ï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š<br>$$<br>i_t = \sigma(W_i \cdot [x_t, h_{t-1}] + b_i)\<br>c_t^-=tanh(W_c \cdot [x_t, h_{t-1})] + b_c)<br>$$<br>$i_t$è¾“å‡ºçš„ä¸º0-1çš„å€¼ï¼Œ$c_{t}^-$çš„è®¡ç®—æ–¹å¼å’ŒRNNä¸­çš„stateæ›´æ–°æ–¹å¼ä¸€è‡´ï¼Œå†ä¹˜ä»¥$i_t$åï¼Œè¡¨ç¤ºå¯¹æœ€æ–°$c_t$çš„æ›´æ–°ç¨‹åº¦ã€‚è¿™å„¿ä¸€æ­¥çš„æ„ä¹‰æ˜¯ï¼Œæ·»åŠ äº†å½“å‰æ—¶é—´æ­¥çš„ä¿¡æ¯ï¼Œéšåæ·»åŠ åˆ°è®°å¿†å•å…ƒä¸­ã€‚è¿™ä¸€æ­¥è¾“å‡ºä»¬è®¡ç®—å®Œæˆåéšåéœ€è¦æ›´æ–°$C_t$ï¼š<br>$$<br>c_t = c_{t-1} * f_t + i_t</em>c_t^-<br>$$</p><h4 id="3-1-3-Output-Gate"><a href="#3-1-3-Output-Gate" class="headerlink" title="3.1.3 Output Gate"></a>3.1.3 Output Gate</h4><p>æœ€åéœ€è¦å†³å®šæœ€ç»ˆçš„è¾“å‡ºï¼Œè¾“å‡ºä¼šåŸºäºå½“å‰çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¿›è¡Œä¸€äº›è¿‡æ»¤ï¼Œå¹¶ç”¨äºä¸‹ä¸€æ­¥å’Œ$C_t$çš„ç»“åˆä¸­ï¼Œç¡®å®šæœ€ç»ˆçš„è¾“å‡ºå€¼ï¼š<br>$$<br>o_t = \sigma(W_o \cdot [h_{t-1}, x_t] + b_o) \<br>h_t = o_t * tanh(C_t)<br>$$<br>æœ€ç»ˆçš„è¾“å‡ºï¼Œç»“åˆå½“å‰çš„ä¿¡æ¯å’Œè®°å¿†å•å…ƒä¿¡æ¯è¿›è¡Œè¾“å‡ºã€‚</p><h3 id="3-2-LSTMç½‘ç»œç»“æ„å¯è§†åŒ–"><a href="#3-2-LSTMç½‘ç»œç»“æ„å¯è§†åŒ–" class="headerlink" title="3.2 LSTMç½‘ç»œç»“æ„å¯è§†åŒ–"></a>3.2 LSTMç½‘ç»œç»“æ„å¯è§†åŒ–</h3><p>æ ¹æ®LSTM Cellçš„ç»“æ„ï¼Œå³å†…éƒ¨çš„è®¡ç®—å…¬å¼è¿›è¡Œå†…éƒ¨ç»“æ„å¯è§†åŒ–ï¼Œä»è¾“å…¥ï¼Œåˆ°è®¡ç®—ï¼Œå†åˆ°è¾“å‡ºçš„è¿‡ç¨‹è¿›è¡Œè¯¦ç»†çš„ç»“æ„å¯è§†åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="%5Cuploads%5CLSTM_X.png" srcset="/img/loading.gif" alt="LSTMå†…éƒ¨ç»“æ„å¯è§†åŒ–"></p><p>ä¸Šé¢å°†LSTM Cellè¿›è¡Œäº†åˆ’åˆ†ï¼Œä¸»è¦åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯ä¸‰é“é—¨å’Œè¾“å…¥çš„è½¬æ¢ï¼›ç¬¬äºŒéƒ¨åˆ†å¯ä»¥çœ‹ä½œæ˜¯è®°å¿†å•å…ƒ$C_t$çš„æ›´æ–°ï¼›ç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯è¾“å‡ºéƒ¨åˆ†ã€‚</p><p>åœ¨ä¸Šé¢çš„ç»“æ„ä¸­ä¹Ÿç»™å‡ºäº†è¾“å…¥ï¼Œè¾“å‡ºçš„æ•°æ®<code>shape</code>ï¼Œæ˜ç™½æ•°æ®åœ¨æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­æ˜¯æ€ä¹ˆæµé€šå’Œè®¡ç®—çš„ã€‚å¹¶å¯ä»¥æ ¹æ®è¾“å…¥çš„æƒ…å†µï¼ŒçŸ¥é“å‚æ•°çš„<code>shape</code>ç­‰ã€‚åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œä¸‰é“é—¨ä¸­çš„å‚æ•°$W$çš„<code>shape</code>åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li>å½“$X_t$å’Œ$H_{t-1}$è¿›è¡Œ<code>concat</code>åï¼Œå‚æ•°<code>W</code>çš„<code>shape</code>ä¸º<code>(depth+n_hidden_unitsï¼Œ n_hidden_units)</code>ï¼Œå‚æ•°$b$çš„<code>shape</code>ä¸º<code>(n_hidden_units)</code>ã€‚</li><li>å½“$X_t$å’Œ$H_{t-1}$åˆ†åˆ«å’Œå‚æ•°$W$è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆå‚æ•°$W$å°±ä¼šå­˜åœ¨ä¸¤ä¸ªï¼Œ$W_x$çš„<code>shape</code>ä¸º<code>(depth, n_hidden_units)</code>ï¼Œ$W_h$çš„$shape$ä¸º<code>(n_hidden_units, n_hidden_units)</code>ï¼›å‚æ•°$b$çš„<code>shape</code>ä¸º<code>(n_hidden_units)</code>ã€‚</li></ul><p>ä¸‰ä¸ªgateçš„è¾“å‡ºåˆ†åˆ«ä¸º$f_t$ï¼Œ$i_t$ï¼Œ$o_t$ï¼›è¿™ä¸‰ä¸ªå€¼çš„è¾“å‡º<code>shape</code>å‡ä¸º<code>(batch_size, n_hidden_units)</code>ã€‚</p><h2 id="4-LSTMç½‘ç»œåœ¨TensorFlowä¸­çš„å®ç°"><a href="#4-LSTMç½‘ç»œåœ¨TensorFlowä¸­çš„å®ç°" class="headerlink" title="4.LSTMç½‘ç»œåœ¨TensorFlowä¸­çš„å®ç°"></a>4.LSTMç½‘ç»œåœ¨TensorFlowä¸­çš„å®ç°</h2><p>LSTMä¹Ÿæ˜¯RNNç½‘ç»œä¸­çš„ä¸€ç§ï¼Œå› æ­¤åœ¨TensorFlowå®ç°æ—¶ï¼Œå’ŒRNNæ¨¡å‹å®ç°çš„æ–¹å¼ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒçš„åœ°æ–¹åœ¨RNNä¸­å®šä¹‰<code>cell</code>çš„åœ°æ–¹ã€‚åœ¨TensorFlowä¸­å®ç°äº†<code>LSTM Cell</code>çš„åŸºæœ¬ç»“æ„ï¼Œå®ç°äº†ä¸¤ç§<code>LSTM Cell</code>çš„ç»“æ„<code>BasicLSTMCell</code>å’Œ<code>LSTMCell</code>ï¼Œä¸‹é¢ä¾æ¬¡å¯¹ä¸¤ç§ç»“æ„è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="4-1-BasicLSTMCellå®ç°"><a href="#4-1-BasicLSTMCellå®ç°" class="headerlink" title="4.1 BasicLSTMCellå®ç°"></a>4.1 <code>BasicLSTMCell</code>å®ç°</h3><p>è¿™ä¸ªCellçš„å®ç°æ˜¯ä»¥æœ€åŸºæœ¬çš„LSTMç»“æ„ä¸ºåŸºç¡€ï¼Œåœ¨TensorFlowä¸­å®ç°äº†è¯¥ç»“æ„ï¼Œä¹Ÿæ˜¯åŸºäº<code>LayerRNNCell</code>å®ç°çš„ï¼Œä¸»è¦å®ç°äº†<code>build</code>å’Œ<code>call</code>æ–¹æ³•ï¼Œä¸‹é¢ä¸º<code>call</code>æ–¹æ³•çš„æºç ï¼š</p><pre><code class="python">  def call(self, inputs, state):    &quot;&quot;&quot;Long short-term memory cell (LSTM).    Args:      inputs: `2-D` tensor with shape `[batch_size, input_size]`.      state: An `LSTMStateTuple` of state tensors, each shaped        `[batch_size, self.state_size]`, if `state_is_tuple` has been set to        `True`.  Otherwise, a `Tensor` shaped        `[batch_size, 2 * self.state_size]`.    Returns:      A pair containing the new hidden state, and the new state (either a        `LSTMStateTuple` or a concatenated state, depending on        `state_is_tuple`).    &quot;&quot;&quot;    sigmoid = math_ops.sigmoid    one = constant_op.constant(1, dtype=dtypes.int32)    # Parameters of gates are concatenated into one multiply for efficiency.    if self._state_is_tuple:      c, h = state    else:      c, h = array_ops.split(value=state, num_or_size_splits=2, axis=one)    gate_inputs = math_ops.matmul(        array_ops.concat([inputs, h], 1), self._kernel)    gate_inputs = nn_ops.bias_add(gate_inputs, self._bias)    # i = input_gate, j = new_input, f = forget_gate, o = output_gate    i, j, f, o = array_ops.split(        value=gate_inputs, num_or_size_splits=4, axis=one)    forget_bias_tensor = constant_op.constant(self._forget_bias, dtype=f.dtype)    # Note that using `add` and `multiply` instead of `+` and `*` gives a    # performance improvement. So using those at the cost of readability.    add = math_ops.add    multiply = math_ops.multiply    new_c = add(multiply(c, sigmoid(add(f, forget_bias_tensor))),                multiply(sigmoid(i), self._activation(j)))    new_h = multiply(self._activation(new_c), sigmoid(o))    if self._state_is_tuple:      new_state = LSTMStateTuple(new_c, new_h)    else:      new_state = array_ops.concat([new_c, new_h], 1)    return new_h, new_state</code></pre><p>æºç ä¸­ä¸»è¦å¯¹å››ä¸ª<code>gate</code>è¿›è¡Œè®¡ç®—ï¼Œå¹¶æ›´æ–°<code>C</code>å’Œ<code>H</code>ï¼Œå¹¶è¿”å›è¾“å‡ºå’Œ<code>state</code>ï¼Œ<code>LSTM</code>ä¸­çš„<code>state</code>åŒ…æ‹¬äº†<code>C</code>å’Œ<code>H</code>ã€‚ä¸Šé¢ä»£ç ä¸­å¯¹å››ä¸ª<code>gate</code>çš„è®¡ç®—ï¼Œæ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆæƒé‡å˜é‡ï¼Œå†å’Œè¾“å…¥çš„$X_t$å’Œ$H_{t-1}$è¿›è¡Œè¿ç®—ï¼Œå†æ‹†åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæƒé‡å˜é‡çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class="python">def build(self, inputs_shape):    if inputs_shape[1].value is None:        raise ValueError(&quot;Expected inputs.shape[-1] to be known, saw shape: %s&quot;                         % inputs_shape)        input_depth = inputs_shape[1].value        h_depth = self._num_units        self._kernel = self.add_variable(            _WEIGHTS_VARIABLE_NAME,            shape=[input_depth + h_depth, 4 * self._num_units])        self._bias = self.add_variable(            _BIAS_VARIABLE_NAME,            shape=[4 * self._num_units],            initializer=init_ops.zeros_initializer(dtype=self.dtype))    self.built = True</code></pre><p>åœ¨å®šä¹‰<code>LSTM</code>ä¸­å››é“<code>gate</code>çš„æƒé‡å˜é‡<code>W</code>å’Œ<code>B</code>æ—¶ï¼Œæ˜¯ä¸€æ¬¡æ€§å®šä¹‰äº†4ä¸ªï¼Œå¹¶åœ¨ä¸€ä¸ªå˜é‡ä¸­ã€‚åç»­åœ¨è®¡ç®—æ—¶ï¼Œåšä¸€æ¬¡è®¡ç®—ï¼Œå†è¿›è¡Œæ‹†åˆ†æˆå››é“<code>gate</code>çš„è¾“å‡ºï¼š<code>i,j,f,o</code>ã€‚</p><h3 id="4-2-LSTMCellçš„å®ç°"><a href="#4-2-LSTMCellçš„å®ç°" class="headerlink" title="4.2 LSTMCellçš„å®ç°"></a>4.2 <code>LSTMCell</code>çš„å®ç°</h3><p><code>LSTMCell</code>æ˜¯<code>BasicLSTMCell</code>æ‰©å±•å®ç°ï¼Œå¢åŠ äº†çª¥è§†çš„çª¥è§†å­”çš„åŠŸèƒ½ï¼Œ<code>LSTMCell</code>çš„åˆå§‹åŒ–å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼Œå…ˆå¯¹åˆå§‹åŒ–çš„å‚æ•°è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</p><p><img src="%5Cuploads%5CLSTM-diag.png" srcset="/img/loading.gif" alt=""></p><pre><code class="python">def __init__(self, num_units, use_peepholes=False, cell_clip=None, initializer=None, num_proj=None,              proj_clip=None, num_unit_shards=None, num_proj_shards=None, forget_bias=1.0,             state_is_tuple=True, activation=None, reuse=None, name=None):    &quot;&quot;&quot;Initialize the parameters for an LSTM cell.    Args:      num_units: int, The number of units in the LSTM cell.      use_peepholes: bool, æ˜¯å¦ä½¿ç”¨çª¥è§†å­”, å½“è®¾ç½®ä¸ºTrueæ—¶åˆ™ä½¿ç”¨çª¥è§†å­”.      cell_clip: (optional) A float value, å•å…ƒ(å››ä¸ªgate)è¾“å‡ºçš„å€¼è¢«é™åˆ¶åœ¨`Â±cell_clip`å†….      initializer: (optional) ç”¨äºæƒé‡å’ŒæŠ•å½±çŸ©é˜µ(projection matrices)çš„åˆå§‹å€¼è®¾å®š.      num_proj: (optional) int, æŠ•å½±çŸ©é˜µçš„è¾“å‡ºç»´æ•°. å¦‚æœè®¾ç½®ä¸ºNoneåˆ™ä¸æ‰§è¡Œ`æŠ•å½±`æ“ä½œ.      proj_clip: (optional) A float value. å¦‚æœè®¾ç½®äº† `num_proj &gt; 0` å’Œ `proj_clip`, åˆ™æŠ•å½±å€¼å°†è¢«é™åˆ¶åœ¨`[-proj_clip, proj_clip]`èŒƒå›´å†….      num_unit_shards: Deprecated, å·²ç»å¼ƒç”¨.      num_proj_shards: Deprecated, å·²ç»å¼ƒç”¨.      forget_bias: Biases of the forget gate are initialized by default to 1 in order to reduce the scale of forgetting at the beginning of the training. Must set it manually to `0.0` when restoring from CudnnLSTM trained checkpoints.      state_is_tuple: If True, accepted and returned states are 2-tuples of the `c_state` and `m_state`.  If False, they are concatenated along the column axis.  This latter behavior will soon be deprecated.      activation: Activation function of the inner states.  Default: `tanh`.      reuse: (optional) Python boolean describing whether to reuse variables in an existing scope.  If not `True`, and the existing scope already has the given variables, an error is raised.      name: String, the name of the layer. Layers with the same name will share weights, but to avoid mistakes we require reuse=True in such cases.      When restoring from CudnnLSTM-trained checkpoints, use `CudnnCompatibleLSTMCell` instead.    &quot;&quot;&quot;</code></pre><p>ä»ä¸Šé¢å‚æ•°è¯´æ˜ï¼Œå¯ä»¥çœ‹å‡º<code>LSTMCell</code>ä¸­ä¸»è¦å¤šå¤„äº†ä¸€ä¸ª<code>çª¥è§†å­”</code>çš„åŠŸèƒ½ï¼Œå½“å‚æ•°<code>use_peepholes</code>è®¾ç½®ä¸º<code>True</code>æ—¶ï¼Œå°±ä½¿ç”¨äº†çª¥è§†å­”çš„åŠŸèƒ½ã€‚åç»­çš„å‡ ä¸ªå‚æ•°ä¹Ÿæ˜¯å¯¹çª¥è§†åŠŸèƒ½çš„è®¾ç½®å‚æ•°ã€‚ä¸‹é¢å¯¹å®ç°çš„<code>call</code>æ–¹æ³•è¿›è¡Œç®€è¦è¯´æ˜ï¼š</p><pre><code class="python">def call(self, inputs, state):    &quot;&quot;&quot;Run one step of LSTM.    Args:      inputs: input Tensor, 2D, `[batch, num_units].      state: if `state_is_tuple` is False, this must be a state Tensor, `2-D, [batch, state_size]`.  If `state_is_tuple` is True, this must be a tuple of state Tensors, both `2-D`, with column sizes `c_state` and `m_state`.    Returns:      A tuple containing:      - A `2-D, [batch, output_dim]`, Tensor representing the output of the LSTM after reading `inputs` when previous state was `state`.        Here output_dim is:           num_proj if num_proj was set, num_units otherwise.      - Tensor(s) representing the new state of LSTM after reading `inputs` when the previous state was `state`.  Same type and shape(s) as `state`.    Raises:      ValueError: If input size cannot be inferred from inputs via static shape inference.    &quot;&quot;&quot;    num_proj = self._num_units if self._num_proj is None else self._num_proj    sigmoid = math_ops.sigmoid    if self._state_is_tuple:      (c_prev, m_prev) = state    else:      c_prev = array_ops.slice(state, [0, 0], [-1, self._num_units])      m_prev = array_ops.slice(state, [0, self._num_units], [-1, num_proj])    input_size = inputs.get_shape().with_rank(2)[1]    if input_size.value is None:      raise ValueError(&quot;Could not infer input size from inputs.get_shape()[-1]&quot;)    # i = input_gate, j = new_input, f = forget_gate, o = output_gate    lstm_matrix = math_ops.matmul(        array_ops.concat([inputs, m_prev], 1), self._kernel)    lstm_matrix = nn_ops.bias_add(lstm_matrix, self._bias)    i, j, f, o = array_ops.split(        value=lstm_matrix, num_or_size_splits=4, axis=1)    # Diagonal connections    if self._use_peepholes:      c = (sigmoid(f + self._forget_bias + self._w_f_diag * c_prev) * c_prev +           sigmoid(i + self._w_i_diag * c_prev) * self._activation(j))      # sigmoid(f + self._forget_bias + self._w_f_diag * c_prev)ä¸ºæ–°çš„forgetè¾“å‡º,    # sigmoid(i + self._w_i_diag * c_prev) ä¸ºæ–°çš„input_gateè¾“å‡º    else:      c = (sigmoid(f + self._forget_bias) * c_prev + sigmoid(i) *           self._activation(j))    if self._cell_clip is not None:      # pylint: disable=invalid-unary-operand-type      c = clip_ops.clip_by_value(c, -self._cell_clip, self._cell_clip)      # pylint: enable=invalid-unary-operand-type    if self._use_peepholes:      m = sigmoid(o + self._w_o_diag * c) * self._activation(c)    else:      m = sigmoid(o) * self._activation(c)    if self._num_proj is not None:      m = math_ops.matmul(m, self._proj_kernel)      if self._proj_clip is not None:        # pylint: disable=invalid-unary-operand-type        m = clip_ops.clip_by_value(m, -self._proj_clip, self._proj_clip)        # pylint: enable=invalid-unary-operand-type    new_state = (LSTMStateTuple(c, m) if self._state_is_tuple else                 array_ops.concat([c, m], 1))    return m, new_state</code></pre><p>ä¸Šé¢<code>call</code>æ–¹æ³•å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œè¾“å‡ºçš„ç»´åº¦ä¸º<code>num_proj</code>(å¦‚æœè®¾ç½®äº†<code>num_proj</code>çš„å€¼)æˆ–<code>num_units</code>ã€‚å½“è®¡ç®—<code>c</code>çš„æ—¶å€™å–å†³äºæ˜¯å¦ä½¿ç”¨çª¥è§†å­”ï¼Œä½¿ç”¨çš„æ—¶å€™è®¡ç®—æ–¹å¼ä¼šä¸åŒ<code>sigmoid(f + self._forget_bias + self._w_f_diag * c_prev)</code>ä¸ºæ–°çš„<code>forget gate</code>è¾“å‡º(åŠ å…¥äº†çª¥è§†å­”<code>self._w_f_diag * c_prev</code>), <code>sigmoid(i + self._w_i_diag * c_prev)</code>ä¸ºæ–°çš„<code>input gate</code>è¾“å‡ºï¼Œç„¶åä¼šé™åˆ¶<code>c = clip_ops.clip_by_value(c, -self._cell_clip, self._cell_clip)</code>è¾“å‡ºã€‚å†è®¡ç®—<code>m</code>çš„æ—¶å€™ä¹Ÿä¼šå–å†³äºæ˜¯å¦ä½¿ç”¨çª¥è§†å­”ï¼Œå†å¯¹<code>m</code>çš„å€¼è¿›è¡Œé™å®šã€‚æœ€åè¾“å‡º<code>m</code>å’Œ<code>state</code>ã€‚</p><p>å½“å®šä¹‰å¥½äº†Cellåï¼Œåç»­å°±æ˜¯åŠ¨æ€æˆ–è€…é™æ€è®¡ç®—æ—¶é—´æ­¥ï¼Œæˆ–è€…å¤šå±‚çš„LSTMæ¨¡å‹ï¼Œå’ŒRNNç½‘ç»œä¸­çš„ä½¿ç”¨å°±æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œå°±ä¸å†è¯¦ç»†è¯´æ˜ã€‚</p><h2 id="5-Refrence"><a href="#5-Refrence" class="headerlink" title="5.Refrence"></a>5.Refrence</h2><p>(1).<a href="https://www.jiqizhixin.com/articles/2017-07-24-2" target="_blank" rel="noopener">LSTMå…¥é—¨å¿…è¯»ï¼šä»å…¥é—¨åŸºç¡€åˆ°å·¥ä½œæ–¹å¼è¯¦è§£</a></p><p>(2).<a href="http://blog.gdf.name/lstm-with-tensorflow/" target="_blank" rel="noopener">ä»Tensorflowä»£ç ä¸­ç†è§£LSTMç½‘ç»œ</a></p><p>(3).<a href="https://yugnaynehc.github.io/2017/01/03/understanding-lstm-networks/" target="_blank" rel="noopener">[è¯‘]ç†è§£LSTMç½‘ç»œ</a></p>]]></content>
    
    
    <categories>
      
      <category>deep learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>deep learning</tag>
      
      <tag>tensorflow</tag>
      
      <tag>RNN</tag>
      
      <tag>LSTM</tag>
      
      <tag>gate</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ -è¯¦è§£RNNç½‘ç»œåŠTensorFlowå®ç°</title>
    <link href="/2018/05/01/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E8%AF%A6%E8%A7%A3RNN%E7%BD%91%E7%BB%9C%E5%8F%8ATensorFlow%E5%AE%9E%E7%8E%B0/"/>
    <url>/2018/05/01/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E8%AF%A6%E8%A7%A3RNN%E7%BD%91%E7%BB%9C%E5%8F%8ATensorFlow%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="1-RNNæ˜¯ä»€ä¹ˆ"><a href="#1-RNNæ˜¯ä»€ä¹ˆ" class="headerlink" title="1.RNNæ˜¯ä»€ä¹ˆ"></a>1.RNNæ˜¯ä»€ä¹ˆ</h2><p>RNNåœ¨<a href="https://zh.wikipedia.org/zh-hans/%E9%80%92%E5%BD%92%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C" target="_blank" rel="noopener">ç»´åŸº</a>ä¸Šé¢æœ‰ä¸¤ç§å®šä¹‰ï¼Œä½†æ˜¯ä¸€èˆ¬é»˜è®¤çš„ä¸ºæ—¶é—´é€’å½’ç¥ç»ç½‘ç»œï¼Œå…¨ç§°ä¸º(<code>Recurrent Neural Network</code>ï¼Œç®€ç§°ä¸ºRNN)ã€‚RNNä¸»è¦è§£å†³åºåˆ—æ•°æ®çš„å¤„ç†ï¼Œå¦‚æ–‡æœ¬ï¼Œè¯­éŸ³ï¼Œè§†é¢‘ç­‰ã€‚å…¸å‹åº”ç”¨åœ¨è¯­è¨€æ¨¡å‹ä¸­ï¼Œæ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><pre><code class="tex">æˆ‘æ˜¨å¤©ä¸Šå­¦è¿Ÿåˆ°äº†ï¼Œè€å¸ˆæ‰¹è¯„äº†____ã€‚</code></pre><p>è®©æœºå™¨åœ¨ç©ºçš„åœ°æ–¹å¡«è¯ï¼Œè¿™å„¿å¡«å†™çš„è¯æœ€æœ‰å¯èƒ½æ˜¯â€æˆ‘â€ï¼Œä½†å¯¹äºè¿™æ ·çš„æ¨¡å‹é€šè¿‡ä»€ä¹ˆæ¥å®ç°å‘¢ï¼ŸRNNå°±æ˜¯å¾ˆå¥½çš„é€‰æ‹©ï¼Œå®ƒå¾ˆæ“…é•¿å¤„ç†åºåˆ—æ•°æ®ã€‚</p><p>ä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œæ˜¯å±‚ä¸å±‚ä¹‹é—´è¿›è¡Œè¿æ¥ï¼Œä½†æ˜¯æ¯å±‚ä¹‹é—´çš„ç¥ç»å…ƒæ˜¯æ²¡æœ‰è¿æ¥çš„ï¼ˆå‡è®¾å„ä¸ªæ•°æ®ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼‰ã€‚è€ŒRNNçš„ç»“æ„å°±æ˜¯å½“å‰å±‚çš„æ•°æ®å’Œä¹‹å‰çš„è¾“å‡ºä¹Ÿæœ‰å…³ç³»ï¼Œå³æ¯å±‚ä¹‹é—´çš„ç¥ç»å…ƒä¸å†æ˜¯æ— è¿æ¥ï¼Œè€Œæ˜¯æœ‰è¿æ¥çš„ã€‚åŸºæœ¬ç»“æ„å¯ä»¥é€šè¿‡ä¸‹é¢è¡¨ç¤ºï¼š</p><p><img src="%5Cuploads%5Crnn_struct.png" srcset="/img/loading.gif" alt="nn"> </p><p>ä¸Šé¢çš„ç»“æ„ä¸­éå¸¸æ¸…æ™°çš„è¡¨ç¤ºäº†layerçš„ç»“æ„ï¼Œä¸»è¦é’ˆå¯¹åºåˆ—å‹çš„æ•°æ®ï¼Œå„ä¸ªç¥ç»å…ƒä¹‹é—´å­˜åœ¨å…³è”ï¼Œæ¯ä¸ªæ—¶åˆ»çš„çŠ¶æ€ä¼šè¾“å…¥åˆ°åç»­çš„æ—¶åˆ»ä¸­ã€‚</p><h2 id="2-RNNç»“æ„"><a href="#2-RNNç»“æ„" class="headerlink" title="2.RNNç»“æ„"></a>2.RNNç»“æ„</h2><p>RNNçš„å¤§ä½“ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¹Ÿå¯ä»¥æ›´åŠ è¯¦ç»†çš„è¡¨ç¤ºï¼Œå¦‚ä¸‹å›¾ä¸­ï¼Œè¾“å…¥ï¼Œè¾“å‡ºï¼ŒçŠ¶æ€é¡¹ç­‰ã€‚å¦‚ä¸‹å›¾ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªå¾ªç¯ç»“æ„ï¼Œæ¯ä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€è¿›è¡Œäº†ä¸‹ä¸€æ—¶é—´ç‚¹è¾“å…¥ã€‚</p><p><img src="%5Cuploads%5Crnn_01.jpg" srcset="/img/loading.gif" alt="RNN01"> </p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œè¾“å…¥å•å…ƒï¼ˆ<code>input units</code>ï¼‰ä¸ºï¼š$x_{t-1}, x_t, x_{t+1}$ï¼Œè¾“å‡ºå•å…ƒï¼ˆ<code>output units</code>ï¼‰ä¸ºï¼š$o_{t-1}, o_t, o_{t+1}$ï¼Œéšè—å•å…ƒï¼ˆ<code>hidden units</code>ï¼‰ä¸ºï¼š$s_{t-1}, s_t, s_{t+1}$ã€‚</p><p>åœ¨æŸä¸ªæ—¶åˆ»çš„éšå±‚å•å…ƒçš„è¾“å‡ºï¼š$s_t=f(Ws_{t-1}+Ux_t)$ ï¼Œå…¶ä¸­$f$å‡½æ•°ä¸ºæ¿€æ´»å‡½æ•°ï¼Œä¸€èˆ¬ä¸º<code>sigmoid,tanh,relu</code>ç­‰å‡½æ•°ã€‚åœ¨è®¡ç®—$s_0$æ—¶éœ€è¦å‰é¢çš„çŠ¶æ€ï¼Œä½†æ˜¯å¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä¸€èˆ¬è®¾ç½®ä¸º0å‘é‡ã€‚</p><p>æŸä¸ªæ—¶åˆ»$t$çš„è¾“å‡ºä¸ºï¼š$o_t=softmax(Vs_t)=softmax(V(f(Ws_{t-1}+Ux_t)))$ï¼Œå…¶ä¸­$s_t$ä¸ºæ—¶åˆ»$t$çš„è®°å¿†å•å…ƒã€‚$s_t$åŒ…å«äº†å‰é¢æ‰€æœ‰æ­¥çš„è®°å¿†ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œ$s_t$åªä¼šåŒ…å«å‰é¢è‹¥å¹²æ­¥çš„è®°å¿†ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ­¥ã€‚</p><p>RNNä¸­ï¼Œæ¯è¾“å…¥ä¸€æ­¥ï¼Œæ¯ä¸€å±‚éƒ½å…±äº«å‚æ•°$U,V,W$ï¼ŒRNNä¸­ä¸»è¦åœ¨äºéšè—å±‚ï¼Œåœ¨éšè—å±‚èƒ½å¤Ÿæ•æ‰åˆ°åºåˆ—çš„å…³é”®ä¿¡æ¯ã€‚</p><a id="more"></a><h2 id="3-RNNçš„æ³›åŒ–ç»“æ„"><a href="#3-RNNçš„æ³›åŒ–ç»“æ„" class="headerlink" title="3.RNNçš„æ³›åŒ–ç»“æ„"></a>3.RNNçš„æ³›åŒ–ç»“æ„</h2><p>RNNçš„å˜ä½“æœ‰å¾ˆå¤šï¼Œå¦‚åŒå‘RNNï¼Œå¤šå±‚åŒå‘RNNï¼Œå¤šå¯¹å¤šçš„RNNï¼Œä¸€å¯¹å¤šçš„RNNç­‰ç­‰ã€‚ä¸‹é¢å¯¹å„ç§ç»“æ„è¿›è¡Œå±•ç¤ºï¼Œå¹¶å¯¹è¿™äº›ç»“æ„è¿›è¡Œç®€è¦è¯´æ˜ã€‚</p><h3 id="3-1-ä¸€å¯¹ä¸€"><a href="#3-1-ä¸€å¯¹ä¸€" class="headerlink" title="3.1 ä¸€å¯¹ä¸€"></a>3.1 ä¸€å¯¹ä¸€</h3><p>å³ä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºçš„ç»“æ„ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ç»“æ„ã€‚</p><h3 id="3-2-å¤šå¯¹ä¸€çš„ç»“æ„"><a href="#3-2-å¤šå¯¹ä¸€çš„ç»“æ„" class="headerlink" title="3.2 å¤šå¯¹ä¸€çš„ç»“æ„"></a>3.2 å¤šå¯¹ä¸€çš„ç»“æ„</h3><p><img src="%5Cuploads%5CRNN_02.png" srcset="/img/loading.gif" alt="Many to one"> </p><p>å¤šä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡ºï¼Œæ¯”å¦‚æƒ…æ„Ÿåˆ†æã€‚å¦‚ä¸€æ®µè¯ï¼Œåˆ¤æ–­è¿™æ®µè¯çš„æƒ…æ„Ÿã€‚å…¶ä¸­ï¼Œ$x_1, x_2, â€¦, x_{t-1}, x_t$è¡¨ç¤ºå¥å­ä¸­çš„$t$ä¸ªè¯è¯­ï¼Œ$o$è¡¨ç¤ºæœ€ç»ˆçš„æƒ…æ„Ÿè¾“å‡ºæ ‡ç­¾ã€‚</p><h3 id="3-3-ä¸€å¯¹å¤šçš„ç»“æ„"><a href="#3-3-ä¸€å¯¹å¤šçš„ç»“æ„" class="headerlink" title="3.3 ä¸€å¯¹å¤šçš„ç»“æ„"></a>3.3 ä¸€å¯¹å¤šçš„ç»“æ„</h3><p><img src="%5Cuploads%5CRNN_03.png" srcset="/img/loading.gif" alt="One to Many"> </p><p>è¿™ä¸ªç»“æ„å’Œ3.2ä¸­çš„å¤šå¯¹ä¸€çš„ç»“æ„ç±»ä¼¼ã€‚</p><h3 id="3-4-å¤šå¯¹å¤šç»“æ„"><a href="#3-4-å¤šå¯¹å¤šç»“æ„" class="headerlink" title="3.4 å¤šå¯¹å¤šç»“æ„"></a>3.4 å¤šå¯¹å¤šç»“æ„</h3><p><img src="%5Cuploads%5CRNN_04.png" srcset="/img/loading.gif" alt="Many to Many"> </p><h3 id="3-5-åŒå‘RNN"><a href="#3-5-åŒå‘RNN" class="headerlink" title="3.5 åŒå‘RNN"></a>3.5 åŒå‘RNN</h3><p>å‰é¢çš„ç»“æ„å‡ä¸ºå•å‘çš„RNNï¼Œ$s_t$éƒ½åªæ˜¯è®°å½•äº†ä¹‹å‰çš„ä¿¡æ¯ï¼Œæœªè€ƒè™‘åé¢çš„ä¿¡æ¯ã€‚åŸºäºè¿™ç§æƒ…å†µï¼Œäºæ˜¯å‡ºç°äº†åŒå‘RNNï¼Œè¿™ç§ç»“æ„å¯ä»¥ç”¨åˆ°æœºå™¨ç¿»è¯‘ï¼Œéœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡çš„æƒ…å†µï¼Œç»™å‡ºç¿»è¯‘ç»“æœã€‚</p><p><img src="%5Cuploads%5CRNN_05.png" srcset="/img/loading.gif" alt="RNN"> </p><p>åŒå‘RNNçš„ç»“æ„è¦å¤æ‚ä¸€äº›ï¼Œå¦‚å‰å‘è®¡ç®—ï¼š<br>$$<br>o_t=w^{os}<em>ts_t+w^{oh}_th_t=w^{os}_t(w</em>{t-1}^{sh}s_{t-1}+w_{t-1}^{sx}x_{t})+w^{oh}<em>t(w</em>{t}^{hx}s_{t+1}+w_{t}^{hh}x_{t})<br>$$</p><h3 id="3-6-å¤šå±‚RNN"><a href="#3-6-å¤šå±‚RNN" class="headerlink" title="3.6 å¤šå±‚RNN"></a>3.6 å¤šå±‚RNN</h3><p>å‰é¢çš„ç»“æ„ä¸­å¤šåªæ˜¯å•å±‚çš„stateå½¢å¼RNNï¼Œæ·±åº¦ç½‘ç»œè‚¯å®šæ˜¯æ·±å±‚æ¬¡ç»“æ„ä¼šæœ‰æ›´å¥½çš„æ•ˆæœã€‚å› æ­¤å¯ä»¥æ˜¯å¤šå±‚çš„RNNï¼Œå¤šå±‚æ¬¡çš„RNNç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="%5Cuploads%5CRNN_06.png" srcset="/img/loading.gif" alt="Ã¦Â·Â±Ã¥Â±Â‚Ã§ÂšÂ„RNN"> </p><h2 id="4-Back-Propagation-Through-Time-BPTT-è®­ç»ƒ"><a href="#4-Back-Propagation-Through-Time-BPTT-è®­ç»ƒ" class="headerlink" title="4.Back Propagation Through Time(BPTT)è®­ç»ƒ"></a>4.Back Propagation Through Time(BPTT)è®­ç»ƒ</h2><h3 id="4-1-ç¬¦å·è¯´æ˜"><a href="#4-1-ç¬¦å·è¯´æ˜" class="headerlink" title="4.1 ç¬¦å·è¯´æ˜"></a>4.1 ç¬¦å·è¯´æ˜</h3><p>ç°åœ¨æ ¹æ®ä¸Šé¢çš„1å¯¹1ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯´æ˜åå‘ä¼ æ’­è¿‡ç¨‹ã€‚åœ¨æ•´ä¸ªæ¨¡å‹è¿‡ç¨‹ä¸­æœ‰éƒ¨åˆ†æ¿€åŠ±å‡½æ•°æ¥å¯¹èŠ‚ç‚¹è¿›è¡Œè®¡ç®—ï¼š</p><p><img src="http://lawlite.me/assets/blog_images/RNN/RNN_09.png" srcset="/img/loading.gif" alt="RNNÃ¥ÂŸÂºÃ¦ÂœÂ¬Ã§Â»Â“Ã¦ÂÂ„"> </p><p>$\phi$ ï¼šéšè—å±‚çš„æ¿€æ´»å‡½æ•°</p><p>$\varphi$ ï¼šè¾“å‡ºå±‚çš„å˜æ¢å‡½æ•°</p><p>$L_t=L_t(o_t, y_t)$ï¼šæ¨¡å‹çš„æŸå¤±å‡½æ•°</p><p>å…¶ä¸­$y_t$ä¸ºä¸€ä¸ªone-hotå‘é‡ã€‚</p><h3 id="4-2-åå‘ä¼ æ’­è¿‡ç¨‹"><a href="#4-2-åå‘ä¼ æ’­è¿‡ç¨‹" class="headerlink" title="4.2 åå‘ä¼ æ’­è¿‡ç¨‹"></a>4.2 åå‘ä¼ æ’­è¿‡ç¨‹</h3><p>ä¸Šé¢çš„æŸå¤±å‡½æ•°åªæ˜¯è®¡ç®—äº†æŸä¸ªæ—¶åˆ»çš„æŸå¤±ï¼Œå½“æ¥å—å®Œåºåˆ—åï¼Œå†ç»Ÿä¸€è®¡ç®—æŸå¤±ï¼Œæ­¤æ—¶æ¨¡å‹çš„æ€»æŸå¤±ä¸ºï¼ˆå‡è®¾è¾“å…¥åºåˆ—çš„é•¿åº¦ä¸º$n$æ—¶ï¼‰ï¼š<br>$$<br>L=\sum_{t=1}^n{L_t}<br>$$<br>ä¸‹é¢å¯¹æ•´ä¸ªç»“æ„ç»†åŒ–åï¼š</p><p><img src="http://lawlite.me/assets/blog_images/RNN/RNN_10.png" srcset="/img/loading.gif" alt="RNN"> </p><p>$o_t=\varphi(Vs_t)=\varphi(V(Ux_t+ws_{t-1}))$</p><p>å…¶ä¸­$s_0=(0, 0, 0, â€¦â€¦, 0)^T$</p><p>ä»¤ï¼š$o_t^=Vs_t$ï¼Œ$s_t^=Us_t+ws_{t-1}$ï¼Œå³å°±æ˜¯æ²¡æœ‰ç»è¿‡æ¿€åŠ±å‡½æ•°å’Œå˜æ¢å‡½æ•°å‰ ï¼Œåˆ™æœ‰ï¼š$o_t=\varphi(o_t^), s_t=\phi(s_t^)$</p><h4 id="4-2-1-çŸ©é˜µVçš„æ›´æ–°"><a href="#4-2-1-çŸ©é˜µVçš„æ›´æ–°" class="headerlink" title="4.2.1 çŸ©é˜µVçš„æ›´æ–°"></a>4.2.1 çŸ©é˜µVçš„æ›´æ–°</h4><p>å¯¹äºVçš„æ›´æ–°å’Œä¼ ç»Ÿçš„ç¥ç»ç½‘ç»œæ›´æ–°æ–¹å¼ä¸€è‡´ï¼Œä¸»è¦é€šè¿‡é“¾å¼æ³•åˆ™æ¥è¿›è¡Œæ±‚å¯¼ï¼š<br>$$<br>\frac{\partial{L_t}}{\partial{s_t^,}}=\frac{\partial{L_t}}{\partial{Vs_t}}\times\frac{\partial{V^Ts^T}}{\partial{s_t}}\times\frac{\partial{s_t}}{\partial{s_t^,}}=V^T(\frac{\partial{L_t}}{\partial{o_t}}\varphiâ€™(o_t^,))\<br>\frac{\partial{L_t}}{\partial{s_{k-1}^,}}=\frac{\partial{L_t}}{\partial{s_{k}^,}}\times\frac{\partial{s_k^,}}{\partial{s_{k-1}^,}}=W^T\times(\frac{\partial{L_t}}{\partial{s_{k}^,}}\varphiâ€™(s_{k-1}^,)), k=1,2,3,4,â€¦â€¦,t<br>$$<br>å› ä¸º$L=\sum_{t=1}^n{L_t}$ï¼Œæ‰€ä»¥å¯¹åº”çŸ©é˜µVçš„æ›´æ–°å¯¼æ•°ä¸ºï¼š<br>$$<br>\frac{\partial{L}}{\partial{V}}=\sum_{t=1}^n(\frac{\partial{L_t}}{\partial{o_t}}{\varphi}â€™(o_t))\times{s_t^T}<br>$$</p><h4 id="4-2-2-çŸ©é˜µUå’ŒWçš„æ›´æ–°"><a href="#4-2-2-çŸ©é˜µUå’ŒWçš„æ›´æ–°" class="headerlink" title="4.2.2 çŸ©é˜µUå’ŒWçš„æ›´æ–°"></a>4.2.2 çŸ©é˜µUå’ŒWçš„æ›´æ–°</h4><p>å› ä¸ºRNNå’ŒBPç½‘ç»œä¸åŒçš„æ˜¯å„ä¸ªç¥ç»å…ƒä¹‹é—´(state)å­˜åœ¨é€šä¿¡ï¼Œå› æ­¤å†è®¡ç®—æ¢¯åº¦çš„æ—¶å€™å’ŒBPç½‘ç»œè®¡ç®—æ¢¯åº¦æœ‰ä¸€å®šçš„å·®å¼‚ã€‚å¯ä»¥é€šè¿‡å¾ªç¯æ¥è®¡ç®—å„ä¸ªæ¢¯åº¦ï¼Œæ—¶é—´tä»nåˆ°1è¿›è¡Œå¾ªç¯ã€‚</p><p>é¦–å…ˆè®¡ç®—æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ¢¯åº¦ï¼š<br>$$<br>\frac{\partial{L_t}}{\partial{s_t^,}}=\frac{\partial{L_t}}{\partial{Vs_t}}\times\frac{\partial{V^Ts^T}}{\partial{s_t}}\times\frac{\partial{s_t}}{\partial{s_t^,}}=V^T(\frac{\partial{L_t}}{\partial{o_t}}\varphiâ€™(o_t^,))\<br>\frac{\partial{L_t}}{\partial{s_{k-1}^,}}=\frac{\partial{L_t}}{\partial{s_{k}^,}}\times\frac{\partial{s_k^,}}{\partial{s_{k-1}^,}}=W^T\times(\frac{\partial{L_t}}{\partial{s_{k}^,}}varphiâ€™(s_{k-1}^,)), k=1,2,3,4,â€¦â€¦,t<br>$$<br>åˆ©ç”¨å·¨è¡¥æ¢¯åº¦è®¡ç®—Uå’ŒWçš„æ¢¯åº¦ï¼š<br>$$<br>\frac{\partial{L_t}}{\partial{U}}+=\sum_{k=1}^t\frac{\partial{L_t}}{\partial{s_k^,}}\times\frac{\partial{s_k^,}}{\partial{U}}=\sum_{k=1}^t\frac{\partial{L_t}}{\partial{s_k^,}}\times{x_t^T}\<br>\frac{\partial{L_t}}{\partial{W}}+=\sum_{k=1}^t\frac{\partial{L_t}}{\partial{s_k^,}}\times\frac{\partial{s_k^,}}{\partial{W}}=\sum_{k=1}^t\frac{\partial{L_t}}{\partial{s_k^,}}\times{s_{t-1}^T}<br>$$</p><h3 id="4-3-è®­ç»ƒé—®é¢˜"><a href="#4-3-è®­ç»ƒé—®é¢˜" class="headerlink" title="4.3 è®­ç»ƒé—®é¢˜"></a>4.3 è®­ç»ƒé—®é¢˜</h3><p>ä»ä¸Šé¢çš„å‚æ•°æ›´æ–°å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ›´æ–°æƒé‡æ—¶éƒ½éœ€è¦è®¡ç®—ä¸€ä¸ªæ¿€æ´»å‡½æ•°çš„å€’æ•°ï¼Œå¦‚æœæ—¶é—´é•¿åº¦è¾ƒé•¿æ—¶ï¼Œè€Œæ¢¯åº¦æ—¶ç´¯ç§¯çš„ï¼Œå› æ­¤ä¼šé€ æˆåº¦æ¶ˆå¤±æˆ–æ¢¯åº¦çˆ†ç‚¸</p><p>RNNçš„ä½œç”¨ä¸»è¦æ˜¯å­˜åœ¨è®°å¿†çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ¢¯åº¦é—®é¢˜åˆååº”å‡ºäº†ä¸èƒ½ä½¿ç”¨å¤ªé•¿çš„æ—¶é—´é•¿åº¦ï¼Œå³ä¸èƒ½è®°å¿†å¤ªä¹…çš„ä¿¡æ¯ï¼Œè¿™æ ·å°±å­˜åœ¨ä¸€å®šçŸ›ç›¾ï¼Œæ”¹è¿›çš„æ€è·¯ä¸»è¦æœ‰ï¼š</p><ol><li>ä½¿ç”¨ä¸€äº›trickï¼Œæ¯”å¦‚åˆé€‚çš„åŠ±å‡½æ•°ä¸ä½¿ç”¨tanh, sigmodç­‰å‡½æ•°ï¼Œä½¿ç”¨reluç±»ä¼¼çš„)ï¼Œåˆå§‹åŒ–ï¼ŒBNç­‰</li><li>æ”¹è¿›RNNä¸­tateçš„ä¼ é€’æ–¹å¼æ¯”å¦‚RNNçš„å‡çº§ç‰ˆæœ¬LSTMæ¨¡å‹ã€‚</li></ol><h2 id="5-RNNç»“æ„è¯¦è§£"><a href="#5-RNNç»“æ„è¯¦è§£" class="headerlink" title="5. RNNç»“æ„è¯¦è§£"></a>5. RNNç»“æ„è¯¦è§£</h2><p><img src="/uploads/RNNs%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3%E5%9B%BE.png" srcset="/img/loading.gif" alt="RNNç»“æ„è¯¦è§£"></p><h2 id="6-RNNåŸºäºmnistçš„å®ç°"><a href="#6-RNNåŸºäºmnistçš„å®ç°" class="headerlink" title="6. RNNåŸºäºmnistçš„å®ç°"></a>6. RNNåŸºäºmnistçš„å®ç°</h2><p>åŸºäºmnistæ•°æ®å®ç°RNNæ¨¡å‹ï¼Œå¯¹ç»“æœçš„é¢„æµ‹ã€‚mnistçš„å›¾ç‰‡ä¸º2828çš„çŸ©é˜µï¼Œå› æ­¤åœ¨RNNè¾“å…¥æ—¶ï¼š<code>time_step=28</code>ï¼Œ<code>depth=28</code>ï¼Œç›®æ ‡åºåˆ—çš„é•¿åº¦ä¸º10ï¼ŒRNNç§çš„éšè—ç¥ç»å…ƒä¸ªæ•°åœ¨æœ¬å®ä¾‹ä¸­å®šä¹‰ä¸º128ï¼Œå³ï¼š<code>state_size=128</code>ã€‚</p><pre><code class="python">&quot;&quot;&quot;Recurrent Neural Network. A Recurrent Neural Network (RNN) implementation example using TensorFlow library.&quot;&quot;&quot;from __future__ import division, print_functionfrom tensorflow.examples.tutorials.mnist import input_dataimport tensorflow as tfimport osos.environ[&#39;TF_MIN_GPU_MULTIPROCESSOR_COUNT&#39;] = &#39;2&#39;mnist = input_data.read_data_sets(&#39;/opt/workspace/project/deep-st-nn/data/MNIST_DATA&#39;, one_hot=True)# defined train parameterslearning_rate = 0.02train_step = 10000batch_size = 100# defined network parameterstime_steps = 28  # the mnist image size 28  28depth = 28  # singe input vector length: depthhidden_num = 128  # state_sizenum_classes = 10  # mnist total class# graph inputswith tf.name_scope(&quot;inputs&quot;):    X = tf.placeholder(tf.float32, shape=(None, time_steps, depth), name=&quot;X&quot;)    Y = tf.placeholder(tf.float32, shape=(None, num_classes), name=&quot;Y&quot;)    with tf.name_scope(&quot;variables&quot;), tf.device(&quot;/cpu:0&quot;):        # defined variables        weights = {&quot;out&quot;: tf.Variable(tf.random_normal((hidden_num, num_classes)), trainable=True,                                      name=&quot;out_weights&quot;)}        bias = {&quot;out&quot;: tf.Variable(tf.random_normal([num_classes]),                                   name=&quot;out_bias&quot;)}def rnn_model(x, weights_, bias_):    &quot;&quot;&quot;    parameters    ----------        x: tensor, model inputs, shape is [batch_size, time_steps, depth]        weights_: dict variable, the output transform parameter, shape is [state_size, output_length or class_num]        bias_: dict variable, the output transform bias, shape is [output_length or class_num]    return    ------        tensor, model output, the shape is [batch_size, class_num]    &quot;&quot;&quot;    # inputs_ = tf.unstack(x, axis=1)  # to list [batch_size, depth]    cell = tf.nn.rnn_cell.BasicLSTMCell(hidden_num, forget_bias=1.0)    # cell = tf.nn.rnn_cell.BasicRNNCell(hidden_num)    outputs, states = tf.nn.dynamic_rnn(cell, x, dtype=tf.float32,                                        initial_state=cell.zero_state(batch_size=batch_size, dtype=tf.float32))    outputs = tf.unstack(outputs, axis=1)    return tf.matmul(outputs[-1], weights_.get(&quot;out&quot;)) + bias_.get(&quot;out&quot;)def mul_rnn_model(x, weights_, bias_):    &quot;&quot;&quot;    parameters    ----------        x: tensor, model inputs, shape is [batch_size, time_steps, depth]        weights_: dict variable, the output transform parameter, shape is [state_size, output_length or class_num]        bias_: dict variable, the output transform bias, shape is [output_length or class_num]    return    ------        tensor, model output, the shape is [batch_size, class_num]    &quot;&quot;&quot;    with tf.name_scope(&quot;hidden&quot;):        mul_cell = tf.nn.rnn_cell.MultiRNNCell([tf.nn.rnn_cell.BasicRNNCell(hidden_num) for _ in range(3)])        # dropout wrapper        dropper_cell = tf.nn.rnn_cell.DropoutWrapper(mul_cell, output_keep_prob=1, state_keep_prob=0.7)        outputs, states = tf.nn.dynamic_rnn(dropper_cell, x, dtype=tf.float32)        outputs = tf.unstack(outputs, axis=1)        # tf.summary.histogram(&quot;hidden_last_ouput&quot;, outputs[-1])        return tf.matmul(outputs[-1], weights_.get(&quot;out&quot;)) + bias_.get(&quot;out&quot;)with tf.name_scope(&quot;loss&quot;):    with tf.device(&quot;/gpu:1&quot;):        logits = mul_rnn_model(X, weights, bias)  # rnn_model(X, weights, bias)        prediction = tf.nn.softmax(logits)        loss_op = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=logits, labels=Y))with tf.name_scope(&quot;train&quot;):    with tf.device(&quot;/gpu:0&quot;):        optimizer = tf.train.GradientDescentOptimizer(learning_rate=learning_rate)        train_op = optimizer.minimize(loss_op)correct_predict = tf.equal(tf.argmax(prediction, axis=1), tf.argmax(Y, axis=1))accuracy = tf.reduce_mean(tf.cast(correct_predict, tf.float32))tf.summary.scalar(&quot;loss&quot;, loss_op)tf.summary.scalar(&quot;acc&quot;, accuracy)tf.summary.histogram(&quot;weight_out&quot;, weights.get(&quot;out&quot;))tf.summary.histogram(&quot;bias_out&quot;, bias.get(&quot;out&quot;))merged = tf.summary.merge_all()init_variable = tf.global_variables_initializer()# starting train# config = tf.ConfigProto(allow_soft_placement=True)with tf.Session() as sess:    sess.run(init_variable)    writer = tf.summary.FileWriter(&quot;.&quot; + &#39;/rnn&#39;, sess.graph)    for step in range(1, train_step+1):        batch_x, batch_y = mnist.train.next_batch(batch_size)        batch_x = batch_x.reshape((batch_size, time_steps, depth))        sess.run(train_op, feed_dict={X: batch_x, Y: batch_y})        if step % 100 == 0:            loss, acc = sess.run([loss_op, accuracy], feed_dict={X: batch_x, Y: batch_y})            print(&quot;The step: %d; Minibatch loss: %f; Train accuracy: %f&quot; % (step, loss, acc))        res = sess.run(merged, feed_dict={X: batch_x, Y: batch_y})        writer.add_summary(res, global_step=step)    print(&quot;Optimization Finished!&quot;)    # test model    test_len = 100    test_datas = mnist.test.images[:test_len].reshape((-1, time_steps, depth))    test_lable = mnist.test.labels[:test_len]    print(&quot;Test accuracy: %f&quot; % (sess.run(accuracy, feed_dict={X: test_datas, Y: test_lable})))</code></pre><h2 id="7-TensorFlowä¸­RNNçš„å®ç°"><a href="#7-TensorFlowä¸­RNNçš„å®ç°" class="headerlink" title="7.TensorFlowä¸­RNNçš„å®ç°"></a>7.TensorFlowä¸­RNNçš„å®ç°</h2><p>åœ¨TensorFlowä¸­å¯¹RNNæ¨¡å‹è¿›è¡Œäº†åŸºæœ¬å®ç°ï¼Œä¸‹é¢å¯¹tensorflowä¸­çš„å®ç°ç»†èŠ‚è¿›è¡Œè¯´æ˜ï¼Œä¸»è¦åŒ…æ‹¬cell`çš„å®ç°ç¯(å¤šæ­¥æ‰§è¡Œ)å®ç°ï¼Œä»¥åŠå¤šå±‚rnnçš„å®ç°ã€‚å¹¶å¯¹cellä¸­çš„è¾“å…¥ï¼Œè¾“å‡ºè¿›è¡Œè¯¦è§£ã€‚</p><p>RNNæ¨¡å‹ä¸­çš„åŸºæœ¬<code>cell</code>ä¸»è¦é€šè¿‡<code>tf.nn.rnn_cell.RNNCell</code>, <code>tf.nn.rnn_cell.BasicRNNCell</code> ,<code>tf.nn.rnn_cell.BasicLSTMCell</code>ä¸‰ä¸ªæ¨¡å—å®ç°ï¼Œåé¢ä¸¤ä¸ªcellæ¨¡å‹å°±æ˜¯åŸºäºå‰é¢æ¨¡å—çš„å®ç°ï¼Œ<code>RNNCell</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»(<code>abstract class</code>)ã€‚ä¸»è¦éœ€è¦å®ç°<code>state_size</code>ï¼Œ<code>output_size</code>ï¼Œ<code>build</code>ç­‰æ–¹æ³•ã€‚ä¸‹é¢ä»RNNä¸­æœ€åŸºæœ¬çš„cellå¼€å§‹ã€‚</p><h3 id="7-1-å•æ­¥RNNï¼šRNNCell"><a href="#7-1-å•æ­¥RNNï¼šRNNCell" class="headerlink" title="7.1 å•æ­¥RNNï¼šRNNCell"></a>7.1 å•æ­¥RNNï¼šRNNCell</h3><p>RNNCellæ˜¯RNNæ¨¡å‹ä¸­çš„åŸºæœ¬å•å…ƒï¼Œè¿™ä¸ªcellå°±æ˜¯ä¸Šå›¾ä¸­çš„ä¸€ä¸ªé•¿æ–¹å½¢æ¨¡å—ï¼Œä¹Ÿæ˜¯tensorflowä¸­å®ç°RNNçš„åŸºæœ¬å•å…ƒï¼Œæ¯ä¸ªRNNCelléƒ½æœ‰ä¸€ä¸ª<code>call</code>æ–¹æ³•ä»¥åŠ<code>__call__</code>æ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼ï¼š<code>output, next_state = call(inputs, state)</code>ï¼Œè°ƒç”¨ä¸€æ¬¡<code>call</code>æ–¹æ³•å°±ä¼šè®¡ç®—å½“å‰æ—¶é—´æ­¥çš„è¾“å‡ºå’ŒçŠ¶æ€ä¸¤ä¸ªå€¼ï¼Œè°ƒç”¨ä¸€æ¬¡<code>RNNCell.call</code>æ–¹æ³•ç›¸å½“äºåœ¨æ—¶é—´è½´ä¸Šæ¨è¿›äº†ä¸€æ­¥ã€‚ä¸Šé¢è¯´äº†<code>BasicRNNCell</code> å’Œ<code>BasicLSTMCell</code>æ˜¯åŸºäº<code>RNNCell</code>æŠ½è±¡ç±»çš„å®ç°ï¼Œå› æ­¤ä¸€èˆ¬åœ¨ä½¿ç”¨æ—¶éƒ½åªæ˜¯ä½¿ç”¨åé¢ä¸¤ä¸ªcellã€‚é¦–å…ˆç”¨ä»£ç æµ‹è¯•cellï¼š</p><pre><code class="python">import osimport tensorflow as tfimport numpy as npos.environ[&#39;TF_MIN_GPU_MULTIPROCESSOR_COUNT&#39;] = &#39;2&#39;cell = tf.nn.rnn_cell.BasicRNNCell(12, reuse=True)  # defined rnn cell, the parameter num_units(hidden_units_num or state_size)state_size = cell.state_size  # the state size in rnn modelprint(&quot;The rnn model state size is %d.&quot; % state_size)  # 12rnn_inputs = tf.placeholder(tf.float32, shape=(100, 10), name=&quot;rnn_inputs_x&quot;)  # 10 is vector depthinputs = rnn_inputsh0 = cell.zero_state(100, tf.float32)  # size: 100, 12out1, h1 = cell(inputs, h0)  # inputs size is (batch_size, depth)print(&quot;The state size:&quot;, h1.shape)# ------------------output----------------------------#The rnn model state size is 12.The state size: (100, 12) The output size: (100, 12)The state shape: (100, 12)</code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªåŸºæœ¬çš„<code>RNNCell</code>ï¼Œä¼ å…¥äº†ä¸€ä¸ªå‚æ•°<code>num_units=12</code>ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å®šä¹‰<code>cell</code>ä¸­çš„éšè—å•å…ƒçš„æ•°é‡ï¼Œå³ä¸Šå›¾ä¸­çš„<code>state_size</code>å¤§å°ï¼Œè€Œå¦å¤–ä¸€ä¸ªå‚æ•°<code>reuse=True</code>ä¸»è¦æ˜¯è§‰å¾—cellçš„å‚æ•°æ˜¯å¦å…±äº«ã€‚<code>state size</code>å¯ä»¥é€šè¿‡cellçš„<code>state_size</code>æ¥è·å–ã€‚ä»ä¸Šé¢çš„ç¨‹åºä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºæ˜¯å’Œè¾“å…¥çš„``num_units`å€¼ç›¸åŒã€‚</p><p><code>state</code>çš„åˆå§‹åŒ–ï¼Œåœ¨å‰é¢ä¹Ÿè¯´è¿‡ï¼Œå½“åœ¨ç¬¬ä¸€ä¸ªæ—¶åˆ»æ—¶ï¼ŒçŠ¶æ€é€šè¿‡0æ¥åˆå§‹åŒ–ä¸€ä¸ª<code>h0(state)</code>æ¥è¾“å…¥åˆ°ç¬¬ä¸€ä¸ªæ—¶åˆ»ï¼Œcellä¸­ä¹Ÿæä¾›äº†åˆå§‹åŒ–çš„æ–¹æ³•<code>zero_state(batch_size, dtype)</code>ï¼Œåˆå§‹åŒ–å<code>h0</code>çš„<code>shape</code>æ˜¯<code>(batch_size, state_size)</code>ã€‚</p><p><code>RNNCell</code>çš„<code>call</code>æ–¹æ³•ä¸»è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°<code>inputs and state</code>ï¼Œå‚æ•°<code>inputs</code>ä¸»è¦æ˜¯æŸæ—¶åˆ»çš„è¾“å…¥å€¼ï¼Œ<code>shape</code>æ˜¯<code>(batch_size, depth)</code>ï¼Œè¿™å„¿çš„<code>depth</code>å°±æ˜¯ä¸Šé¢å›¾ä¸­çš„<code>k</code>å€¼ã€‚å‚æ•°<code>state</code>å°±æ˜¯é€šè¿‡<code>cell</code>çš„æ–¹æ³•<code>zero_state(batch_size, dtype</code>ç”Ÿæˆçš„<code>state</code>ã€‚è°ƒç”¨<code>call</code>åè¿”å›<code>output, state</code>ï¼Œå®ƒä»¬çš„sizeéƒ½æ˜¯<code>(batch_size, state_size)</code>.</p><p>ä¸‹é¢çœ‹ä¸‹<code>RNNCell</code>çš„<code>call</code>æ–¹æ³•æºç ï¼š</p><pre><code class="python">def call(self, inputs, state):    gate_inputs = math_ops.matmul(array_ops.concat([inputs, state], 1), self._kernel)    # _kernel shape: (depth+state_size, state_size)    gate_inputs = nn_ops.bias_add(gate_inputs, self._bias)  # _bias size: state_size    output = self._activation(gate_inputs)  # default `tanh` function    return output, output</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨å®ç°è¿‡ç¨‹ä¸­å®é™…ä¸Šæ˜¯å¯¹<code>inputs</code>å’Œ<code>state</code>è¿›è¡Œäº†<code>concat</code>ï¼Œå½¢æˆäº†<code>(batch_size, depth+state_size)</code>å¤§å°çš„tensorã€‚ç„¶åå†å’Œå‚æ•°è¿›è¡Œä¹˜ç§¯è¿ç®—(_kernelçš„sizeæ˜¯<code>(depth+state_size, state_size)</code>)ï¼Œå†åŠ ä¸Šäº†ä¸€ä¸ªbias(sizeæ˜¯ï¼š<code>(state_size)</code>)ã€‚å†é€šè¿‡æ¿€æ´»å‡½æ•°è¿ç®—ï¼Œå†æ²¡æœ‰ç»™å®šæ¿€æ´»å‡½æ•°æƒ…å†µä¸‹ï¼Œtensorflowé»˜è®¤ä½¿ç”¨çš„æ˜¯<code>tanh</code>ã€‚</p><p>ä¸Šé¢æ•´ä¸ªè¿‡ç¨‹å•æ­¥çš„RNNCellå°±è¿ç®—ç»“æŸäº†ã€‚ä¸‹é¢è¿›è¡Œå¤šéƒ¨RNNCellè®¡ç®—ã€‚</p><h3 id="7-2-å¾ªç¯èµ·æ¥ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ­¥RNNCell"><a href="#7-2-å¾ªç¯èµ·æ¥ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ­¥RNNCell" class="headerlink" title="7.2 å¾ªç¯èµ·æ¥ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ­¥RNNCell"></a>7.2 å¾ªç¯èµ·æ¥ï¼šä¸€æ¬¡æ‰§è¡Œå¤šæ­¥RNNCell</h3><p>å•æ­¥RNNCellåªèƒ½è®¡ç®—ä¸€ä¸ªæ­¥éª¤ï¼Œå¦‚æœåºåˆ—é•¿åº¦ä¸º100ï¼Œé‚£ä¹ˆå°±éœ€è¦å¾ªç¯è°ƒç”¨100æ¬¡çš„RNNCellï¼Œå¦‚x1ï¼Œh0å¾—åˆ°o1ï¼Œh1ï¼›x2ï¼Œh1å¾—åˆ°o2ï¼Œh2ï¼›x3ï¼Œh2å¾—åˆ°o3ï¼Œh3ï¼Œè¿™æ ·ä¾æ¬¡æ‰§è¡Œã€‚è€ŒTensorFlowä¸­ä¹Ÿæä¾›ä¸€ä¸ªå‡½æ•°(<code>tf.nn.dynamic_rnn</code>)æ¥å®ç°è¿™ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç›´æ¥é€šè¿‡ï¼ˆh0, x1, x2, â€¦,x100ï¼‰å¾—åˆ°(h1, h2, h3, h4, â€¦, h100)ç­‰ã€‚ä¸‹é¢çœ‹<code>dynamic_rnn</code>çš„å‚æ•°ï¼š</p><pre><code class="python">def dynamic_rnn(cell, inputs, sequence_length=None, initial_state=None, dtype=None,                 parallel_iterations=None, swap_memory=False, time_major=False, scope=None):    &quot;&quot;&quot;    cell: An instance of RNNCell.    inputs: The RNN inputs.      If `time_major == False` (default), this must be a `Tensor` of shape:`[batch_size, max_time, ...]`, or a nested tuple of such elements.      If `time_major == True`, this must be a `Tensor` of shape: `[max_time, batch_size, ...]`, or a nested tuple of such elements.    initial_state: (optional) An initial state for the RNN.      If `cell.state_size` is an integer, this must be a `Tensor` of appropriate type and shape `[batch_size, cell.state_size]`.      If `cell.state_size` is a tuple, this should be a tuple of tensors having shapes `[batch_size, s] for s in cell.state_size`.    &quot;&quot;&quot;</code></pre><p>å‚æ•°<code>cell</code>æ¥æ”¶RNNCellå®ä¾‹åŒ–å¯¹è±¡ï¼Œå¦‚<code>BasicRNNCell</code> ï¼Œ<code>BasicLSTMCell</code>å®ä¾‹åŒ–å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶<code>MultiRNNCell</code>å®ä¾‹åŒ–å¯¹è±¡ç­‰ã€‚å‚æ•°<code>inputs</code>ä¸ºè¾“å…¥åºåˆ—ï¼Œ<code>inputs</code>çš„<code>shape</code>æ˜¯<code>(batch_size, time_steps, depth)</code>ï¼Œå…¶ä¸­<code>depth</code>å°±æ˜¯ä¸Šå›¾ä¸­çš„<code>k</code>ï¼Œè¿™ä¸ªå‚æ•°çš„shapeä¸»è¦å–å†³äºå¦å¤–ä¹Ÿç»™å‚æ•°<code>time_major</code>ï¼Œé»˜è®¤ä¸º<code>False</code>ï¼›è¿™å„¿è¾“å…¥åå†è¿›å…¥åˆ°cellçš„<code>inputs</code>æ—¶è¿›è¡Œäº†è½¬æ¢ï¼Œå¯ä»¥é€šè¿‡<code>unstack</code>çš„æ–¹å¼è½¬æ¢æˆ<code>time_steps(bathc_size, depth)</code>ï¼Œcellæ¯æ¬¡æ¥æ”¶çš„inputsæ˜¯<code>(batch_size, depth)</code>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´æµ‹è¯•ï¼š</p><pre><code class="python"># defined rnn cell, the parameter num_units(hidden_units_num or state_size)cell = tf.nn.rnn_cell.BasicRNNCell(12, reuse=None)  state_size = cell.state_size  # the state size in rnn modelprint(&quot;The rnn model state size is %d.&quot; % state_size)  # 12rnn_inputs = tf.placeholder(tf.float32, shape=(100, 20, 10), name=&quot;rnn_inputs_x&quot;)  # 20 is time steps, 10 is vector depthinputs = tf.unstack(rnn_inputs, axis=1)h0 = cell.zero_state(100, tf.float32)  # size: 100, 12out1, h1 = cell(inputs[0], h0)  # inputs size is (batch_size, depth)print(&quot;The state size:&quot;, h1.shape, &quot;The output size:&quot;, out1.shape)# dynamic_rnn: one time execute many time stepsoutput, state = tf.nn.dynamic_rnn(cell, rnn_inputs, initial_state=h0) print(&quot;The state shape:&quot;, state.shape)  # (100, 12)</code></pre><p>ä¸Šé¢å¾—åˆ°å¾—outputå¾—shapeæ˜¯ï¼š<code>(batch_size, time_steps, cell.output_size)</code>ï¼Œåœ¨ä¸Šé¢å¾—ä¾‹å­ä¸­ï¼Œè¾“å‡ºå¾—shapeæ˜¯ï¼š<code>(100, 20, 12)</code>ã€‚</p><h3 id="7-3-MultiRNNCellï¼šå¤šå±‚RNNCell"><a href="#7-3-MultiRNNCellï¼šå¤šå±‚RNNCell" class="headerlink" title="7.3 MultiRNNCellï¼šå¤šå±‚RNNCell"></a>7.3 MultiRNNCellï¼šå¤šå±‚RNNCell</h3><p>ä¸Šé¢çš„è¿‡ç¨‹éƒ½åªæ˜¯å•å±‚çš„RNNæ¨¡å‹ï¼Œä½†æ˜¯åœ¨å®é™…åº”ç”¨ä¸­ä¼šä½¿ç”¨å¤šå±‚RNNæ¨¡å‹ï¼Œå› æ­¤éœ€è¦åŸºäºRNNCellæ¥å †å å¤šå±‚çš„RNNï¼Œç¬¬ä¸€å±‚RNNè¾“å‡ºçš„(h1, h2, h3, â€¦)ï¼Œä½œä¸ºä¸‹ä¸€å±‚çš„è¾“å…¥ï¼Œè¿™æ ·ä»¥æ­¤ç±»æ¨ã€‚åœ¨TensorFlowä¸­é€šè¿‡<code>MultiRNNCell</code>å®ç°è¯¥åŠŸèƒ½ï¼š</p><pre><code class="python">def get_a_cell(num):    return tf.nn.rnn_cell.BasicRNNCell(num_units=num)# ç”¨tf.nn.rnn_cell MultiRNNCellåˆ›å»º3å±‚RNNcell = tf.nn.rnn_cell.MultiRNNCell([get_a_cell(i) for i in [128, 256, 128]])  # 3å±‚RNNprint(cell.state_size)  # (128, 256, 128)inputs = tf.placeholder(np.float32, shape=(32, 100))  # 32æ˜¯batch_size, 10ä¸ºdepthh0 = cell.zero_state(32, np.float32)  # é€šè¿‡zero_stateå¾—åˆ°ä¸€ä¸ªå…¨0çš„åˆå§‹çŠ¶æ€output_multi, h1 = cell.call(inputs, h0)print(h1)  # tupleä¸­å«æœ‰3ä¸ª32x128çš„å‘é‡</code></pre><p>ä¸Šé¢çš„æµ‹è¯•ä»£ç ä¸­ï¼Œåˆ›å»ºäº†3å±‚çš„<code>RNN</code>æ¨¡å‹ï¼Œæ¯å±‚çš„<code>state_size</code>æ˜¯<code>(128, 256, 128)</code>ï¼Œ<code>MultiRNNCell</code>å¾—åˆ°çš„cellå…¶å®ä¹Ÿæ˜¯<code>RNNCell</code>çš„å­ç±»ï¼Œç„¶åè°ƒç”¨<code>call</code>æ–¹æ³•åè¾“å‡ºäº†<code>output</code>å’Œ<code>h1</code>ï¼Œè¾“å‡ºåçš„<code>h1</code>æ˜¯ä¸€ä¸ªtupleï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ å¯¹åº”çš„æ˜¯ä¸€ä¸ªtensorï¼Œtensorçš„å¤§å°åˆ†åˆ«æ˜¯<code>((32, 128), (32, 256), (32, 128))</code>ã€‚</p><p><code>MultiRNNCell</code>åªæ˜¯åˆ›å»ºäº†å•æ­¥çš„å¤šå±‚RNNï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­è‚¯å®šæ˜¯å¤šæ­¥çš„ï¼Œå› æ­¤è¿˜éœ€è¦è¿›è¡Œå¤šæ­¥æ‰§è¡Œå¤šå±‚RNNï¼Œæ¯å±‚çš„time_stepsæ˜¯ç›¸åŒçš„ã€‚åœ¨TensorFlowä¸­è¿˜æ˜¯é€šè¿‡<code>dynamic_rnn</code>æ¥å®ç°çš„ï¼Œä¸‹é¢æ˜¯TensorFlowçš„å®˜æ–¹ç¤ºä¾‹ï¼š</p><pre><code class="python"># create 2 LSTMCellsrnn_layers = [tf.nn.rnn_cell.LSTMCell(size) for size in [128, 256]]# create a RNN cell composed sequentially of a number of RNNCellsmulti_rnn_cell = tf.nn.rnn_cell.MultiRNNCell(rnn_layers)# &#39;outputs&#39; is a tensor of shape [batch_size, max_time, 256]# &#39;state&#39; is a N-tuple where N is the number of LSTMCells containing a tf.contrib.rnn.LSTMStateTuple for each celloutputs, state = tf.nn.dynamic_rnn(cell=multi_rnn_cell, inputs=data, dtype=tf.float32)</code></pre><h3 id="7-4-è¯¯åŒº"><a href="#7-4-è¯¯åŒº" class="headerlink" title="7.4 è¯¯åŒº"></a>7.4 è¯¯åŒº</h3><h4 id="7-4-1-è¯¯åŒºä¸€ï¼šcellä¸­çš„ouput"><a href="#7-4-1-è¯¯åŒºä¸€ï¼šcellä¸­çš„ouput" class="headerlink" title="7.4.1 è¯¯åŒºä¸€ï¼šcellä¸­çš„ouput"></a>7.4.1 è¯¯åŒºä¸€ï¼šcellä¸­çš„ouput</h4><p>ä»ä¸Šé¢å•æ­¥RNNä¸­çš„æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œoutputå’Œstateéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™å„¿cellçš„outputå¹¶éåœ¨å®é™…åº”ç”¨ä¸­çš„Yå€¼ã€‚è¿˜éœ€è¦ç»è¿‡å¤„ç†ã€è®¡ç®—æ‰èƒ½è¾“å‡ºæœ€ç»ˆçš„outputã€‚åœ¨RNNCellä¸­çš„outputåªæ˜¯å½“å‰cellçš„outputï¼Œå¹¶éæœ€ç»ˆæ¨¡å‹è¾“å‡ºçš„Yå€¼ï¼Œå› æ­¤Yå€¼å¾—sizeå’Œcellå¾—output_sizeä¹Ÿå¹¶éç›¸ç­‰ã€‚éœ€è¦å¯¹cellå¾—outputå†å®šä¹‰æ–°å¾—å˜æ¢æ‰èƒ½è½¬æ¢æˆå¸Œæœ›å¾—è¾“å‡ºYã€‚</p><h4 id="7-4-2-è¯¯åŒºäºŒï¼šRNNä¸­çš„dropout"><a href="#7-4-2-è¯¯åŒºäºŒï¼šRNNä¸­çš„dropout" class="headerlink" title="7.4.2 è¯¯åŒºäºŒï¼šRNNä¸­çš„dropout"></a>7.4.2 è¯¯åŒºäºŒï¼šRNNä¸­çš„dropout</h4><p>åœ¨RNNæ¨¡å‹ä¸­ä¹Ÿå¯ä»¥é€šè¿‡ dropoutæ¥æœ‰æ•ˆå¾—é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œåœ¨RNNä¸­çš„dropoutå’Œå…¶ä»–çš„æœ‰ä¸€å®šçš„å·®å¼‚ï¼Œåœ¨RNNä¸­åœ¨æ—¶é—´åºåˆ—æ–¹å‘ä¸è¿›è¡Œdropoutï¼Œä¹Ÿå°±æ˜¯åœ¨å¾ªç¯çš„éƒ¨åˆ†ä¸ä¼šè¿›è¡Œdropoutï¼Œå¦‚ä¸‹å›¾ä¸­ï¼Œå®çº¿çš„éƒ¨åˆ†ä¸ä¼šè¿›è¡Œdropoutï¼Œåœ¨è™šçº¿çš„éƒ¨åˆ†è¿›è¡Œdropoutã€‚åœ¨å®ç°æ—¶ä¸»è¦é€šè¿‡dropoutwrapperå®ç°dropoutåŠŸèƒ½ã€‚</p><p><img src="%5Cuploads%5Cdropoutwrapper.png" srcset="/img/loading.gif" alt="RNNç®€åŒ–ç»“æ„"></p><h2 id="8-Refrence"><a href="#8-Refrence" class="headerlink" title="8.Refrence"></a>8.Refrence</h2><p>(1).<a href="http://www.tensorflownews.com/category/course/" target="_blank" rel="noopener">åŸºäºTensorFlowå…³äºå„ç§ç½‘ç»œç»“æ„çš„å®æˆ˜æ¡ˆä¾‹</a></p><p>(2).<a href="https://www.jianshu.com/p/39a99c88a565" target="_blank" rel="noopener">è¯¦è§£å¾ªç¯ç¥ç»ç½‘ç»œ(Recurrent Neural Network)</a></p><p>(3).<a href="https://zybuluo.com/hanbingtao/note/541458" target="_blank" rel="noopener">é›¶åŸºç¡€å…¥é—¨å¾ªç¯ç¥ç»ç½‘ç»œ</a></p><p>(4).<a href="https://zhuanlan.zhihu.com/p/32755043" target="_blank" rel="noopener">å¾ªç¯ç¥ç»ç½‘ç»œRNNä»‹ç»1ï¼šä»€ä¹ˆæ˜¯RNNã€ä¸ºä»€ä¹ˆéœ€è¦RNNã€å‰åå‘ä¼ æ’­è¯¦è§£ã€Keraså®ç°</a></p><p>(5).<a href="https://blog.csdn.net/chenvast/article/details/79133127" target="_blank" rel="noopener">æ·±åº¦å­¦ä¹ -TensorFlowå®ç°RNN</a></p><p>(6).<a href="http://lawlite.me/2017/06/14/RNN-%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%92%8CLSTM-01%E5%9F%BA%E7%A1%80/" target="_blank" rel="noopener">å¾ªç¯ç¥ç»ç½‘ç»œRNNåŸºç¡€</a></p><p>(7).<a href="https://blog.csdn.net/mydear_11000/article/details/52414342" target="_blank" rel="noopener">è§£è¯»TensorFlowä¸‹å®ç°çš„RNN</a></p><p>(8).<a href="http://lawlite.me/2017/06/16/RNN-%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-02Tensorflow%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0/#1-%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B" target="_blank" rel="noopener">RNN-å¾ªç¯ç¥ç»ç½‘ç»œ-02Tensorflowä¸­çš„å®ç° </a></p><p>(9).<a href="http://lawlite.me/2017/06/21/RNN-LSTM%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-03Tensorflow%E8%BF%9B%E9%98%B6%E5%AE%9E%E7%8E%B0/" target="_blank" rel="noopener">RNN-LSTMå¾ªç¯ç¥ç»ç½‘ç»œ-03Tensorflowè¿›é˜¶å®ç°</a></p>]]></content>
    
    
    <categories>
      
      <category>deep learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>deep learning</tag>
      
      <tag>tensorflow</tag>
      
      <tag>SGD</tag>
      
      <tag>RNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TensorBoardçš„ä½¿ç”¨æ•™ç¨‹</title>
    <link href="/2018/04/26/TensorBoard%E7%9A%84%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
    <url>/2018/04/26/TensorBoard%E7%9A%84%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>TensorFlow å¯ç”¨äºè®­ç»ƒå¤§è§„æ¨¡æ·±åº¦ç¥ç»ç½‘ç»œæ‰€éœ€çš„è®¡ç®—ï¼Œä½¿ç”¨è¯¥å·¥å…·æ¶‰åŠçš„è®¡ç®—å¾€å¾€å¤æ‚è€Œæ·±å¥¥ã€‚å¾ˆå¤šäººä¹Ÿè®¤ä¸ºNNä¸ºä¸€ä¸ªé»‘ç›’ï¼Œå¯¹è®­ç»ƒè¿‡ç¨‹ç§çš„å¾ˆå¤šä¸œè¥¿ä¸å¤ªäº†è§£ã€‚å› æ­¤Googleæ¨å‡ºäº†åŸºäºTensorFlowçš„æ·±åº¦å­¦ä¹ å¯è§†åŒ–å·¥å…·TensorBoard ã€‚æ‚¨å¯ä»¥ç”¨ TensorBoard æ¥å±•ç° TensorFlow å›¾ï¼Œç»˜åˆ¶å›¾åƒç”Ÿæˆçš„å®šé‡æŒ‡æ ‡å›¾ä»¥åŠæ˜¾ç¤ºé™„åŠ æ•°æ®ï¼ˆå¦‚å…¶ä¸­ä¼ é€’çš„å›¾åƒï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯¥å·¥å…·äº†è§£æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ç§å‚æ•°çš„æ”¶æ•›è¿‡ç¨‹ï¼Œåˆ¤æ–­æ¨¡å‹æ˜¯å¦è¿‡æ‹Ÿåˆï¼Œæ˜¯å¦æ˜¯æ¬ æ‹Ÿåˆç­‰ã€‚</p><h2 id="1-summary"><a href="#1-summary" class="headerlink" title="1.summary"></a>1.summary</h2><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹,<code>summary</code>ä¹Ÿæ˜¯<code>op</code>ã€‚è¦å¯¹æŸäº›å˜é‡æˆ–å€¼è¿›è¡Œå¯è§†åŒ–ï¼Œå°±å¿…é¡»åœ¨åˆ›å»ºå›¾çš„è¿‡ç¨‹ä¸­å°†è¿™äº›å˜é‡æˆ–æ ‡é‡ç»™è®°å½•ä¸‹æ¥ï¼Œåç»­å°†è®­ç»ƒè¿‡ç¨‹å¾—è®°å½•ç»™å†™å…¥logï¼Œå†é€šè¿‡tensorboardè¿›è¡Œå±•ç¤ºã€‚</p><h3 id="1-1-æ ‡é‡å¯è§†åŒ–"><a href="#1-1-æ ‡é‡å¯è§†åŒ–" class="headerlink" title="1.1 æ ‡é‡å¯è§†åŒ–"></a>1.1 æ ‡é‡å¯è§†åŒ–</h3><p>å¦‚æœæˆ‘ä»¬æƒ³å¯¹æ ‡é‡åœ¨è®­ç»ƒä¸­å¯è§†åŒ–ï¼Œå¯ä»¥ä½¿ç”¨<code>tf.summary.scalar()</code>ï¼Œæ¯”å¦‚æŸå¤±lossï¼Œaccuracyç­‰ã€‚è¿™ä¸ªAPIå¾—æ¥å£å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸»è¦ç”¨äºæ ‡é‡ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªæ ‡é‡å¾—summaryï¼š</p><pre><code class="python">tf.summary.scalar(name, tensor, collections=None, family=None)&quot;&quot;&quot;è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è§‚å¯ŸTensorflowçš„Graphä¸­æŸä¸ªèŠ‚ç‚¹parameters----------tensor: æƒ³è¦åœ¨TensorBoardä¸­è§‚å¯Ÿçš„èŠ‚ç‚¹name: ä¸ºè¯¥èŠ‚ç‚¹è®¾ç½®åå­—ï¼Œåœ¨TensorBoardä¸­æˆ‘ä»¬è§‚å¯Ÿçš„æ›²çº¿å°†ä¼šä»¥nameå‘½å&quot;&quot;&quot;</code></pre><a id="more"></a><h3 id="1-2-å‚æ•°å¯è§†åŒ–"><a href="#1-2-å‚æ•°å¯è§†åŒ–" class="headerlink" title="1.2 å‚æ•°å¯è§†åŒ–"></a>1.2 å‚æ•°å¯è§†åŒ–</h3><p>ä½¿ç”¨<code>tf.summary.histogram()</code>å¯ä»¥å¯¹å‚æ•°è¿›è¡Œå¯è§†åŒ–ï¼Œå¦‚æƒé‡ï¼Œåç½®é¡¹ç­‰ã€‚å¯ä»¥é€šè¿‡è¯¥APIå¯è§†åŒ–å‚æ•°çš„åˆ†å¸ƒæƒ…å†µï¼Œæ¯æ¬¡è¿­ä»£çš„åˆ†å¸ƒæƒ…å†µç­‰ã€‚</p><pre><code class="python">tf.summary.histogram(name, values, collections=None, family=None)&quot;&quot;&quot;return------A scalar Tensor of type string. The serialized Summary protocol buffer.parameters----------    name: A name for the generated node. Will also serve as a series name in TensorBoard.    values: A real numeric Tensor. Any shape. Values to use to build the histogram.    collections: Optional list of graph collections keys. The new summary op is added to these collections.     Defaults to [GraphKeys.SUMMARIES].    family: Optional; if provided, used as the prefix of the summary tag name, which controls the tab name used for display on Tensorboard.&quot;&quot;&quot;</code></pre><h3 id="1-3-å…¶ä»–-images-text-audio-çš„å¯è§†åŒ–"><a href="#1-3-å…¶ä»–-images-text-audio-çš„å¯è§†åŒ–" class="headerlink" title="1.3 å…¶ä»–(images, text, audio)çš„å¯è§†åŒ–"></a>1.3 å…¶ä»–(images, text, audio)çš„å¯è§†åŒ–</h3><p>TensorBoardä¹Ÿå¯ä»¥å¯¹å›¾ç‰‡ï¼Œæ–‡æœ¬å’ŒéŸ³é¢‘ç­‰è¿‘å¯è§†åŒ–ï¼Œå…·ä½“APIå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p><h2 id="2-å¯¹æ‰€æœ‰çš„summaryè¿›è¡Œmerge"><a href="#2-å¯¹æ‰€æœ‰çš„summaryè¿›è¡Œmerge" class="headerlink" title="2.å¯¹æ‰€æœ‰çš„summaryè¿›è¡Œmerge"></a>2.å¯¹æ‰€æœ‰çš„summaryè¿›è¡Œmerge</h2><p>åœ¨ TensorFlow ä¸­ï¼Œåªæœ‰å½“æ‚¨è¿è¡ŒæŒ‡ä»¤æ—¶ï¼ŒæŒ‡ä»¤æ‰ä¼šæ‰§è¡Œï¼Œæˆ–è€…å¦ä¸€ä¸ª op ä¾èµ–äºæŒ‡ä»¤çš„è¾“å‡ºæ—¶ï¼ŒæŒ‡ä»¤æ‰ä¼šè¿è¡Œã€‚æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„è¿™äº›æ€»ç»“èŠ‚ç‚¹éƒ½å›´ç»•ç€æ‚¨çš„å›¾ï¼šæ‚¨ç›®å‰è¿è¡Œçš„ op éƒ½ä¸ä¾èµ–äºè¿™äº›èŠ‚ç‚¹çš„ç»“æœã€‚å› æ­¤ï¼Œä¸ºäº†ç”Ÿæˆæ€»ç»“ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œæ‰€æœ‰è¿™äº›æ€»ç»“èŠ‚ç‚¹ã€‚è¿™æ ·çš„æ‰‹åŠ¨æ“ä½œæ˜¯æ¯ç‡¥è€Œä¹å‘³çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ <a href="https://www.tensorflow.org/api_docs/python/tf/summary/merge_all?hl=zh-cn" target="_blank" rel="noopener"><code>tf.summary.merge_all</code></a> æ¥å°†è¿™äº›æ“ä½œåˆå¹¶ä¸ºä¸€ä¸ª opï¼Œä»è€Œç”Ÿæˆæ‰€æœ‰æ€»ç»“æ•°æ®ï¼Œç”Ÿæˆä¸€ä¸ª<code>summary</code>å¯¹è±¡ï¼Œä¾›åé¢<code>File_Writer</code>çš„<code>add_summary</code>ä½¿ç”¨ã€‚<strong>å’Œåˆå§‹åŒ–æ‰€æœ‰çš„å˜é‡ç”¨æ³•ç›¸ä¼¼</strong>ã€‚</p><p>ç„¶åæ‚¨å¯ä»¥æ‰§è¡Œè¯¥åˆå¹¶çš„æ€»ç»“ opï¼Œå®ƒä¼šåœ¨ç‰¹å®šæ­¥éª¤å°†æ‰€æœ‰æ€»ç»“æ•°æ®ç”Ÿæˆä¸€ä¸ªåºåˆ—åŒ–çš„ <code>summary protobuf</code> å¯¹è±¡ã€‚æœ€åï¼Œè¦å°†æ­¤æ€»ç»“æ•°æ®å†™å…¥ç£ç›˜ï¼Œè¯·å°†æ­¤æ€»ç»“ protobuf å¯¹è±¡ä¼ é€’ç»™ <a href="https://www.tensorflow.org/api_docs/python/tf/summary/FileWriter?hl=zh-cn" target="_blank" rel="noopener"><code>tf.summary.FileWriter</code></a>ã€‚</p><h2 id="3-FileWriter"><a href="#3-FileWriter" class="headerlink" title="3.FileWriter"></a>3.FileWriter</h2><p>è¿™ä¸ªæ­¥éª¤ä¸»è¦æ˜¯å°†summaryçš„ç»“æœï¼ˆprotobufåºåˆ—åŒ–åçš„æ•°æ®ï¼‰å†™å…¥ç£ç›˜ã€‚åé¢å¯åŠ¨TensorBoardæœåŠ¡æ—¶å¥½ä½¿ç”¨è¯¥æ•°æ®ï¼Œåœ¨å‰ç«¯è¿›è¡Œå¯è§†åŒ–ã€‚ä¸‹é¢åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šé€šè¿‡<code>add_summary(summary, global_step=None)</code>å°†summaryæ·»åŠ åˆ°FileWriterå¯¹è±¡ä¸­ã€‚</p><pre><code class="python">Class FileWriter:    &quot;&quot;&quot;    Writes Summary protocol buffers to event files.    &quot;&quot;&quot;    def __init__(logdir, graph=None, max_queue=10, flush_secs=120, graph_def=None, filename_suffix=None)        &quot;&quot;&quot;        parameters        ----------        logdir: string, directory where event file will be written.        graph: A Graph object, such as sess.graph.        max_queue: Integer. åœ¨å‘diskå†™æ•°æ®ä¹‹å‰ï¼Œæœ€å¤§èƒ½å¤Ÿç¼“å­˜eventçš„ä¸ªæ•°         flush_secs: Number. æ¯å¤šå°‘ç§’åƒdiskä¸­å†™æ•°æ®ï¼Œå¹¶æ¸…ç©ºå¯¹è±¡ç¼“å­˜.        graph_def: DEPRECATED: Use the graph argument instead.        filename_suffix: A string. Every event file&#39;s name is suffixed with suffix.        &quot;&quot;&quot;# examplewriter = tf.summary.FileWriter(&quot;.&quot; + &#39;/train&#39;, session.graph)</code></pre><h3 id="3-1-add-summary"><a href="#3-1-add-summary" class="headerlink" title="3.1 add_summary"></a>3.1 add_summary</h3><p>å› ä¸ºå‰é¢è¯´æ˜äº†summaryä¹Ÿæ˜¯ä¸€ä¸ªOPï¼Œå› æ­¤åœ¨éœ€è¦sessionä¸­ï¼Œæ¯ä¸ªè®­ç»ƒæ­¥ï¼ˆæˆ–è€…å¤šä¸ªè®­ç»ƒæ­¥ï¼‰å°†summaryå¯¹è±¡æ·»åŠ åˆ°FileWriterä¸­ã€‚summaryå¯¹è±¡æ˜¯é€šè¿‡å‰é¢mergeæ­¥éª¤ä¸­ç”Ÿæˆã€‚å› æ­¤ä¸€èˆ¬ä¼šæ‰§è¡Œä¸‹é¢ä¸¤ä¸ªæ­¥éª¤ï¼š</p><pre><code class="python">summary = session.run(merged, feed_dict={x: X, y: Y})wiriter.add_summary(summary, global_step=train_step)</code></pre><p>ä¸‹é¢å†çœ‹ä¸‹<code>add_summary</code>çš„apiæ¥å£ï¼š</p><pre><code class="python">def add_summary(summary, global_step=None):    &quot;&quot;&quot;    parameters    ----------    summary: A Summary protocol buffer, optionally serialized as a string.    global_step: Number. Optional global step value to record with the summary.    &quot;&quot;&quot;</code></pre><blockquote><p><strong>note</strong>ï¼š</p><ol><li>å¦‚æœä½¿ç”¨<code>writer.add_summary(summaryï¼Œglobal_step)</code>æ—¶æ²¡æœ‰ä¼ <code>global_step</code>å‚æ•°,ä¼šä½¿<code>scarlar_summary</code>å˜æˆä¸€æ¡ç›´çº¿ã€‚</li><li>åªè¦æ˜¯åœ¨è®¡ç®—å›¾ä¸Šçš„<code>Summary op</code>ï¼Œéƒ½ä¼šè¢«<code>merge_all</code>æ•æ‰åˆ°ï¼Œ ä¸éœ€è¦è€ƒè™‘å˜é‡ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚</li><li>å¦‚æœæ‰§è¡Œä¸€æ¬¡ï¼Œ<code>disk</code>ä¸Šæ²¡æœ‰ä¿å­˜<code>Summary</code>æ•°æ®çš„è¯ï¼Œå¯ä»¥å°è¯•ä¸‹<code>file_writer.flush()</code></li></ol></blockquote><h2 id="4-å¯åŠ¨TensorBoardæœåŠ¡"><a href="#4-å¯åŠ¨TensorBoardæœåŠ¡" class="headerlink" title="4.å¯åŠ¨TensorBoardæœåŠ¡"></a>4.å¯åŠ¨TensorBoardæœåŠ¡</h2><p>è®­ç»ƒå®Œæˆåï¼Œå°±å¯ä»¥è¿›å…¥åˆ°å‘½ä»¤è¡Œå¯åŠ¨TensorBoardï¼Œå¯ä»¥æŒ‡å®šåˆ°æŸä¸ªlogdirï¼ŒæŒ‡å®šTensorBoardæœåŠ¡ç›‘å¬çš„IPï¼Œç›‘å¬çš„ç«¯å£ç­‰ã€‚åªéœ€è¦å†å‘½ä»¤è¡ŒæŒ‡å®šï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="shell">tensorboard --logdir tain --host 0.0.0.0 --port 88888tensorboard --logdir /tmp/train</code></pre><p>å¯åŠ¨æœåŠ¡åå°±å¯ä»¥å†æµè§ˆå™¨ä¸­æŸ¥çœ‹æ·±åº¦ç½‘ç»œçš„å¯è§†åŒ–ã€‚</p><h2 id="5-é…åˆname-scopeä½¿ç”¨"><a href="#5-é…åˆname-scopeä½¿ç”¨" class="headerlink" title="5.é…åˆname_scopeä½¿ç”¨"></a>5.é…åˆ<code>name_scope</code>ä½¿ç”¨</h2><p>å½“ç½‘ç»œæ¯”è¾ƒå¤æ‚æ—¶ï¼Œæ•´ä½“ç½‘ç»œçš„å›¾çœ‹ä¸Šå»å°±ä¼šæ¯”è¾ƒæ··ä¹±ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTensorFlowä¸­åŠ å…¥äº†name_scopeï¼Œè¿™æ ·TensorBoardçš„å¯è§†åŒ–ç½‘ç»œçœ‹ä¸Šå»æ›´æœ‰å±‚æ¬¡æ€§ã€‚å¦‚ä¸‹ä½¿ç”¨ï¼š</p><pre><code class="python">with tf.name_scope(&quot;weight&quot;):    w = tf.Variable(initial_value=tf.random_uniform([784, 10], -1, 1), name=&quot;weight&quot;)with tf.name_scope(&quot;bias&quot;):    b = tf.Variable(initial_value=tf.random_uniform(shape=[10]), name=&quot;bias&quot;)</code></pre><h2 id="6-Refrence"><a href="#6-Refrence" class="headerlink" title="6.Refrence"></a>6.Refrence</h2><p>[1]. <a href="https://jhui.github.io/2017/03/12/TensorBoard-visualize-your-learning/" target="_blank" rel="noopener">TensorBoard - Visualize your learning</a></p><p>[2].<a href="https://blog.csdn.net/u012436149/article/details/53184847" target="_blank" rel="noopener">TensorFlowå¯è§†åŒ–</a></p><p>[3].<a href="http://www.tensorfly.cn/tfdoc/how_tos/summaries_and_tensorboard.html" target="_blank" rel="noopener">TensorBoardå¯è§†åŒ–å­¦ä¹ </a></p><p>[4].<a href="https://www.youtube.com/watch?v=eBbEDRsCmv4" target="_blank" rel="noopener">Hands on TensorBoard</a></p>]]></content>
    
    
    <categories>
      
      <category>tensorflow</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tensorflow</tag>
      
      <tag>tensorboard</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CentOS_7(1708)ä¸‹åŸºäºTensorflowå¯¹åŒGPUæ·±åº¦å­¦ä¹ ç¯å¢ƒé…ç½®</title>
    <link href="/2018/04/25/CentOS7(1708)%E4%B8%8B%E5%9F%BA%E4%BA%8E%E5%8F%8C%E6%98%BE%E5%8D%A1%E7%9A%84TensorFlow%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <url>/2018/04/25/CentOS7(1708)%E4%B8%8B%E5%9F%BA%E4%BA%8E%E5%8F%8C%E6%98%BE%E5%8D%A1%E7%9A%84TensorFlow%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>åœ¨å·¥ä½œç§éœ€è¦å¯¹tensorflowçš„GPUç¯å¢ƒè¿›è¡Œé…ç½®ï¼Œä¸»è¦æ˜¯åŸºäºcentos7ä¸‹çš„å•æœºå¤šæ˜¾å¡ç¯å¢ƒè¿›è¡Œéƒ¨ç½²ï¼Œå› æ­¤é¦–å…ˆéœ€è¦å¯¹centos7è¿›è¡Œå®‰è£…ã€‚å…¶æ¬¡å¯¹æ˜¾å¡é©±åŠ¨çš„å®‰è£…ï¼Œå› ä¸ºæ˜¯å¤šæ˜¾å¡ï¼Œåœ¨å®‰è£…å¤šæ˜¾å¡é©±åŠ¨çš„æ—¶å€™å’Œä½†æ˜¾å¡é©±åŠ¨å®‰è£…æœ‰ä¸€å®šçš„åŒºåˆ«ã€‚ä¸‹é¢å¯¹æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¦‚æœé‡åˆ°ç±»ä¼¼çš„ç¯å¢ƒéƒ¨ç½²ï¼Œå¯ä»¥å‚è€ƒè¯¥æ–‡æ¡£ã€‚</p><h2 id="1-Linuxç³»ç»Ÿcentos7-1708çš„å®‰è£…"><a href="#1-Linuxç³»ç»Ÿcentos7-1708çš„å®‰è£…" class="headerlink" title="1.Linuxç³»ç»Ÿcentos7-1708çš„å®‰è£…"></a>1.Linuxç³»ç»Ÿcentos7-1708çš„å®‰è£…</h2><p>é€šè¿‡é•œåƒå†™å…¥è½¯ä»¶å°†ç³»ç»Ÿé•œåƒå†™å…¥åˆ°Uç›˜ï¼Œå†å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œå®‰è£…ã€‚åœ¨å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡Uç›˜å¯åŠ¨ï¼Œåœ¨é€‰æ‹©æ—¶æœ‰<em>UEFI</em>æ¨¡å¼å’Œé<em>UEFI</em>æ¨¡å¼ï¼Œé€‰æ‹©é<em>UEFI</em>æ¨¡å¼çš„Uç›˜å¯åŠ¨ã€‚è¿›å…¥åˆ°å®‰è£…é€‰æ‹©ç•Œé¢ã€‚</p><h3 id="1-1-ä¿®æ”¹é•œåƒæŒ‚è½½åœ°å€"><a href="#1-1-ä¿®æ”¹é•œåƒæŒ‚è½½åœ°å€" class="headerlink" title="1.1 ä¿®æ”¹é•œåƒæŒ‚è½½åœ°å€"></a>1.1 ä¿®æ”¹é•œåƒæŒ‚è½½åœ°å€</h3><p>é€‰æ‹©<code>Install CentOS7</code>é€‰é¡¹åï¼Œè¿›å…¥åˆ°å®‰è£…è¿‡ç¨‹ï¼Œå¦‚æœæ•´ä¸ªè¿‡ç¨‹é¡ºåˆ©ï¼Œåˆ™å¯ä»¥ç»§ç»­ï¼Œæœ¬1.1å°±å¯ä»¥å¿½ç•¥ã€‚å¦‚å‡ºç°é—®é¢˜ï¼š<code>failed to map image memory......</code>çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹é•œåƒæŒ‚è½½åœ°å€ã€‚åœ¨å‡ºç°è¯¥é”™è¯¯åç»§ç»­ï¼Œé—´éš”1-2åˆ†é’Ÿåä¼šå‡ºç°å‘½ä»¤è¡Œã€‚å¯ä»¥æŸ¥çœ‹devä¸‹çš„ç›®å½•(<code>ls /dev</code>)ã€‚æˆ‘çš„Uç›˜è¢«æŒ‚è½½åˆ°äº†<code>/dev/sdb4</code>ï¼Œéœ€è¦æŠŠè¯¥ç›®å½•è®°å½•ä¸‹æ¥ï¼Œåç»­ä¼šä½¿ç”¨ã€‚</p><p>å†é‡å¯è®¡ç®—æœºï¼Œè¿›å…¥åˆ°Uç›˜å¯åŠ¨åçš„ç•Œé¢ï¼Œé€‰æ‹©<code>Install CentOS7</code>ï¼Œç„¶åæŒ‰<code>tab</code>è¿›å…¥åˆ°ç¼–è¾‘æ¨¡å¼ï¼Œä¿®æ”¹å…¶ä¸­çš„å‘½ä»¤è¡Œï¼š<code>Linuxefi /images/pxeboot/vmlinuzinst.stage22=hd:LABEL=CentOS\x207\x20x\86_64 quiet</code>ï¼Œå°†ä¿®æ”¹ä¸ºï¼š<code>Linuxefi /images/pxeboot/vmlinuzinst.stage22=hd:/dev/sdb4 quiet</code>ï¼Œå†é€šè¿‡<code>Enter</code>å¿«æ·é”®æ‰§è¡Œå®‰è£…ã€‚ç„¶åè¿›å…¥åˆ°å›¾å½¢å®‰è£…ç•Œé¢ã€‚å¦‚æœè¿˜æ˜¯ä¸èƒ½è¿›å…¥åˆ°å›¾å½¢ç•Œé¢ï¼Œå®‰è£…å‡ºé”™ï¼Œè¯·å‚è€ƒä¸‹é¢ã€‚</p><h3 id="1-2-å›¾å½¢ç•Œé¢å‡ºé”™é—®é¢˜è§£å†³"><a href="#1-2-å›¾å½¢ç•Œé¢å‡ºé”™é—®é¢˜è§£å†³" class="headerlink" title="1.2 å›¾å½¢ç•Œé¢å‡ºé”™é—®é¢˜è§£å†³"></a>1.2 å›¾å½¢ç•Œé¢å‡ºé”™é—®é¢˜è§£å†³</h3><p>å¦‚æœå›¾å½¢ç•Œé¢å®‰è£…å‡ºç°é—®é¢˜(<code>x startup failed falling back to text mod</code>)ï¼Œä¸€èˆ¬æ˜¯å®‰è£…åŸºç¡€çš„å›¾å½¢ç•Œé¢å‡ºé—®é¢˜ã€‚è§£å†³æ–¹æ³•æ˜¯é‡å¯è®¡ç®—æœºï¼ŒUç›˜å¯åŠ¨ï¼Œä¸é€‰æ‹©<code>Install CentOS7</code>ï¼Œé€‰æ‹©<code>Troubleshooting --&gt;</code>ï¼Œè¿›å…¥åˆ°é€‰é¡¹ï¼Œå¹¶é€‰æ‹©ç¬¬ä¸€é¡¹ï¼Œä¿®æ”¹é•œåƒåœ°å€(tabæˆ–eä¿®æ”¹ï¼Œä¿®æ”¹çš„åœ°æ–¹å’Œ1.1ä¸­çš„ä¸€æ ·)ã€‚</p><h3 id="1-3-é…ç½®SSHæœåŠ¡"><a href="#1-3-é…ç½®SSHæœåŠ¡" class="headerlink" title="1.3 é…ç½®SSHæœåŠ¡"></a>1.3 é…ç½®SSHæœåŠ¡</h3><p>å®‰è£…å®Œç³»ç»Ÿåé…ç½®sshæœåŠ¡ï¼Œæœ¬æ–‡ä¸­å°†sshç«¯å£ä¿®æ”¹ä¸º22222ï¼Œéœ€è¦å¼€æ”¾22222ç«¯å£ã€‚sshå…·ä½“é…ç½®å°±ä¸è¯¦ç»†è¯´æ˜ã€‚</p><h2 id="2-LinuxæŸ¥çœ‹æ˜¾å¡çš„ç›¸å…³å‘½ä»¤"><a href="#2-LinuxæŸ¥çœ‹æ˜¾å¡çš„ç›¸å…³å‘½ä»¤" class="headerlink" title="2.LinuxæŸ¥çœ‹æ˜¾å¡çš„ç›¸å…³å‘½ä»¤"></a>2.LinuxæŸ¥çœ‹æ˜¾å¡çš„ç›¸å…³å‘½ä»¤</h2><p><code>lspci</code>å‘½ä»¤æŸ¥çœ‹ç¡¬ä»¶æ¥å£ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡<code>lspci |grep -i vga</code>æ¥æŸ¥è¯¢æ˜¾å¡ï¼Œå¯ä»¥çœ‹å‡ºç”µè„‘çš„æ‰€æœ‰æ˜¾å¡ï¼Œæ˜¾ç¤ºæ˜¾å¡å‹å·ã€‚ä¹Ÿå¯ä»¥æ˜¾ç¤ºæ˜¾å¡æ¯”è¾ƒè¯¦ç»†çš„ä¿¡æ¯ï¼š<code>lspci -vnn | grep VGA -A 12</code></p><a id="more"></a><h2 id="3-å®‰è£…nvidiaæ˜¾å¡é©±åŠ¨"><a href="#3-å®‰è£…nvidiaæ˜¾å¡é©±åŠ¨" class="headerlink" title="3.å®‰è£…nvidiaæ˜¾å¡é©±åŠ¨"></a>3.å®‰è£…nvidiaæ˜¾å¡é©±åŠ¨</h2><pre><code class="shell">rpm -Uvh &lt;http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm&gt;  # æ·»åŠ æºyum install nvidia-detect  # å®‰è£…nvidia-detectå‘½ä»¤nvidia-detect -v  # æ£€æµ‹æ˜¾å¡å‹å·yum update  # æ›´æ–°yumyum update kernel kernel-devel  # æ›´æ–°æ ¸lsmod|grep nouveau</code></pre><p>ä¿®æ”¹<code>/lib/modprobe.d/dist-blacklist.conf</code>æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­åŠ å…¥ï¼š<code>blacklist nouveau options nouveau modeset=0</code></p><h3 id="3-1-æ›´æ”¹å¹¶é‡æ–°ç”Ÿæˆgrub2"><a href="#3-1-æ›´æ”¹å¹¶é‡æ–°ç”Ÿæˆgrub2" class="headerlink" title="3.1 æ›´æ”¹å¹¶é‡æ–°ç”Ÿæˆgrub2"></a>3.1 æ›´æ”¹å¹¶é‡æ–°ç”Ÿæˆgrub2</h3><p>æ‰“å¼€ <code>/etc/default/grub</code>æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­çš„ï¼š<code>GRUB_CMDLINE_LINUX=â€rd.lvm.lv=vg_centos/lv_root rd.lvm.lv=vg_centos/lv_swap rhgb quietâ€</code> quietåé¢åŠ å…¥<code>rdblacklist=nouveau</code>ï¼Œä¿å­˜ã€‚</p><pre><code class="shell">grub2-mkconfig -o /boot/grub2/grub.cfg</code></pre><p>æˆ‘ä»¬é¦–å…ˆæŠŠç°æœ‰çš„ç§»åŠ¨åˆ°å…¶å®ƒè·¯å¾„ä¸‹ä»¥ä½œä¸ºç•™æ‰‹å¤‡ä»½ï¼Œæ‰“å¼€ç»ˆç«¯æ‰§è¡Œï¼š</p><p><code>sudo mv /boot/initramfs-$(uname -r).img /ä½ å–œæ¬¢çš„è·¯å¾„ï¼Œ</code>ç„¶åé‡å»ºå®ƒï¼Œæ‰§è¡Œï¼š<code>sudo dracut /boot/initramfs-$(uname -r).img $(uname -r)</code>å³å¯ã€‚</p><h3 id="3-2-å®‰è£…NVIDIAé©±åŠ¨"><a href="#3-2-å®‰è£…NVIDIAé©±åŠ¨" class="headerlink" title="3.2 å®‰è£…NVIDIAé©±åŠ¨"></a>3.2 å®‰è£…NVIDIAé©±åŠ¨</h3><p>å®˜ç½‘<a href="http://www.nvidia.com/Download/index.aspx?lang=en-us" target="_blank" rel="noopener">ä¸‹è½½</a>é©±åŠ¨ï¼Œä¸‹è½½ä¸‹æ¥æ—¶.runçš„æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ<code>sh *.run</code>å³å¯ã€‚ç„¶åé‡åˆ°æç¤ºä»€ä¹ˆçš„ç›´æ¥<code>yes</code>å³å¯ã€‚åœ¨å®‰è£…äº†é©±åŠ¨åæä¾›äº†é©±åŠ¨è‡ªåŠ¨æ›´æ–°çš„å‘½ä»¤ï¼š<code>nvidia-installer --update</code>ã€‚å®‰è£…å®ŒåæŸ¥çœ‹<code>/etc/X11/xorg.conf</code>çš„å†…å®¹ï¼Œä¼šå‘ç° Device çš„ Driver è®¾ç½®ä¼šæˆä¸ºNVidiaã€‚</p><p>å†é€šè¿‡<code>lspci |grep -i vga</code>æŸ¥çœ‹æ˜¾å¡ï¼Œå‘ç°intelçš„é›†æˆæ˜¾å¡ä¸è§äº†ï¼Œå› ä¸ºå‰é¢å°†é›†æˆæ˜¾å¡ç¦ç”¨æ‰äº†ã€‚å› æ­¤åªèƒ½çœ‹ç°åœ¨çš„ç‹¬ç«‹æ˜¾å¡ã€‚</p><h3 id="3-3-å®‰è£…Bumblebee"><a href="#3-3-å®‰è£…Bumblebee" class="headerlink" title="3.3 å®‰è£…Bumblebee"></a>3.3 å®‰è£…Bumblebee</h3><pre><code class="shell"> yum -y install bumblebee</code></pre><p>åœ¨Bumblebeeå®˜æ–¹wikiä¸Šå¯¹cudaä½¿ç”¨è¿›è¡Œäº†è¯´æ˜ï¼Œå¦‚æœä½¿ç”¨cudaå¯ä»¥ä¸ç”¨Bumblebeeï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä¸ç”¨å®‰è£…Bumblebeeï¼Œä¸ç”¨é…ç½®åˆ‡æ¢ã€‚</p><h2 id="4-å®‰è£…CUDA-toolkit"><a href="#4-å®‰è£…CUDA-toolkit" class="headerlink" title="4.å®‰è£…CUDA-toolkit"></a>4.å®‰è£…CUDA-toolkit</h2><p>ä¸‹è½½åœ°å€åœ¨<a href="https://developer.nvidia.com/cuda-downloads?target_os=Linux&target_arch=x86_64&target_distro=CentOS&target_version=7&target_type=runfilelocal" target="_blank" rel="noopener">è¿™é‡Œ</a>é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼Œæœ¬æ¬¡é€‰ç”¨çš„cuda9.1çš„æœ€æ–°ç‰ˆæœ¬å®‰è£…ï¼Œä¸‹è½½åæ”¾å…¥æŸä¸ªç›®å½•ä¸‹é¢ï¼Œå¹¶è¿è¡Œ<code>sh ./cuda_9.1.85_387.26_linux.run</code>è¿›è¡Œå®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ä¸­ä¸€å®šè¦æ³¨æ„æŸäº›é€‰é¡¹ï¼š</p><pre><code class="tex">Do you accept the previously read EULA?accept/decline/quit: acceptInstall NVIDIA Accelerated Graphics Driver for Linux-x86_64 387.26?(y)es/(n)o/(q)uit: nInstall the CUDA 9.1 Toolkit?(y)es/(n)o/(q)uit: yEnter Toolkit Location [ default is /usr/local/cuda-9.1 ]:Do you want to install a symbolic link at /usr/local/cuda?(y)es/(n)o/(q)uit:Do you want to install a symbolic link at /usr/local/cuda?(y)es/(n)o/(q)uit: yInstall the CUDA 9.1 Samples?(y)es/(n)o/(q)uit: yEnter CUDA Samples Location [ default is /root ]: /usr/local/cuda-9.1/examples</code></pre><p>å¦‚æœå‡ºç°éƒ¨åˆ†libç¼ºå¤±çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±éœ€è¦å®‰è£…ç›¸åº”çš„ä¾èµ–åº“ï¼Œä¸»è¦å‡ºç°ä»¥ä¸‹çš„æƒ…å†µ</p><pre><code class="tex">Installing the CUDA Toolkit in /usr/local/cuda-9.1 ...Missing recommended library: libGLU.soMissing recommended library: libX11.soMissing recommended library: libXi.soMissing recommended library: libXmu.so</code></pre><p>åœ¨é€šè¿‡å‘½ä»¤<code>yum install mesa-libGLU-devel libXi-devel libXmu-devel</code>æ¥å®‰è£…ä¾èµ–åº“å¹¶é‡æ–°å®‰è£…cuda-toolkitã€‚å¹¶æŒ‰ç…§ä¸Šé¢çš„è¿‡ç¨‹è¿›è¡Œå®‰è£…ã€‚å®‰è£…å®Œåä¼šæç¤ºï¼š</p><pre><code>lease make sure that -   PATH includes /usr/local/cuda-9.1/bin -   LD_LIBRARY_PATH includes /usr/local/cuda-9.1/lib64, or, add /usr/local/cuda-9.1/lib64 to /etc/ld.so.conf and run ldconfig as rootTo uninstall the CUDA Toolkit, run the uninstall script in /usr/local/cuda-9.1/bin</code></pre><p>é…ç½®cudaï¼Œå°†cuda/binå’Œcuda/libåˆ†å¸ƒæ·»åŠ åˆ°PATHå’ŒLD_LIBRARY_PATHã€‚å¦‚å°†ç¯å¢ƒå˜é‡æ·»åŠ åˆ°<code>/etc/profile</code>ä¸­ï¼š<code>export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/cuda-9.1/lib64:/usr/local/cuda/lib64</code>ï¼Œ<code>export PATH=$PATH:/usr/local/cuda-9.1/bin:/usr/local/cuda/bin</code>ï¼Œ<code>export CUDA_HOME=/usr/local/cuda-9.1</code>å¹¶<code>source /etc/profile</code>ã€‚å¦‚æœè¦å¯¹cudaè¿›è¡Œæµ‹è¯•ï¼Œè¿›å…¥åˆ°examplesç›®å½•ä¸‹çš„å¯¹NVIDIA_CUDA-9.1_Samplesä¸‹çš„æ–‡ä»¶è¿›è¡Œç¼–è¯‘ã€‚ç¼–è¯‘åè¿è¡ŒæŸä¸ªexampleè¿›è¡Œæµ‹è¯•ã€‚å¦‚ä¸‹ï¼š</p><pre><code>[root@localhost deviceQuery]# ./deviceQuery./deviceQuery Starting... CUDA Device Query (Runtime API) version (CUDART static linking)Detected 2 CUDA Capable device(s)Device 0: &quot;GeForce GTX 1060 6GB&quot;  CUDA Driver Version / Runtime Version          9.1 / 9.1  CUDA Capability Major/Minor version number:    6.1  Total amount of global memory:                 6078 MBytes (6373572608 bytes)  (10) Multiprocessors, (128) CUDA Cores/MP:     1280 CUDA Cores  GPU Max Clock rate:                            1785 MHz (1.78 GHz)  Memory Clock rate:                             4004 Mhz  Memory Bus Width:                              192-bit  L2 Cache Size:                                 1572864 bytes  Maximum Texture Dimension Size (x,y,z)         1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384)  Maximum Layered 1D Texture Size, (num) layers  1D=(32768), 2048 layers  Maximum Layered 2D Texture Size, (num) layers  2D=(32768, 32768), 2048 layers  Total amount of constant memory:               65536 bytes  Total amount of shared memory per block:       49152 bytes  Total number of registers available per block: 65536  Warp size:                                     32  Maximum number of threads per multiprocessor:  2048  Maximum number of threads per block:           1024  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)  Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)  Maximum memory pitch:                          2147483647 bytes  Texture alignment:                             512 bytes  Concurrent copy and kernel execution:          Yes with 2 copy engine(s)  Run time limit on kernels:                     No  Integrated GPU sharing Host Memory:            No  Support host page-locked memory mapping:       Yes  Alignment requirement for Surfaces:            Yes  Device has ECC support:                        Disabled  Device supports Unified Addressing (UVA):      Yes  Supports Cooperative Kernel Launch:            Yes  Supports MultiDevice Co-op Kernel Launch:      Yes  Device PCI Domain ID / Bus ID / location ID:   0 / 2 / 0  Compute Mode:     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;Device 1: &quot;GeForce GTX 1050 Ti&quot;  CUDA Driver Version / Runtime Version          9.1 / 9.1  CUDA Capability Major/Minor version number:    6.1  Total amount of global memory:                 4040 MBytes (4235919360 bytes)  ( 6) Multiprocessors, (128) CUDA Cores/MP:     768 CUDA Cores  GPU Max Clock rate:                            1392 MHz (1.39 GHz)  Memory Clock rate:                             3504 Mhz  Memory Bus Width:                              128-bit  L2 Cache Size:                                 1048576 bytes  Maximum Texture Dimension Size (x,y,z)         1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384)  Maximum Layered 1D Texture Size, (num) layers  1D=(32768), 2048 layers  Maximum Layered 2D Texture Size, (num) layers  2D=(32768, 32768), 2048 layers  Total amount of constant memory:               65536 bytes  Total amount of shared memory per block:       49152 bytes  Total number of registers available per block: 65536  Warp size:                                     32  Maximum number of threads per multiprocessor:  2048  Maximum number of threads per block:           1024  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)  Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)  Maximum memory pitch:                          2147483647 bytes  Texture alignment:                             512 bytes  Concurrent copy and kernel execution:          Yes with 2 copy engine(s)  Run time limit on kernels:                     No  Integrated GPU sharing Host Memory:            No  Support host page-locked memory mapping:       Yes  Alignment requirement for Surfaces:            Yes  Device has ECC support:                        Disabled  Device supports Unified Addressing (UVA):      Yes  Supports Cooperative Kernel Launch:            Yes  Supports MultiDevice Co-op Kernel Launch:      Yes  Device PCI Domain ID / Bus ID / location ID:   0 / 1 / 0  Compute Mode:     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;&gt; Peer access from GeForce GTX 1060 6GB (GPU0) -&gt; GeForce GTX 1050 Ti (GPU1) : No&gt; Peer access from GeForce GTX 1050 Ti (GPU1) -&gt; GeForce GTX 1060 6GB (GPU0) : NodeviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 9.1, CUDA Runtime Version = 9.1, NumDevs = 2Result = PASS</code></pre><p>ä¸Šé¢<code>Result = PASS</code>è¯´æ˜æ ¡éªŒé€šè¿‡ã€‚</p><pre><code>[root@localhost bandwidthTest]# ./bandwidthTest[CUDA Bandwidth Test] - Starting...Running on... Device 0: GeForce GTX 1060 6GB Quick Mode Host to Device Bandwidth, 1 Device(s) PINNED Memory Transfers   Transfer Size (Bytes)        Bandwidth(MB/s)   33554432                     6374.1 Device to Host Bandwidth, 1 Device(s) PINNED Memory Transfers   Transfer Size (Bytes)        Bandwidth(MB/s)   33554432                     6448.6 Device to Device Bandwidth, 1 Device(s) PINNED Memory Transfers   Transfer Size (Bytes)        Bandwidth(MB/s)   33554432                     144068.5Result = PASSNOTE: The CUDA Samples are not meant for performance measurements. Results may vary when GPU Boost is enabled.</code></pre><p><code>Result = PASS</code>è¯´æ˜é€šä¿¡æ­£å¸¸ã€‚</p><h2 id="5-å®‰è£…cuDNN"><a href="#5-å®‰è£…cuDNN" class="headerlink" title="5.å®‰è£…cuDNN"></a>5.å®‰è£…cuDNN</h2><p>é¦–å…ˆä¸‹è½½å’ŒCUDAå¯¹åº”ç‰ˆæœ¬çš„cuDNNçš„ç‰ˆæœ¬ã€‚ä¸‹è½½åœ°å€åœ¨<a href="https://developer.nvidia.com/rdp/cudnn-download" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸ŠæŸä¸ªç›®å½•ï¼Œè¿›è¡Œæ“ä½œã€‚é¦–å…ˆä¸‹è½½çš„æ–‡ä»¶ä¸ºå‹ç¼©æ ¼å¼çš„ï¼Œä¸»è¦æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre><code class="shell"># åˆ‡æ¢åˆ°å‹ç¼©åŒ…ä½ç½®cp cudnn-9.1-linux-x64-v7.1.solitairetheme8 cudnn-9.1-linux-x64-v7.1.tgztar -xvf cudnn-9.1-linux-x64-v7.1.tgzcp ./lib64/* /usr/local/cuda-9.1/lib64/cp ./include/* /usr/local/cuda-9.1/include/chmod a+r /usr/local/cuda-9.1/include/cudnn.h /usr/local/cuda-9.1/lib64/libcudnn*</code></pre><p>é€šè¿‡ä¸Šé¢çš„è¿‡ç¨‹å°±å®‰è£…é…ç½®å®Œæˆäº†ã€‚</p><h2 id="6-å®‰è£…tensorflow-gpu"><a href="#6-å®‰è£…tensorflow-gpu" class="headerlink" title="6.å®‰è£…tensorflow-gpu"></a>6.å®‰è£…tensorflow-gpu</h2><h3 id="6-1-Anacondaå®‰è£…"><a href="#6-1-Anacondaå®‰è£…" class="headerlink" title="6.1 Anacondaå®‰è£…"></a>6.1 Anacondaå®‰è£…</h3><p>åœ¨æ¸…åå¤§å­¦çš„é•œåƒç½‘ç«™ï¼ˆ<a href="https://mirrors.tuna.tsinghua.edu.cn/ï¼‰ä¸Šä¸‹è½½æœ€æ–°çš„Anacondaç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸‹è½½çš„æ˜¯5.1.0ç‰ˆæœ¬ï¼Œpythonç‰ˆæœ¬ä¸º3.6.4ï¼Œç„¶åè¿›è¡Œå®‰è£…ï¼š" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/ï¼‰ä¸Šä¸‹è½½æœ€æ–°çš„Anacondaç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸‹è½½çš„æ˜¯5.1.0ç‰ˆæœ¬ï¼Œpythonç‰ˆæœ¬ä¸º3.6.4ï¼Œç„¶åè¿›è¡Œå®‰è£…ï¼š</a></p><pre><code class="shell">sh Anaconda3-5.1.0-Linux-x86_64.sh# prefixå¤„è¾“å…¥/opt/anaconda3ï¼Œå°†anacondaå®‰è£…åˆ°/opt/anacondaç›®å½•ä¸‹# å¹¶å°†pythonå’Œanacondaçš„binç›®å½•åŠ å…¥åˆ°.bashrcä¸‹</code></pre><p>å®‰è£…äº†anacondaåï¼Œå°†pipï¼Œnumpyï¼Œscipyï¼Œmatplotlibï¼Œpandasï¼Œjupyter-notebookç­‰éƒ½é›†æˆäº†ï¼Œå†å®‰è£…ä¸€ä¸ªæŸ¥çœ‹gpuçŠ¶æ€çš„å·¥å…·ï¼š</p><pre><code class="shell">pip install gpustat</code></pre><h3 id="6-2-å®‰è£…Tensorflowçš„GPUç‰ˆæœ¬"><a href="#6-2-å®‰è£…Tensorflowçš„GPUç‰ˆæœ¬" class="headerlink" title="6.2 å®‰è£…Tensorflowçš„GPUç‰ˆæœ¬"></a>6.2 å®‰è£…Tensorflowçš„GPUç‰ˆæœ¬</h3><p>åœ¨å®‰è£…äº†anacondaåï¼Œå¯ä»¥å®‰è£…ä¸€ä¸ªæŸ¥çœ‹GPUçŠ¶æ€çš„å·¥å…·ï¼Œé€šè¿‡pipè¿›è¡Œå®‰è£…å³å¯ï¼š<code>pip install gpustat</code>ã€‚å®‰è£…tensorflowç›´æ¥æ‰§è¡Œ<code>conda install tensorflow-gpu</code>ï¼Œä¼šè‡ªåŠ¨å®‰è£…tensorflowçš„GPUç‰ˆæœ¬å¹¶å°†cudaçš„ç›¸å…³åŠ¨æ€é“¾æ¥åº“å®‰è£…å¥½ï¼Œcudaç›¸å…³çš„åŠ¨æ€åº“éƒ½å·²ç»å®‰è£…åœ¨äº†<code>${CONDA_HOME}/anaconda3/lib</code>ã€‚</p><p>ç”±äºcondaä¸Šé¢æ”¯æŒçš„<code>tensorflow-gpu</code>ç‰ˆæœ¬ï¼Œå› æ­¤condaå®‰è£…<code>tensorflow-gpu</code>ä¼šå°†cudnnï¼Œcudaä»¥åŠmklä¸€èµ·å®‰è£…ï¼Œç‰ˆæœ¬ä¼šè‡ªåŠ¨å¯¹åº”ï¼Œå› æ­¤ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®¹æ˜“ï¼Œä¸”ä¸å®¹æ˜“å‡ºé”™ã€‚</p><p>è¿˜å¯ä»¥é€šè¿‡pipæ¥å®‰è£…æœ€æ–°çš„<code>tensorflow</code>ç‰ˆæœ¬ï¼š<code>pip install tensorflow-gpu</code>ï¼Œpipä¼šæ‰¾åˆ°ç›¸åº”çš„ç‰ˆæœ¬å®‰è£…ã€‚å®‰è£…åå¯èƒ½ä¼šå‡ºç°GPUä¸å¯ç”¨çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µåŸºæœ¬æ˜¯tensorflowå®‰è£…çš„ç‰ˆæœ¬é—®é¢˜ã€‚</p><p>å®‰è£…å®Œæˆåè¿›è¡Œæµ‹è¯•ï¼š</p><pre><code class="shell">&gt;&gt;&gt; hello = tf.constant(&#39;Hello, Tensorflow&#39;)&gt;&gt;&gt; sess = tf.Session()2018-04-16 02:26:55.745130: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA2018-04-16 02:26:56.924933: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero2018-04-16 02:26:56.925576: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1344] Found device 0 with properties:name: GeForce GTX 1060 6GB major: 6 minor: 1 memoryClockRate(GHz): 1.7845pciBusID: 0000:02:00.0totalMemory: 5.94GiB freeMemory: 5.86GiB2018-04-16 02:26:56.992033: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero2018-04-16 02:26:56.992277: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1344] Found device 1 with properties:name: GeForce GTX 1050 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.392pciBusID: 0000:01:00.0totalMemory: 3.94GiB freeMemory: 3.89GiB2018-04-16 02:26:56.992325: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1408] Ignoring visible gpu device (device: 1, name: GeForce GTX 1050 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1) with Cuda multiprocessor count: 6. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.2018-04-16 02:26:56.992342: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1423] Adding visible gpu devices: 02018-04-16 02:26:57.159155: I tensorflow/core/common_runtime/gpu/gpu_device.cc:911] Device interconnect StreamExecutor with strength 1 edge matrix:2018-04-16 02:26:57.159213: I tensorflow/core/common_runtime/gpu/gpu_device.cc:917]      0 12018-04-16 02:26:57.159237: I tensorflow/core/common_runtime/gpu/gpu_device.cc:930] 0:   N N2018-04-16 02:26:57.159245: I tensorflow/core/common_runtime/gpu/gpu_device.cc:930] 1:   N N2018-04-16 02:26:57.159377: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1041] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 5649 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 1060 6GB, pci bus id: 0000:02:00.0, compute capability: 6.1)&gt;&gt;&gt; print(sess.run(hello))b&#39;Hello, Tensorflow&#39;</code></pre><h3 id="6-3-å®‰è£…keras"><a href="#6-3-å®‰è£…keras" class="headerlink" title="6.3 å®‰è£…keras"></a>6.3 å®‰è£…keras</h3><p>å®‰è£…kerasè¾ƒç®€å•ï¼Œç›´æ¥ç”¨pipå®‰è£…å³å¯ï¼š<code>pip install keras</code>ï¼Œä¼šè‡ªåŠ¨å®‰è£…åˆ°site-packagesï¼Œè¿›å…¥åˆ°/root/.keras/keras.jsonæ–‡ä»¶ä¿®æ”¹backedä¸ºtensorflowï¼š</p><pre><code class="json">{    &quot;floatx&quot;: &quot;float32&quot;,    &quot;epsilon&quot;: 1e-07,    &quot;backend&quot;: &quot;tensorflow&quot;,    &quot;image_data_format&quot;: &quot;channels_last&quot;}</code></pre><h2 id="7-é…ç½®jupyter-notebookæˆ–jupyter-lab"><a href="#7-é…ç½®jupyter-notebookæˆ–jupyter-lab" class="headerlink" title="7.é…ç½®jupyter-notebookæˆ–jupyter-lab"></a>7.é…ç½®jupyter-notebookæˆ–jupyter-lab</h2><p>jupyteré…ç½®å¥½åï¼Œå¯ä»¥è¿œç¨‹è¿æ¥æœåŠ¡å™¨ä¸Šçš„jupyter-serverï¼Œæ–¹ä¾¿å¤šäººä½¿ç”¨anacondaçš„ç¯å¢ƒã€‚é¦–å…ˆï¼Œéœ€è¦å¯¹jupyterçš„cnfigè¿›è¡Œé…ç½®ï¼Œå…ˆç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><pre><code class="shell">jupyter notebook --generate-config# Writing default config to: /root/.jupyter/jupyter_notebook_config.py</code></pre><p>åœ¨è®¾ç½®æœåŠ¡å™¨ç™»é™†çš„å¯†ç ï¼š</p><pre><code class="python">In [1]: from notebook.auth import passwdIn [2]: passwd()Enter password:Verify password:Out[2]: &#39;sha1:1c5cf71ad9a3:dad7ae0af719426816841d239f5e8247176dd0adsf&#39;</code></pre><p>å°†ç”Ÿæˆçš„<code>sha1:...</code>å¤åˆ¶ä¸‹æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®(<code>vim ~/.jupyter/jupyter_notebook_config.py</code>)ï¼Œé…ç½®é¡¹ä¸»è¦æœ‰ï¼š</p><pre><code class="shell">c.NotebookApp.password =c.NotebookApp.port = 8888c.NotebookApp.allow_root = Truec.NotebookApp.open_browser = Falsec.NotebookApp.notebook_dir = &#39;/opt/workspace&#39;</code></pre><p>å¼€æ”¾ç›¸åº”çš„ç«¯å£ï¼š</p><pre><code class="shell">[root@localhost cuda]# firewall-cmd --zone=public --add-port=8888/tcp --permanent[root@localhost cuda]# firewall-cmd --zone=public --add-port=8889/tcp --permanent[root@localhost cuda]# firewall-cmd --reload</code></pre><h2 id="8-å¯èƒ½å‡ºç°çš„é”™è¯¯åŠè§£å†³åŠæ³•"><a href="#8-å¯èƒ½å‡ºç°çš„é”™è¯¯åŠè§£å†³åŠæ³•" class="headerlink" title="8.å¯èƒ½å‡ºç°çš„é”™è¯¯åŠè§£å†³åŠæ³•"></a>8.å¯èƒ½å‡ºç°çš„é”™è¯¯åŠè§£å†³åŠæ³•</h2><h3 id="8-1-å‡ºç°é”™è¯¯-39-GLIBC-2-23-39-not-fund"><a href="#8-1-å‡ºç°é”™è¯¯-39-GLIBC-2-23-39-not-fund" class="headerlink" title="8.1 å‡ºç°é”™è¯¯&#39;GLIBC_2.23&#39; not fund"></a>8.1 å‡ºç°é”™è¯¯<code>&#39;GLIBC_2.23&#39; not fund</code></h3><p><code>ImportError: /lib64/libm.so.6: version GLIBC_2.23&#39; not found (required by /opt/anaconda3/lib/python3.6/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so)</code></p><pre><code class="shell">mkdir ~/glibccd ~/glibc wget http://ftp.gnu.org/gnu/glibc/glibc-2.23.tar.gztar zxvf glibc-2.23.tar.gzcd glibc-2.23mkdir buildcd build../configure --prefix=/opt/glibc-2.23make -j4sudo make installexport LD_LIBRARY_PATH=/opt/glibc-2.23/lib</code></pre><p>è¿™ä¸ªé”™è¯¯ä¿®å¤åå¯èƒ½ä¼šå‡ºç°pythonæ— æ³•ä½¿ç”¨çš„æƒ…å†µã€‚pythonæœ€åˆæ˜¯æ ¹æ®glibc-2.17å®‰è£…çš„ï¼Œå› æ­¤pythonä¼šå‡ºç°é—®é¢˜ã€‚ä½†æ˜¯è¿™ç§æ”¾è‚†èƒ½è§£å†³ä¸Šé¢çš„é”™è¯¯ã€‚åœ¨å…¶ä»–åœºæ™¯èƒ½é€šè¿‡è¿™ç§æ–¹å¼ã€‚</p><h3 id="8-2å‡ºç°é”™è¯¯ï¼šInvalidArgumentError"><a href="#8-2å‡ºç°é”™è¯¯ï¼šInvalidArgumentError" class="headerlink" title="8.2å‡ºç°é”™è¯¯ï¼šInvalidArgumentError"></a>8.2å‡ºç°é”™è¯¯ï¼š<code>InvalidArgumentError</code></h3><p>å‡ºç°é”™è¯¯å¦‚ä¸‹ï¼Œåªæ£€æµ‹åˆ°äº†CPUä½†æ˜¯æ²¡æœ‰æ£€æµ‹åˆ°GPUã€‚åŸºæœ¬æ˜¯tensorflowçš„ç‰ˆæœ¬å’Œcudaå’Œcudnnçš„ç‰ˆæœ¬æœªåŒ¹é…ã€‚å¦‚æœå¯ä»¥é€šè¿‡condaæ¥å®‰è£…å°±é€šè¿‡condaå®‰è£…ï¼Œä¼šè‡ªåŠ¨åŒ¹é…å¯¹åº”çš„ç‰ˆæœ¬ã€‚</p><pre><code class="tex">(see above for traceback): Cannot assign a device for operation &#39;matmul/bias&#39;: Operation was illuminated assigned to /device:GPU:1 but available devices are [/job:localhost/replica:0/task:0/device :CPU:0 ]. Make sure the device specification refers to a valid device`</code></pre><p>è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œåªèƒ½æ£€æµ‹åˆ°ä¸€ä¸ªCPUï¼Œå¦å¤–ä¸€ä¸ªCPUä¸åœ¨GPUåˆ—è¡¨ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸»è¦æ˜¯å› ä¸ºtensorflowå•æœºé»˜è®¤åªæ˜¯ç”¨ä¸€ä¸ªGPUï¼Œå› æ­¤éœ€è¦è¿›è¡ŒæŒ‡å®šæŸä¸ªGPUï¼Œä½†æ˜¯éœ€è¦è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡<code>TF_MIN_GPU_MULTIPROCESSOR_COUNT</code>ã€‚åœ¨ç³»ç»Ÿç§å¯ä»¥è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡<code>export TF_MIN_GPU_MULTIPROCESSOR_COUNT=2</code>ï¼›åœ¨å·¥ç¨‹ç§åº”ç”¨æ—¶éœ€è¦é€šè¿‡ä»£ç è®¾ç½®ä¸‹ç¯å¢ƒå˜é‡ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="python">import osos.environ[&#39;TF_MIN_GPU_MULTIPROCESSOR_COUNT&#39;] = &#39;2&#39;</code></pre><h3 id="8-3-å‡ºç°FutureWarningè­¦å‘Š"><a href="#8-3-å‡ºç°FutureWarningè­¦å‘Š" class="headerlink" title="8.3 å‡ºç°FutureWarningè­¦å‘Š"></a>8.3 å‡ºç°FutureWarningè­¦å‘Š</h3><p>å‡ºç°è¿™ä¸ªè­¦å‘Š<code>FutureWarning: Conversion of the second argument of issubdtype from float to np.floating is deprecated. In future, it will be treated as np.float64 == np.dtype(float).type</code>.è§£å†³åŠæ³•ï¼šæ›´æ–°_h5py_çš„ç‰ˆæœ¬åˆ°_2.8.0rc1_ï¼Œé€šè¿‡<code>pip install h5py==2.8.0rc1</code>å‘½ä»¤æ¥æ›´æ–°ã€‚</p><h2 id="9-Refrence"><a href="#9-Refrence" class="headerlink" title="9.Refrence"></a>9.Refrence</h2><p>1.<a href="https://wizardforcel.gitbooks.io/vbird-linux-basic-4e/content/204.html" target="_blank" rel="noopener">Linuxé©±åŠ¨ç¨‹åºå®‰è£…èŒƒä¾‹</a></p><p>2.<a href="http://infonook.org/centos-bumblebee-nvidia/" target="_blank" rel="noopener">CentOS 7(1708) Intel+NvidiaåŒæ˜¾å¡ç¬”è®°æœ¬å®‰è£…Nvidiaé©±åŠ¨å¹¶ç”¨Bumblebeeæ§åˆ¶ç‹¬æ˜¾</a></p><p>3.<a href="https://wiki.archlinux.org/index.php/Bumblebee_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank" rel="noopener">Bumblebee wiki</a></p><p>4.<a href="http://notes.maxwi.com/2017/02/26/ubuntu-cuda8-env-set/" target="_blank" rel="noopener">CUDAçš„å®‰è£…é…ç½®</a></p><p>5.<a href="http://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html#installlinux" target="_blank" rel="noopener">cuDNNå®˜æ–¹é…ç½®</a></p><p>6.<a href="https://ying-zhang.github.io/cloud/2017/setup-tensorflow-gpu-centos7/" target="_blank" rel="noopener">Centos7å®‰è£…tensorflowæ·±åº¦å­¦ä¹ ç¯å¢ƒ</a></p>]]></content>
    
    
    <categories>
      
      <category>deep learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tensorflow</tag>
      
      <tag>gpu</tag>
      
      <tag>deeplearning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AWSä¸ŠEC2ä¸»æœº(ubuntu)ä¸‹å¯¹æŸä¸ªç«¯å£çš„å¼€æ”¾</title>
    <link href="/2018/04/18/AWS%E4%B8%8AEC2%E4%B8%BB%E6%9C%BA%E4%B8%8B%E5%AF%B9%E6%9F%90%E4%B8%AA%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%BC%80%E6%94%BE/"/>
    <url>/2018/04/18/AWS%E4%B8%8AEC2%E4%B8%BB%E6%9C%BA%E4%B8%8B%E5%AF%B9%E6%9F%90%E4%B8%AA%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%BC%80%E6%94%BE/</url>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆç”¨telnetæ¥çœ‹ä¸‹æœ¬åœ°çš„ç«¯å£æ˜¯å¦å¼€å¯ï¼š<code>telnet ip 7711</code>ï¼Œå¦‚æœæ˜¯æ­£å¸¸çš„é‚£ä¹ˆéœ€è¦å¯¹è¯¥ç«¯å£è¿›è¡Œå¼€æ”¾ã€‚é¦–å…ˆéœ€è¦å¯¹æœ¬åœ°çš„é˜²ç«å¢™ç«¯å£è¿›è¡Œå¼€æ”¾ã€‚å…¶ä»–éœ€è¦å¯¹AWSä¸Šçš„å®‰å…¨ç»„è¿›è¡Œè®¾ç½®ï¼Œè®¾ç½®ä¸ºå¯¹åº”çš„ç«¯å£æˆ–æ‰€æœ‰ç«¯å£å¼€æ”¾æƒé™ã€‚æœ¬æ–‡ä¸­ä¸å¯¹AWSå®‰å…¨ç»„çš„è®¾ç½®è¯´æ˜ï¼Œè‡ªè¡Œgoogleå³å¯ã€‚</p><pre><code class="shell">iptables-save &gt; /${DIR_PATH)}/iptables.rules</code></pre><a id="more"></a>ç¼–è¾‘`/${DIR_PATH)}/iptables.rules`<pre><code class="tex"># Generated by iptables-save v1.6.0 on Wed Apr 18 03:08:40 2018*mangle:PREROUTING ACCEPT [1427:334897]:INPUT ACCEPT [1427:334897]:FORWARD ACCEPT [0:0]:OUTPUT ACCEPT [1092:144305]:POSTROUTING ACCEPT [1092:144305]:FORWARD_direct - [0:0]:INPUT_direct - [0:0]:OUTPUT_direct - [0:0]:POSTROUTING_direct - [0:0]:PREROUTING_ZONES - [0:0]:PREROUTING_ZONES_SOURCE - [0:0]:PREROUTING_direct - [0:0]:PRE_public - [0:0]:PRE_public_allow - [0:0]:PRE_public_deny - [0:0]:PRE_public_log - [0:0]-A PREROUTING -j PREROUTING_direct-A PREROUTING -j PREROUTING_ZONES_SOURCE-A PREROUTING -j PREROUTING_ZONES-A INPUT -j INPUT_direct-A FORWARD -j FORWARD_direct-A OUTPUT -j OUTPUT_direct-A POSTROUTING -j POSTROUTING_direct-A PREROUTING_ZONES -g PRE_public-A PRE_public -j PRE_public_log-A PRE_public -j PRE_public_deny-A PRE_public -j PRE_public_allowCOMMIT# Completed on Wed Apr 18 03:08:40 2018# Generated by iptables-save v1.6.0 on Wed Apr 18 03:08:40 2018*security:INPUT ACCEPT [1327:356187]:FORWARD ACCEPT [0:0]:OUTPUT ACCEPT [1095:144849]:FORWARD_direct - [0:0]:INPUT_direct - [0:0]:OUTPUT_direct - [0:0]-A INPUT -j INPUT_direct-A FORWARD -j FORWARD_direct-A OUTPUT -j OUTPUT_directCOMMIT# Completed on Wed Apr 18 03:08:40 2018# Generated by iptables-save v1.6.0 on Wed Apr 18 03:08:40 2018*raw:PREROUTING ACCEPT [1433:361586]:OUTPUT ACCEPT [1095:144849]:OUTPUT_direct - [0:0]:PREROUTING_direct - [0:0]-A PREROUTING -j PREROUTING_direct-A OUTPUT -j OUTPUT_directCOMMIT# Completed on Wed Apr 18 03:08:40 2018# Generated by iptables-save v1.6.0 on Wed Apr 18 03:08:40 2018*nat:PREROUTING ACCEPT [115:6083]:INPUT ACCEPT [19:1084]:OUTPUT ACCEPT [9:920]:POSTROUTING ACCEPT [9:920]:OUTPUT_direct - [0:0]:POSTROUTING_ZONES - [0:0]:POSTROUTING_ZONES_SOURCE - [0:0]:POSTROUTING_direct - [0:0]:POST_public - [0:0]:POST_public_allow - [0:0]:POST_public_deny - [0:0]:POST_public_log - [0:0]:PREROUTING_ZONES - [0:0]:PREROUTING_ZONES_SOURCE - [0:0]:PREROUTING_direct - [0:0]:PRE_public - [0:0]:PRE_public_allow - [0:0]:PRE_public_deny - [0:0]:PRE_public_log - [0:0]-A PREROUTING -j PREROUTING_direct-A PREROUTING -j PREROUTING_ZONES_SOURCE-A PREROUTING -j PREROUTING_ZONES-A OUTPUT -j OUTPUT_direct-A POSTROUTING -j POSTROUTING_direct-A POSTROUTING -j POSTROUTING_ZONES_SOURCE-A POSTROUTING -j POSTROUTING_ZONES-A POSTROUTING_ZONES -g POST_public-A POST_public -j POST_public_log-A POST_public -j POST_public_deny-A POST_public -j POST_public_allow-A PREROUTING_ZONES -g PRE_public-A PRE_public -j PRE_public_log-A PRE_public -j PRE_public_deny-A PRE_public -j PRE_public_allowCOMMIT# Completed on Wed Apr 18 03:08:40 2018# Generated by iptables-save v1.6.0 on Wed Apr 18 03:08:40 2018*filter:INPUT ACCEPT [0:0]:FORWARD ACCEPT [0:0]:OUTPUT ACCEPT [677:90233]:FORWARD_IN_ZONES - [0:0]:FORWARD_IN_ZONES_SOURCE - [0:0]:FORWARD_OUT_ZONES - [0:0]:FORWARD_OUT_ZONES_SOURCE - [0:0]:FORWARD_direct - [0:0]:FWDI_public - [0:0]:FWDI_public_allow - [0:0]:FWDI_public_deny - [0:0]:FWDI_public_log - [0:0]:FWDO_public - [0:0]:FWDO_public_allow - [0:0]:FWDO_public_deny - [0:0]:FWDO_public_log - [0:0]:INPUT_ZONES - [0:0]:INPUT_ZONES_SOURCE - [0:0]:INPUT_direct - [0:0]:IN_public - [0:0]:IN_public_allow - [0:0]:IN_public_deny - [0:0]:IN_public_log - [0:0]:OUTPUT_direct - [0:0]:ufw-after-forward - [0:0]:ufw-after-input - [0:0]:ufw-after-logging-forward - [0:0]:ufw-after-logging-input - [0:0]:ufw-after-logging-output - [0:0]:ufw-after-output - [0:0]:ufw-before-forward - [0:0]:ufw-before-input - [0:0]:ufw-before-logging-forward - [0:0]:ufw-before-logging-input - [0:0]:ufw-before-logging-output - [0:0]:ufw-before-output - [0:0]:ufw-reject-forward - [0:0]:ufw-reject-input - [0:0]:ufw-reject-output - [0:0]:ufw-track-forward - [0:0]:ufw-track-input - [0:0]:ufw-track-output - [0:0]-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT-A INPUT -i lo -j ACCEPT-A INPUT -j INPUT_direct-A INPUT -j INPUT_ZONES_SOURCE-A INPUT -j INPUT_ZONES-A INPUT -p icmp -j ACCEPT-A INPUT -m conntrack --ctstate INVALID -j DROP-A INPUT -j REJECT --reject-with icmp-host-prohibited-A INPUT -j ufw-before-logging-input-A INPUT -j ufw-before-input-A INPUT -j ufw-after-input-A INPUT -j ufw-after-logging-input-A INPUT -j ufw-reject-input-A INPUT -j ufw-track-input-A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT-A FORWARD -i lo -j ACCEPT-A FORWARD -j FORWARD_direct-A FORWARD -j FORWARD_IN_ZONES_SOURCE-A FORWARD -j FORWARD_IN_ZONES-A FORWARD -j FORWARD_OUT_ZONES_SOURCE-A FORWARD -j FORWARD_OUT_ZONES-A FORWARD -p icmp -j ACCEPT-A FORWARD -m conntrack --ctstate INVALID -j DROP-A FORWARD -j REJECT --reject-with icmp-host-prohibited-A FORWARD -j ufw-before-logging-forward-A FORWARD -j ufw-before-forward-A FORWARD -j ufw-after-forward-A FORWARD -j ufw-after-logging-forward-A FORWARD -j ufw-reject-forward-A FORWARD -j ufw-track-forward-A OUTPUT -j OUTPUT_direct-A OUTPUT -j ufw-before-logging-output-A OUTPUT -j ufw-before-output-A OUTPUT -j ufw-after-output-A OUTPUT -j ufw-after-logging-output-A OUTPUT -j ufw-reject-output-A OUTPUT -j ufw-track-output-A FORWARD_IN_ZONES -g FWDI_public-A FORWARD_OUT_ZONES -g FWDO_public-A FWDI_public -j FWDI_public_log-A FWDI_public -j FWDI_public_deny-A FWDI_public -j FWDI_public_allow-A FWDO_public -j FWDO_public_log-A FWDO_public -j FWDO_public_deny-A FWDO_public -j FWDO_public_allow-A INPUT_ZONES -g IN_public-A IN_public -j IN_public_log-A IN_public -j IN_public_deny-A IN_public -j IN_public_allow-A IN_public_allow -p tcp -m tcp --dport 22 -m conntrack --ctstate NEW -j ACCEPTCOMMIT# Completed on Wed Apr 18 03:08:40 2018</code></pre><p>å°†éœ€è¦å¼€æ”¾çš„ç«¯å£(ç«¯å£å·è‡ªè¡Œä¿®æ”¹)åŠ å…¥åˆ°è¯¥æ–‡ä»¶ä¸­çš„COMMITå‰ï¼š</p><pre><code>-A IN_public_allow -p tcp -m tcp --dport 7711 -m conntrack --ctstate NEW -j ACCEPT-A IN_public_allow -p tcp -m tcp --dport 7712 -m conntrack --ctstate NEW -j ACCEPT-A IN_public_allow -p tcp -m tcp --dport 7713 -m conntrack --ctstate NEW -j ACCEPT-A IN_public_allow -p tcp -m tcp --dport 7714 -m conntrack --ctstate NEW -j ACCEPT</code></pre><p>æ¢å¤è§„åˆ™ï¼š<code>iptables-restore ./iptables.rules</code>ï¼Œå†ä½¿ç”¨ä½¿ç”¨ufwå‘½ä»¤æ¥reloadï¼š<code>sudo ufw reload</code>ã€‚ä¸‹é¢å¯ä»¥åœ¨å…¶ä»–æœºå™¨ä¸Šæ¥è¿œç¨‹pingä¸‹ç«¯å£æ˜¯å¦æ­£å¸¸ï¼š<code>telnet ip 7711</code>ã€‚</p><p>ä¸Šé¢çš„è¿‡ç¨‹å¯ä»¥è§£å†³<code>telnet: connect to address ip: No route to host</code>çš„é—®é¢˜ã€‚</p><pre><code class="shell">[root@localhost ~]# telnet 13.59.15.195 7712Trying 13.59.15.96...telnet: connect to address 13.59.15.195: No route to host</code></pre>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ubuntu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonç§‘å­¦è®¡ç®—åŠ é€Ÿ</title>
    <link href="/2018/04/14/python%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E5%8A%A0%E9%80%9F/"/>
    <url>/2018/04/14/python%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E5%8A%A0%E9%80%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="1-ä½¿ç”¨GPU"><a href="#1-ä½¿ç”¨GPU" class="headerlink" title="1.ä½¿ç”¨GPU"></a>1.ä½¿ç”¨GPU</h2><p>ä½¿ç”¨GPUæœ‰ä¸¤ç§æ–¹å¼ï¼šnumbaå’Œpycudaï¼Œå¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªpackageå’Œpythonå®ç°CUDAç¨‹åºã€‚</p><h3 id="1-1-numba"><a href="#1-1-numba" class="headerlink" title="1.1 numba"></a>1.1 numba</h3><p>CUDAå®˜æ–¹åŠ é€Ÿæ˜¯é€šè¿‡numbaæ¥ä½¿ç”¨GPUæˆ–CPUåŠ é€Ÿï¼Œåœ¨å¾ˆæ—©ä»¥å‰æ˜¯é€šè¿‡numbaproå®ç°çš„ï¼Œå±äºæ”¶è´¹ç‰ˆæœ¬ï¼Œåé¢å…¨éƒ¨æ•´åˆæˆäº†numbaå’Œaccelerateï¼Œè€Œä¸”å…è´¹å¼€æ”¾ï¼Œåœ¨Anacondaç¯å¢ƒä¸‹å·²ç»å®‰è£…äº†numbaï¼Œåªéœ€è¦ä½¿ç”¨å³å¯ã€‚ä½¿ç”¨numbaçš„GPUåŠ é€Ÿéœ€è¦è¿›è¡Œé…ç½®ã€‚å…·ä½“é…ç½®æ–¹å¼å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p><p>Refrence</p><p>[1].numbaå®˜æ–¹åœ°å€ï¼š<a href="http://numba.pydata.org/" target="_blank" rel="noopener">http://numba.pydata.org/</a></p><p>[2].numbaå®˜æ–¹æ–‡æ¡£ï¼š<a href="http://numba.pydata.org/doc.html" target="_blank" rel="noopener">http://numba.pydata.org/doc.html</a></p><p>[3].numbaé…ç½®CUDAçš„GPUï¼š<a href="http://blog.csdn.net/u013975830/article/details/78822919" target="_blank" rel="noopener">http://blog.csdn.net/u013975830/article/details/78822919</a><a id="more"></a></p><h3 id="1-2-pycudapy"><a href="#1-2-pycudapy" class="headerlink" title="1.2 pycudapy"></a>1.2 pycudapy</h3><p>cudaä¹Ÿæ˜¯æä¾›pythonåˆ°gpuçš„æ¥å£ï¼Œç®€å•å¯ä»¥ä½¿ç”¨pycudaè‡ªèº«çš„æ¥å£å®ç°ï¼Œå¤æ‚çš„å°±éœ€è¦è‡ªå·±å®ç°cudaç¨‹åºå†é€šè¿‡pycudaå®ç°ã€‚</p><p>Refrence</p><p>[1].CUDAå’Œpycudaç¯å¢ƒçš„é…ç½®ï¼š<a href="http://blog.csdn.net/zhouqingtaostudy/article/details/50896948" target="_blank" rel="noopener">http://blog.csdn.net/zhouqingtaostudy/article/details/50896948</a></p><p>[2].pycudaçš„å®˜ç½‘ï¼š<a href="https://documen.tician.de/pycuda/" target="_blank" rel="noopener">https://documen.tician.de/pycuda/</a>    <a href="https://mathema.tician.de/software/pycuda/" target="_blank" rel="noopener">https://mathema.tician.de/software/pycuda/</a></p><p>[3].pycudaçš„tutorialç¿»è¯‘ï¼š<a href="http://blog.cycleuser.org/pycuda-tutorial-zhong-wen-ban.html" target="_blank" rel="noopener">http://blog.cycleuser.org/pycuda-tutorial-zhong-wen-ban.html</a></p><p>[4].pycudaçš„notebookï¼š<a href="http://nbviewer.jupyter.org/github/Kivy-CN/Duke-STA-633-CN/tree/master/%E5%B7%B2%E7%BB%8F%E7%BF%BB%E8%AF%91%E7%9A%84%E8%AE%B2%E5%BA%A7%E5%86%85%E5%AE%B9/Topic21_GPU_Computing/" target="_blank" rel="noopener">http://nbviewer.jupyter.org/github/Kivy-CN/Duke-STA-633-CN/tree/master/å·²ç»ç¿»è¯‘çš„è®²åº§å†…å®¹/Topic21_GPU_Computing/</a></p><p>[5].pycudaçš„ç¿»è¯‘ï¼š<a href="https://zhuanlan.zhihu.com/p/32062796" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32062796</a></p><h2 id="2-ä½¿ç”¨CåŠ é€Ÿ"><a href="#2-ä½¿ç”¨CåŠ é€Ÿ" class="headerlink" title="2.ä½¿ç”¨CåŠ é€Ÿ"></a>2.ä½¿ç”¨CåŠ é€Ÿ</h2><p>pythonä¸­å¯ä»¥ä½¿ç”¨cå®ç°éƒ¨åˆ†åŠŸèƒ½æ¥è¿›è¡ŒåŠ é€Ÿï¼Œæ¯”å¦‚Cythonï¼ŒCythonä¹Ÿå¯ä»¥å’Œnumpyé…åˆä½¿ç”¨ï¼Œæ¥å¯¹numpyè¿›è¡ŒåŠ é€Ÿã€‚</p><h3 id="2-1-CythonåŠ é€Ÿ"><a href="#2-1-CythonåŠ é€Ÿ" class="headerlink" title="2.1 CythonåŠ é€Ÿ"></a>2.1 CythonåŠ é€Ÿ</h3><p>(1) ä½¿ç”¨Cythonå’Œnumpyç»“åˆ    å°†ä¸¤è€…ç»“åˆä½¿ç”¨å¯ä»¥æœ‰æ•ˆçš„åŠ é€Ÿpythonä¸­çš„æ ¸å¿ƒä»£ç ï¼Œä¸‹é¢é€šè¿‡ç¤ºä¾‹è¯´æ˜æ€ä¹ˆç»“åˆã€‚ä¸‹é¢é€šè¿‡cythonçš„å½¢å¼å®ç°ä¸€ä¸ªçŸ©é˜µç‚¹ä¹˜çš„æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼Œæ–‡ä»¶åä¸º<code>multi.pyx</code>ï¼š</p><pre><code class="python">from __future__ import divisioncimport cythonimport numpy as npcimport numpy as npDTYPE = np.float64ctypedef np.float64_t DTYPE_t@cython.boundscheck(False)def multi_product(np.ndarray a, np.ndarray b):    &quot;&quot;&quot;    Parameters    ----------        a: np.ndarray, the shape of (m, n)        b: np.ndarray, the shape of (m, n)    return    ------        np.ndarray, return the array shape of (m, n)    &quot;&quot;&quot;    cdef int a_array_r = a.shape[0]    cdef int a_array_c = a.shape[1]    cdef int b_array_r = b.shape[0]    cdef int b_array_c = b.shape[1]    if a_array_r != b_array_r or a_array_c != b_array_c:        raise Exception(&quot;ValueError: operands could not be broadcast together with shapes %s %s&quot;                       %(str((a_array_r, a_array_c)), str((b_array_r, b_array_c))))     out = np.zeros((a_array_r, a_array_c))    for _r_ in range(a_array_r):        for _c_ in range(a_array_c):             out[_r_, _c_] = a[_r_, _c_] * b[_r_, _c_]    return out</code></pre><p>åˆ›å»ºä¸€ä¸ªsetup.pyçš„æ–‡ä»¶ï¼Œç±»ä¼¼c++ä¸­çš„makefileé…ç½®æ–‡ä»¶ï¼Œsetup.pyæ–‡ä»¶å†…å®¹ä¸»è¦æ—¶é…ç½®ç¼–è¯‘ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class="python">import numpyfrom distutils.core import setup, Extensionfrom Cython.Distutils import build_extsetup(    cmdclass={&#39;build_ext&#39;: build_ext},    ext_modules=[                 Extension(&quot;multi&quot;, [&quot;multi.pyx&quot;],                 include_dirs=[numpy.get_include()])              ])</code></pre><p>ä¸Šé¢setup.pyæ–‡ä»¶ä¸­çš„include_dirséå¸¸é‡è¦ï¼Œå¦åˆ™åœ¨åé¢ç¼–è¯‘pyxæ–‡ä»¶æ—¶ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼šæ‰¾ä¸åˆ°â€numpy/arrayobject.hâ€,å› æ­¤éœ€è¦åœ¨setup.pyæ–‡ä»¶ä¸­å°†ä¾èµ–çš„.hæ–‡ä»¶ç»™æ·»åŠ ä¸Šã€‚ä¸‹é¢é€šè¿‡å‘½ä»¤è¿›è¡Œç¼–è¯‘å³å¯ï¼š</p><pre><code class="shell">python setup.py build_ext --inplace</code></pre><p> ç¼–è¯‘åä¼šç”Ÿæˆ<code>.so</code>æ–‡ä»¶(linuxï¼Œwindowsä¸‹ä¸ºdllæ–‡ä»¶)ã€‚åé¢é€šè¿‡pythonç›´æ¥å¼•ç”¨è¯¥æ–‡ä»¶ï¼Œè°ƒç”¨å…¶ä¸­çš„æ–¹æ³•å³å¯ã€‚ä¸‹é¢å¯¹ä½¿ç”¨cythonå®ç°çš„ç‚¹ä¹˜æ–¹æ³•å’ŒnumpyåŒ…çš„<code>multiply</code>æ–¹æ³•æ•ˆç‡è¿›è¡Œå¯¹æ¯”ï¼š</p><pre><code class="python">import timeitprint(timeit.timeit(stmt=&quot;multi.multi_product(x, y)&quot;, setup=&quot;import multi; import numpy as np; x = np.array([[1, 2, 3], [2.4, 89.0, 11]]); y = np.array([[1, 2, 3], [2.4, 89.0, 11]])&quot;, number=10000))print(timeit.timeit(stmt=&quot;np.multiply(x, y)&quot;, setup=&quot;import numpy as np; x = np.array([[1, 2, 3], [2.4, 89.0, 11]]); y = np.array([[1, 2, 3], [2.4, 89.0, 11]])&quot;, number=10000))# -------- output -------------------0.031960667001840190.006172515997604933</code></pre><p>æ•ˆç‡ä¸Šè¿˜æ˜¯æ¯”ä¸ä¸Šnumpyï¼Œä¸»è¦æ˜¯å› ä¸ºnumpyåœ¨è¿™æ–¹é¢åšäº†æ·±åº¦ä¼˜åŒ–ã€‚ä½†æ˜¯æ¯”çº¯pythonå®ç°çš„æ–¹æ³•è¦å¿«å¾ˆå¤šã€‚<br>Refrence</p><p>[1]Cythonå®˜æ–¹æ–‡æ¡£ï¼š<a href="http://cython.org/" target="_blank" rel="noopener">http://cython.org/</a></p><p>[2].CythonåŸºç¡€æ•™ç¨‹ä¸­æ–‡ç‰ˆï¼š<a href="https://moonlet.gitbooks.io/cython-document-zh_cn/content/ch1-basic_tutorial.html" target="_blank" rel="noopener">https://moonlet.gitbooks.io/cython-document-zh_cn/content/ch1-basic_tutorial.html</a></p><p>[3].Cythonä¸­<code>def</code>, <code>cdef</code>å’Œ<code>cpdef</code>åŒºåˆ«å’Œä½¿ç”¨ï¼š<a href="http://notes-on-cython.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">http://notes-on-cython.readthedocs.io/en/latest/index.html</a></p><p>[4].<a href="http://www.cnblogs.com/lidyan/p/7474244.html" target="_blank" rel="noopener">Cythonä¸­def,cdef,cpdefçš„åŒºåˆ«</a>: <a href="http://www.cnblogs.com/lidyan/p/7474244.html" target="_blank" rel="noopener">http://www.cnblogs.com/lidyan/p/7474244.html</a></p><h3 id="2-2-PyPy-åŠ é€Ÿ"><a href="#2-2-PyPy-åŠ é€Ÿ" class="headerlink" title="2.2 PyPy åŠ é€Ÿ"></a>2.2 <a href="http://pypy.org/" target="_blank" rel="noopener">PyPy</a> åŠ é€Ÿ</h3><p>PyPyæ˜¯ç”¨<a href="https://baike.baidu.com/item/Python" target="_blank" rel="noopener">Python</a>å®ç°çš„Pythonè§£é‡Šå™¨ã€‚</p><p>[1].ç”¨ Psyco è®© Python è¿è¡Œå¾—åƒ C ä¸€æ ·å¿«ï¼š<a href="https://www.ibm.com/developerworks/cn/linux/sdk/python/charm-28/" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/sdk/python/charm-28/</a></p><h3 id="2-3-numexpråŠ é€Ÿ"><a href="#2-3-numexpråŠ é€Ÿ" class="headerlink" title="2.3 numexpråŠ é€Ÿ"></a>2.3 numexpråŠ é€Ÿ</h3><p>ä½¿ç”¨numexpr[<a href="http://numexpr.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">http://numexpr.readthedocs.io/en/latest/index.html</a>]</p><p>Refrence</p><p>[1].ä¼˜åŒ– Python æ€§èƒ½ï¼šPyPyã€Numba ä¸ Cythonæ¯”è¾ƒï¼š<a href="https://www.zhihu.com/question/24695645" target="_blank" rel="noopener">https://www.zhihu.com/question/24695645</a></p><p>[2].numpyçš„c-apiæ¥å£ï¼š<a href="http://python.usyiyi.cn/documents/NumPy_v111/reference/c-api.html" target="_blank" rel="noopener">http://python.usyiyi.cn/documents/NumPy_v111/reference/c-api.html</a></p><p>[3].pythonä¸­ä½¿ç”¨Cä»£ç -ä»¥numpyä¸ºä¾‹ï¼š<a href="https://segmentfault.com/a/1190000000479951" target="_blank" rel="noopener">https://segmentfault.com/a/1190000000479951</a></p><p>[4].<a href="https://github.com/johnnylee/python-numpy-c-extension-examples" target="_blank" rel="noopener">python-numpy-c-extension-examples</a>ï¼š<a href="https://github.com/johnnylee/python-numpy-c-extension-examples" target="_blank" rel="noopener">https://github.com/johnnylee/python-numpy-c-extension-examples</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>numba</tag>
      
      <tag>cython</tag>
      
      <tag>cuda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Youthé’æ˜¥-å¡ç¼ªå°”Â·å„å°”æ›¼</title>
    <link href="/2018/01/22/Youth%E9%9D%92%E6%98%A5-%E5%A1%9E%E7%BC%AA%E5%B0%94%C2%B7%E5%8E%84%E5%B0%94%E6%9B%BC/"/>
    <url>/2018/01/22/Youth%E9%9D%92%E6%98%A5-%E5%A1%9E%E7%BC%AA%E5%B0%94%C2%B7%E5%8E%84%E5%B0%94%E6%9B%BC/</url>
    
    <content type="html"><![CDATA[<blockquote><p>é’æ˜¥ä¸æ˜¯å¹´åï¼Œè€Œæ˜¯å¿ƒå¢ƒï¼›é’æ˜¥ä¸æ˜¯æ¡ƒé¢ã€çº¢å”‡ã€æŸ”è†ï¼Œè€Œæ˜¯åšå¼ºçš„æ„å¿—ã€æ¢å®çš„æƒ³è±¡ã€ç‚½çƒ­çš„æ„Ÿæƒ…ï¼›é’æ˜¥æ˜¯ç”Ÿå‘½æ·±æ³‰çš„è‡ªåœ¨æ¶Œæµã€‚</p><p>é’æ˜¥æ°”è´¯é•¿è™¹ï¼Œå‹‡é”ç›–è¿‡æ€¯å¼±ï¼Œè¿›å–å‹å€’è‹Ÿå®‰ã€‚å¦‚æ­¤é”æ°”ï¼ŒäºŒååç”Ÿæœ‰ä¹‹ï¼Œå…­æ—¬ç”·å­åˆ™æ›´å¤šè§ã€‚å¹´å²æœ‰åŠ ï¼Œå¹¶éå‚è€ï¼›ç†æƒ³ä¸¢å¼ƒï¼Œæ–¹å •æš®å¹´ã€‚</p><p>å²æœˆæ‚ æ‚ ï¼Œè¡°å¾®åªåŠè‚Œè‚¤ï¼›çƒ­å¿±æŠ›å´ï¼Œé¢“åºŸå¿…è‡´çµé­‚ã€‚å¿§çƒ¦ã€æƒ¶æã€ä¸§å¤±è‡ªä¿¡ï¼Œå®šä½¿å¿ƒçµæ‰­æ›²ï¼Œæ„æ°”å¦‚ç°ã€‚</p><p>æ— è®ºå¹´å±ŠèŠ±ç”²ï¼ŒæŠ‘æˆ–äºŒå…«èŠ³é¾„ï¼Œå¿ƒä¸­çš†æœ‰ç”Ÿå‘½ä¹‹æ¬¢ä¹ï¼Œå¥½å¥‡ä¹‹å†²åŠ¨ï¼Œå­©ç«¥èˆ¬å¤©çœŸä¹…ç››ä¸è¡°ã€‚</p><p>ä½ æˆ‘å¿ƒä¸­éƒ½æœ‰ä¸€å°å¤©çº¿ï¼Œåªè¦ä½ ä»å¤©ä¸Šã€äººé—´æ¥å—ç¾å¥½ã€å¸Œæœ›ã€æ¬¢ä¹ã€å‹‡æ°”å’ŒåŠ›é‡çš„ä¿¡å·ï¼Œä½ å°±ä¼šé’æ˜¥æ°¸é©»ï¼Œé£åå¸¸å­˜ã€‚</p><p> ä¸€æ—¦å¤©çº¿å ä¸‹ï¼Œé”æ°”ä¾¿è¢«å†°é›ªè¦†ç›–ï¼Œç©ä¸–ä¸æ­ã€è‡ªæš´è‡ªå¼ƒæ²¹ç„¶è€Œç”Ÿï¼Œå³ä½¿å¹´æ–¹äºŒåï¼Œå®åˆ™å‚å‚è€çŸ£ï¼›ç„¶è€Œåªè¦ç«–èµ·å¤©çº¿ï¼Œæ•æ‰ä¹è§‚ä¿¡å·ï¼Œå³ä½¿å…«åé«˜é¾„ï¼Œè¡Œå°†å‘Šåˆ«å°˜å¯°ï¼Œä½ ä¹Ÿä¼šè§‰å¾—å¹´è½»ä¾æ—§ï¼Œå¸Œæœ›æ°¸å­˜ã€‚<a id="more"></a></p></blockquote><p>ä¸‹é¢æ˜¯è‹±æ–‡ç‰ˆæœ¬çš„åŸæ–‡ï¼š</p><p><strong>YOUTH</strong>  - Samuel Ullman</p><p>Youth is not a time of life; it is astateof mind; it is not a matter of rosy cheeks, red lips and supple knees; itis amatter of the will, a quality of the imagination, a vigor of the emotions;itis the freshness of the deep springs of life.</p><p>Youth means a tempera-mental predominanceofcourage over timidity, of the appetite for adventure over the love of ease.Thisoften exists in a man of 60 more than a boy of 20. Nobody grows old merelyby anumber of years. We grow old by deserting our ideals.</p><p>Years may wrinkle the skin, but to giveupenthusiasm wrinkles the soul. Worry, fear, self-distrust bows the heartandturns the spring back to dust.</p><p>Whether 60 or 16, there is in everyhumanbeingâ€™s heart the lure of wonder, the unfailing childlike appetite of whatâ€™snextand the joy of the game of living.</p><p>In the center of your heart and myheartthere is a wireless station: so long as it receives messages of beauty,hope,cheer, courage and power from men and from the Infinite, so long are youyoung.</p><p>When the aerials are down, and yourspiritis covered with snows of cynicism and the ice of pessimism, then you aregrownold, even at 20, but as long as your aerials are up, to catch wavesofoptimism, there is hope you may die young at 80.</p><p>ã€Šé’æ˜¥ã€‹çš„ä½œè€…å¡ç¼ªå°”Â·å„å°”æ›¼æ˜¯ä½çŠ¹å¤ªäººï¼Œ1840å¹´ç”Ÿäºå¾·å›½ï¼Œå„¿æ—¶éšå®¶è¥¿æ¸¡ï¼Œç§»å±…ç¾å›½ï¼Œå¹´é€¾70å¼€å§‹å†™ä½œã€‚ä»–ä»¥æ•™è‚²å®¶å’Œç¤¾ä¼šæ´»åŠ¨å®¶è€Œé—»åï¼Œåœ¨æ–‡å­¦åˆ›ä½œæ–¹é¢ä¹Ÿå¾ˆæœ‰æ‰åã€‚äºŒæˆ˜æœŸé—´ï¼Œå¤ªå¹³æ´‹æˆ˜äº‰æ‰“å¾—æ­£é…£ï¼Œéº¦å…‹é˜¿ç‘Ÿå°†å†›å¸¸å¸¸ä»ç¹å¿™ä¸­æŠ¬èµ·å¤´ï¼Œæ³¨è§†ç€æŒ‚åœ¨å¢™ä¸Šçš„é•œæ¡†ï¼Œé•œæ¡†é‡Œæ­£æ˜¯ç¯‡æ–‡ç« ï¼Œå¡ç¼ªå°”Â·å„å°”æ›¼çš„ã€Šé’æ˜¥ã€‹ã€‚åæ¥ï¼Œæ—¥æœ¬äººåœ¨ä¸œäº¬çš„ç¾å†›æ€»éƒ¨å‘ç°äº†å®ƒï¼Œã€Šé’æ˜¥ã€‹ä¾¿å¼€å§‹åœ¨æ—¥æœ¬æµä¼ ã€‚</p><p>1988å¹´ï¼Œæ—¥æœ¬æ•°ç™¾åæµèšä¼šä¸œäº¬ï¼Œçºªå¿µå„å°”æ›¼çš„è¿™ç¯‡æ–‡ç« ã€‚æ¾ä¸‹å…¬å¸å…ƒè€æ¾ä¸‹å¹¸ä¹‹åŠ©æ„Ÿæ…¨åœ°è¯´ï¼šâ€œ20å¹´æ¥ï¼Œã€Šé’æ˜¥ã€‹ä¸æˆ‘æœå¤•ç›¸ä¼´ï¼Œå®ƒæ˜¯æˆ‘çš„åº§å³é“­ã€‚â€</p><p>æ¬§æ´²ä¸€ä½æ”¿ç•Œåå®¿ä¹ŸæåŠ›æ¨èï¼šâ€œæ— è®ºç”·å¥³è€å¹¼ï¼Œè¦æƒ³æ´»å¾—é£å…‰ï¼Œå°±å¾—æ‹œè¯»ã€Šé’æ˜¥ã€‹ã€‚â€</p>]]></content>
    
    
    <categories>
      
      <category>è¯—æ­Œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¯—æ­Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨pythonè¿æ¥hiveæ•°æ®åº“å¹¶è¿›è¡Œæ•°æ®æ“ä½œ</title>
    <link href="/2017/10/13/%E4%BD%BF%E7%94%A8python%E8%BF%9E%E6%8E%A5hive%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/"/>
    <url>/2017/10/13/%E4%BD%BF%E7%94%A8python%E8%BF%9E%E6%8E%A5hive%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>åœ¨æ•°æ®æŠ½å–æˆ–è€…æ•°æ®å­˜å–è¿‡ç¨‹ä¸­éš¾å…ä¼šé‡åˆ°ç”¨å…¶ä»–è¯­è¨€å¯¹<code>hive</code>æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚å¦‚<code>python</code>è¿œç¨‹å¯¹<code>hive</code>æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œéœ€è¦é€šè¿‡<code>thrift</code>æœåŠ¡è¿›è¡Œæ“ä½œã€‚æœ¬æ–‡çš„ç¯å¢ƒæ˜¯<code>python==3.6.1</code>ï¼Œ <code>hive==1.1.0</code>ï¼Œ<code>thfit==0.10.0</code></p><h2 id="ThriftServerä»‹ç»"><a href="#ThriftServerä»‹ç»" class="headerlink" title="ThriftServerä»‹ç»"></a>ThriftServerä»‹ç»</h2><p>å®¢æˆ·ç«¯å¯¹<code>hive</code>æ•°æ®åº“è¿›è¡Œæ“ä½œå¯ä»¥é€šè¿‡<code>Cli</code>è¿›è¡Œï¼Œåœ¨æœ¬åœ°è¿™ç§æ–¹å¼è¾ƒå¥½ï¼Œä½†æ˜¯åœ¨è¿œç¨‹æ“ä½œæ—¶ä¼šå¾ˆéº»çƒ¦ï¼Œå› æ­¤æä¾›äº†<code>hiveserver</code>å’Œ<code>hiveserver2</code>ï¼Œåœ¨ä¸å¯åŠ¨cliçš„æƒ…å†µä¸‹å¯¹<code>hive</code>è¿›è¡Œæ“ä½œï¼Œå¯ä»¥åœ¨è¿œç¨‹é€šè¿‡å…¶ä»–è¯­è¨€(<code>java, python, php</code>ç­‰)å‘hiveè¯·æ±‚å¹¶è¿”å›ç»“æœã€‚ä¹Ÿå°±æ˜¯åˆ©ç”¨<code>thrift</code>è¿›è¡Œæ•´ä¸ªè¿‡ç¨‹æ“ä½œã€‚</p><p><code>hiveserver2</code>ä¸»è¦æ˜¯å‘è¿œç¨‹è°ƒç”¨æä¾›äº†æ¥å£ï¼Œé€šè¿‡<code>thrift rpc</code>å®ç°ï¼Œè¿›è¡Œè¿œç¨‹çš„æ“ä½œã€‚å¯ä»¥å®ç°è¿œç¨‹å¹¶è¡Œæ“ä½œ<code>hive</code>æ•°æ®åº“ã€‚å¯åŠ¨<code>hiveserver2</code>å¦‚ä¸‹ï¼š</p><pre><code class="shell">nohup hive --service hiveserver2 &amp;</code></pre><p>åœ¨å¯åŠ¨å<code>hiveserver2</code>é»˜è®¤ç›‘å¬çš„ç«¯å£ä¸º<code>10000</code>ï¼Œå¯ä»¥åœ¨hiveçš„é…ç½®æ–‡ä»¶(<code>hive-site.xml</code>)ä¸­æŸ¥çœ‹æˆ–è€…ä¿®æ”¹è¯¥ç«¯å£ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹è¯¥ç«¯å£æ˜¯å¦è¢«ç›‘å¬ï¼š<code>netstat -antp | grep 10000</code><a id="more"></a></p><h2 id="è¿æ¥hiveçš„æ¡†æ¶"><a href="#è¿æ¥hiveçš„æ¡†æ¶" class="headerlink" title="è¿æ¥hiveçš„æ¡†æ¶"></a>è¿æ¥hiveçš„æ¡†æ¶</h2><p>åœ¨è¿æ¥<code>hive</code>æ—¶ï¼Œå¯ä»¥é€‰æ‹©<code>thrift</code>æœ¬èº«ï¼Œ<code>pyhive</code>ï¼Œ<code>pyhs2</code>å’Œ<code>impyla</code>ã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é¦–å…ˆå°è¯•äº†<code>thrift</code>æœ¬èº«ï¼Œä½†æ˜¯é€šè¿‡é…ç½®ååœ¨è¿æ¥è¿”å›ï¼š<code>thrift.transport.TTransport.TTransportException: None</code>ï¼Œæ®ç½‘å‹è¯´è¿™æ˜¯è¿æ¥<code>hiveserver2</code>å‡ºç°çš„é—®é¢˜ã€‚å› æ­¤å¼ƒç”¨<code>thrift</code>ç›´æ¥è¿æ¥<code>hive</code>ï¼Œé€‰æ‹©å…¶ä»–ä¸‰ä¸ªã€‚</p><p><code>pyhs2</code>æ˜¯ä»¥å‰hiveå®˜æ–¹æ¨èä½¿ç”¨çš„åº“ï¼Œä¸»è¦ä¾èµ–äº†<code>thrift</code>å’Œ<code>sasl</code>ã€‚ä½†æ˜¯è¿™ä¸ªåº“åé¢æ²¡æœ‰ç»´æŠ¤äº†ï¼Œå› æ­¤åœ¨æœ€æ–°çš„<code>python</code>å’Œ<code>hive</code>ä¸‹æœ‰å¾ˆå¤šé—®é¢˜ï¼Œå› æ­¤å¼ƒç”¨ã€‚</p><p><code>impyla</code>æ˜¯é€šè¿‡<code>impala</code>æ¥å¯¹æ“ä½œ<code>hive</code>ï¼Œç›®å‰ä½¿ç”¨çš„ç¯å¢ƒä¸­<code>impala</code>æ²¡æœ‰å¯ç”¨ï¼Œå› æ­¤è¯¥åº“å°±æ”¾å¼ƒä½¿ç”¨äº†ã€‚å› æ­¤åªå‰©ä¸‹çš„<code>pyhive</code>ã€‚ä½†æ˜¯ç½‘ä¸Šçš„ä½¿ç”¨è€…ååº”ï¼Œæ¨èä½¿ç”¨<code>pyhive</code>å’Œ<code>impyla</code>ã€‚</p><h2 id="é…ç½®pyhiveçš„è¿è¡Œç¯å¢ƒ"><a href="#é…ç½®pyhiveçš„è¿è¡Œç¯å¢ƒ" class="headerlink" title="é…ç½®pyhiveçš„è¿è¡Œç¯å¢ƒ"></a>é…ç½®pyhiveçš„è¿è¡Œç¯å¢ƒ</h2><p>å› ä¸ºé€šè¿‡æ¯”è¾ƒé€‰æ‹©äº†<code>pyhive</code>å’Œ<code>hive</code>è¿›è¡Œäº¤äº’ï¼Œå› æ­¤éœ€è¦åœ¨å®¢æˆ·ç«¯éƒ¨ç½²<code>pyhive</code>ï¼Œä¸éœ€è¦åœ¨æœåŠ¡ç«¯å®‰è£…<code>pyhive</code>ã€‚æœ¬æ–‡ä¸­ä¸»è¦æ˜¯é’ˆå¯¹<code>linux</code>ç³»ç»Ÿä¸Šçš„éƒ¨ç½²ï¼Œä¸è€ƒè™‘<code>windows</code>ä¸Šçš„éƒ¨ç½²ã€‚</p><ol><li>å®‰è£…ä¾èµ–åŒ…<code>sasl</code>çš„ç¯å¢ƒ. å½“å®‰è£…äº†ä¸‹é¢çš„<code>sasl</code>ç›¸å…³çš„éƒ¨ç½²åŒ…æ‰èƒ½æ­£ç¡®å®‰è£…sasl</li></ol><pre><code class="shell"># ubuntusudo apt-get install sasl2-bin libsasl2-2 libsasl2-dev libsasl2-modules# centossudo yum install cyrus-sasl-devel cyrus-sasl-gssapi cyrus-sasl-md5 cyrus-sasl-plain# ä½¿ç”¨pipå®‰è£…pythonä¸‹çš„saslpip install sasl==0.2.1</code></pre><ol start="2"><li>å®‰è£…<code>thrift</code>çš„<code>python</code>åŒ…ï¼š<code>pip install thrift==0.10.0</code></li><li>å®‰è£…<code>thrift_sasl</code>ï¼Œè€…ä¸ªåŒ…ä¾èµ–äº†<code>sasl</code>å’Œ<code>thrift</code>ï¼š<code>pip install thrift_sasl====0.3.0</code></li><li>å¦‚æœæ˜¯<code>ubuntu</code>ï¼Œåˆ™ä¼šå¤šå‡ºä¸€ä¸ªæ­¥éª¤ï¼Œå¦åˆ™åœ¨å¼•ç”¨<code>sasl</code>åŒ…æ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼š<code>_ZTVNSt7__cxx1118basic_stringstreamIcSt11char_traitsIcESaIcEEE</code>ï¼Œå› æ­¤éœ€è¦å¯¹<code>python</code>ä½¿ç”¨çš„<code>libgcc</code>è¿›è¡Œæ›´æ–°ï¼Œå› ä¸ºæˆ‘éƒ¨ç½²çš„<code>python</code>ç¯å¢ƒæ˜¯<code>anaconda3</code>å› æ­¤ç›´æ¥æ‰§è¡Œ<code>conda install libgcc</code>å³å¯ã€‚</li><li>å®‰è£…<code>pyhive</code>ï¼Œ<code>pyhive</code>çš„å®‰è£…å¾ˆç®€å•ï¼š<code>pip install pyhive==0.5.0</code></li></ol><p>ç»è¿‡ä¸Šé¢çš„å®‰è£…å¯ä»¥è¿›è¡ŒåŒ…çš„æµ‹è¯•ï¼š</p><pre><code class="shell">python -c &quot;import sasl&quot;python -c &quot;import thrift&quot;python -c &quot;import pyhive&quot;</code></pre><p>æµ‹è¯•æˆåŠŸåå°±å¯ä»¥è¿æ¥æœåŠ¡ç«¯æ“ä½œhiveï¼š</p><pre><code class="python">from pyhive import hivefrom TCLIService.ttypes import TOperationStatecursor = hive.connect(&#39;localhost&#39;).cursor()cursor.execute(&#39;SELECT * FROM table LIMIT 10&#39;, async=True)status = cursor.poll().operationStatewhile status in (TOperationState.INITIALIZED_STATE, TOperationState.RUNNING_STATE):    logs = cursor.fetch_logs()    for message in logs:        print message    status = cursor.poll().operationStateprint cursor.fetchall()</code></pre><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="http://www.cnblogs.com/liu-yao/p/3hive-dethriftserver-fu-wu.html" target="_blank" rel="noopener">hiveçš„hiveserveræœåŠ¡ä»‹ç»</a></p><p><a href="https://github.com/dropbox/PyHive" target="_blank" rel="noopener">pyhiveçš„githubå®˜æ–¹åœ°å€</a></p><p><a href="https://stackoverflow.com/questions/22838752/hadoop-python-client-driver-for-hiveserver2-fails-to-install" target="_blank" rel="noopener">Python client driver for HiveServer2 fails to install</a></p><p><a href="https://stackoverflow.com/questions/27147208/python-hive-thrift-transport-ttransport-ttransportexception-none" target="_blank" rel="noopener">Python Hive: thrift.transport.TTransport.TTransportException: None</a></p><p><a href="http://blog.csdn.net/hjh00/article/details/64917226" target="_blank" rel="noopener">Thiftåœ¨ç³»ç»Ÿä¸­çš„é…ç½®</a></p><p>[<a href="http://www.cnblogs.com/KattyJoy/p/6540125.html" target="_blank" rel="noopener">CentOS6.5ä¸‹é€šè¿‡Thriftä½¿ç”¨Pythonè¿æ¥æ“ä½œhive å®‰è£…é…ç½®è®°å½•</a>]</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>hive</tag>
      
      <tag>thrift</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯¹pycå’Œpyoæ–‡ä»¶çš„ç†è§£</title>
    <link href="/2017/10/10/%E5%AF%B9pyc%E5%92%8Cpyo%E6%96%87%E4%BB%B6%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <url>/2017/10/10/%E5%AF%B9pyc%E5%92%8Cpyo%E6%96%87%E4%BB%B6%E7%9A%84%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="1-pythonçš„åŸºæœ¬è¿è¡Œæœºåˆ¶"><a href="#1-pythonçš„åŸºæœ¬è¿è¡Œæœºåˆ¶" class="headerlink" title="1. pythonçš„åŸºæœ¬è¿è¡Œæœºåˆ¶"></a>1. pythonçš„åŸºæœ¬è¿è¡Œæœºåˆ¶</h2><p>ä½œä¸º<code>Python</code>çˆ±å¥½è€…ï¼Œéœ€è¦äº†è§£<code>.py</code>è„šæœ¬çš„<strong>åŸºæœ¬è¿è¡Œæœºåˆ¶</strong>åŠ<strong>ç‰¹æ€§</strong>ï¼šåœ¨å¾ˆå¤šå·¥ä½œä¸Š<code>Python</code>çš„è¿è¡Œæµç¨‹åŸºæœ¬ä¸Š<strong>å–å†³äºç”¨æˆ·</strong>ï¼Œå› æ­¤æºç ä¸éœ€è¦ç¼–è¯‘æˆäºŒè¿›åˆ¶ä»£ç (å¦åˆ™æ— æ³•å®ç°å¤§éƒ¨åˆ†è´´è¿‘ç”¨æˆ·çš„ç‰¹æ€§)ï¼Œè€Œç›´æ¥ä»æºç è¿è¡Œç¨‹åºã€‚å½“æˆ‘ä»¬è¿è¡Œ<code>python</code>æ–‡ä»¶ç¨‹åºçš„æ—¶å€™ï¼Œ<code>Python</code>è§£é‡Šå™¨å°†<strong>æºç </strong>è½¬æ¢ä¸º<strong>å­—èŠ‚ç </strong>ï¼Œç„¶åå†ç”±<strong>è§£é‡Šå™¨</strong>æ¥æ‰§è¡Œè¿™äº›å­—èŠ‚ç ã€‚<br>å› æ­¤æ€»çš„æ¥è¯´ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ä¸‰æ¡ç‰¹æ€§ï¼š</p><ol><li>æºç <strong>è·ç¦»åº•å±‚æ›´è¿œ</strong>(æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šã€‚ä¸è¯´ï¼Œä¹Ÿæ„Ÿè§‰å¾—åˆ°)</li><li>è¿è¡Œæ—¶<strong>éƒ½éœ€è¦ç”Ÿæˆå­—èŠ‚ç </strong>ï¼Œäº¤ç”±<strong>è™šæ‹Ÿæœº</strong>æ‰§è¡Œã€‚(è™šæ‹Ÿæœºåœ¨å“ªå„¿ï¼ä½ ä»¬ä¹Ÿä¸çœ‹çœ‹å„è‡ªéƒ½æ˜¯ç”¨ä»€ä¹ˆè½¯ä»¶æ‰§è¡Œçš„ï¼æ²¡é”™ï¼Œå°±æ˜¯è§£é‡Šå™¨ï¼Œåˆ«å’Œæˆ‘è¯´æ˜¯<code>IDLE</code>å•Šã€‚è™šæ‹Ÿæœºå…·ä½“å®ç°äº†ç”±<code>switch-case</code>è¯­å¥æ„æˆçš„æ¡†æ¶å‡½æ•°<em><code>PyEval_EvalFrameEx</code></em>ï¼Œåˆšåˆšè¯´çš„å­—èŠ‚ç å°±æ˜¯è¿™è´§æ‰§è¡Œçš„)</li><li>æ¯æ¬¡æ‰§è¡Œè„šæœ¬ï¼Œè™šæ‹Ÿæœº<strong>æ€»è¦å¤šå‡ºåŠ è½½å’Œé“¾æ¥çš„æµç¨‹</strong>ã€‚<a id="more"></a></li></ol><h2 id="2-æ‰§è¡Œè„šæœ¬çš„è¿‡ç¨‹"><a href="#2-æ‰§è¡Œè„šæœ¬çš„è¿‡ç¨‹" class="headerlink" title="2. æ‰§è¡Œè„šæœ¬çš„è¿‡ç¨‹"></a>2. æ‰§è¡Œè„šæœ¬çš„è¿‡ç¨‹</h2><p>é‚£ä¹ˆï¼Œæœ‰äººè¦é—®äº†ï¼šä¸æ˜¯è¯´ï¼Œè¿è¡Œæ—¶æ€»è¦ç”Ÿæˆå­—èŠ‚ç ä¹ˆï¼é‚£ï¼Œå­—èŠ‚ç éƒ½å»å“ªå„¿äº†ï¼Ÿå…ˆè¯´è¯´ï¼Œè™šæ‹Ÿæœºå®ƒæ˜¯æ€ä¹ˆæ‰§è¡Œè„šæœ¬çš„</p><ol><li>å®Œæˆæ¨¡å—çš„åŠ è½½å’Œé“¾æ¥ï¼›</li><li>å°†æºä»£ç ç¿»è¯‘ä¸º<code>PyCodeObject</code>å¯¹è±¡(è¿™è´§å°±æ˜¯å­—èŠ‚ç )ï¼Œå¹¶å°†å…¶å†™å…¥å†…å­˜å½“ä¸­(æ–¹ä¾¿<code>CPU</code>è¯»å–ï¼Œèµ·åˆ°åŠ é€Ÿç¨‹åºè¿è¡Œçš„ä½œç”¨)ï¼›</li><li>ä»ä¸Šè¿°å†…å­˜ç©ºé—´ä¸­è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œï¼›</li><li>ç¨‹åºç»“æŸåï¼Œæ ¹æ®å‘½ä»¤è¡Œè°ƒç”¨æƒ…å†µ(å³è¿è¡Œç¨‹åºçš„æ–¹å¼)å†³å®šæ˜¯å¦å°†<code>PyCodeObjec</code>tå†™å›ç¡¬ç›˜å½“ä¸­(ä¹Ÿå°±æ˜¯ç›´æ¥å¤åˆ¶åˆ°<code>.pyc</code>æˆ–<code>.pyo</code>æ–‡ä»¶ä¸­)ï¼›</li><li>ä¹‹åè‹¥å†æ¬¡æ‰§è¡Œè¯¥è„šæœ¬ï¼Œåˆ™å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ä¸Šè¿°å­—èŠ‚ç æ–‡ä»¶ã€‚æœ‰åˆ™æ‰§è¡Œï¼Œå¦åˆ™é‡å¤ä¸Šè¿°æ­¥éª¤ã€‚</li></ol><p>åœ¨æˆ‘ä»¬ç‚¹å‡»(æˆ–è¾“å…¥å‘½ä»¤)è¿è¡Œè„šæœ¬ï¼Œå¹¶æ‚ é—²åœ°å–å’–å•¡æ—¶ï¼Œè™šæ‹Ÿæœºåšäº†è¿™ä¹ˆå¤šçš„äº‹æƒ…ã€‚ä¸è¿‡ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°<code>.pyc</code>æˆ–<code>.pyo</code>æ–‡ä»¶æ˜¯å¦ç”Ÿæˆï¼Œæ˜¯å–å†³äºæˆ‘ä»¬å¦‚ä½•è¿è¡Œç¨‹åºçš„ã€‚</p><h2 id="3-pycå’Œpyoæ–‡ä»¶çš„ç”Ÿæˆ"><a href="#3-pycå’Œpyoæ–‡ä»¶çš„ç”Ÿæˆ" class="headerlink" title="3. pycå’Œpyoæ–‡ä»¶çš„ç”Ÿæˆ"></a>3. pycå’Œpyoæ–‡ä»¶çš„ç”Ÿæˆ</h2><p>è™šæ‹Ÿæœºä¹Ÿæ˜¯è®²ç©¶æ•ˆç‡çš„ã€‚æ¯•ç«Ÿå¯¹äºæ¯”è¾ƒå¤§çš„é¡¹ç›®ï¼Œè¦å°†<code>PyCodeObject</code>å†™å›ç¡¬ç›˜ä¹Ÿæ˜¯ä¸å¯é¿å…åœ°è¦èŠ±äº›æ—¶é—´çš„ï¼Œè€Œä¸”å®ƒåˆä¸çŸ¥é“ä½ æ˜¯ä¸æ˜¯ä¹Ÿå°±åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åå°±å¯¹åˆšåˆšè·‘å®Œçš„è„šæœ¬å¼ƒä¹‹ä¸é¡¾äº†å‘¢ã€‚ä¸è¿‡ï¼Œå®ƒå…¶å®ä¹Ÿæœ‰è´´å¿ƒçš„ä¸€é¢ã€‚æ¯”å¦‚ï¼Œ</p><ul><li>è‹¥ä½ åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥<code>python path/to/projectDir</code>(å‡è®¾<code>projectDir</code>ç›®å½•å«æœ‰<code>__main__.py</code>æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–å°†è¦è°ƒç”¨çš„æ¨¡å—)ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œç»“æŸåä¾¿è‡ªåŠ¨ä¸ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„è„šæœ¬ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ï¼Œå¹¶ä¿å­˜äºæœ¬åœ°æ–°æ–‡ä»¶å¤¹<code>__pycache__</code>å½“ä¸­ã€‚(è¿™ä¹Ÿæœ‰å¯èƒ½æ˜¯<code>IDE</code>å†™å°é¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆ<code>.pyc</code>æ–‡ä»¶çš„åŸå› ï¼Œä¸è¿‡é—®é¢˜æè¿°ç•¥å¾®æš§æ˜§ã€‚è¯¦æƒ…å‚è§ä¸Šé¢çŸ¥ä¹é—®é¢˜æ¿å—)</li></ul><p>æˆ–è€…æ˜¯ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥<code>python path/to/projectDir/__main__.py</code>ï¼Œåˆ™ç”Ÿæˆé™¤<code>__main__.py</code>å¤–è„šæœ¬çš„å­—èŠ‚ç æ–‡ä»¶ã€‚ä¸è¿‡æ€»çš„æ¥è¯´ï¼Œä¸Šè¿°è¿™ä¸¤ç§è¡Œä¸ºéƒ½å¤§å¤§ç¼©çŸ­äº†é¡¹ç›®è¿è¡Œå‰çš„å‡†å¤‡æ—¶é—´ï¼ˆæ¯•ç«Ÿåˆ†å·¥æ˜ç¡®çš„ç¨‹åºï¼Œè§„æ¨¡åº”è¯¥ä¸ä¼šå¤ªå°ï¼Œå¤ç”¨ç‡ä¹Ÿä¸ä¼šå¤ªä½ã€‚é™¤éåƒé¥±äº†æ’‘ç€ï¼Œæå‡ºè¿™ä¹ˆå¤šäº‹æƒ…</p><ul><li>æ¨¡å—åœ¨æ¯æ¬¡å¯¼å…¥å‰æ€»ä¼š<strong>æ£€æŸ¥å…¶å­—èŠ‚ç æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦ä¸è‡ªèº«çš„ä¸€è‡´</strong>ã€‚è‹¥æ˜¯åˆ™ç›´æ¥ä»è¯¥å­—èŠ‚ç æ–‡ä»¶è¯»å–å†…å®¹ï¼Œå¦åˆ™æºæ¨¡å—é‡æ–°å¯¼å…¥ï¼Œå¹¶åœ¨æœ€åç”ŸæˆåŒåæ–‡ä»¶è¦†ç›–å½“å‰å·²æœ‰çš„å­—èŠ‚ç ï¼Œä»è€Œå®Œæˆå†…å®¹çš„æ›´æ–°(è¯¦è§<code>import.py</code>)ã€‚è¿™æ ·ï¼Œå°±é¿å…äº†ä¿®æ”¹æºä»£ç åä¸æœ¬åœ°å­—èŠ‚ç æ–‡ä»¶äº§ç”Ÿå†²çª(å½“ç„¶ï¼Œè®¾è®¡è€…ä¹Ÿä¸ä¼šè¿™ä¹ˆå‚»ã€‚</li></ul><ul><li><p><strong><code>.pycæ–‡ä»¶</code></strong>æ˜¯ç”±<code>.py</code>æ–‡ä»¶ç»è¿‡ç¼–è¯‘åç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå…¶<strong>åŠ è½½é€Ÿåº¦ç›¸å¯¹äºä¹‹å‰çš„<code>.py</code>æ–‡ä»¶æœ‰æ‰€æé«˜</strong>ï¼Œè€Œä¸”è¿˜å¯ä»¥<strong>å®ç°æºç éšè—</strong>ï¼Œä»¥åŠ<strong>ä¸€å®šç¨‹åº¦ä¸Šçš„åç¼–è¯‘</strong>ã€‚æ¯”å¦‚ï¼Œ<code>Python3.3</code>ç¼–è¯‘ç”Ÿæˆçš„<code>.pyc</code>æ–‡ä»¶ï¼Œ<code>Python3.4</code>å°±åˆ«æƒ³ç€å»è¿è¡Œå•¦ï¼</p></li><li><p><strong><code>.pyo</code>æ–‡ä»¶</strong>ä¹Ÿæ˜¯<strong>ä¼˜åŒ–</strong>(æ³¨æ„è¿™ä¸¤ä¸ªå­—ï¼Œä¾¿äºåç»­çš„ç†è§£)ç¼–è¯‘åçš„ç¨‹åº(<strong>ç›¸æ¯”äº<code>.pyc</code>æ–‡ä»¶æ›´å°</strong>)ï¼Œä¹Ÿå¯ä»¥<strong>æé«˜åŠ è½½é€Ÿåº¦</strong>ã€‚ä½†å¯¹äºåµŒå…¥å¼ç³»ç»Ÿï¼Œå®ƒå¯å°†æ‰€éœ€æ¨¡å—ç¼–è¯‘æˆ<code>.pyo</code>æ–‡ä»¶ä»¥<strong>å‡å°‘å®¹é‡</strong>ã€‚</p><p>ä½†æ€»çš„æ¥è¯´ï¼Œä½œç”¨ä¸Šæ˜¯å‡ ä¹ä¸åŸæ¥çš„<code>.py</code>è„šæœ¬æ²¡æœ‰åŒºåˆ«çš„ï¼Œä¹Ÿå°±æ˜¯ç„¶å¹¶åµ (å½“ç„¶ï¼Œå¹¶éæ¯«æ— ä½œç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä¸ªäººè§‰å¾—ç”¨å¤„æœ€å¤§çš„åœ°æ–¹å°±æ˜¯<strong>é˜²æ­¢åˆ«äººå·çœ‹æˆ‘çš„ä»£ç </strong>ã€‚æ¯•ç«Ÿ<code>.py</code>æºæ–‡ä»¶æ˜¯ç›´æ¥ä»¥æºç çš„å½¢å¼å‘ˆç°ç»™å¤§å®¶çš„)ã€‚å‘ƒâ€¦è¿™ä¹ˆè¯´ï¼Œå¥½åƒåˆæœ‰ç‚¹è‡ªç›¸çŸ›ç›¾çš„èµ¶è„šã€‚</p></li></ul><p><code>Python</code>é€‰é¡¹</p><ul><li><em><code>-O</code></em>ï¼Œè¡¨ç¤º<strong>ä¼˜åŒ–ç”Ÿæˆ.pyoå­—èŠ‚ç </strong>(è¿™é‡Œåˆæœ‰ä¼˜åŒ–ä¸¤ä¸ªå­—ï¼Œå¾—æ³¨æ„å•¦ï¼)</li><li><em><code>-OO</code></em>ï¼Œè¡¨ç¤ºè¿›ä¸€æ­¥<strong>ç§»é™¤*</strong><code>-O</code><em>é€‰é¡¹ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­çš„*</em>æ–‡æ¡£å­—ç¬¦ä¸²*<em>(è¿™æ˜¯åœ¨ä½œç”¨æ•ˆæœä¸Šè§£é‡Šçš„ï¼Œè€Œä¸æ˜¯è¯´ä»</em><code>-O</code>*é€‰é¡¹å¾—åˆ°çš„æ–‡ä»¶å»é™¤)</li><li><em><code>-m</code></em>ï¼Œè¡¨ç¤º<strong>å¯¼å…¥å¹¶è¿è¡ŒæŒ‡å®šçš„æ¨¡å—</strong></li></ul><p>å¯¹æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ¼å¼è¿è¡Œ<code>.py</code>æ–‡ä»¶æ¥ç”Ÿæˆ<code>.pyc</code>æ–‡ä»¶(ä»¥ä¸‹è°ƒç”¨å‡å‡è®¾<code>/path/to</code>ç›®å½•å«æœ‰<code>.py</code>è„šæœ¬)ï¼š</p><pre><code class="python">python -m py_compile /path/to/éœ€è¦ç”Ÿæˆ.pycçš„è„šæœ¬.py #è‹¥æ‰¹é‡å¤„ç†.pyæ–‡ä»¶#åˆ™æ›¿æ¢ä¸º/path/to/{éœ€è¦ç”Ÿæˆ.pycçš„è„šæœ¬1,è„šæœ¬2,...}.py#æˆ–è€…/path/to/</code></pre><p>æ•ˆæœç­‰åŒäºä¸‹é¢:</p><pre><code class="python">import py_compilepy_compile.compile(r&#39;/path/to/éœ€è¦ç”Ÿæˆ.pycçš„è„šæœ¬.py&#39;) #åŒæ ·ä¹Ÿå¯ä»¥æ˜¯åŒ…å«.pyæ–‡ä»¶çš„ç›®å½•è·¯å¾„#æ­¤å¤„å°½å¯èƒ½ä½¿ç”¨rawå­—ç¬¦ä¸²ï¼Œä»è€Œé¿å…è½¬ä¹‰çš„éº»çƒ¦ã€‚æ¯”å¦‚ï¼Œè¿™é‡Œä¸åŠ â€œrâ€çš„è¯ï¼Œä½ å°±å¾—å¯¹æ–œæ è¿›è¡Œè½¬ä¹‰</code></pre><h2 id="3-py-compileæ¨¡å—"><a href="#3-py-compileæ¨¡å—" class="headerlink" title="3. py_compileæ¨¡å—"></a>3. py_compileæ¨¡å—</h2><p><code>py_compile</code>æ˜¯<code>Python</code>çš„è‡ªå¸¦æ¨¡å—ï¼Œè¿™é‡Œé¢å°±ä¸¤ä¸ªå‡½æ•°ã€‚å…¶ä¸‹çš„<code>py_compile.compile*(*file*[, *cfile*[, *dfile*[, *doraise*]]])</code>å¯å°†<code>.py</code>æ–‡ä»¶ç¼–è¯‘ç”Ÿæˆ<code>.pyc</code>æ–‡ä»¶ï¼Œå¯¹åº”çš„å‚æ•°è§£é‡Šå¦‚ä¸‹</p><ol><li><em><code>file</code></em>ï¼Œè¡¨ç¤ºéœ€è¦ç”Ÿæˆ<code>.pyc</code>æˆ–<code>.pyo</code>æ–‡ä»¶çš„<strong>æºè„šæœ¬å</strong>(å­—ç¬¦ä¸²)ï¼›</li><li><em><code>cfile</code></em>ï¼Œè¡¨ç¤ºéœ€è¦ç”Ÿæˆ<code>.pyc</code>æˆ–<code>.pyo</code>æ–‡ä»¶çš„<strong>ç›®æ ‡è„šæœ¬å</strong>ã€‚å‘ƒâ€¦å¥½åƒæ²¡æœ‰åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯æºè„šæœ¬â€”â€“ç›®æ ‡è„šæœ¬ã€‚å½“ç„¶ï¼Œå®ƒé»˜è®¤æ˜¯ä»¥<code>.pyc</code>ä¸ºæ‰©å±•åçš„è·¯å¾„åçš„å­—ç¬¦ä¸²ã€‚æ­¤å¤–ï¼Œå½“ä¸”ä»…å½“æ‰€ä½¿ç”¨çš„è§£é‡Šå™¨å…è®¸ç¼–è¯‘æˆ<code>.pyo</code>æ–‡ä»¶ï¼Œæ‰èƒ½ä»¥<code>.pyo</code>ç»“å°¾ã€‚</li><li><em><code>dfile</code></em>ï¼Œè¡¨ç¤ºç¼–è¯‘å‡ºé”™æ—¶ï¼Œ<strong>å°†æŠ¥é”™ä¿¡æ¯ä¸­çš„åå­—<code>file</code>æ›¿æ¢ä¸º<code>dfile</code></strong>ã€‚</li><li><em><code>doraise</code></em>ï¼Œ<strong>è®¾ç½®æ˜¯å¦å¿½ç•¥å¼‚å¸¸</strong>ã€‚è‹¥ä¸º<code>True</code>ï¼Œåˆ™æŠ›å‡º<code>PyCompileError</code>å¼‚å¸¸ï¼›å¦åˆ™ç›´æ¥å°†é”™è¯¯ä¿¡æ¯å†™å…¥<code>sys.stderr</code>ï¼ˆä»€ä¹ˆï¼ä¸çŸ¥é“<code>sys.stderr</code>ï¼æ¸©é¦¨æç¤ºï¼š<code>sys.stderr</code>æ˜¯<code>Python</code>è‡ªå¸¦çš„<strong>æ ‡å‡†é”™è¯¯è¾“å‡º</strong>)</li></ol><pre><code class="python">python -O -m py_compile /path/to/éœ€è¦ç”Ÿæˆ.pyoçš„è„šæœ¬.py</code></pre><p>é‚£ä¹ˆï¼Œæœ‰äººè¦é—®äº†ï¼šä¸ºä»€ä¹ˆä¸æ˜¯åƒç”Ÿæˆ<code>.pyc</code>æ–‡ä»¶é‚£æ ·é‡‡ç”¨<em><code>python -O /path/to/</code>éœ€è¦ç”Ÿæˆ<code>pyo</code>çš„è„šæœ¬<code>.py</code></em>å½¢å¼çš„è°ƒç”¨ï¼Ÿ<br>å¿˜è®°è¯´æ˜è¿™ä¸€ç‚¹äº†ï¼Œå¾ˆå¤šåšå®¢ä»¥åŠä¹¦ç±éƒ½åƒæˆ‘ä¸Šé¢é‚£æ ·è§£é‡Š<em><code>-O</code></em>é€‰é¡¹çš„ä½œç”¨ï¼Œä½†è¯¦ç»†æ¥è§£é‡Šçš„è¯æ˜¯ï¼š    </p><p>-O <strong>é€‰é¡¹ï¼Œå°†<code>.pyc</code>æ–‡ä»¶ä¼˜åŒ–(æ³¨æ„æˆ‘ä¸€ç›´å¼ºè°ƒçš„ä¼˜åŒ–äºŒå­—ï¼Œè¿™é‡Œå°±ç”¨åˆ°å•¦ï¼)</strong>ä¸º<code>.pyo</code>æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°†<code>.py</code>æ–‡ä»¶ä¼˜åŒ–ç¼–è¯‘ä¸º<code>.pyo</code>æ–‡ä»¶ã€‚(å…¶ç›´æ¥çš„ç»“æœæ˜¯ä¼˜åŒ–ç¼–è¯‘åçš„æ–‡ä»¶ç•¥å¾®å°äº<code>.pyc</code>æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å‡è‚¥äº†ã€‚ç°åœ¨ï¼Œå¤§å®¶çŸ¥é“<code>.pyo</code>æ–‡ä»¶ä¸ºä»€ä¹ˆå°çš„åŸå› äº†å§ï¼)</p><h2 id="4-æ³¨æ„"><a href="#4-æ³¨æ„" class="headerlink" title="4. æ³¨æ„"></a>4. æ³¨æ„</h2><p>ä»¥ä¸Šæ— è®ºæ˜¯ç”Ÿæˆ<code>.pyc</code>è¿˜æ˜¯<code>.pyo</code>æ–‡ä»¶ï¼Œéƒ½å°†åœ¨å½“å‰è„šæœ¬çš„ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå«æœ‰å­—èŠ‚ç çš„æ–‡ä»¶å¤¹<strong><code>__pycache__</code></strong>ã€‚</p><p>å¯èƒ½è¿˜æœ‰äººä¼šé—®ï¼Œ<strong><code>pyd</code>æ–‡ä»¶</strong>åˆæ˜¯ä»€ä¹ˆï¼Œåˆ«åœ¨æ„ï¼Œé‚£åªæ˜¯<code>Python</code>çš„åŠ¨æ€é“¾æ¥åº“ã€‚å¦‚æœè¦æ·±ç©¶ï¼Œè¿˜å¾—æ‰¯ä¸Š<code>C++</code>çš„çŸ¥è¯†</p><p>å†å•°å—¦ä¸€å¥ï¼šç”Ÿæˆå­—èŠ‚ç çš„æ–¹æ³•å¤šäº†å»äº†ï¼Œä¸æ­¢ä»¥ä¸Šè¿™å‡ ç§ã€‚æ¯”å¦‚ï¼Œä½ ä»¬ä¸å¦¨è¯•è¯•å°†ä¸Šé¢å‘½ä»¤è¡Œè°ƒç”¨ä¸­çš„<em><code>py_compile</code></em>æ”¹æˆ<em><code>compileall</code></em>ï¼Œè€Œä»£ç è¡Œä¸­çš„<em>`py_compile.compile</em><code>æ”¹æˆ*</code>compileall.compile_file<code>*æˆ–*</code>compileall.compile_dir`*ï¼Œåˆæˆ–è€…ç›´æ¥ä½¿ç”¨å¸¦æœ‰ç¼–è¯‘åŠŸèƒ½çš„IDEç”Ÿæˆå­—èŠ‚ç ã€‚</p><p>å†å†å•°å—¦ä¸€å¥ï¼šçŸ¥é“<code>Python</code>è¿è¡Œæœºåˆ¶ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬ä¸€èˆ¬äººæ‰€å¿…é¡»çš„ã€‚ä½†æ˜¯ï¼Œäº†è§£å…¶åŠ é€Ÿç¨‹åºè¿è¡Œä»¥åŠä¼˜åŒ–ä»£ç çš„è®¾è®¡æ€æƒ³ï¼Œå¯¹äºæˆ‘ä»¬åœ¨æ—¥åæ„é€ ç¼“å­˜ç³»ç»Ÿã€å¦‚ä½•å‡å°‘ä¸å¿…è¦çš„è¿è¡Œæ—¶é—´ï¼Œä»¥åŠåŒæ­¥æ›´æ–°å·¥ä½œå†…å®¹ç­‰é—®é¢˜ä¸Šèµ·åˆ°å¾ˆå¤§çš„å€Ÿé‰´ä½œç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>compile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºMLEçš„logisticæ¨¡å‹</title>
    <link href="/2017/09/05/%E5%9F%BA%E4%BA%8EMLE%E7%9A%84logistic%E6%A8%A1%E5%9E%8B/"/>
    <url>/2017/09/05/%E5%9F%BA%E4%BA%8EMLE%E7%9A%84logistic%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<p>ä¸»è¦ä»‹ç»é€»è¾‘å›å½’ï¼ˆ<code>Logistic Regression</code>ï¼‰å’Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡ã€‚é€»è¾‘å›å½’æ˜¯æœºå™¨å­¦ä¹ ç®—æ³•ä¸­æœ€å¸¸ç”¨çš„ç®—æ³•ï¼Œç”¨äºåˆ†ç±»ï¼Œå±äºæœ‰ç›‘ç£å­¦ä¹ ã€‚åœ¨æœ‰ç›‘ç£å­¦ä¹ ä¸­ï¼Œå¦‚æœå› å˜é‡ä¸ºæœ‰é™ä¸ªç¦»æ•£å€¼ï¼Œåˆ™é¢„æµ‹é—®é¢˜å°±è½¬å˜æˆåˆ†ç±»é—®é¢˜ï¼Œä»è¿™ä¸ªè§’åº¦ä¹Ÿå¯ä»¥è¯´åˆ†ç±»é—®é¢˜æ˜¯é¢„æµ‹é—®é¢˜çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚æ­¤æ—¶ï¼Œé€šè¿‡æ ·æœ¬é›†è®­ç»ƒè·å¾—çš„æœ‰ç›‘ç£å­¦ä¹ æ¨¡å‹ï¼Œå³é€»è¾‘å›å½’æ¨¡å‹å°±ç§°ä¸ºåˆ†ç±»æ¨¡å‹æˆ–åˆ†ç±»å†³ç­–å‡½æ•°ï¼Œä¹Ÿç§°ä¸ºåˆ†ç±»å™¨ï¼ˆ<code>Classifier</code>ï¼‰ã€‚</p><a id="more"></a><h2 id="1-é€»è¾‘å›å½’"><a href="#1-é€»è¾‘å›å½’" class="headerlink" title="1. é€»è¾‘å›å½’"></a>1. é€»è¾‘å›å½’</h2><p>æ‹Ÿåˆå†³ç­–è¾¹ç•Œ(è¿™é‡Œçš„å†³ç­–è¾¹ç•Œä¸å±€é™äºçº¿æ€§ï¼Œè¿˜å¯ä»¥æ˜¯å¤šé¡¹å¼ï¼Œå¹³é¢ï¼Œæ›²é¢ç­‰)ï¼Œå†å»ºç«‹è¿™ä¸ªè¾¹ç•Œä¸åˆ†ç±»çš„æ¦‚ç‡è”ç³»ï¼Œä»è€Œå¾—åˆ°äº†äºŒåˆ†ç±»æƒ…å†µä¸‹çš„æ¦‚ç‡ã€‚å¯¹äºæŸä¸ªåˆ†ç±»ä»»åŠ¡ï¼Œå¦‚åˆ¤å®šä¸€å°é‚®ä»¶æ˜¯å¦ä¸ºåƒåœ¾é‚®ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åˆ†ç±»å™¨é¢„æµ‹åˆ†ç±»ç»“æœï¼šæ˜¯ï¼ˆè®°ä¸º1ï¼‰orä¸æ˜¯ï¼ˆè®°ä¸º0ï¼‰ã€‚å¦‚æœæˆ‘ä»¬è€ƒè™‘0å°±æ˜¯â€œä¸å‘ç”Ÿâ€ï¼Œ1å°±æ˜¯â€œå‘ç”Ÿâ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†åˆ†ç±»ä»»åŠ¡ç†è§£æˆä¼°è®¡äº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡pï¼Œé€šè¿‡äº‹ä»¶å‘ç”Ÿæ¦‚ç‡çš„å¤§å°æ¥è¾¾åˆ°åˆ†ç±»ç›®çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿å¾—é¢„æµ‹ç»“æœå³æ¦‚ç‡å€¼é™å®šåœ¨0ï½1ä¹‹é—´ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬ä»ç„¶é‡‡ç”¨çº¿æ€§å›å½’$p=f(x,\theta)=\theta^T x$ä½œä¸ºåˆ†ç±»å™¨ï¼Œå…¶é¢„æµ‹å€¼å¯èƒ½ä¼šè¿œè¿œå¤§äº1æˆ–è€…è¿œè¿œå°äº0ï¼Œä¸ç¬¦åˆæˆ‘ä»¬é¢„æœŸæƒ³æ³•ã€‚æ‰€ä»¥ï¼Œé€»è¾‘å›å½’å¼•å…¥logisticå‡½æ•°ï¼Œå°†åˆ†ç±»å™¨è¾“å‡ºç•Œå®šåœ¨ï¼»0ï¼Œ1ï¼½ä¹‹é—´ï¼Œå…¶ä¸€èˆ¬å½¢å¼å¯è¡¨ç¤ºä¸º$f(x, \theta)=g(\theta^T x)$ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬åˆ°åº•éœ€è¦é€‰æ‹©ä»€ä¹ˆæ ·å½¢å¼çš„logisticå‡½æ•°g(z)ï¼Ÿ</p><h3 id="logisticå‡½æ•°çš„ç”±æ¥"><a href="#logisticå‡½æ•°çš„ç”±æ¥" class="headerlink" title="logisticå‡½æ•°çš„ç”±æ¥"></a>logisticå‡½æ•°çš„ç”±æ¥</h3><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸é€‰ç”¨çº¿æ€§å›å½’çš„åŸå› æ˜¯çº¿æ€§å›å½’ä¸èƒ½ä¿è¯é¢„æµ‹å€¼çš„èŒƒå›´ä½äºï¼»0ï¼Œ1ï¼½ä¹‹é—´ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹è¯¥é—®é¢˜æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç§»é™¤å› å˜é‡å€¼åŸŸçš„é™åˆ¶ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹æ¦‚ç‡å½¢å¼åšæŸç§å˜æ¢ã€‚</p><p>é¦–å…ˆï¼Œé€‰ç”¨å‘ç”Ÿæ¯”(the odds of experiencing an event)ä»£æ›¿æ¦‚ç‡ï¼Œå‘ç”Ÿæ¯”æ˜¯äº‹ä»¶å‘ç”Ÿæ¦‚ç‡å’Œä¸å‘ç”Ÿæ¦‚ç‡ä¹‹é—´çš„æ¯”å€¼ï¼Œè®°ä¸º$odds = \frac{p}{1-p}$ï¼Œé€šè¿‡è¯¥å˜æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†ï¼»0ï¼Œ1ï¼½ä¹‹é—´çš„ä»»æ„æ•°æ˜ å°„åˆ°$[0,\infty]$ä¹‹é—´çš„ä»»æ„å®æ•°ã€‚ä½†æ˜¯ï¼Œçº¿æ€§å›å½’çš„è¾“å‡ºè¿˜å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¦ä¸€æ­¥å˜æ¢å°†$[0,\infty]$çš„å®æ•°åŸŸæ˜ å°„åˆ°è¿™ä¸ªå®æ•°åŸŸRç©ºé—´ï¼›</p><p>ç„¶åï¼Œåœ¨ä¼—å¤šéçº¿æ€§å‡½æ•°ä¸­ï¼Œlogå‡½æ•°çš„å€¼åŸŸä¸ºæ•´ä¸ªå®æ•°åŸŸä¸”å•è°ƒï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—ä¼˜åŠ¿æ¯”çš„å¯¹æ•°ï¼Œå¦$\eta = log(odds)=log \frac{p}{1-p}=logit(p)$ã€‚</p><p>ç»è¿‡ä»¥ä¸Šä¸¤æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å»é™¤åˆ†ç±»é—®é¢˜å¯¹å› å˜é‡å€¼åŸŸçš„é™åˆ¶ï¼Œå¦‚æœæ¦‚ç‡ç­‰äº0ï¼Œé‚£ä¹ˆä¼˜åŠ¿æ¯”åˆ™ä¸º0ï¼Œlogitå€¼ä¸º$-\infty$ï¼›ç›¸åï¼Œå¦‚æœæ¦‚ç‡ç­‰äº1ï¼Œä¼˜åŠ¿æ¯”ä¸º$\infty$ï¼Œlogitå€¼ä¸º$\infty$ã€‚å› æ­¤ï¼Œlogitå‡½æ•°å¯ä»¥å°†èŒƒå›´ä¸ºï¼»0ï¼Œ1ï¼½çš„æ¦‚ç‡å€¼æ˜ å°„åˆ°æ•´ä¸ªå®åŸŸç©ºé—´ï¼Œå½“æ¦‚ç‡å€¼å°äº0.5æ—¶ï¼Œlogitå€¼ä¸ºè´Ÿæ•°ï¼Œåä¹‹ï¼Œlogitå€¼ä¸ºæ­£æ•°ã€‚</p><h3 id="é€»è¾‘å›å½’"><a href="#é€»è¾‘å›å½’" class="headerlink" title="é€»è¾‘å›å½’"></a>é€»è¾‘å›å½’</h3><p>è§£å†³äº†åˆ†ç±»é—®é¢˜å¯¹åˆ†ç±»å™¨é¢„æµ‹çš„å› å˜é‡å€¼åŸŸçš„é™åˆ¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨çº¿æ€§å›å½’å¯¹ä¸€ä¸€æ˜ å°„åçš„æ¦‚ç‡å€¼è¿›è¡Œçº¿æ€§æ‹Ÿåˆï¼Œå³$logit(p)=log(\frac{p}{1-p})=\eta=f_{\theta}(x)=\theta^T \cdot x$ã€‚å› ä¸ºlogitå˜æ¢æ˜¯ä¸€ä¸€æ˜ å°„ï¼Œæ‰€ä»¥å­˜åœ¨logitçš„åå˜æ¢ï¼ˆantilogitï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å¾—på€¼çš„è§£æè¡¨è¾¾å¼ï¼š<br>$$<br>p=antilogit(x)=logit^{\eta}=\frac{e^{\eta}}{1+e^{\eta}}=\frac{e^{\theta^T \cdot x}}{1+e^{\theta^T \cdot x}}<br>$$<br>$$<br>1-p=1-antilogit(x)=1-logit^{\eta}=1-\frac{e^{\eta}}{1+e^{\eta}}=1-\frac{e^{\theta^T \cdot x}}{1+e^{\theta^T \cdot x}}ï¼\frac{1}{1+e^{\theta^T \cdot x}}<br>$$<br>ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸Šå¼å³ä¸ºlogisticå›å½’çš„ä¸€èˆ¬è¡¨è¾¾å¼ï¼Œå…¶é‡‡ç”¨çš„logitå˜æ¢ä¸€èˆ¬è®°ä¸ºsigmoidå‡½æ•°ï¼š<br>$$<br>g(x)=\frac{e^{\theta^T x}}{1+e^{\theta^T x}}<br>$$<br>è®²åˆ°è¿™é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯<strong>ä¸ºä»€ä¹ˆè¦é€‰ç”¨sigmoidå‡½æ•°</strong>å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸é€‰ç”¨å…¶ä»–å‡½æ•°ï¼Œå¦‚probitå‡½æ•°ï¼Ÿ</p><p>å…¶å®ï¼Œæ— è®ºæ˜¯sigmoidå‡½æ•°è¿˜æ˜¯probitå‡½æ•°éƒ½æ˜¯å¹¿ä¹‰çº¿æ€§æ¨¡å‹çš„è¿æ¥å‡½æ•°ï¼ˆlink functionï¼‰ä¸­çš„ä¸€ç§ã€‚é€‰ç”¨è”æ¥å‡½æ•°æ˜¯å› ä¸ºï¼Œä»ç»Ÿè®¡å­¦è§’åº¦è€Œè¨€ï¼Œæ™®é€šçº¿æ€§å›å½’æ¨¡å‹æ˜¯åŸºäºå“åº”å˜é‡å’Œè¯¯å·®é¡¹å‡æœä»æ­£æ€åˆ†å¸ƒçš„å‡è®¾ï¼Œä¸”è¯¯å·®é¡¹å…·æœ‰é›¶å‡å€¼ï¼ŒåŒæ–¹å·®çš„ç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œä¾‹å¦‚åˆ†ç±»ä»»åŠ¡ï¼ˆåˆ¤æ–­è‚¿ç˜¤æ˜¯å¦ä¸ºè‰¯æ€§ã€åˆ¤æ–­é‚®ä»¶æ˜¯å¦ä¸ºåƒåœ¾é‚®ä»¶ï¼‰ï¼Œå…¶å“åº”å˜é‡ä¸€èˆ¬ä¸æœä»äºæ­£æ€åˆ†å¸ƒï¼Œå…¶æœä»äºäºŒé¡¹åˆ†å¸ƒï¼Œæ‰€ä»¥é€‰ç”¨æ™®é€šçº¿æ€§å›å½’æ¨¡å‹æ¥æ‹Ÿåˆæ˜¯ä¸å‡†ç¡®çš„ï¼Œå› ä¸ºä¸ç¬¦åˆå‡è®¾ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦é€‰ç”¨å¹¿ä¹‰çº¿æ€§æ¨¡å‹æ¥æ‹Ÿåˆæ•°æ®ï¼Œé€šè¿‡æ ‡å‡†è”æ¥å‡½æ•°(canonical link or standard link function)æ¥æ˜ å°„å“åº”å˜é‡ï¼Œå¦‚ï¼šæ­£æ€åˆ†å¸ƒå¯¹åº”äºæ’ç­‰å¼ï¼Œæ³Šæ¾åˆ†å¸ƒå¯¹åº”äºè‡ªç„¶å¯¹æ•°å‡½æ•°ï¼ŒäºŒé¡¹åˆ†å¸ƒå¯¹åº”äºlogitå‡½æ•°ï¼ˆäºŒé¡¹åˆ†å¸ƒæ˜¯ç‰¹æ®Šçš„æ³Šæ¾åˆ†å¸ƒï¼‰ã€‚</p><h2 id="2-æœ€å¤§ä¼¼ç„¶ä¼°è®¡"><a href="#2-æœ€å¤§ä¼¼ç„¶ä¼°è®¡" class="headerlink" title="2. æœ€å¤§ä¼¼ç„¶ä¼°è®¡"></a>2. æœ€å¤§ä¼¼ç„¶ä¼°è®¡</h2><p>é€šè¿‡ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—logisticå›å½’çš„è¡¨è¾¾å¼ï¼š<br>$$P(y=1|X)=\frac{exp(\theta^T \cdot x)}{1+exp(\theta^T \cdot x)}$$<br>ä»¥åŠ$$P(y=0|X)=\frac{1}{1+exp(\theta^T \cdot x)}$$<br>å…¶ä¸­$\theta$æ˜¯æœªçŸ¥å‚æ•°ã€‚å‡è®¾æœ‰ä¸€ç»„è§‚æµ‹æ ·æœ¬ï¼Œé‚£ä¹ˆç°åœ¨çš„ä»»åŠ¡å°±å˜æˆç»™å®šä¸€ç»„æ•°æ®å’Œä¸€ä¸ªå‚æ•°å¾…å®šçš„æ¨¡å‹ä¸‹ï¼Œå¦‚ä½•ä¼°è®¡æ¨¡å‹å‚æ•°çš„é—®é¢˜ã€‚è€Œè¿™é‡Œæƒ³è¦è®²è¿°çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡å°±æ˜¯ä¼°è®¡æœªçŸ¥å‚æ•°çš„ä¸€ç§æ–¹æ³•ï¼Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMaximum Likelihood Methodï¼‰æ˜¯å»ºç«‹åœ¨å„æ ·æœ¬é—´ç›¸äº’ç‹¬ç«‹ä¸”æ ·æœ¬æ»¡è¶³éšæœºæŠ½æ ·ï¼ˆå¯ä»£è¡¨æ€»ä½“åˆ†å¸ƒï¼‰ä¸‹çš„ä¼°è®¡æ–¹æ³•ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¦‚æœç°æœ‰æ ·æœ¬å¯ä»¥ä»£è¡¨æ€»ä½“ï¼Œé‚£ä¹ˆæœ€å¤§ä¼¼ç„¶ä¼°è®¡å°±æ˜¯æ‰¾åˆ°ä¸€ç»„å‚æ•°ä½¿å¾—å‡ºç°ç°æœ‰æ ·æœ¬çš„å¯èƒ½æ€§æœ€å¤§ï¼Œå³ä»ç»Ÿè®¡å­¦è§’åº¦éœ€è¦ä½¿å¾—æ‰€æœ‰è§‚æµ‹æ ·æœ¬çš„è”åˆæ¦‚ç‡æœ€å¤§åŒ–ï¼Œåˆå› ä¸ºæ ·æœ¬é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥æ‰€æœ‰è§‚æµ‹æ ·æœ¬çš„è”åˆæ¦‚ç‡å¯ä»¥å†™æˆå„æ ·æœ¬å‡ºç°æ¦‚ç‡çš„è¿ä¹˜ç§¯ï¼Œå¦‚ä¸‹å¼ï¼š<br>$$<br>\begin{aligned}<br>\prod^m_{i=1}\underbrace{P(y^{(i)}=1|x^{(i)})}_{where , i\in m , and , y^{(i)}=1} \cdot \underbrace{P(y^{(i)}=0|x^{(i)})}_{where , i \in m ,<br>and , y^{(i)}=0}\\<br>&amp; = \prod^m_{i=1} P(y^{(i)}=1|x^{(i)})^{y(i)} \cdot P(y^{(i)}=0|x^{(i)})^{1-y(i)}<br>\end{aligned}<br>$$<br>ä¸Šé¢ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å‘¢ï¼Ÿå½“y=1çš„æ—¶å€™ï¼Œåé¢é‚£ä¸€é¡¹æ˜¯ä¸æ˜¯æ²¡æœ‰äº†ï¼Œé‚£å°±åªå‰©ä¸‹xå±äº1ç±»çš„æ¦‚ç‡ï¼Œå½“y=0çš„æ—¶å€™ï¼Œç¬¬ä¸€é¡¹æ˜¯ä¸æ˜¯æ²¡æœ‰äº†ï¼Œé‚£å°±åªå‰©ä¸‹åé¢é‚£ä¸ªxå±äº0çš„æ¦‚ç‡ï¼ˆ1å‡å»xå±äº1çš„æ¦‚ç‡ï¼‰ã€‚æ‰€ä»¥ä¸ç®¡yæ˜¯0è¿˜æ˜¯1ï¼Œä¸Šé¢å¾—åˆ°çš„æ•°ï¼Œéƒ½æ˜¯(x, y)å‡ºç°çš„æ¦‚ç‡ã€‚é‚£æˆ‘ä»¬çš„æ•´ä¸ªæ ·æœ¬é›†ï¼Œä¹Ÿå°±æ˜¯nä¸ªç‹¬ç«‹çš„æ ·æœ¬å‡ºç°çš„ä¼¼ç„¶å‡½æ•°ä¸ºï¼ˆå› ä¸ºæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥nä¸ªæ ·æœ¬å‡ºç°çš„æ¦‚ç‡å°±æ˜¯ä»–ä»¬å„è‡ªå‡ºç°çš„æ¦‚ç‡ç›¸ä¹˜ï¼‰ã€‚</p><p>é€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“æ ·æœ¬å“åº”å˜é‡ä¸º1æ—¶ï¼Œä¸Šå¼ç­‰äº$P(y^{(i)}=1ï½œx^{(i)})$ï¼›å½“æ ·æœ¬å“åº”å˜é‡ä¸º0æ—¶ï¼Œä¸Šå¼ç­‰äº$P(y^{(i)}=0ï½œx^{(i)})$ï¼Œæ˜¯æ‰€æœ‰æ ·æœ¬è¾¹é™…åˆ†å¸ƒæ¦‚ç‡çš„è¿ä¹˜ç§¯ï¼Œé€šå¸¸è¢«ç§°ä¹‹ä¸ºä¼¼ç„¶å‡½æ•°$\ell(\theta)$ã€‚</p><p>æœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„ç›®æ ‡æ˜¯æ±‚å¾—ä½¿å¾—ä¼¼ç„¶å‡½æ•°$\ell(\theta)$æœ€å¤§çš„å‚æ•°$\theta$çš„ç»„åˆï¼Œç†è®ºä¸Šè®²æˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨æ¢¯åº¦ä¸Šå‡ç®—æ³•æ±‚è§£è¯¥ç›®æ ‡å‡½æ•°ï¼ˆä¼¼ç„¶å‡½æ•°ï¼‰çš„æå¤§å€¼ã€‚</p><h3 id="ä¸ºä»€ä¹ˆé‡‡ç”¨æœ€å¤§ä¼¼ç„¶ï¼Ÿâ€”éå‡¸å‡½æ•°"><a href="#ä¸ºä»€ä¹ˆé‡‡ç”¨æœ€å¤§ä¼¼ç„¶ï¼Ÿâ€”éå‡¸å‡½æ•°" class="headerlink" title="ä¸ºä»€ä¹ˆé‡‡ç”¨æœ€å¤§ä¼¼ç„¶ï¼Ÿâ€”éå‡¸å‡½æ•°"></a>ä¸ºä»€ä¹ˆé‡‡ç”¨æœ€å¤§ä¼¼ç„¶ï¼Ÿâ€”éå‡¸å‡½æ•°</h3><p>æˆ‘ä»¬çŸ¥é“ä¹‹å‰çº¿æ€§å›å½’å¯ä»¥é‡‡ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ±‚è§£æ˜¯å› ä¸ºçº¿æ€§å›å½’çš„ä»£ä»·å‡½æ•°ï¼ˆå‡æ–¹è¯¯å·®å‡½æ•°ï¼‰æ˜¯å‡¸å‡½æ•°ï¼Œä¸ºç¢—çŠ¶ï¼Œè€Œå‡¸å‡½æ•°å…·æœ‰è‰¯å¥½çš„æ€§è´¨ï¼ˆå¯¹äºå‡¸å‡½æ•°æ¥è¯´å±€éƒ¨æœ€å°å€¼ç‚¹å³ä¸ºå…¨å±€æœ€å°å€¼ç‚¹ï¼‰ä½¿å¾—æˆ‘ä»¬ä¸€èˆ¬ä¼šå°†éå‡¸å‡½æ•°è½¬æ¢ä¸ºå‡¸å‡½æ•°è¿›è¡Œæ±‚è§£ã€‚å› æ­¤ï¼Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡é‡‡ç”¨è‡ªç„¶å¯¹æ•°å˜æ¢ï¼Œå°†ä¼¼ç„¶å‡½æ•°è½¬æ¢ä¸ºå¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œå…¶å…·ä½“å½¢å¼ä¸ºï¼š<br>$$<br>\begin{aligned}<br>log(\ell(\theta)) &amp; = log(\prod_{i=1}^m P(y^{(i)}=1ï½œx^{(i)})^{y(i)} \cdot P(y^{(i)}=0ï½œx^{(i)})^{1-y(i)}) \\<br>&amp; = \sum^m \lgroup y^{(i)} log(g(x)) + (1-y^{(i)})log(1-g(x)) \rgroup<br>\end{aligned}<br>$$</p><p>ç›¸å¯¹äºæ±‚è§£å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„æœ€å¤§å€¼ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥å°†è¯¥ç›®æ ‡è½¬æ¢ä¸ºå¯¹å¶é—®é¢˜ï¼Œå³æ±‚è§£ä»£ä»·å‡½æ•°$J(\theta)=-log(\ell(\theta))$çš„æœ€å°å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰logisticå›å½’çš„ä»£ä»·å‡½æ•°ä¸ºï¼š<br>$$<br>cost=J(\theta)=-log(\ell(\theta))ï¼ï¼\frac{1}{m} \sum^m_{i=1} \lgroup y^{(i)} log(g(x)) + (1-y^{(i)})log(1-g(x)) \rgroup<br>$$<br>ä»ä»£ä»·å‡½æ•°çš„ç›´è§‚è¡¨è¾¾ä¸Šæ¥çœ‹ï¼Œå½“$y^{(i)}=1, g(x)=1$æ—¶(é¢„æµ‹ç±»åˆ«å’ŒçœŸå®ç±»åˆ«ç›¸åŒ)ï¼Œ$J(\thetaï½œx^{(i)})=0$ï¼›å½“$y^{(i)}=1, g(x) \rightarrow 0$æ—¶(é¢„æµ‹ç±»åˆ«å’ŒçœŸå®ç±»åˆ«ç›¸å)ï¼Œ$J(\thetaï½œx^{(i)}) \rightarrow \infty$ï¼ˆæ³¨æ„å¯¹æ•°å‡½æ•°å‰æœ‰ä¸ªè´Ÿå·ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå½“é¢„æµ‹ç»“æœå’ŒçœŸå®ç»“æœè¶Šæ¥è¿‘æ—¶ï¼Œé¢„æµ‹äº§ç”Ÿçš„ä»£ä»·è¶Šå°ï¼Œå½“é¢„æµ‹ç»“æœå’ŒçœŸå®ç»“æœå®Œå…¨ç›¸åæ—¶ï¼Œé¢„æµ‹ä¼šäº§ç”Ÿå¾ˆå¤§çš„æƒ©ç½šã€‚è¯¥ç†è®ºåŒæ ·é€‚ç”¨äº$y^{(i)}=0$çš„æƒ…å†µã€‚</p><p>å®é™…ä¸Šï¼Œæœ€å°äºŒä¹˜ä¼°è®¡æ˜¯æœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„ä¸€ç§ï¼Œæœ‰å¿ƒçš„äººè¿˜è®°å¾—ä¸Šé¢æåˆ°è¿‡çš„çº¿æ€§å›å½’å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œå³è¯¯å·®é¡¹å‡æœä»æ­£æ€åˆ†å¸ƒçš„å‡è®¾ï¼Œå¦‚æœçº¿æ€§å›å½’è®°ä¸º$y=\theta x + \epsilon$çš„è¯ï¼Œå¯¹äºè¯¯å·®å‡½æ•°ÏµÏµï¼Œå…¶æœä»æ­£æ€åˆ†å¸ƒï¼Œ$\epsilon \sim N(0, \sigma^2)$ï¼Œå› æ­¤åˆ©ç”¨æ­£æ€åˆ†å¸ƒçš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°$y-\theta x \sim N(0, \sigma^2) \Rightarrow y \sim N(\theta x, \sigma^2)$ã€‚</p><p>å› æ­¤ï¼Œæ ¹æ®æå¤§ä¼¼ç„¶ä¼°è®¡çš„å®šä¹‰ï¼Œæˆ‘ä»¬è¦è·å¾—äº§ç”Ÿæ ·æœ¬yyå¯èƒ½æ€§æœ€å¤§çš„ä¸€ç»„å‚æ•°Î¸Î¸ï¼Œå› æ­¤ï¼Œä¼¼ç„¶å‡½æ•°å¯å†™ä¸ºï¼š<br>$$<br>\ell(\theta)=\prod^m_{i=1} \frac{1}{\sqrt{2\pi}\sigma} exp(- \frac{(y^{(i)}-\theta x)^2}{2 \sigma})<br>$$<br>ä¸logisticå›å½’ç±»ä¼¼ï¼Œæˆ‘ä»¬ä»ç„¶å°†ä¼¼ç„¶å‡½æ•°å˜æ¢ä¸ºå¯¹æ•°ä¼¼ç„¶å‡½æ•°æ±‚è§£æå€¼ï¼Œæ­¤æ—¶ï¼Œ<br>$$<br>log(\ell(\theta))=mlog(\frac{1}{\sqrt{2\pi}}) + \sum^m_{i=1} -\frac{(y^{(i)}-\theta x)^2}{2 \sigma}<br>$$<br>ç»¼ä¸Šæ‰€è¿°ï¼Œè¦è®©$log(\ell(\theta))$æœ€å¤§ï¼Œæˆ‘ä»¬éœ€è¦è®©$\sum^m_{i=1}(y^{(i)}-\theta x)^2$æœ€å°ï¼Œè¯¥å¼å³ä¸ºæˆ‘ä»¬ç»å¸¸æåŠçš„çº¿æ€§å›å½’çš„ä»£ä»·å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œå½“çº¿æ€§å›å½’çš„æ±‚è§£è¿‡ç¨‹ä¹Ÿåˆ©ç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„æ€æƒ³ã€‚</p><h2 id="3-æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ±‚è§£"><a href="#3-æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ±‚è§£" class="headerlink" title="3. æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ±‚è§£"></a>3. æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ±‚è§£</h2><p>æœ‰äº†ä»£ä»·å‡½æ•°ï¼Œæˆ‘ä»¬è‡ªç„¶å¯ä»¥é€‰ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æˆ–è€…å…¶ä»–ä¼˜åŒ–ç®—æ³•å¯¹ç›®æ ‡å‡½æ•°è¿›è¡Œæ±‚è§£ã€‚åœ¨Rä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯é‡‡ç”¨optimå‡½æ•°ï¼Œåˆ©ç”¨æ¨¡æ‹Ÿé€€ç«ç®—æ³•æˆ–è€…å•çº¯å½¢ç®—æ³•æ±‚è§£ã€‚å¯¹äºæ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚è§£ç›®æ ‡å‡½æ•°çš„ä¸€é˜¶åå¯¼æ•°è·å¾—æ¢¯åº¦ï¼Œä¸ºï¼š<br>$$<br>\begin{aligned}<br>\frac{\partial J}{\partial \theta} &amp; = -\sum_{i=1}^m ( \frac{y}{g(x)} \cdot gâ€™(x) - \frac{1-y}{1-g(x)}\cdot gâ€™(x)) \\<br>&amp; = -\sum^m( \frac{y-yg(x)-g(x)+yg(x)}{g(x)(1-g(x))} \cdot gâ€™(x) )  \\<br>&amp; = -\sum^m \frac{y-g(x)}{g(x)(1-g(x))} \cdot (-\frac{x e^{\theta x}}{(1+e^{\theta x})^2}) \\<br>&amp; = -\sum^m \frac{g(x)-y}{g(x)(1-g(x))} \cdot \frac{e^{\theta x}}{1+e^{\theta x}} \cdot \frac{1}{1+e^{\theta x}} \cdot x \\<br>&amp; = -\sum^m \frac{g(x)-y}{g(x)(1-g(x))} \cdot g(x) \cdot (1-g(x)) \cdot x \\<br>&amp; = -\sum^m (g(x)-y) \cdot x \\<br>\end{aligned}<br>$$<br>å› æ­¤ï¼Œæ¢¯åº¦æ›´æ–°çš„è¡¨è¾¾å¼ä¸ºï¼š<br>$$<br>\theta := \alpha \sum^m_{i=1} (g(x)-y) \ cdot x<br>$$<br>è‡³æ­¤ï¼Œlogisticå›å½’å’Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡åŸç†éƒ¨åˆ†å°±overã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="http://blog.csdn.net/han_xiaoyang/article/details/49332321" target="_blank" rel="noopener">æœºå™¨å­¦ä¹ ç³»åˆ—(2)_ä»åˆç­‰æ•°å­¦è§†è§’è§£è¯»é€»è¾‘å›å½’</a></li><li><a href="https://chenrudan.github.io/blog/2016/01/09/logisticregression.html" target="_blank" rel="noopener">æµ…æLogistic Regression</a></li><li><a href="http://wenjunoy.com/2016/01/logistic-sigmoid-function.html" target="_blank" rel="noopener">Logisticå‡½æ•°ï¼ˆsigmoidå‡½æ•°ï¼‰</a></li><li><a href="http://blog.csdn.net/zouxy09/article/details/20319673" target="_blank" rel="noopener">æœºå™¨å­¦ä¹ ç®—æ³•ä¸Pythonå®è·µä¹‹ï¼ˆä¸ƒï¼‰é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>MLE</tag>
      
      <tag>logistic</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sparkä¸­jobè¿è¡Œè¿‡ç¨‹è¯¦è§£å’Œjob,stage,taskè§£æ</title>
    <link href="/2017/08/30/spark%E4%B8%ADjob%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3%E5%92%8Cjob-stage-task%E8%A7%A3%E6%9E%90/"/>
    <url>/2017/08/30/spark%E4%B8%ADjob%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3%E5%92%8Cjob-stage-task%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>äº†è§£äº†sparkçš„åŸºç¡€åä¸€ç›´æƒ³æ¸…æ¥šåœ¨sparkæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ã€‚åœ¨sparkå®¢æˆ·ç«¯æäº¤ä»»åŠ¡åï¼Œä»<code>jobï¼Œstageï¼Œtask</code>ï¼Œåœ¨åˆ°<code>worker</code>ä¸Šæ‰§è¡Œï¼Œæ•´è¿‡æµç¨‹å¿…é¡»æ¸…æ¥šï¼Œå¯¹åç»­çš„è°ƒä¼˜ï¼Œsparkä¸­jobè¿è¡ŒåŸç†éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚ä¸‹é¢å¯¹sparkä¸­jobè¿è¡Œè¿‡ç¨‹è¿›è¡Œè¯¦ç»†è§£æï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="/uploads/spark%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90.png" srcset="/img/loading.gif" alt="enter description here"></p><a id="more"></a><h2 id="Jobè¿è¡Œæµç¨‹"><a href="#Jobè¿è¡Œæµç¨‹" class="headerlink" title="Jobè¿è¡Œæµç¨‹"></a>Jobè¿è¡Œæµç¨‹</h2><p>åœ¨clientç«¯æäº¤Jobï¼Œè€ŒJobä¼šç”Ÿæˆä¸€ä¸ª<code>sparkcontext</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å‘é›†ç¾¤ç”³è¯·Executorèµ„æºï¼Œå°†jobåˆ†è§£æˆå¯å¹¶è¡Œçš„taskï¼Œç„¶åå°†taskåˆ†å‘åˆ°å„ä¸ª<code>executor</code>ä¸Šæ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåå°†<code>executor</code>çš„ç»“æœå…¨éƒ¨è¿”å›åˆ°<code>sparkcontext</code>ä¸­ã€‚ä¸‹é¢å¯¹æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</p><h3 id="Jobåˆ°DAGSchedulerè¿‡ç¨‹"><a href="#Jobåˆ°DAGSchedulerè¿‡ç¨‹" class="headerlink" title="Jobåˆ°DAGSchedulerè¿‡ç¨‹"></a>Jobåˆ°DAGSchedulerè¿‡ç¨‹</h3><p>Jobçš„æ¦‚å¿µï¼šåŒ…å«å¾ˆå¤š<code>task</code>çš„å¹¶è¡Œè®¡ç®—ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯<code>Spark RDD</code> é‡Œé¢çš„<code>action</code>ï¼Œæ¯ä¸ª<code>action</code>çš„è§¦å‘ä¼šç”Ÿæˆä¸€ä¸ªjobã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¸»è¦æ˜¯å°†RDDä¸­çš„ä¾èµ–å…³ç³»å½¢æˆDAGï¼Œå¹¶å°†DAGä¼ é€’åˆ°<code>DAGScheduler</code>ä¸­ã€‚</p><h3 id="DAGSchedulerå¯¹DAGçš„å¤„ç†"><a href="#DAGSchedulerå¯¹DAGçš„å¤„ç†" class="headerlink" title="DAGSchedulerå¯¹DAGçš„å¤„ç†"></a>DAGSchedulerå¯¹DAGçš„å¤„ç†</h3><p><code>DAGSchedule</code>å¯¹DAGè¿›è¡Œ<code>stage</code>çš„åˆ’åˆ†ï¼Œå¹¶åœ¨æ¯ä¸ª<code>Stage</code>å†…åŒ–ä¸ºå‡ºä¸€ç³»åˆ—å¯å¹¶è¡Œå¤„ç†çš„<code>task</code>,å†å°†<code>task</code>ä¼ é€’åˆ°ä¸‹ä¸€å±‚; <code>DAGScheduler</code>ä¼šè®°å½•å“ªä¸ªRDDæˆ–è€…<code>Stage</code>ä¼šè¢«ç‰©åŒ–ï¼Œä»è€Œå¯»æ‰¾ä¸€ä¸ªæœ€ä½³è°ƒåº¦æ–¹æ¡ˆã€‚å°†<code>TaskSet</code>æäº¤ç»™<code>Task Tracker</code>ã€‚é‡æ–°æäº¤è¾“å‡º<code>lost</code>çš„<code>Stage</code>ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†å¾ˆé‡è¦çš„ç¯èŠ‚â€”<code>stage</code>çš„åˆ’åˆ†,åé¢ä¼šç€é‡è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="taskè¿è¡Œ"><a href="#taskè¿è¡Œ" class="headerlink" title="taskè¿è¡Œ"></a>taskè¿è¡Œ</h3><p>åœ¨1.2ä¸­ç”Ÿæˆäº†ä¸€ç³»åˆ—çš„<code>task</code>ï¼Œ<code>task</code>å’Œåº•å±‚çš„èµ„æºäº¤äº’ï¼Œè€Œè¿™ä¸ªèµ„æºäº¤äº’çš„åè°ƒäººå°±æ˜¯<code>TaskScheduler</code>ï¼Œ<code>taskset</code>æäº¤åˆ°<code>TaskScheduler</code>ç­‰å¾…è°ƒåº¦æ‰§è¡Œã€‚<code>TaskScheduler</code>æä¾›äº†å¯¹å¤–çš„æ¥å£ï¼Œ<code>TaskScheduler</code>å¯¹æ¥çš„æ˜¯ä¸åŒçš„<code>SchedulerBackend</code>çš„å®ç°(æ¯”å¦‚<code>mesos</code>ï¼Œ<code>yarn</code>ï¼Œ<code>standalone</code>)ï¼Œéƒ½æ˜¯é€šè¿‡<code>TaskScheduler</code>æ¥è¿›è¡Œåä½œã€‚<code>TaskScheduler</code>åœ¨åˆå§‹åŒ–åä¼šå¯åŠ¨<code>SchedulerBackend</code>(yarn, mesosç­‰)ï¼Œå®ƒ(<code>SchedulerBackend</code>)è´Ÿè´£è·Ÿå¤–ç•Œæ‰“äº¤é“ï¼Œæ¥æ”¶<code>Executor</code>çš„æ³¨å†Œä¿¡æ¯ï¼Œå¹¶ç»´æŠ¤<code>Executor</code>çš„çŠ¶æ€ï¼Œæ‰€ä»¥è¯´<code>SchedulerBackend</code>æ˜¯ç®¡èµ„æº(<code>worker</code>)çš„ï¼ŒåŒæ—¶å®ƒåœ¨å¯åŠ¨åä¼šå®šæœŸåœ°å»â€œè¯¢é—®â€<code>TaskScheduler</code>æœ‰æ²¡æœ‰ä»»åŠ¡è¦è¿è¡Œï¼Œ<code>TaskScheduler</code>åœ¨<code>SchedulerBackend</code>â€œé—®â€å®ƒçš„æ—¶å€™ï¼Œä¼šä»è°ƒåº¦é˜Ÿåˆ—ä¸­æŒ‰ç…§æŒ‡å®šçš„è°ƒåº¦ç­–ç•¥é€‰æ‹©<code>TaskSetManager</code>å»è°ƒåº¦è¿è¡Œã€‚</p><p><code>TaskScheduler</code>æ”¯æŒä¸¤ç§è°ƒåº¦ç­–ç•¥ï¼Œä¸€ç§æ˜¯<code>FIFO</code>ï¼Œä¹Ÿæ˜¯é»˜è®¤çš„è°ƒåº¦ç­–ç•¥ï¼Œå¦ä¸€ç§æ˜¯<code>FAIR</code>ã€‚è¿™ä¸¤ç§è°ƒåº¦ç­–ç•¥å¯ä»¥é€šè¿‡èµ„æ–™å»æŸ¥å…·ä½“çš„å®ç°æ–¹å¼ã€‚</p><p>Sparkå®ç°äº†ä¸‰ç§ä¸åŒçš„<code>TaskScheduler</code>ï¼ŒåŒ…æ‹¬<code>LocalSheduler</code>ã€<code>ClusterScheduler</code>å’Œ<code>MesosScheduler</code>ã€‚<code>LocalSheduler</code>æ˜¯ä¸€ä¸ªåœ¨æœ¬åœ°æ‰§è¡Œçš„çº¿ç¨‹æ± ï¼Œ<code>DAGScheduler</code>æäº¤çš„æ‰€æœ‰taskä¼šåœ¨çº¿ç¨‹æ± ä¸­è¢«æ‰§è¡Œï¼Œå¹¶å°†ç»“æœè¿”å›ç»™<code>DAGScheduler</code>ã€‚<code>TaskScheduler</code>çš„å¯åŠ¨ä¼šä¼´éš<code>SparkDeploySchedulerBackend</code>çš„å¯åŠ¨ï¼Œè€Œ<code>backend</code>ä¼šå°†è‡ªå·±åˆ†ä¸ºä¸¤ä¸ªè§’è‰²ï¼šé¦–å…ˆæ˜¯<code>driver</code>ï¼Œ<code>driver</code>æ˜¯ä¸€ä¸ª<code>local</code>è¿è¡Œçš„<code>actor</code>ï¼Œè´Ÿè´£ä¸<code>remote</code>çš„<code>executor</code>è¿›è¡Œé€šè¡Œï¼Œæäº¤ä»»åŠ¡ï¼Œæ§åˆ¶<code>executor</code>ï¼›å…¶æ¬¡æ˜¯<code>StandaloneExecutorBackend</code>ï¼ŒSparkä¼šåœ¨æ¯ä¸€ä¸ªslave nodeä¸Šå¯åŠ¨ä¸€ä¸ª<code>StandaloneExecutorBackend</code>è¿›ç¨‹ï¼Œè´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œè¿”å›æ‰§è¡Œç»“æœã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾<code>TaskScheduler</code>éƒ¨åˆ†æ‰€ç¤ºï¼š</p><p><img src="/uploads/TaskScheduler%E8%AF%A6%E8%A7%A3.png" srcset="/img/loading.gif" alt="TaskSchedulerè¯¦è§£"></p><p>ä¸Šå›¾ä¸­æ˜¯ä¸€ä¸ªå®Œæ•´çš„sparkä»»åŠ¡è°ƒåº¦è¿‡ç¨‹ä¸­<code>ApplicationMaster</code>ã€<code>Driver</code>ä»¥åŠ<code>Executor</code>çš„äº¤äº’è¿‡ç¨‹ã€‚<code>Driver</code>åˆå§‹åŒ–<code>SparkContext</code>è¿‡ç¨‹ä¸­ï¼Œä¼šåˆ†åˆ«åˆå§‹åŒ–<code>DAGScheduler</code>ã€<code>TaskScheduler</code>ã€<code>SchedulerBackend</code>ä»¥åŠ<code>HeartbeatReceiver</code>ï¼Œå¹¶å¯åŠ¨<code>SchedulerBackend</code>ä»¥åŠ<code>HeartbeatReceiver</code>ã€‚<code>SchedulerBackend</code>é€šè¿‡<code>ApplicationMaster</code>ç”³è¯·èµ„æºï¼Œå¹¶ä¸æ–­ä»<code>TaskScheduler</code>ä¸­æ‹¿åˆ°åˆé€‚çš„<code>Task</code>åˆ†å‘åˆ°<code>Executor</code>æ‰§è¡Œã€‚<code>HeartbeatReceiver</code>è´Ÿè´£æ¥æ”¶<code>Executor</code>çš„å¿ƒè·³ä¿¡æ¯ï¼Œç›‘æ§<code>Executor</code>çš„å­˜æ´»çŠ¶å†µï¼Œå¹¶é€šçŸ¥åˆ°<code>TaskScheduler</code>ã€‚</p><p>ä¸Šé¢å¯¹sparkä¸­ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹æœ‰äº†å¤§æ¦‚çš„äº†è§£ä¹‹åï¼Œç°åœ¨å¯ä»¥å¯¹å…¶ä¸­éƒ¨åˆ†çš„ç»†èŠ‚è¿›è¡Œäº†è§£ã€‚å¦‚jobï¼Œtaskï¼Œstageçš„åˆ’åˆ†ç­‰ã€‚å…¶ä¸­stageçš„åˆ’åˆ†æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h2 id="job-stageå’Œtaskç†è§£"><a href="#job-stageå’Œtaskç†è§£" class="headerlink" title="job,stageå’Œtaskç†è§£"></a>job,stageå’Œtaskç†è§£</h2><h3 id="jobçš„ç†è§£"><a href="#jobçš„ç†è§£" class="headerlink" title="jobçš„ç†è§£"></a>jobçš„ç†è§£</h3><p><code>job</code>æ˜¯<code>rdd</code>çš„<code>action</code>æ‰€è§¦å‘çš„ä¸€ä¸ªåŠ¨ä½œï¼Œå½“<code>rdd</code>æ‰§è¡Œ<code>action</code>çš„æ—¶å€™å³è§¦å‘ä¸€ä¸ª<code>job</code>ã€‚åœ¨è§¦å‘<code>job</code>åï¼Œ<code>RDD</code>çš„<code>runJob</code>åˆ™åœ¨<code>SparkContext</code>çš„<code>runJob</code>ä¸­è°ƒç”¨ï¼Œ<code>SparkContext</code>çš„<code>runJo</code>båº•å±‚ä¼šè°ƒç”¨<code>DAGScheduler</code>çš„<code>runJob</code>æ–¹æ³•ã€‚åœ¨<code>DAGScheduler</code>ä¼šå°†æ¯ä¸ª<code>job</code>åˆ’åˆ†ä¸ºå¤šä¸ª<code>stage</code>ï¼Œå¹¶åˆ†æä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œä¼šå¯»æ‰¾æœ€ä¼˜çš„è¿è¡Œç­–ç•¥ï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p><p>å¦å¤–<code>job</code>ä¹Ÿåˆ†ä¸ºä¸å«æœ‰<code>shuffle</code>å’Œ<code>reduce</code>ï¼Œå«æœ‰<code>shuffle</code>å’Œ<code>reduce</code>çš„<code>job</code>,å¯¹äºä¸¤ç§<code>job</code>ï¼Œç¬¬ä¸€ç§<code>job</code>åªä¼šäº§ç”Ÿä¸€ä¸ª<code>finalStage</code>ï¼Œè€Œç¬¬äºŒç§<code>job</code>ä¼šäº§ç”Ÿ<code>finalStage</code>å’Œ<code>mapStage</code>ã€‚</p><h3 id="stageçš„åˆ’åˆ†"><a href="#stageçš„åˆ’åˆ†" class="headerlink" title="stageçš„åˆ’åˆ†"></a>stageçš„åˆ’åˆ†</h3><p>ä¸€ä¸ªjobä¼šè¢«åˆ†æˆ1ç»„æˆ–1ç»„ä»¥ä¸Štaskï¼Œå…¶ä¸­æ¯ç»„taskå°±æ˜¯ä¸€ä¸ªstageï¼Œå°±åƒmap stageå’Œreduce stageä¸€æ ·ã€‚å¦å¤–ä¸€ä¸ªè¯´æ³•ï¼šstageæ˜¯jobçš„ç»„æˆå•å…ƒï¼Œä¸€ä¸ªjobä¼šè¢«åˆ‡åˆ†ä¸ºä¸€ä¸ªæˆ–è€…å¤šä¸ªstageã€‚é‚£ä¹ˆstageæ˜¯æ€ä¹ˆåˆ’åˆ†çš„å‘¢ï¼Ÿ</p><p>å®˜æ–¹çš„è¯´æ˜ï¼šè°ƒåº¦å™¨ä»<code>DAG</code>å›¾æœ«ç«¯å‡ºå‘ï¼Œé€†å‘éå†æ•´ä¸ªä¾èµ–å…³ç³»é“¾ï¼Œé‡åˆ°<code>ShuffleDependency</code>ï¼ˆå®½ä¾èµ–å…³ç³»çš„ä¸€ç§å«æ³•ï¼‰å°±æ–­å¼€ï¼Œé‡åˆ°<code>NarrowDependency</code>å°±å°†å…¶åŠ å…¥åˆ°å½“å‰<code>stage</code>ã€‚ä»è§¦å‘<code>action</code>æ“ä½œçš„<code>RDD</code>å¾€å‰å€’æ¨ï¼Œå¦‚æœå‘ç°äº†æŸä¸ª<code>RDD</code>æ˜¯å®½ä¾èµ–ï¼Œé‚£ä¹ˆå°±ä¼šå°†å®½ä¾èµ–çš„<code>RDD</code>åˆ›å»ºä¸ºä¸€ä¸ªæ–°çš„<code>stage</code>ã€‚é‚£ä¸ª<code>RDD</code>æ˜¯æ–°çš„<code>stage</code>ä¸­æœ€åä¸€ä¸ª<code>RDD</code>ï¼Œè¿™æ ·ä¾æ¬¡éå†ï¼ŒçŸ¥é“æ‰€æœ‰çš„<code>RDD</code>å…¨éƒ¨éå†ã€‚ç»“åˆå®˜æ–¹çš„å›¾æ¥è§£é‡Šã€‚</p><p><img src="/uploads/RDD%E4%B8%ADstage%E5%88%92%E5%88%86.jpg" srcset="/img/loading.gif" alt="RDDä¸­stageåˆ’åˆ†"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºåœ¨å®½ä¾èµ–å…³ç³»å¤„å°±ä¼šæ–­å¼€ä¾èµ–é“¾ï¼Œåˆ’åˆ†<code>stage</code>ï¼Œå®½ä¾èµ–çš„<code>RDD</code>æ˜¯<code>stage</code>ä¸­çš„æœ€åä¸€ä¸ª<code>RDD</code>ã€‚è¿™é‡Œçš„<code>stage1</code>ä¸éœ€è¦è®¡ç®—ï¼Œåªéœ€è¦è®¡ç®—<code>stage2</code>å’Œ<code>stage3</code>ï¼Œå°±å¯ä»¥å®Œæˆæ•´ä¸ª<code>Job</code>ã€‚</p><h4 id="å®½ä¾èµ–å’Œçª„ä¾èµ–çš„å®šä¹‰"><a href="#å®½ä¾èµ–å’Œçª„ä¾èµ–çš„å®šä¹‰" class="headerlink" title="å®½ä¾èµ–å’Œçª„ä¾èµ–çš„å®šä¹‰"></a>å®½ä¾èµ–å’Œçª„ä¾èµ–çš„å®šä¹‰</h4><p>RDDæ¯ä¸€æ¬¡transformationéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„RDDï¼Œè¿™æ ·å°±ä¼šå»ºç«‹RDDä¹‹é—´çš„å‰åä¾èµ–å…³ç³»ï¼Œåœ¨Sparkä¸­ï¼Œä¾èµ–å…³ç³»è¢«å®šä¹‰ä¸ºä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯çª„ä¾èµ–å’Œå®½ä¾èµ–ï¼š</p><ul><li>çª„ä¾èµ–ï¼šçˆ¶RDDçš„åˆ†åŒºæœ€å¤šåªä¼šè¢«å­RDDçš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨</li><li>å®½ä¾èµ–ï¼šçˆ¶RDDçš„ä¸€ä¸ªåˆ†åŒºä¼šè¢«å­RDDçš„å¤šä¸ªåˆ†åŒºä½¿ç”¨</li></ul><p>ä¸‹å›¾ä¸­ä¸ºå®½ä¾èµ–å’Œçª„ä¾èµ–çš„å®˜æ–¹è¯´æ˜ï¼š</p><p><img src="/uploads/%E5%AE%BD%E4%BE%9D%E8%B5%96%E5%92%8C%E7%AA%84%E4%BE%9D%E8%B5%96.jpg" srcset="/img/loading.gif" alt="å®½ä¾èµ–å’Œçª„ä¾èµ–"></p><p>ä¸‹é¢æ ¹æ®stageåˆ’åˆ†çš„ç®—æ³•å¯¹<code>wordcount</code>è¿›è¡Œ<code>stage</code>åˆ’åˆ†ç¤ºæ„å›¾ï¼š</p><p><img src="/uploads/wordcount%E7%9A%84stage%E5%88%92%E5%88%86%E8%BF%87%E7%A8%8B.jpg" srcset="/img/loading.gif" alt="wordcountçš„stageåˆ’åˆ†è¿‡ç¨‹"></p><h3 id="taskçš„ç†è§£"><a href="#taskçš„ç†è§£" class="headerlink" title="taskçš„ç†è§£"></a>taskçš„ç†è§£</h3><p><code>task</code>å®åœ¨<code>stage</code>çš„åŸºç¡€ä¸Šè¿›è¡Œï¼Œè®¡ç®—æ˜¯ä»¥<code>partition</code>ä¸ºå•å…ƒï¼Œ<code>task</code>çš„æ•°é‡å’Œ<code>partition</code>çš„æ•°æ®ç›¸åŒã€‚<code>partition</code>çš„åˆ’åˆ†ä¾æ®å¾ˆå¤šï¼Œå¯ä»¥æ ¹æ®<code>key</code>åˆ’åˆ†ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œä»¥æ–‡ä»¶çš„<code>block</code>æ¥åˆ’åˆ†ç­‰ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://ieevee.com/tech/2016/07/11/spark-scheduler.html" target="_blank" rel="noopener">Taskè°ƒåº¦ç®—æ³•ï¼ŒFIFOè¿˜æ˜¯FAIR</a></li><li><a href="https://litaotao.github.io/deep-into-spark-exection-model" target="_blank" rel="noopener">æ·±å…¥ç ”ç©¶ spark è¿è¡ŒåŸç†ä¹‹ job, stage, task</a></li><li><a href="http://sharkdtu.com/posts/spark-scheduler.html" target="_blank" rel="noopener">Spark Schedulerå†…éƒ¨åŸç†å‰–æ</a></li><li><a href="http://jerryshao.me/architecture/2013/04/21/Spark%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B-scheduler%E6%A8%A1%E5%9D%97/" target="_blank" rel="noopener">Sparkæºç åˆ†æä¹‹-scheduleræ¨¡å—</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>spark</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spark</tag>
      
      <tag>stage</tag>
      
      <tag>job</tag>
      
      <tag>task</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨scikit-learnæ¥åˆ†ææ¨¡å‹æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆé—®é¢˜</title>
    <link href="/2017/08/15/%E5%88%A9%E7%94%A8scikit-learn%E6%9D%A5%E5%88%86%E6%9E%90%E6%A8%A1%E5%9E%8B%E6%AC%A0%E6%8B%9F%E5%90%88%E5%92%8C%E8%BF%87%E6%8B%9F%E5%90%88%E9%97%AE%E9%A2%98/"/>
    <url>/2017/08/15/%E5%88%A9%E7%94%A8scikit-learn%E6%9D%A5%E5%88%86%E6%9E%90%E6%A8%A1%E5%9E%8B%E6%AC%A0%E6%8B%9F%E5%90%88%E5%92%8C%E8%BF%87%E6%8B%9F%E5%90%88%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å½“ä½ è¿è¡Œä¸€ä¸ªå­¦ä¹ ç®—æ³•æ—¶ï¼Œå¦‚æœè¿™ä¸ªç®—æ³•çš„è¡¨ç°ä¸ç†æƒ³ï¼Œé‚£ä¹ˆå¤šåŠæ˜¯å‡ºç°ä¸¤ç§æƒ…å†µï¼šè¦ä¹ˆæ˜¯åå·®æ¯”è¾ƒå¤§ã€è¦ä¹ˆæ˜¯æ–¹å·®æ¯”è¾ƒå¤§ã€‚æ¢å¥è¯è¯´ï¼Œå‡ºç°çš„æƒ…å†µè¦ä¹ˆæ˜¯æ¬ æ‹Ÿåˆã€è¦ä¹ˆæ˜¯è¿‡æ‹Ÿåˆé—®é¢˜ã€‚åœ¨å»ºæ¨¡çš„è¿‡ç¨‹ä¸­ç»å¸¸ä¼šé‡åˆ°æ¨¡å‹æ‹Ÿåˆåº¦ä¸å¤Ÿæˆ–è€…è¿‡æ‹Ÿåˆï¼Œä½†æ˜¯æ€ä¹ˆå»åˆ†ææ¨¡å‹æ˜¯å¦å­˜åœ¨æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆå‘¢ï¼Ÿä¸€èˆ¬é€šè¿‡æ¨¡å‹çš„å­¦ä¹ æ›²çº¿å’Œè¯„ä¼°æ›²çº¿æ¥åˆ†ææ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆã€‚å¹¶åœ¨å®é™…åº”ç”¨ä¸­é’ˆå¯¹æ€§çš„æå‡ºè§£å†³æ–¹æ¡ˆã€‚ä¸‹å›¾ä¸ºç†è®ºä¸Šè¯†åˆ«æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆçš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š<br><img src="/uploads/poly_nihe.png" srcset="/img/loading.gif" alt="polynline.png"></p><h3 id="1-ä½¿ç”¨å­¦ä¹ æ›²çº¿åˆ¤åˆ«åå·®å’Œæ–¹å·®é—®é¢˜"><a href="#1-ä½¿ç”¨å­¦ä¹ æ›²çº¿åˆ¤åˆ«åå·®å’Œæ–¹å·®é—®é¢˜" class="headerlink" title="1. ä½¿ç”¨å­¦ä¹ æ›²çº¿åˆ¤åˆ«åå·®å’Œæ–¹å·®é—®é¢˜"></a>1. ä½¿ç”¨å­¦ä¹ æ›²çº¿åˆ¤åˆ«åå·®å’Œæ–¹å·®é—®é¢˜</h3><p>å¦‚æœä¸€ä¸ªæ¨¡å‹è¿‡äºå¤æ‚ï¼Œåˆ™å‚æ•°å¤ªå¤šï¼Œå¯èƒ½å¯¼è‡´æ¨¡å‹è¿‡æ‹Ÿåˆã€‚è§£å†³è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å¢åŠ è®­ç»ƒæ•°æ®é›†ï¼Œé™ä½æ¨¡å‹å¤æ‚åº¦ï¼Œäº¤å‰æ£€éªŒç­‰ã€‚æ ¹æ®ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€æ¸å¢åŠ æ¨¡å‹è®­ç»ƒé›†ï¼Œè§‚å¯Ÿæ¨¡å‹çš„åå·®å’Œæ–¹å·®å˜åŒ–ï¼Œç¡®å®šè¿™ç§æ–¹å¼æ˜¯å¦æœ‰æ•ˆã€‚<br><img src="/uploads/bias_variance.png" srcset="/img/loading.gif" alt="biasvariance.png"><br>ä¸Šå›¾ä¸­å·¦ä¸Šè§’çš„æƒ…å†µï¼Œæ¨¡å‹åå·®è¾ƒå¤§ï¼Œè®­ç»ƒå’Œæµ‹è¯•æ•ˆæœæ›²çº¿éƒ½å¾ˆå·®ï¼Œç²¾åº¦å¤ªä½ï¼Œå¯èƒ½æ˜¯æ¬ æ‹Ÿåˆï¼Œè§£å†³æ¬ æ‹Ÿåˆé—®é¢˜ï¼šä¸€èˆ¬é€šè¿‡å¢åŠ æ¨¡å‹å‚æ•°ï¼Œå¢åŠ ç‰¹å¾æˆ–è€…å‡å°æ­£åˆ™é¡¹ç­‰ã€‚</p><p>ä¸‹é¢é€šè¿‡<code>python</code>ä¸­<code>scikit-learn</code>çš„å­¦ä¹ æ›²çº¿æ¥å¯¹æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆè¿›è¡Œè¯´æ˜ï¼Œä¸»è¦é€šè¿‡ä¸åŒçš„æ•°æ®é‡æ¥é€æ­¥åˆ†ææ¨¡å‹æ•ˆæœï¼Œçœ‹æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆçš„æƒ…å†µã€‚</p><a id="more"></a><pre><code class="python">import numpy as npimport randomfrom sklearn.datasets import load_irisfrom sklearn.linear_model import LogisticRegressionfrom sklearn.model_selection import learning_curve, validation_curvefrom matplotlib import pyplot as pltfrom sklearn.preprocessing import StandardScalerfrom sklearn.metrics import f1_score, make_scorerload_data = load_iris()X, Y = load_data.data, load_data.targetindex = range(150)random.shuffle(index)random_x = X[index, :]random_y = Y[index]estimator = LogisticRegression(penalty=&#39;l2&#39;, C=1.0, fit_intercept=True)f1 = make_scorer(f1_score)train_size, train_scores, test_scores = learning_curve(estimator, X=random_x, y=random_y,                                                       train_sizes=np.linspace(0.1, 1.0, 10), cv=10,                                                        scoring=&#39;accuracy&#39;)train_mean = np.mean(train_scores, axis=1)train_std = np.std(train_scores, axis=1)test_mean = np.mean(test_scores, axis=1)test_std = np.std(test_scores, axis=1)fig = plt.figure(figsize=(9, 6))ax = fig.add_subplot(111)ax.plot(train_size, train_mean, linestyle=&#39;--&#39;, color=&quot;green&quot;, marker=&#39;o&#39;, markersize=5,label=&quot;train line&quot;)ax.fill_between(train_size, train_mean+train_std, train_mean-train_std, alpha=0.3, color=&quot;green&quot;)ax.plot(train_size, test_mean, linestyle=&#39;-&#39;, marker=&#39;s&#39;, markersize=5, color=&quot;blue&quot;, label=&quot;test line&quot;)ax.fill_between(train_size, test_mean+test_std, test_mean-test_std, alpha=0.3, color=&quot;blue&quot;)plt.legend(loc=&quot;lower right&quot;)plt.show()</code></pre><p><img src="/uploads/output_5_0.png" srcset="/img/loading.gif" alt="png"></p><p><code>learning_curve</code>ä¸­çš„<code>train_sizes</code>å‚æ•°æ§åˆ¶äº§ç”Ÿå­¦ä¹ æ›²çº¿çš„è®­ç»ƒæ ·æœ¬çš„ç»å¯¹/ç›¸å¯¹æ•°é‡ï¼Œæ­¤å¤„ï¼Œæˆ‘ä»¬è®¾ç½®çš„<code>train_sizes=np.linspace(0.1, 1.0, 10)</code>ï¼Œå°†è®­ç»ƒé›†å¤§å°åˆ’åˆ†ä¸º10ä¸ªç›¸ç­‰çš„åŒºé—´ã€‚<code>learning_curve</code>é»˜è®¤ä½¿ç”¨åˆ†å±‚kæŠ˜äº¤å‰éªŒè¯è®¡ç®—äº¤å‰éªŒè¯çš„å‡†ç¡®ç‡ï¼Œæˆ‘ä»¬é€šè¿‡cvè®¾ç½®kã€‚ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºæ¨¡å‹çš„æ•ˆæœéå¸¸å¥½ï¼Œåœ¨æ•°æ®é‡è¾¾åˆ°80ä»¥ä¸Šæ—¶ï¼Œè®­ç»ƒå’Œæµ‹è¯•çš„å‡†ç¡®ç‡åŸºæœ¬é‡åˆã€‚å› æ­¤åŸºæœ¬æ˜¯æ²¡æœ‰è¿‡æ‹Ÿåˆæƒ…å†µï¼Œè€Œæ¨¡å‹çš„æ•´ä¸ªå‡†ç¡®ç‡åœ¨95%ä»¥ä¸Šï¼Œå› æ­¤æ¨¡å‹ä¹Ÿä¸å­˜åœ¨æ¬ æ‹Ÿåˆçš„æƒ…å†µã€‚</p><h3 id="2-ç”¨éªŒè¯æ›²çº¿è§£å†³è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"><a href="#2-ç”¨éªŒè¯æ›²çº¿è§£å†³è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ" class="headerlink" title="2. ç”¨éªŒè¯æ›²çº¿è§£å†³è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"></a>2. ç”¨éªŒè¯æ›²çº¿è§£å†³è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ</h3><p>éªŒè¯æ›²çº¿å¯ä»¥è°ƒæ•´æ¨¡å‹çš„å‚æ•°ï¼Œä»è€Œè§£å†³è¿‡æ‹Ÿåˆæˆ–è€…æ¬ æ‹Ÿåˆé—®é¢˜ï¼ŒéªŒè¯æ›²çº¿å’Œå­¦ä¹ æ›²çº¿è¿‘ä¼¼ï¼Œä½†æ˜¯æ„ä¹‰ä¸ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡<code>validation_curve</code>æ¥å®ç°ã€‚è¿˜èƒ½å¯¹æ¨¡å‹è¿›è¡Œä¼˜åŒ–ï¼ŒåŠ å¼ºæ¨¡å‹çš„ç²¾åº¦ä»¥åŠæ³›åŒ–èƒ½åŠ›ã€‚ä¸‹å›¾(å€Ÿç”¨ç½‘ä¸Šä¸€å¼ å›¾è¡¨ç¤º)ä¸­åˆ™ä¸ºæ¨¡å‹çš„éšç€å‚æ•°çš„ä¸åŒï¼Œæ¨¡å‹æ•ˆæœå˜åŒ–ã€‚</p><ol><li>å½“<code>cross validation error (Jcv)</code> è·Ÿ<code>training error(Jtrain)</code>å·®ä¸å¤šï¼Œä¸”<code>Jtrain</code>è¾ƒå¤§æ—¶ï¼Œå½“å‰æ¨¡å‹æ›´å¯èƒ½å­˜åœ¨æ¬ æ‹Ÿåˆã€‚</li><li>å½“<code>Jcv &gt;&gt; Jtrain</code>ä¸”<code>Jtrain</code>è¾ƒå°æ—¶ï¼Œå½“å‰æ¨¡å‹æ›´å¯èƒ½å­˜åœ¨è¿‡æ‹Ÿåˆ<br><img src="/uploads/param_bias_variance.png" srcset="/img/loading.gif" alt="parambiasvariance.png"></li></ol><pre><code class="python">param_c = [0.001, 0.01, 0.1, 0.5, 0.8, 1, 2, 3, 10]train_scores, test_scores = validation_curve(estimator, X=random_x, y=random_y, param_name=&#39;C&#39;, param_range=param_c, cv=10,                  scoring=&#39;accuracy&#39;)train_mean = train_scores.mean(axis=1)train_std = train_scores.std(axis=1)test_mean = test_scores.mean(axis=1)test_std = test_scores.std(axis=1)fig = plt.figure(figsize=(9, 6))ax = fig.add_subplot(111)ax.plot(param_c, train_mean, marker=&#39;o&#39;, markersize=5, color=&#39;blue&#39;, label=&quot;train_acc&quot;)ax.fill_between(param_c, train_mean+train_std, train_mean-train_std, color=&#39;blue&#39;, alpha=0.3)ax.plot(param_c, test_mean, marker=&#39;*&#39;, markersize=5, color=&#39;green&#39;, label=&quot;test_acc&quot;)ax.fill_between(param_c, test_mean+test_std, test_mean-test_std, color=&#39;green&#39;, alpha=0.3)plt.bar(left=param_c, height=10*(train_mean-test_mean), width=0.2,         color=&#39;0.2&#39;, yerr=test_std, align=&#39;center&#39;)plt.xticks(map(lambda x: round(x, 1), param_c))plt.grid()plt.legend(loc=&quot;center right&quot;)plt.show()</code></pre><p><img src="/uploads/output_8_0.png" srcset="/img/loading.gif" alt="png"></p><h3 id="3-å‚è€ƒæ–‡æ¡£"><a href="#3-å‚è€ƒæ–‡æ¡£" class="headerlink" title="3. å‚è€ƒæ–‡æ¡£"></a>3. å‚è€ƒæ–‡æ¡£</h3><p><a href="http://studyai.site/2016/10/24/%E6%96%AF%E5%9D%A6%E7%A6%8F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%AF%BE%E7%A8%8B%20%E7%AC%AC%E5%85%AD%E5%91%A8%20%282%29%E5%81%8F%E5%B7%AEVS%E6%96%B9%E5%B7%AE/" target="_blank" rel="noopener">æ–¯å¦ç¦æœºå™¨å­¦ä¹ è¯¾ç¨‹ ç¬¬å…­å‘¨ (2)åå·®VSæ–¹å·®</a><br><a href="http://studyai.site/2016/09/04/%E6%96%AF%E5%9D%A6%E7%A6%8F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%AF%BE%E7%A8%8B%20%E7%AC%AC%E4%B8%89%E5%91%A8%20%284%29%E6%AD%A3%E5%88%99%E5%8C%96%EF%BC%9A%E8%A7%A3%E5%86%B3%E8%BF%87%E6%8B%9F%E5%90%88%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">æ–¯å¦ç¦æœºå™¨å­¦ä¹ è¯¾ç¨‹ ç¬¬ä¸‰å‘¨ (4)æ­£åˆ™åŒ–ï¼šè§£å†³è¿‡æ‹Ÿåˆé—®é¢˜</a><br><a href="http://www.cnblogs.com/instant7/p/4135416.html" target="_blank" rel="noopener">æ¬ æ‹Ÿåˆè¿˜æ˜¯è¿‡æ‹Ÿåˆçš„åˆ¤æ–­</a><br><a href="https://ljalphabeta.gitbooks.io/python-/content/debugging.html" target="_blank" rel="noopener">ä½¿ç”¨å­¦ä¹ æ›²çº¿å’ŒéªŒè¯æ›²çº¿ è°ƒè¯•ç®—æ³•</a></p>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>scikit-learn</tag>
      
      <tag>overfit</tag>
      
      <tag>underfit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯¹æ¢¯åº¦ä¸‹é™ç®—æ³•çš„æ€è€ƒ</title>
    <link href="/2017/08/13/%E5%AF%B9%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95%E7%9A%84%E6%80%9D%E8%80%83/"/>
    <url>/2017/08/13/%E5%AF%B9%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95%E7%9A%84%E6%80%9D%E8%80%83/</url>
    
    <content type="html"><![CDATA[<p>æ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯æœ€ä¼˜åŒ–ç†è®ºä¸­çš„æœ€å¸¸ç”¨æ–¹æ³•ï¼Œç›®å‰åœ¨æ·±åº¦å­¦ä¹ ä»¥åŠæœºå™¨å­¦ä¹ ç®—æ³•ä¸­å¹¿æ³›åº”ç”¨ï¼Œä¸»è¦ä¸ºäº†æ±‚ç›®æ ‡å‡½æ•°æå€¼çš„æœ€ä¼˜è§£ã€‚å…¶ä¸­åŸç†å¾ˆç®€å•æ²¿ç€ç›®æ ‡å‡½æ•°æ¢¯åº¦ä¸‹é™çš„æ–¹å‘æœç´¢æå°å€¼ã€‚å‚æ•°æŒ‰ç…§æ¢¯åº¦æ›´æ–°çš„å…¬å¼å¦‚ä¸‹ï¼š<br>$$<br>\theta := \theta - {\alpha} \cdot {\nabla}_{\theta} {J(\theta)}<br>$$<br>å…¶ä¸­$\alpha$ä¸ºå­¦ä¹ ç‡æˆ–è€…è¡°å‡å› å­ï¼Œæ¯æ¬¡åœ¨æ›´æ–°æ—¶éƒ½ä¼šç”¨$\alpha$ä¸ºæ­¥é•¿æ¥æ›´æ–°å‚æ•°ã€‚å› æ­¤$\alpha$çš„å–å€¼æ¯”è¾ƒè®²ç©¶ã€‚</p><ol><li>å­¦ä¹ ç‡è¾ƒå°æ—¶ï¼Œæ”¶æ•›åˆ°æå€¼çš„é€Ÿåº¦è¾ƒæ…¢ã€‚</li><li>å­¦ä¹ ç‡è¾ƒå¤§æ—¶ï¼Œå®¹æ˜“åœ¨æœç´¢è¿‡ç¨‹ä¸­å‘ç”Ÿéœ‡è¡ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/uploads/lr_diff.jpg" srcset="/img/loading.gif" alt="lrå–å€¼ä¸åŒæ—¶çš„æ”¶æ•›æƒ…å†µ"><br>ä¸Šå›¾ä¸­ï¼Œå½“lrè¿‡å¤§æ—¶å°±ä¼šå‡ºç°æ¥å›éœ‡è¡ï¼Œä¸»è¦æ˜¯å› ä¸ºlrå–å€¼è¿‡å¤§ï¼Œè€Œåœ¨å‚æ•°æ›´æ–°å…¬å¼ä¸­æ¢¯åº¦å¯æ­£å¯è´Ÿï¼Œå› æ­¤å¯¼è‡´æ¥å›éœ‡åŠ¨ã€‚è€Œlrè¿‡å°æ—¶ï¼Œæ”¶æ•›ä¼šé€æ¸å‡æ…¢ã€‚å› æ­¤æœ‰å¾ˆå¤šæ”¹è¿›çš„æ¢¯åº¦ä¸‹é™æ³•å¯¹å­¦ä¹ ç‡è¿›è¡Œæ”¹è¿›ï¼Œå¦‚å†²é‡çš„æ¢¯åº¦ä¸‹é™æ³•ã€‚è¿˜æœ‰å­¦ä¹ ç‡è¡°å‡å› å­ã€‚å¦‚:<br>$$<br>lr_{i} = lr_{0} \cdot \frac {1} {1 + \alpha \cdot i}<br>$$<br>ä¸Šé¢çš„å…¬å¼ä¸­lrä¼šéšç€è¿­ä»£çš„æ¬¡æ•°é€æ¸å‡å°ã€‚$lr_{0}$ä¸ºåˆå§‹å­¦ä¹ ç‡ï¼Œ$\alpha$ä¸º0-1çš„ä¸€ä¸ªå¸¸æ•°ã€‚$\alpha$è¶Šå°ï¼Œå­¦ä¹ ç‡è¡°å‡åœ°è¶Šæ…¢ï¼Œå½“$\alpha$=0æ—¶ï¼Œå­¦ä¹ ç‡ä¿æŒä¸å˜ã€‚$\alpha$è¶Šå¤§ï¼Œå­¦ä¹ ç‡è¡°å‡åœ°è¶Šå¿«ï¼Œå½“$\alpha$=1æ—¶ï¼Œå­¦ä¹ ç‡è¡°å‡æœ€å¿«ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>SGD</tag>
      
      <tag>æ¢¯åº¦ä¸‹é™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¿¡æ¯è®ºä¸­KLæ•£åº¦è¯¦è§£</title>
    <link href="/2017/07/26/%E4%BF%A1%E6%81%AF%E8%AE%BA%E4%B8%ADKL%E6%95%A3%E5%BA%A6%E8%AF%A6%E8%A7%A3/"/>
    <url>/2017/07/26/%E4%BF%A1%E6%81%AF%E8%AE%BA%E4%B8%ADKL%E6%95%A3%E5%BA%A6%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¿¡æ¯è®ºä¸­ï¼Œå¯¹ä¿¡æ¯çš„åº¦é‡ä¸»è¦æ˜¯é€šè¿‡é¦™å†œç†µï¼Œè‡ªä¿¡æ¯ç­‰ã€‚è€Œæœ¬æ–‡ä¸­çš„KLæ•£åº¦(<code>Kullback-Leible</code>æ•£åº¦)åˆ™æ˜¯å¯¹ä¿¡æ¯ä¹‹é—´çš„åº¦é‡æˆ–è€…ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„è·ç¦»çš„åº¦é‡ï¼Œåˆç§°ä¸ºäº¤å‰ç†µï¼Œç›¸å¯¹ç†µã€‚</p><h3 id="1-KLæ•£åº¦çš„å®šä¹‰"><a href="#1-KLæ•£åº¦çš„å®šä¹‰" class="headerlink" title="1. KLæ•£åº¦çš„å®šä¹‰"></a>1. KLæ•£åº¦çš„å®šä¹‰</h3><p>è®¾$p(x)$å’Œ$q(x)$æ˜¯$x$å–å€¼çš„ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œä¸€èˆ¬$p(x)$å’Œ$q(x)$ä¸ºå¯†åº¦å‡½æ•°åˆ™$p$å¯¹$q$çš„ç›¸å¯¹ç†µä¸ºï¼š<br>$$<br>DL(p||q)=\sum{_{i=1}^{n}} p(x) \log{\frac{p(x)}{q(x)}}<br>$$<br>åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼ŒKLæ•£åº¦å¯ä»¥åº¦é‡ä¸¤ä¸ªéšæœºå˜é‡çš„è·ç¦»ã€‚KLæ•£åº¦æ˜¯ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒPå’ŒQå·®åˆ«çš„éå¯¹ç§°æ€§çš„åº¦é‡ã€‚KLæ•£åº¦æ˜¯ç”¨æ¥åº¦é‡ä½¿ç”¨åŸºäºQçš„ç¼–ç æ¥ç¼–ç æ¥è‡ªPçš„æ ·æœ¬å¹³å‡æ‰€éœ€çš„é¢å¤–çš„ä½å…ƒæ•°ã€‚ å…¸å‹æƒ…å†µä¸‹ï¼ŒPè¡¨ç¤ºæ•°æ®çš„çœŸå®åˆ†å¸ƒï¼ŒQè¡¨ç¤ºæ•°æ®çš„ç†è®ºåˆ†å¸ƒï¼Œæ¨¡å‹åˆ†å¸ƒï¼Œæˆ–Pçš„è¿‘ä¼¼åˆ†å¸ƒã€‚<a id="more"></a></p><h3 id="2-KLæ•£åº¦çš„æ€§è´¨"><a href="#2-KLæ•£åº¦çš„æ€§è´¨" class="headerlink" title="2. KLæ•£åº¦çš„æ€§è´¨"></a>2. KLæ•£åº¦çš„æ€§è´¨</h3><ul><li>è™½ç„¶KLæ•£åº¦ä¼¼ä¹æ˜¯ä¸€ä¸ªè·ç¦»æˆ–è€…åº¦é‡ï¼Œä½†æ˜¯åœ¨ä¸¥æ ¼çš„æ„ä¹‰ä¸Šè®²åˆä¸æ˜¯è·ç¦»çš„åº¦é‡ï¼Œå› ä¸ºä»–ä»¬æ˜¯ä¸å¯¹ç§°çš„ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªæ€§è´¨å°±æ˜¯ä¸å¯¹ç§°æ€§ï¼Œä½†æ˜¯å¯ä»¥å°†å…¬å¼è½¬æ¢ä¸ºå¯¹ç§°çš„å…¬å¼ï¼Œå¦‚ä¸‹ï¼š<br>$$<br>DL(p||q) \ne DL(q||p)<br>$$<br>$$<br>D(p, q) = \frac {DL(p||q + DL(q||p} {2}<br>$$</li><li>KLæ•£åº¦çš„å€¼å§‹ç»ˆæ˜¯éè´Ÿçš„:<br>$$<br>DL(p||q) \ge 0<br>$$</li></ul><h3 id="3-KLæ•£åº¦çš„åº”ç”¨"><a href="#3-KLæ•£åº¦çš„åº”ç”¨" class="headerlink" title="3. KLæ•£åº¦çš„åº”ç”¨"></a>3. KLæ•£åº¦çš„åº”ç”¨</h3><ol><li>ç›¸å¯¹ç†µå¯ä»¥è¡¡é‡ä¸¤ä¸ªéšæœºåˆ†å¸ƒä¹‹é—´çš„è·ç¦»ï¼Œå½“ä¸¤ä¸ªéšæœºåˆ†å¸ƒç›¸åŒæ—¶ï¼Œå®ƒä»¬çš„ç›¸å¯¹ç†µä¸ºé›¶ï¼Œå½“ä¸¤ä¸ªéšæœºåˆ†å¸ƒçš„å·®åˆ«å¢å¤§æ—¶ï¼Œå®ƒä»¬çš„ç›¸å¯¹ç†µä¹Ÿä¼šå¢å¤§ã€‚æ‰€ä»¥ç›¸å¯¹ç†µï¼ˆKLæ•£åº¦ï¼‰å¯ä»¥ç”¨äºæ¯”è¾ƒæ–‡æœ¬çš„ç›¸ä¼¼åº¦ï¼Œå…ˆç»Ÿè®¡å‡ºè¯çš„é¢‘ç‡ï¼Œç„¶åè®¡ç®—KLæ•£åº¦å°±è¡Œäº†ã€‚</li><li>åœ¨å¤šæŒ‡æ ‡ç³»ç»Ÿè¯„ä¼°ä¸­ï¼ŒæŒ‡æ ‡æƒé‡åˆ†é…æ˜¯ä¸€ä¸ªé‡ç‚¹å’Œéš¾ç‚¹ï¼Œé€šè¿‡ç›¸å¯¹ç†µå¯ä»¥å¤„ç†ã€‚</li><li>åœ¨ç”¨æˆ·ç”»åƒç³»ç»Ÿä¸­å¯ä»¥è¿›è¡Œåº”ç”¨</li><li>æ¨èç³»ç»Ÿ</li><li>T-SNEé™ç»´</li><li>EMç®—æ³•(æœ€å¤§æœŸæœ›ç®—æ³•)</li></ol>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>KLæ•£åº¦</tag>
      
      <tag>æœºå™¨å­¦ä¹ </tag>
      
      <tag>è·ç¦»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sparkä¸­é‡åˆ°çš„é—®é¢˜æ±‡æ€»</title>
    <link href="/2017/07/24/spark%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <url>/2017/07/24/spark%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    
    <content type="html"><![CDATA[<ol><li><strong>å‡ºç°<code>â€œorg.apache.spark.SparkException: Task not serializableâ€</code>è¿™ä¸ªé”™è¯¯</strong></li></ol><p>åœ¨ç¼–å†™<code>spark</code>ç¨‹åºæ˜¯å‡ºç°äº†<code>org.apache.spark.SparkException: Task not serializable</code>é”™è¯¯ï¼Œç”±äºåœ¨æ“ä½œ<code>RDD</code>ç®—å­<code>map</code>ä¸­ä½¿ç”¨åˆ°äº†ç±»ä¸­å®šä¹‰çš„å…¶ä»–å‡½æ•°æˆ–è€…å®šä¹‰çš„å…¶ä»–å˜é‡ï¼Œè€Œå¼•å‘çš„æœªåºåˆ—åŒ–é—®é¢˜ã€‚åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­éš¾å…ä¼šå¼•ç”¨å®šä¹‰çš„å…¶ä»–å‡½æ•°æˆ–è€…å˜é‡è¿›è¡Œæ“ä½œã€‚ä¸ºäº†è§£å†³ä¸ºåºåˆ—åŒ–çš„é—®é¢˜éœ€è¦å¯¹ç±»è¿›è¡Œåºåˆ—åŒ–å¤„ç†ã€‚ä¸‹é¢çš„ä»£ç æ˜¯æœªåºåˆ—åŒ–ä¹‹å‰ï¼š</p><pre><code class="scala">case class TypeMatched(label: Boolean, features:Array[Int])class loadData {    /*    * Created by Miller on 17-7-17.    * Load sandbox&#39;s bson data from location and transform to rdd type    * Use spark analysis data and static data    * */    val dataPath: String = &quot;/opt/Project/spark_project/data/sbx_data/text_data_by_spark.csv&quot;    val sc: SparkContext = new SparkContext(new SparkConf().setMaster(&quot;local[*]&quot;).setAppName(&quot;LoadSandboxData&quot;))    // This method use to generate RDD    def toRDD: RDD[Array[Int]] = {        sc.textFile(dataPath).map(line =&gt; line.split(&quot;,&quot;).map(x =&gt; x.toInt))    }    private def IntToBoolean(s: Int): Boolean = if (s &gt; 0) true else false    def toTypeData(rdds: RDD[Array[Int]]) = {        rdds.map(array =&gt; {            val _label_ = IntToBoolean(array(0))            val _features_ = array.slice(0, array.length)            TypeMatched(_label_, _features_)        })    }}</code></pre><a id="more"></a>åœ¨è¿è¡Œæ˜¯ä¼šå‡ºç°é”™è¯¯ï¼š<p><code>Exception in thread &quot;main&quot; org.apache.spark.SparkException: Task not serializable</code><br>è§£å†³çš„æ–¹æ³•ï¼š<br>(1).å°†ç±»è¿›è¡Œåºåˆ—åŒ–,ä½¿ç”¨<code>extends Serializable</code>å³å¯.<br>(2).è‹¥ç±»ä¸­æœ‰ä¸èƒ½åºåˆ—åŒ–çš„å˜é‡æˆ–è€…å‡½æ•°éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†:<code>@transent</code><br>ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹:</p><pre><code class="scala">class loadData extends Serializable {    /*    * Created by Miller on 17-7-17.    * Load sandbox&#39;s bson data from location and transform to rdd type    * Use spark analysis data and static data    * */    val dataPath: String = &quot;/opt/Project/spark_project/data/sbx_data/text_data_by_spark.csv&quot;    @transient    val sc: SparkContext = new SparkContext(new SparkConf().setMaster(&quot;local[*]&quot;).setAppName(&quot;LoadSandboxData&quot;))    // This method use to generate RDD    def toRDD: RDD[Array[Int]] = {        sc.textFile(dataPath).map(line =&gt; line.split(&quot;,&quot;).map(x =&gt; x.toInt))    }    private def IntToBoolean(s: Int): Boolean = if (s &gt; 0) true else false    def toTypeData(rdds: RDD[Array[Int]]) = {        rdds.map(array =&gt; {            val _label_ = IntToBoolean(array(0))            val _features_ = array.slice(0, array.length)            TypeMatched(_label_, _features_)        })    }}</code></pre><p>ç”±äº<code>spark</code>ä¸­<code>SparkContext</code>å’Œ<code>SparkConf</code>éƒ½æ˜¯ä¸èƒ½åºåˆ—åŒ–çš„å˜é‡ï¼Œå› æ­¤éœ€è¦å¯¹å…¶æ ‡æ³¨ä¸ºä¸éœ€è¦è¿›è¡Œåºåˆ—åŒ–<code>(@transient)</code>.åœ¨å¤„ç†ä¹‹åä»£ç èƒ½é¡ºåˆ©è¿è¡Œäº†ã€‚å¾—åˆ°ç»“è®ºï¼šç”±äº<code>Spark</code>ç¨‹åºä¸­çš„<code>map</code>ã€<code>filter</code>ç­‰ç®—å­å†…éƒ¨å¼•ç”¨äº†ç±»æˆå‘˜å‡½æ•°æˆ–å˜é‡å¯¼è‡´è¯¥ç±»æ‰€æœ‰æˆå‘˜éƒ½éœ€è¦æ”¯æŒåºåˆ—åŒ–ï¼Œåˆç”±äºè¯¥ç±»æŸäº›æˆå‘˜å˜é‡ä¸æ”¯æŒåºåˆ—åŒ–ï¼Œæœ€ç»ˆå¼•å‘<code>Task</code>æ— æ³•åºåˆ—åŒ–é—®é¢˜ã€‚ç›¸ååœ°ï¼Œå¯¹ç±»ä¸­é‚£äº›ä¸æ”¯æŒåºåˆ—åŒ–é—®é¢˜çš„æˆå‘˜å˜é‡æ ‡æ³¨åï¼Œä½¿å¾—æ•´ä¸ªç±»èƒ½å¤Ÿæ­£å¸¸åºåˆ—åŒ–ï¼Œæœ€ç»ˆæ¶ˆé™¤<code>Task</code>æœªåºåˆ—åŒ–é—®é¢˜ã€‚<br>å¦å¤–è¿˜æœ‰ä¸€ç§å¤„ç†çš„æ–¹å¼å°±æ˜¯å°†è¦å¼•ç”¨çš„å‡½æ•°æˆ–è€…å˜é‡å®šä¹‰åˆ°ä¸€ä¸ª<code>object</code>ç±»ä¸­ï¼Œå°±åƒ<code>java</code>ä¸­çš„<code>static</code>ç±»ã€‚è¿™æ ·ä¹Ÿå¯ä»¥ä¸åšåºåˆ—åŒ–å¤„ç†ã€‚ä¸‹é¢å¯ä»¥ä¿®æ”¹æˆè¿™æ ·çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p><pre><code class="scala">object utilTool {    def IntToBoolean(s: Int): Boolean = if (s &gt; 0) true else false}class loadData {    /*    * Created by Miller on 17-7-17.    * Load sandbox&#39;s bson data from location and transform to rdd type    * Use spark analysis data and static data    * */    val dataPath: String = &quot;/opt/Project/spark_project/data/sbx_data/text_data_by_spark.csv&quot;    val sc: SparkContext = new SparkContext(new SparkConf().setMaster(&quot;local[*]&quot;).setAppName(&quot;LoadSandboxData&quot;))    // This method use to generate RDD    def toRDD: RDD[Array[Int]] = {        sc.textFile(dataPath).map(line =&gt; line.split(&quot;,&quot;).map(x =&gt; x.toInt))    }    private def IntToBoolean(s: Int): Boolean = if (s &gt; 0) true else false    def toTypeData(rdds: RDD[Array[Int]]) = {        rdds.map(array =&gt; {            val _label_ = utilTool.IntToBoolean(array(0))  // utilTool.IntToBoolean            val _features_ = array.slice(0, array.length)            TypeMatched(_label_, _features_)        })    }}</code></pre><p>è§£å†³åŠæ³•å’Œç¼–ç¨‹å»ºè®®ï¼š<br>(1)åœ¨<code>map</code>æˆ–è€…<code>filter</code>æ“ä½œä¸­ä¸è¦å¼•ç”¨ç±»(ä¸€èˆ¬æ˜¯å½“å‰ç±»)æˆå‘˜ã€‚å¦‚æœå‡½æ•°å¯ä»¥ç‹¬ç«‹å‡ºæ¥ï¼Œå¯ä»¥å†™åœ¨<code>object</code>ç±»ä¸­ï¼Œè¿™æ ·ä¸éœ€è¦è¿›è¡Œåºåˆ—åŒ–å¤„ç†ã€‚<br>(2)å¦‚æœä¸èƒ½é¿å…ä¸Šé¢1ä¸­çš„æƒ…å†µï¼Œå°±å¿…é¡»è¦åšåºåˆ—åŒ–å¤„ç†ï¼šå¯¹ç±»è¿›è¡Œåºåˆ—åŒ–ï¼Œç±»ä¸­ä¸èƒ½åºåˆ—åŒ–çš„æˆå‘˜éœ€è¦è¿›è¡Œç‰¹æ®Šæ ‡è®°å¤„ç†ï¼Œä½¿å¾—æ•´ä¸ªç±»èƒ½æ­£å¸¸çš„åºåˆ—åŒ–ã€‚</p><ol start="2"><li><strong><code>Spark</code>ä¸­å¯¹è±¡çš„åºåˆ—åŒ–</strong></li></ol><p>åœ¨<code>RDD</code>çš„<code>API</code>é‡Œæ‰€å¼•ç”¨çš„æ‰€æœ‰å¯¹è±¡ï¼Œéƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå› ä¸ºRDDåˆ†å¸ƒåœ¨å¤šå°æœºå™¨æ˜¯ï¼Œä»£ç å’Œæ‰€å¼•ç”¨çš„å¯¹è±¡ä¼šåºåˆ—åŒ–ï¼Œç„¶åå¤åˆ¶åˆ°å¤šå°æœºå™¨ï¼Œæ‰€ä»¥å‡¡æ˜¯è¢«å¼•ç”¨çš„æ•°æ®ï¼Œéƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä»£ç ï¼Œå°±ä¼šæŠ¥<code>java.lang.NotSerializableException: scala.util.Random</code> å¼‚å¸¸ï¼š</p><pre><code class="scala">val rnd = new Random()rdd.mapPartition { x=&gt;  // ...  val i = rnd.nextInt(10)  // ...}</code></pre><p>å› ä¸º<code>mapPartition</code>é‡Œå¼•ç”¨äº†<code>rnd</code>, è€Œ<code>Random</code>å¯¹è±¡æ²¡æœ‰ç»§æ‰¿è‡ª<code>Serialize</code>ï¼Œæ˜¯ä¸å¯åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥ä¼šæŠ¥å¼‚å¸¸ã€‚æŠŠ<code>val rnd = new Random()</code>ç§»åŠ¨åˆ° <code>mapPartion()</code>é‡Œé¢æ‰è¡Œã€‚<br>åœ¨ä¸€ä¸ª<code>RDD</code>çš„<code>api</code>é‡Œï¼Œä¸èƒ½å¼•ç”¨å¦ä¸€ä¸ª<code>RDD</code>ã€‚<code>RDD</code>æ˜¯ä¸å¯åºåˆ—åŒ–çš„ï¼Œåœ¨ä¸€ä¸ª<code>RDD</code>çš„<code>api</code>é‡Œï¼Œä¸èƒ½å¼•ç”¨å¦ä¸€ä¸ª<code>RDD</code>ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ª<code>RDD</code>çš„<code>API</code>é‡Œï¼Œä¾‹å¦‚<code>map()</code>é‡Œï¼Œå¼•ç”¨äº†å¦ä¸€ä¸ª<code>RDD</code>ï¼Œç¼–è¯‘è™½ç„¶ä¼šé€šè¿‡ï¼Œä½†æ˜¯è¿è¡Œä¼šå‡ºç°<code>java.lang.NullPointerException</code></p><ol start="3"><li><strong>åœ¨IDEAä¸­å†™scalaæ—¶å½“ä¸¤ä¸ªç±»åˆ†åˆ«åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œå¼•ç”¨æ—¶ä¼šå‡ºç°é”™è¯¯ï¼š<code>Error:not found:type xxxxx</code></strong></li></ol><p>å½“åœ¨é¡¹ç›®çš„ä»£ç <code>root</code>ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªç±»æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªç±»å»è°ƒç”¨å¦å¤–ä¸€ä¸ªç±»æ—¶å‡ºç°äº†é”™è¯¯ï¼š<code>error:not found type xxxxx</code>. é€šè¿‡è°·æ­Œå‘ç°ä¸‹å¾ˆå¤šäººä¹Ÿé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ã€‚å¾ˆå¤šå¤„ç†çš„æ–¹å¼éƒ½æœ€ç»ˆæ”¾å…¥åŒä¸€ä¸ª<code>scala</code>æ–‡ä»¶ä¸­ã€‚å…·ä½“åŸå› ä¹Ÿä¸æ˜¯æ¸…æ¥šã€‚é€šè¿‡å¤šç•ªæµ‹è¯•è§£å†³æ–¹æ¡ˆå¦‚ä¸‹:<br><img src="/uploads/tree.png" srcset="/img/loading.gif" alt="é¡¹ç›®ç»“æ„"><br>(1)æ–°å»ºä¸€ä¸ªåŒ…ï¼Œåœ¨åŒ…ä¸­å°†åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ã€‚å…¶ä»–ä»£ç å’Œä¹‹å‰çš„ä»£ç ä¸€è‡´ï¼Œåªéœ€è¦åœ¨ä¸¤ä¸ªæ–‡ä»¶å¤´ä¸­åŠ ä¸Š<code>package</code> è·¯å¾„<br>åŸå› åˆ†æï¼šå½“å°†ä¸¤ä¸ª<code>scala</code>æ–‡ä»¶æ”¾å…¥åˆ°æ ¹ç›®å½•ä¸‹(å¦‚ä¸Šå›¾ä¸­çš„<code>scala</code>ç›®å½•ä¸‹)å°±ä¼šå‡ºç°ä¸Šè¿°çš„é”™è¯¯ã€‚å½“æ”¾å…¥ä¸€ä¸ªåŒ…å†…å°±ä¸ä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯ã€‚è€Œåœ¨<code>eclipse</code>ä¸­ï¼Œåœ¨æ ¹ç›®å½•åˆ›å»ºæ–‡ä»¶æ—¶é»˜è®¤æ˜¯æ”¾å…¥åˆ°äº†ä¸€ä¸ª<code>default package</code>çš„åŒ…ä¸‹ï¼Œå› æ­¤ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚å› æ­¤å¯èƒ½æ˜¯å› ä¸ºåŒ…å’Œæ ¹ç›®å½•çš„åŒºåˆ«å¯¼è‡´è¿™ä¸ªé”™è¯¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>spark</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spark</tag>
      
      <tag>RDD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>abcä¸­çš„å…ƒç±»å’Œsixæ¨¡å—é…åˆä½¿ç”¨</title>
    <link href="/2017/07/20/abc%E4%B8%AD%E7%9A%84%E5%85%83%E7%B1%BB%E5%92%8Csix%E6%A8%A1%E5%9D%97%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8/"/>
    <url>/2017/07/20/abc%E4%B8%AD%E7%9A%84%E5%85%83%E7%B1%BB%E5%92%8Csix%E6%A8%A1%E5%9D%97%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p><code>metaclass</code>æ˜¯ç±»çš„ç±»æˆ–è€…å…ƒç±»ï¼Œç§‰æ‰¿<code>Python</code>ä¸€åˆ‡çš†å¯¹è±¡çš„ç†å¿µï¼Œ<code>Python</code>ä¸­çš„ç±»ä¹Ÿæ˜¯ä¸€ç±»å¯¹è±¡ï¼Œ<code>metaclass</code>çš„å®ä¾‹å°±æ˜¯ç±»(<code>class</code>)ï¼Œè‡ªå·±å†™<code>metaclass</code>æ—¶éœ€è¦è®©å…¶ç»§æ‰¿è‡ª<code>type</code>å¯¹è±¡ã€‚å…³äº<code>metaclass</code>çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹<code>python</code>å­¦ä¹ æ‰‹å†Œä¸­çš„å…ƒç±»æ¦‚å¿µéƒ¨åˆ†ã€‚<br><code>ABC</code>ï¼ˆæŠ½è±¡åŸºç±»ï¼‰ï¼Œä¸»è¦å®šä¹‰äº†åŸºæœ¬ç±»å’Œæœ€åŸºæœ¬çš„æŠ½è±¡æ–¹æ³•ï¼Œå¯ä»¥ä¸ºå­ç±»å®šä¹‰å…±æœ‰çš„<code>API</code>ï¼Œä¸éœ€è¦å…·ä½“å®ç°ã€‚<code>abc</code>æ¨¡å—ï¼Œ<code>Python</code>å¯¹äº<code>ABC</code>çš„æ”¯æŒæ¨¡å—ï¼Œå®šä¹‰äº†ä¸€ä¸ªç‰¹æ®Šçš„<code>metaclass-ABCMeta</code> è¿˜æœ‰ä¸€äº›è£…é¥°å™¨â€” <code>@abstractmethod</code>å’Œ<code>@abstarctproperty</code> ã€‚<code>abc.ABCMeta</code> æ˜¯ä¸€ä¸ª<code>metaclass</code>ï¼Œç”¨äºåœ¨<code>Python</code>ç¨‹åºä¸­åˆ›å»ºæŠ½è±¡åŸºç±»ã€‚<a id="more"></a></p><p>æŠ½è±¡åŸºç±»å¯ä»¥ä¸å®ç°å…·ä½“çš„æ–¹æ³•(ä¹Ÿå¯ä»¥å®ç°)ï¼Œå¯ä»¥ç•™ç»™å­ç±»å»å®ç°ã€‚è¿™ç±»æ–¹æ³•åœ¨æŠ½è±¡åŸºç±»ä¸­æ˜¯é€šè¿‡ <code>@abstractmethod</code>å»å®ç°çš„ã€‚æŠ½è±¡åŸºç±»å¯ä»¥è¢«å­ç±»ç›´æ¥ç»§æ‰¿ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä»–çš„ç±»â€æ³¨å†Œâ€œ<code>(register)</code>åˆ°å…¶é—¨ä¸‹å½“è™šæ‹Ÿå­ç±»ï¼Œè™šæ‹Ÿå­ç±»çš„å¥½å¤„æ˜¯ä½ å®ç°çš„ç¬¬ä¸‰æ–¹å­ç±»ä¸éœ€è¦ç›´æ¥ç»§æ‰¿è‡ªåŸºç±»ä½†æ˜¯ä»ç„¶å¯ä»¥å£°ç§°è‡ªå·±å­ç±»ä¸­çš„æ–¹æ³•å®ç°äº†åŸºç±»è§„å®šçš„æ¥å£<code>issubclass(), issubinstance()</code>ï¼è™šæ‹Ÿå­ç±»æ˜¯é€šè¿‡è°ƒç”¨<code>metaclass</code>æ˜¯ <code>abc.ABCMeta</code> çš„æŠ½è±¡åŸºç±»çš„ <code>register</code>æ–¹æ³•æ³¨å†Œåˆ°æŠ½è±¡åŸºç±»é—¨ä¸‹çš„ï¼Œå¯ä»¥å®ç°æŠ½è±¡åŸºç±»ä¸­çš„éƒ¨åˆ†<code>API</code>æ¥å£ï¼Œä¹Ÿå¯ä»¥æ ¹æœ¬ä¸å®ç°ï¼Œä½†æ˜¯<code>issubclass(), issubinstance()</code>è¿›è¡Œåˆ¤æ–­æ—¶ä»ç„¶è¿”å›çœŸå€¼ã€‚</p><p>ç›´æ¥ç»§æ‰¿æŠ½è±¡åŸºç±»çš„å­ç±»å°±æ²¡æœ‰è¿™ä¹ˆçµæ´»ï¼Œåœ¨<code>metaclass</code>æ˜¯ <code>abc.ABCMeta</code>çš„æŠ½è±¡åŸºç±»ä¸­å¯ä»¥å£°æ˜â€æŠ½è±¡æ–¹æ³•â€œå’Œâ€œæŠ½è±¡å±æ€§â€ï¼Œç›´æ¥ç»§æ‰¿è‡ªæŠ½è±¡åŸºç±»çš„å­ç±»è™½ç„¶åˆ¤æ–­<code>issubclass()</code>æ—¶ä¸ºçœŸï¼Œä½†åªæœ‰å®Œå…¨è¦†å†™ï¼ˆå®ç°ï¼‰äº†æŠ½è±¡åŸºç±»ä¸­çš„â€œæŠ½è±¡â€å†…å®¹åï¼Œæ‰èƒ½è¢«å®ä¾‹åŒ–ï¼Œè€Œé€šè¿‡æ³¨å†Œçš„è™šæ‹Ÿå­ç±»åˆ™ä¸å—æ­¤å½±å“ã€‚</p><p><code>metaclass</code>ä¸º <code>abc.ABCMeta</code> çš„æŠ½è±¡åŸºç±»å¦‚æœæƒ³è¦å£°æ˜â€œæŠ½è±¡æ–¹æ³•â€ï¼Œå¯ä»¥ä½¿ç”¨<code>abc</code>æ¨¡å—ä¸­çš„è£…é¥°å™¨ <code>@abstractmethod</code>ï¼Œå¦‚æœæƒ³å£°æ˜â€œæŠ½è±¡å±æ€§â€ï¼Œå¯ä»¥ä½¿ç”¨<code>abc</code>æ¨¡å—ä¸­çš„<code>@abstractproperty</code> ã€‚æœ€åï¼Œä¸ºä»€ä¹ˆè¦æ<code>six</code>æ¨¡å—å‘¢ï¼Œ<code>six</code>æ¨¡å—æ˜¯<code>Python</code>ä¸ºäº†å…¼å®¹<code>Python 2.x</code> å’Œ<code>Python 3.x</code>æä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸­æœ‰ä¸€ä¸ªé’ˆå¯¹ç±»çš„è£…é¥°å™¨<code>@six.add_metaclass(MetaClass)</code>å¯ä»¥ä¸ºä¸¤ä¸ªç‰ˆæœ¬çš„<code>Python</code>ç±»æ–¹ä¾¿åœ°æ·»åŠ <code>metaclass</code>ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åŒæ—¶åˆ©ç”¨<code>Python</code>ä¸­çš„<code>abc</code>æ¨¡å—å’Œ<code>six</code>æ¨¡å—åœ¨ç±»çš„å®šä¹‰å‰æ·»åŠ <code>@six.add_metaclass(abc.ABCMeta)</code>æ¥ä¼˜é›…åœ°å£°æ˜ä¸€ä¸ªæŠ½è±¡åŸºç¡€ç±»äº†ï¼</p><p>åœ¨<code>python2.x</code>å’Œ<code>python3.x</code>ä¸‹éƒ½å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥å®ç°ï¼š</p><pre><code class="python">from abc import ABCMeta, abstractmethodimport six@six.add_metaclass(ABCMeta)class MyClass1(object):    def __init__(self, x, y, z):        self.x = x        self.y = y        self.z = z    def add():        return self.x + self.y + self.z    @abstractmethod    def run(self):        &quot;å­ç±»ä¸­å®ç°è¯¥æ–¹æ³•&quot;</code></pre><pre><code class="python">class metaTest(six.with_metaclass(ABCMeta, object)):    def __init__(self, x, y, z):        self.x = x        self.y = y        self.z = z    @abstractmethod    def run(self):        &quot;&quot;&quot;éœ€è¦å®ç°è¿™ä¸ªç±»çš„æ–¹æ³•&quot;&quot;&quot;    def __len__(self):        return 3</code></pre><p>è€ŒåŸå§‹åœ¨<code>python2</code>å’Œ<code>python3</code>ä¸­éœ€è¦ä½¿ç”¨ä¸åŒçš„æ–¹å¼ï¼š</p><pre><code class="python"># python2class MyClass(object):    __metaclass__ = ABCMeta    pass# python3class MyClass3(object, metaclass=ABCMeta):    pass</code></pre>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>six</tag>
      
      <tag>metaclass</tag>
      
      <tag>abc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ€ä¼˜åŒ–-æ¢¯åº¦ä¸‹é™ç®—æ³•</title>
    <link href="/2017/07/14/%E6%9C%80%E4%BC%98%E5%8C%96-%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95/"/>
    <url>/2017/07/14/%E6%9C%80%E4%BC%98%E5%8C%96-%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>æ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯æœ€ä¼˜åŒ–ç®—æ³•ä¹‹ä¸€ï¼Œåœ¨å¤§é‡çš„æœºå™¨å­¦ä¹ ç®—æ³•å’Œæ·±åº¦å­¦ä¹ ä¸­éƒ½ä¼šè¢«ç”¨åˆ°ã€‚ä¼˜åŒ–æ˜¯æŒ‡å½“æ”¹å˜$x$ä»¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸä¸ªå‡½æ•°$f(x)$ï¼Œè¯¥å‡½æ•°ä¸€èˆ¬ä¸ºç®—æ³•ä¸­çš„ç›®æ ‡å‡½æ•°æˆ–æŸå¤±å‡½æ•°ï¼Œæˆ–è€…ç§°ä¸ºä»£ä»·å‡½æ•°ã€è¯¯å·®å‡½æ•°ç­‰ã€‚åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­éœ€è¦é€šè¿‡å¯¼æ•°$fâ€™(x)$æˆ–$\frac{dy}{dx}$æ¥æè¿°ç¼©æ”¾$x$å¯¹è¾“å‡º$f(x)$çš„å˜åŒ–:$f(x+\theta) \approx f(x)+\theta fâ€™(x)$ã€‚å¯¹äºä»»æ„å°çš„$\eta$ä½¿å¾—$f(x-\eta sign(fâ€™(x))) \lt f(x)$ï¼Œå› æ­¤å¯ä»¥å°†$x$å¾€å¯¼æ•°çš„ç›¸åæ–¹å‘ç§»åŠ¨ä¸€å°æ­¥æ¥å‡å°$f(x)$ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ¢¯åº¦ä¸‹é™ã€‚<br><img src="/uploads/grad.jpg" srcset="/img/loading.gif" alt=""></p><a id="more"></a><h3 id="æ¢¯åº¦ä¸‹é™"><a href="#æ¢¯åº¦ä¸‹é™" class="headerlink" title="æ¢¯åº¦ä¸‹é™"></a>æ¢¯åº¦ä¸‹é™</h3><p>åœ¨æœ€å°åŒ–å¤šç»´è¾“å…¥çš„å‡½æ•°ï¼š$f: R^n \rightarrow R^n$ï¼Œä¸ºäº†ä½¿å¾—$f$æœ€å°åŒ–ï¼Œåœ¨ä¸€ç»´æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨å¯¼æ•°ï¼Œå¦‚æœæ˜¯å¤šç»´çš„æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨åå¯¼æ•°(<code>partial derivative</code>)ï¼Œåå¯¼æ•°$\frac {\partial} {\partial x} f(x)$è¡¡é‡ç‚¹$x$åœ¨$x_i$å¢åŠ æˆ–å‡å°æ˜¯$f(x)$çš„å˜åŒ–ã€‚æ¢¯åº¦æ˜¯ç›¸å¯¹ä¸€ä¸ªå‘é‡æ±‚å¯¼çš„å¯¼æ•°ï¼š$f$çš„å¯¼æ•°æ˜¯åŒ…å«æ‰€æœ‰åå¯¼æ•°çš„å‘é‡ï¼Œå¯ä»¥è®°ä½œ${\nabla}_x f(x)$ã€‚æ¢¯åº¦çš„ç¬¬<code>i</code>ä¸ªå…ƒç´ æ˜¯$f$å…³äº$x_i$çš„åå¯¼æ•°ã€‚åœ¨$u$(å•ä½å‘é‡)æ–¹å‘ä¸Šçš„æ–¹å‘å¯¼æ•°æ˜¯å‡½æ•°$f$åœ¨$u$æ–¹å‘çš„æ–œç‡ã€‚æ¢å¥è¯è¯´ï¼Œæ–¹å‘å¯¼æ•°æ˜¯å‡½æ•°$f(x+\alpha u)$å…³äº$\alpha$çš„å¯¼æ•°ã€‚å¯ä»¥æ ¹æ®é“¾å¼æ³•åˆ™ï¼Œå½“$\alpha=0$æ—¶ï¼Œ$\frac{\partial}{\partial_{\alpha}}f(x+\alpha u)=u^T \nabla_{x}f(x)$ã€‚ä¸ºäº†æœ€å°åŒ–$f$å¸Œæœ›æ‰¾åˆ°ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œè®¡ç®—æ–¹å‘å¯¼æ•°<br>$$<br>Min_{u,u^T u}{u^T {\nabla}_{x}{f(x)}} = Min_{u,u^T u}{||u||_2 ||{\nabla}_x f(x)||_2 cos{\theta}}<br>$$<br>å…¶ä¸­$\theta$æ˜¯$u$ä¸æ¢¯åº¦çš„å¤¹è§’ã€‚å°†$||u||_2 = 1$ä»£å…¥ï¼Œå¹¶ä¼šç•¥å’Œ$u$æ— å…³çš„é¡¹ï¼Œèƒ½ç®€åŒ–å¾—åˆ°${min}_{u}cos{\theta}$ã€‚è¿™åœ¨$u$ ä¸æ¢¯åº¦æ–¹å‘ç›¸åæ—¶å–å¾—æœ€å°ã€‚æ¢å¥è¯è¯´ï¼Œæ¢¯åº¦å‘é‡æŒ‡å‘ä¸Šå¡ï¼Œ<br>è´Ÿæ¢¯åº¦å‘é‡æŒ‡å‘ä¸‹å¡ã€‚æˆ‘ä»¬åœ¨è´Ÿæ¢¯åº¦æ–¹å‘ä¸Šç§»åŠ¨å¯ä»¥å‡å°$f$ã€‚è¿™è¢«ç§°ä¸ºæœ€é€Ÿä¸‹é™æ³•(<code>method of steepest descent</code>) æˆ–æ¢¯åº¦ä¸‹é™(<code>gradient descent</code>)ã€‚å¿«é€Ÿä¸‹é™å¹¶æ›´æ–°çš„å…¬å¼ä¸º<br>$$<br>xâ€™=x-{\epsilon}{\nabla}_x f(x)<br>$$<br>å…¶ä¸­$\epsilon$ä¸ºå­¦ä¹ ç‡ï¼Œæè¿°æ›´æ–°çš„æ­¥é•¿å¤§å°çš„é‡ã€‚å½“æ¢¯åº¦çš„æ¯ä¸ªå…ƒç´ ä¸º0æˆ–è€…æ¥è¿‘0çš„åœ°æ–¹æ”¶æ•›ã€‚</p><p>å€Ÿç”¨ç»´åŸºç™¾ç§‘ä¸Šçš„è¯´æ˜ï¼š</p><blockquote><p>æ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯åŸºäºè§‚å¯Ÿï¼šå¦‚æœ$f(x)$åœ¨$a$ç‚¹å¤„å¯å¯¼ä¸”æœ‰å®šä¹‰ï¼Œé‚£ä¹ˆå‡½æ•°$f(x)$åœ¨$a$æ²¿ç€æ¢¯åº¦çš„åå‘$-\nabla{f(a)}$ï¼Œå¦‚æœï¼š<br>$$b = a - {\gamma}{\nabla}f(a)$$<br>å…¶ä¸­æ¯æ¬¡$\gamma$çš„æ­¥é•¿æ›´æ–°ï¼Œä¸”å¯ä»¥æ”¹å˜ã€‚å¯¹äº$\gamma&gt;0$ä¸ºä¸€ä¸ªä»»æ„å°çš„æ•°æˆç«‹ï¼Œé‚£ä¹ˆ$f(a) \gt f(b)$ã€‚å› æ­¤å¯ä»¥é€šè¿‡æœ€åˆçš„ä¼°è®¡åˆ°åç»­è¿‡ç¨‹ä¸­è¿›è¡Œæ¨æ–­å¾—åˆ°$x_{n+1}=x_{n}-\gamma_{n}\nabla{f(x_{n})}, n \ge 0$ï¼Œå› æ­¤å¯ä»¥å¾—åˆ°$f(x_{0} \ge f(x_1) \ge f(x_2) \ge â€¦ \ge f(x_{n+1})$ï¼Œå¯ä»¥å¾—åˆ°ä¸‹å›¾çš„å½¢å¼ï¼š</p></blockquote><p><img src="/uploads/Gradient_descent.png" srcset="/img/loading.gif" alt=""></p><p>å¯ä»¥æ ¹æ®çº¿æ€§æ¨¡å‹æ¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥æ±‚è§£ã€‚å…¶ä¸­$h(x)$ä¸ºæ‹Ÿåˆçš„å‡½æ•°ï¼Œ$J(\theta)$ä¸ºè¯¯å·®å‡½æ•°æˆ–æŸå¤±å‡½æ•°ï¼Œç”¨æ¥è¡¡é‡è®­ç»ƒæ•°æ®é›†ç”¨$h(x)$æ¥æ‹Ÿåˆçš„æ•ˆæœç¨‹åº¦ï¼Œ$\theta$ä¸ºéœ€è¦æ±‚å¾—å‚æ•°ã€‚å‡è®¾ï¼š<br>$$<br>h(x) = \sum{i=1}^{n}{\theta{i}x_{i}}<br>$$</p><p>$$<br>J(\theta) = \frac {1} {2m} \sum_{i=1}^{m} {(y^i - h_{\theta}(x^i))^2}<br>$$</p><p>ä¸‹é¢æ˜¯é€šè¿‡æ¢¯åº¦ä¸‹é™æ¥è¿›è¡Œå‚æ•°è¿­ä»£ï¼š</p><ol><li>è®¡ç®—$J(\theta)$å…³äº$\theta$çš„åå¯¼æ•°ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—å‘é‡ä¸­æ¯ä¸€ä¸ª$\theta$çš„æ¢¯åº¦ï¼š</li></ol><p>$$<br>\begin{align}<br>\frac{\partial J(\theta)}{\partial\theta_j}\\<br>&amp; = -\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i)) \frac{\partial}{\partial\theta_j}(y^i-h_\theta(x^i)) \\<br>&amp; = -\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i)) \frac{\partial}{\partial\theta_j}(\sum_{j=0}^n\theta_jx_j^i-y^i) \\<br>&amp; = -\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i))x^i_j<br>\end{align}<br>$$</p><ol start="2"><li>æ²¿ç€æ¢¯åº¦çš„æ–¹å‘æ›´æ–°å‚æ•°</li></ol><p>$$<br>\theta_j := \theta_j + \alpha\frac{\partial J(\theta)}{\partial\theta_j}<br>:=\theta_j - \alpha\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i))x^i_j<br>$$</p><ol start="3"><li>è¿­ä»£ç›´åˆ°æ”¶æ•›</li></ol><p>$$<br>\theta_{j} := \theta_{j} + \alpha \sum_{i=1}^{m} (y^{(i)}-h_{\theta}(x^{(i)}))x_{j}^{(i)}<br>$$</p><p>ä¸Šé¢çš„æ¢¯åº¦ä¸‹é™æ˜¯ä½¿ç”¨äº†æ‰€æœ‰çš„æ ·æœ¬ã€‚å› æ­¤åœ¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šå°†è®­ç»ƒé›†éå†ä¸€æ¬¡ï¼Œå†…å­˜çš„å¼€é”€ä¼šå¾ˆå¤§ï¼Œå› æ­¤åç»­å¯¹è¿™ç§æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„æ–¹å¼è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå‡ºç°äº†éšæœºæ¢¯åº¦ä¸‹é™ç­‰ç®—æ³•ã€‚</p><h3 id="é€šè¿‡ç¤ºä¾‹å®ç°æ‰¹é‡æ¢¯åº¦ä¸‹é™"><a href="#é€šè¿‡ç¤ºä¾‹å®ç°æ‰¹é‡æ¢¯åº¦ä¸‹é™" class="headerlink" title="é€šè¿‡ç¤ºä¾‹å®ç°æ‰¹é‡æ¢¯åº¦ä¸‹é™"></a>é€šè¿‡ç¤ºä¾‹å®ç°æ‰¹é‡æ¢¯åº¦ä¸‹é™</h3><pre><code class="python"># coding:utf-8import numpy as np# æ•°æ®x = np.array([[2.1, 1.5], [2.5, 2.3], [3.3, 3.9], [3.9, 5.1], [2.7, 2.7]])y = np.array([2.5, 3.9, 6.7, 8.8, 4.6])# æ‹Ÿåˆçš„å‡½æ•°ï¼šf(x) = w1*x1 + w2*x2# æŸå¤±å‡½æ•°ï¼šJ(w) = (sum((f(x) - y)^2))/2m# åˆå§‹åŒ–æƒé‡w = np.random.rand(2)# åˆå§‹åŒ– é˜ˆå€¼eps, å­¦ä¹ ç‡(å­¦ä¹ æ­¥é•¿)eps = 0.00001alpha = 0.1loss = 1max_iter = 500iter = 1while loss &gt; eps and iter &lt; 500:    # åˆå§‹åŒ– æŸå¤±å‡½æ•°å·®å€¼    loss = 0    sigma = np.array([0, 0])    # æ›´æ–°æƒé‡    for i in range(x.shape[0]):        h = y[i] - sum(w * x[i, :])        sigma = sigma + h * x[i, :] / 5    w = w + alpha * sigma    for i in range(x.shape[0]):        loss += (sum(w * x[i, :]) - y[i]) ** 2    print loss, w    iter += 1</code></pre>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¼˜åŒ–</tag>
      
      <tag>æ¢¯åº¦ä¸‹é™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>numbaåŠ é€Ÿpythonç¨‹åºè¿è¡Œ</title>
    <link href="/2017/07/09/numba%E5%8A%A0%E9%80%9Fpython%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C/"/>
    <url>/2017/07/09/numba%E5%8A%A0%E9%80%9Fpython%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<p><code>python</code>ä½œä¸ºä¸€ä¸ªåŠ¨æ€è¯­è¨€ï¼Œåœ¨è¿è¡Œæ•ˆç‡ä¸Šä¸ºä¸€å¤§ç¼ºé™·ï¼Œä½†æ˜¯ä½œä¸ºä¸€é—¨æˆç†Ÿçš„è¯­è¨€ï¼Œæœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥æé«˜<code>python</code>çš„è¿è¡Œæ•ˆç‡ï¼Œå¦‚:<code>cpython, pypy,numba,LLVMPy</code>ã€‚ä¸ªäººä¸»è¦ç”¨æˆ·<code>python</code>å¤„ç†æ•°æ®å’Œå†™ä¸€äº›æ•°æ®æŒ–æ˜æ–¹é¢çš„ç®—æ³•ï¼Œå› æ­¤ä½¿ç”¨<code>numba</code>è¾ƒä¸ºæ–¹ä¾¿ã€‚å› æ­¤å¯¹<code>numba</code>è¯´æ˜ä¸‹ï¼Œå¹¶ä½œä¸ºç¬”è®°è®°å½•ä»¥ä¾¿ä»¥åæŸ¥é˜…ã€‚<code>numba</code>çš„æ¥æºä¸»è¦ï¼Œ<code>NumPy</code>çš„åˆ›å§‹äºº<code>Travis Oliphant</code>åœ¨ç¦»å¼€<code>Enthought</code>ä¹‹åï¼Œåˆ›å»ºäº†<code>CONTINUUM</code>ï¼Œè‡´åŠ›äºå°†<code>Python</code>å¤§æ•°æ®å¤„ç†æ–¹é¢çš„åº”ç”¨ã€‚æœ€è¿‘æ¨å‡ºçš„<code>Numba</code>é¡¹ç›®èƒ½å¤Ÿå°†å¤„ç†<code>NumPy</code>æ•°ç»„çš„<code>Python</code>å‡½æ•°<code>JIT</code>ç¼–è¯‘ä¸ºæœºå™¨ç æ‰§è¡Œï¼Œä»è€Œä¸Šç™¾å€çš„æé«˜ç¨‹åºçš„è¿ç®—é€Ÿåº¦ã€‚<a id="more"></a>ä¸‹é¢çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><pre><code class="python">import numba as nbfrom numba import jit@jit(&#39;f8(f8[:])&#39;)def sum1d(array):    s = 0.0    n = array.shape[0]    for i in range(n):        s += array[i]    return simport numpy as nparray = np.random.random(10000)%timeit sum1d(array)%timeit np.sum(array)%timeit sum(array</code></pre><p>è¾“å‡ºï¼š</p><pre><code>10000 loops, best of 3: 38.9 us per loop10000 loops, best of 3: 32.3 us per loop100 loops, best of 3: 12.4 ms per loop</code></pre><p><code>numba</code>ä¸­æä¾›äº†ä¿®é¥°å™¨åˆ©ç”¨<code>JIT</code>å°†å…¶ä¿®é¥°çš„å‡½æ•°ä¾¿ä»¥ä¸ºæœºå™¨å‡½æ•°ï¼Œå˜è¿”å›ä¸€ä¸ªå¯åœ¨<code>python</code>ä¸­è°ƒç”¨æœºå™¨ç çš„åŒ…è£…å¯¹è±¡ã€‚ä¸ºäº†èƒ½å¤Ÿå°†<code>python</code>å‡½æ•°ç¼–è¯‘æˆèƒ½å‘Šè¯‰æ‰§è¡Œçš„æœºå™¨ç ï¼Œéœ€è¦å‘Šè¯‰<code>JIT</code>ç¼–è¯‘å™¨å‡½æ•°çš„å„ä¸ªå‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æŒ‡å®šç±»å‹ä¿¡æ¯ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç±»å‹ä¿¡æ¯ç”±ä¸€ä¸ªå­—ç¬¦ä¸²<code>f8(f8[:])</code>æŒ‡å®šã€‚å…¶ä¸­<code>f8</code>è¡¨ç¤º8ä¸ªå­—èŠ‚åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œæ‹¬å·å‰é¢çš„<code>f8</code>è¡¨ç¤ºè¿”å›å€¼ç±»å‹ï¼Œæ‹¬å·é‡Œçš„è¡¨ç¤ºå‚æ•°ç±»å‹ï¼Œ<code>[:]</code>è¡¨ç¤ºä¸€ç»´æ•°ç»„ã€‚å› æ­¤æ•´ä¸ªç±»å‹å­—ç¬¦ä¸²è¡¨ç¤º<code>sum1d()</code>æ˜¯ä¸€ä¸ªå‚æ•°ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°çš„ä¸€ç»´æ•°ç»„ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯JITå‡½æ•°åªèƒ½å¯¹æŒ‡å®šçš„ç±»å‹å‚æ•°è¿›è¡Œè¿ç®—ã€‚</p><p>å¦‚æœå¸Œæœ›<code>JIT</code>èƒ½å¤Ÿå¯¹æ‰€æœ‰çš„ç±»å‹è¿›è¡Œè¿ç®—ï¼Œå¯ä»¥æ‰€æœ‰<code>autojit</code>ã€‚ä½†æ˜¯è¯¥å‡½æ•°çš„è¿ç®—é€Ÿåº¦è¿œä¸åŠ<code>JIT</code>ï¼Œå› ä¸º<code>autojit</code>åœ¨è¿ç®—å‰éœ€è¦åˆ¤æ–­ç±»å‹ï¼Œå› æ­¤å¤§å¤§é™ä½äº†æ•ˆç‡ã€‚åœ¨<code>numba</code>ä¸­åŸºæœ¬æ˜¯ä½¿ç”¨<code>JIT</code>å’Œ<code>autojit</code>è¿™ä¸¤ä¸ªå‡½æ•°è£…é¥°è‡ªå·±çš„å‡½æ•°ã€‚ä¸‹é¢æ˜¯<code>numba</code>æ¨¡å—æ‰€æ”¯æŒçš„æ‰€æœ‰ç±»å‹ï¼š</p><pre><code>[type for type in dir(numba.types)][&#39;Any&#39;, &#39;Array&#39;, &#39;CPointer&#39;, &#39;CharSeq&#39;, &#39;Complex&#39;, &#39;Dispatcher&#39;, &#39;Dummy&#39;, &#39;Float&#39;, &#39;Function&#39;, &#39;FunctionPointer&#39;, &#39;Integer&#39;, &#39;Kind&#39;, &#39;Macro&#39;, &#39;Method&#39;, &#39;Module&#39;, &#39;Object&#39;, &#39;OpaqueType&#39;, &#39;Optional&#39;, &#39;Prototype&#39;, &#39;Record&#39;, &#39;Tuple&#39;, &#39;Type&#39;, &#39;UniTuple&#39;, &#39;UniTupleIter&#39;, &#39;UnicodeCharSeq&#39;, &#39;VarArg&#39;, &#39;__all__&#39;, &#39;__builtins__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;_autoincr&#39;, &#39;_make_signed&#39;, &#39;_make_unsigned&#39;, &#39;_typecache&#39;, &#39;abs_type&#39;, &#39;absolute_import&#39;, &#39;b1&#39;, &#39;bool_&#39;, &#39;boolean&#39;, &#39;byte&#39;, &#39;c16&#39;, &#39;c8&#39;, &#39;char&#39;, &#39;complex128&#39;, &#39;complex64&#39;, &#39;complex_domain&#39;, &#39;defaultdict&#39;, &#39;division&#39;, &#39;double&#39;, &#39;exception_type&#39;, &#39;f4&#39;, &#39;f8&#39;, &#39;float32&#39;, &#39;float64&#39;, &#39;float_&#39;, &#39;i1&#39;, &#39;i2&#39;, &#39;i4&#39;, &#39;i8&#39;, &#39;int16&#39;, &#39;int32&#39;, &#39;int64&#39;, &#39;int8&#39;, &#39;int_&#39;, &#39;intc&#39;, &#39;integer_domain&#39;, &#39;intp&#39;, &#39;len_type&#39;, &#39;long_&#39;, &#39;longlong&#39;, &#39;neg_type&#39;, &#39;none&#39;, &#39;number_domain&#39;, &#39;numpy&#39;, &#39;print_function&#39;, &#39;print_item_type&#39;, &#39;print_type&#39;, &#39;pyobject&#39;, &#39;range_iter32_type&#39;, &#39;range_iter64_type&#39;, &#39;range_state32_type&#39;, &#39;range_state64_type&#39;, &#39;range_type&#39;, &#39;real_domain&#39;, &#39;short&#39;, &#39;sign_type&#39;, &#39;signed_domain&#39;, &#39;slice3_type&#39;, &#39;slice_type&#39;, &#39;string&#39;, &#39;u1&#39;, &#39;u2&#39;, &#39;u4&#39;, &#39;u8&#39;, &#39;uchar&#39;, &#39;uint&#39;, &#39;uint16&#39;, &#39;uint32&#39;, &#39;uint64&#39;, &#39;uint8&#39;, &#39;uintc&#39;, &#39;uintp&#39;, &#39;ulong&#39;, &#39;ulonglong&#39;, &#39;unsigned_domain&#39;, &#39;ushort&#39;, &#39;void&#39;, &#39;voidptr&#39;]</code></pre><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œåˆ©ç”¨<code>jit</code>å’Œ<code>autojit</code>è¿›è¡Œå¯¹æ¯”ï¼Œçœ‹æ•ˆç‡å¦‚ä½•ï¼šä¸‹é¢çš„ä¾‹å­ä¸­é€šè¿‡è¯»å–<code>ecexl</code>ä¸­çš„æ•°æ®ï¼Œå†å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼ˆæ‰¾å‡ºæŸä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•å€¼ã€‚ï¼‰</p><pre><code class="python">import xlrdimport numpy as npimport numbafrom time import clock@numba.jit(&#39;int64(char[:])&#39;)   #@autojitdef get_array_table(path):    book = xlrd.open_workbook(filename=path)    table = book.sheets()[0]    nrows = table.nrows    data_array = []    columns = []    for i in range(nrows):        if i == 0:            columns = table.row_values(i)        else:            data_array.append(table.row_values(i))    data = np.array(data_array)    return data@numba.jit(&#39;int64(int64[:])&#39;)   #@autojitdef get_array_index(number): #æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å…ƒç´ çš„ç´¢å¼•indexï¼Œå¹¶è¿”å›è¿™ä¸ªç´¢å¼•    index = 0    tryï¼š        for k in range(len(data2)):            if data2[k,0] == number:                index = k                busi_amount = sum(data2[index:,0]*data2[index:,1]) #busi amount, å¤§äºé˜ˆå€¼ä¸šåŠ¡é‡çš„å€¼                user_amount = sum(data2[index:,1])                 #å¤§äºé˜ˆå€¼çš„ç”¨æˆ·é‡                      break            else:                index = 0                continue        return index    except Exception as e:        print &quot;THere is error:%s ï¼&quot; % e  if __name__ == &quot;__main__&quot;:    start_time = clock()    path1 = &quot;f:\\TEST1.xlsx&quot;    #file2 in path, sample data, normal user in cp    path2 = &quot;f:\\TEST2.xlsx&quot;    #file1 in path, all data      data1 = get_array_table(path1)    data2 = get_array_table(path2)    all_busi_cnt = sum(data2[:,0]*data2[:,1])    all_user_cnt = sum(data2[:,1])    index = get_array_index(200)    end_time = clock()    print data2[:,0][np.where(data2[:,0] &gt; 200)]    #é€šè¿‡whereæ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®é›†    print data2[:,0].tolist().index(200)            #å°†arrayè½¬åŒ–ä¸ºlistè¿›è¡Œindex    print data2[index,:]    print &quot;This process have to time %s second!&quot; % (end_time-start_time)  </code></pre><p>è¾“å‡ºä¸ºï¼š</p><pre><code>199[ 200.  261.]This process have to time 2.8969633643 second!#@autojit199[ 200.  261.]This process have to time 8.33246232783 second!</code></pre><p>å¯ä»¥çœ‹å‡º<code>JIT</code>æ¯”<code>AUTOJIT</code>è¦å¿«ä¸€äº›ã€‚å½“æ•°æ®é‡å¤§æ—¶å·®è·ä¼šæ›´åŠ çš„å¤§ã€‚å¦å¤–<code>numba</code>å’Œ<code>numpy</code>é…åˆä½¿ç”¨æ•ˆæœæœ€ä½³ã€‚å¯ä»¥é€šè¿‡<code>google</code>æŸ¥è¯¢<code>cpython</code> ,<code>pypy</code> å’Œ<code>numba</code>çš„æ•ˆç‡æ¯”è¾ƒ,æœ‰å¾ˆå¤šè¿™æ ·æ–‡ç« ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>numba</tag>
      
      <tag>numpy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è™è ä¾ å‰ä¼ é»‘æš—éª‘å£«è§‚åæ„Ÿ</title>
    <link href="/2017/07/09/%E8%9D%99%E8%9D%A0%E4%BE%A0%E5%89%8D%E4%BC%A02-%E9%BB%91%E6%9A%97%E9%AA%91%E5%A3%AB%E8%A7%82%E5%90%8E%E6%84%9F/"/>
    <url>/2017/07/09/%E8%9D%99%E8%9D%A0%E4%BE%A0%E5%89%8D%E4%BC%A02-%E9%BB%91%E6%9A%97%E9%AA%91%E5%A3%AB%E8%A7%82%E5%90%8E%E6%84%9F/</url>
    
    <content type="html"><![CDATA[<p>å¯¹ã€Šè™è ä¾ ï¼šé»‘æš—éª‘å£«ã€‹è¿™éƒ¨ç”µå½±æ˜¯ç™¾çœ‹ä¸åŒï¼Œè¿™éƒ¨ç”µå½±åœ¨å½“æ—¶ä¹Ÿæ˜¯è·å¾—äº†ç›¸å½“é«˜çš„è¯„ä»·ï¼Œä»è¿™éƒ¨ç”µå½±æ ‡é¢˜å°±å…·æœ‰ä¸¤é¢æ€§ï¼Œè‹¥ä»å¸ƒé²æ–¯éŸ¦æ©çš„è§’åº¦çœ‹ï¼Œé»‘æš—éª‘å£«æ˜¯å…·æœ‰è¤’ä¹‰ï¼Œè€Œä»ä¸¹ç‰¹çš„è§’åº¦åˆ™æœ€ç»ˆåæ˜ äº†äººå†…å®¹çš„é»‘æš—é¢ã€‚ç”µå½±ä¸­å¸ƒé²æ–¯Â·éŸ¦æ©ï¼Œå“ˆç»´Â·ä¸¹ç‰¹ï¼Œå°ä¸‘ï¼Œå‰å§†Â·æˆˆç™»è¿™å‡ ä¸ªä¸»è¦çš„äººç‰©ï¼Œå„è‡ªå°†è‡ªå·±çš„è§’è‰²æ¼”çš„éå¸¸çš„åˆ°ä½ï¼Œç‰¹åˆ«æ˜¯å°ä¸‘ã€‚åœ¨ç”µå½±ä¸­å¯¹è‹±é›„ä¸»æ„è¿›è¡Œäº†é‡æ–°å®šä¹‰ï¼Œä»æœ€åº•å±‚çš„ç¤¾ä¼šåˆ°æœ€ä¸Šå±‚çš„ç¤¾ä¼šå‡å±•ç°çš„æ·‹æ¼“å°½è‡´ï¼Œéƒ½åæ˜ å‡ºäº†å„ä¸ªé˜¶å±‚çš„ä¸‘é™‹é¢è²Œå’Œå„ç±»äººçš„ä¿¡ä»°ä»¥åŠç²¾ç¥å ¡å’ç­‰ç­‰ã€‚å¯¹äººæ€§çš„ä¸‘æ¶è¿›è¡Œäº†æ·±åˆ»çš„æ€è€ƒï¼Œç‰¹åˆ«æ˜¯é€šè¿‡å“ˆç»´Â·ä¸¹ç‰¹åœ¨ç”µå½±ä¸­çš„è‹±é›„äººç‰©æœ€ç»ˆæ²¦è½åˆ°å’Œå°ä¸‘ä¸€æ ·ï¼Œä»å…‰æ˜éª‘å£«åˆ°ä¸¤é¢éª‘å£«æœ€ç»ˆåˆ°é»‘æš—éª‘å£«ã€‚</p><p>é¦–å…ˆçœ‹è¿™éƒ¨ç”µå½±çš„å¯¼æ¼”å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°çš„åˆä¸€å¤§ä½œï¼Œä»ä¸Šä¸€éƒ¨å¼€æˆ˜æ—¶åˆ»ï¼Œè¯ºå…°å†æ¬¡å¯¹è™è ä¾ çš„åˆ°æ¥è¿›è¡Œäº†æ·±å…¥çš„æ€è€ƒã€‚é‚£ä¹ˆè¯ºå…°çš„èƒŒæ™¯æ˜¯æ€æ ·çš„å‘¢ï¼Ÿè¯ºå…°æ‹¥æœ‰çˆ±å°”å…°è¡€ç»Ÿï¼Œæ‹¥æœ‰è‹±ç¾åŒé‡å›½ç±ï¼Œä»å°å°±åœ¨è¿›è¡Œæ‹æ‘„ï¼Œè¯ºå…°æ˜¯007çš„ç‹‚çƒ­ç²‰ï¼Œä»–æ›¾ç»è·Ÿå¤§å«Â·SÂ·é«˜è€¶è¯´è¿‡ï¼Œæœ€çˆ±çš„é‚¦å¾·ç”µå½±æ˜¯ã€Šå¥³ç‹å¯†ä½¿ã€‹ã€‚åœ¨å°æ—¶å€™è¯ºå…°ä¸ƒå²å°±ç”¨çˆ¶äº²çš„è¶…8æ‘„å½±æœºæ‹æ‘„è‡ªå·±çš„ç©å…·å…µäººï¼Œå¼€å§‹äº†æœ€æ—©çš„ç”µå½±åˆ›ä½œã€‚å­©ææ—¶ä»£çš„ä»–ä½åœ¨èŠåŠ å“¥æ—¶ï¼Œè¿˜å’Œæ—¥åæˆä¸ºå¯¼æ¼”ã€åˆ¶ç‰‡äººçš„ç½—ç§‘Â·è´åˆ©å…‹ä¸€èµ·æ‹æ‘„çŸ­ç‰‡ã€‚å¦å¤–åœ¨ä»–çš„æ‰‹ä¸­è¿˜æœ‰ã€Šç›—æ¢¦ç©ºé—´ã€‹,ã€Šè®°å¿†ç¢ç‰‡ã€‹,ã€Šè‡´å‘½é­”æœ¯ã€‹ç­‰ç­‰ç»å…¸çš„ç”µå½±ã€‚è€Œæ¯éƒ¨ç”µå½±æœ‰ä¸ªå…±åŒç‚¹ï¼Œåœ¨ä¸€ä¸ªæƒ³è±¡åŠ›éå¸¸ä¸°å¯Œç©ºé—´ï¼Œä»–å™äº‹æ‰‹æ³•éå¸¸è®©äººå‡ºä¹æ„æ–™ã€‚<a id="more"></a></p><p>å›åˆ°ç”µå½±çš„æœ¬èº«ï¼Œä»æ¯ä¸ªäººç‰©æ¥åˆ†ææ‰€åæ˜ å‡ºçš„ç¤¾ä¼šç°è±¡å’Œä¸€äº›æ€è€ƒæˆ–è€…äººç”Ÿå“²ç†ï¼Œé¦–å…ˆæ˜¯è™è ä¾ æœ¬èº«ï¼ˆå¸ƒé²æ–¯éŸ¦æ©ï¼‰ï¼Œä½œä¸ºç”µå½±çš„ç”·ä¸»è§’ï¼Œè€Œåœ¨å½“æ—¶æ··ä¹±çš„é«™æ½­å¸‚ï¼Œè™è ä¾ ç¡®å®æ‰“å‡»äº†å¾ˆå¤šçŠ¯ç½ªå›¢ä¼™ï¼Œä½†æ˜¯åœ¨äººä»¬çš„å¿ƒä¸­ï¼Œä¼¼ä¹è®¤ä¸ºä»–æ˜¯çœŸæ­£çš„è‹±é›„ï¼Œè€Œä¸”æœåˆ°é»‘å¸®å„ç§çš„æŒ¤å…‘ï¼Œè€Œæ”¿åºœä¹Ÿå¯¹è™è ä¾ ä¸æ˜¯éå¸¸è®¤å¯ã€‚ä½œä¸ºè™è ä¾ æœ¬äººä¹Ÿè®¤ä¸ºè‡ªå·±ä¸èƒ½å®Œå…¨æ‹¯æ•‘é«™æ½­å¸‚ï¼Œè€Œæ˜¯éœ€è¦ä¸€ä½èƒ½å¤ŸçœŸæ­£ç«™å‡ºæ¥çš„å…‰æ˜éª‘å£«ã€‚è™è ä¾ åœ¨ç”µå½±ä¸­ä¹Ÿå¾—åˆ°äº†åæ€ï¼Œè®¤ä¸ºé«™æ½­å¸‚æ˜¯ä¸èƒ½é€šè¿‡æ­¦åŠ›æˆ–è€…æš´åŠ›æ¥ç»´æŒæ­£ä¹‰ï¼Œè€Œéœ€è¦ä»¥ä¸ºäººä»¬ç›¸ä¿¡çš„æ­£ä¹‰è€…ï¼Œè™è ä¾ ç”šè‡³å¤šæ¬¡å¯¹è‡ªå·±èº«ä»½è¿›è¡Œäº†æ€€ç–‘ï¼Œç”šè‡³æƒ³è¿‡æ”¾å¼ƒï¼Œå¤šæ¬¡å‘è‡ªå·±çš„ç®¡å®¶å’Œè‡ªå·±å…¬å¸çš„è´Ÿè´£äººè¯¢é—®ã€‚åœ¨ç”µå½±ä¸­å½“å°ä¸‘é€¼ç€è™è ä¾ éœ²å‡ºçœŸé¢ç›®çš„æ—¶å€™ï¼Œè™è ä¾ é€‰æ‹©äº†æŒºèº«è€Œå‡ºï¼Œæ­¤æ—¶ç¼–å‰§å¯¹è¿™ä¸ªè‹±é›„äººç‰©è¿›è¡Œäº†æ·±åˆ»çš„æ€è€ƒï¼Œè€Œä¸åƒå…¶ä»–è‹±é›„ä¸»ä¹‰çš„ç”µå½±ã€‚å½“åé¢ä¸¹ç‰¹å’Œå¥³å‹åŒæ—¶è¢«å°ä¸‘ç»‘æ¶æ—¶ï¼Œè™è ä¾ æ¯…ç„¶é€‰æ‹©äº†è‡ªå·±çš„çš„å¥³å‹ï¼Œè¿™åˆå®Œå…¨åæ˜ å‡ºäº†ä½œä¸ºä¸€ä¸ªè‹±é›„å†…å¿ƒæ·±å¤„å¯¹è‡ªå·±é‡è¦çš„äººçš„ä¿æŠ¤ï¼Œè€Œæ”¾å¼ƒäº†äººä»¬å…¬è®¤çš„å…‰æ˜éª‘å£«ã€‚ç”µå½±ä¸­å„ä¸ªé˜¶å±‚éƒ½åæ˜ å‡ºäº†è‡ªå·±çš„å¼±ç‚¹ï¼Œå¦‚è™è ä¾ å¯¹è‡ªå·±é‡è¦äººçš„å¼±ç‚¹ï¼Œäººæ€§çš„å¼±ç‚¹ï¼Œå…¶ä¸­å˜ç™»èº«è¾¹æœ€ä¿¡ä»»çš„å¥³è­¦çš„å¼±ç‚¹ï¼Œåœ¨è¿™ç§éå¸¸æ··ä¹±çš„æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†äººé€‰æ‹©äº†é»‘æš—é¢ã€‚<br>åœ¨ç”µå½±ä¸­æœ€ç»ˆå“ˆç‰¹å€’ä¸‹ï¼Œè™è ä¾ å’Œé«˜ç™»çŸ¥é“è‹¥å“ˆç»´è°‹æ€è­¦å¯Ÿçš„äº‹ä¼ å‡ºå»ï¼Œä¼šè®©åŸå¸‚æ··ä¹±ä¸”é“å¾·æ²¦é™·ï¼Œè€Œè¿™å°±æ˜¯å°ä¸‘çš„æœ€å¤§ç›®çš„ã€‚è™è ä¾ è¯´æœé«˜ç™»ï¼Œè™è ä¾ è‡ªå·±æ‰›ä¸‹è¿™äº›ç½ªåï¼Œä¸ºäº†ç»´æŒè¿™ä¸€å…‰è¾‰å½¢è±¡ï¼Œè®©äººä»¬æƒ³è±¡æ­£ä¹‰çš„çš„å­˜åœ¨ï¼Œè¿™æ‰æ˜¯è‹±é›„çš„è¯ é‡Šï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯è¯ºå…°å¿ƒä¸­çš„è‹±é›„ã€‚æœ€ç»ˆé«˜ç™»å‘å‡ºäº†è™è ä¾ çš„è¿½æ•ä»¤ï¼Œç ¸æ¯äº†è™è ä¿¡å·ç¯ï¼Œå¹¶ç»™äº†è™è ä¾ é»‘æš—éª‘å£«çš„ç§°å·ã€‚</p><p>å°ä¸‘ï¼Œè¿™ä¸ªäººç‰©åœ¨ç”µå½±ä¸­ä¸€ç‚¹ä¸é€Šäºä¸»è§’ï¼Œæ¯æ¬¡äº‹ä»¶çš„åˆ¶é€ è€…ï¼Œäººç‰©å¿ƒç†çš„åˆ†æï¼Œäº‹ä»¶ç­–åˆ’ç­‰ç­‰éƒ½éå¸¸çš„åˆ°ä½ï¼Œç”šè‡³å®Œç¾ã€‚è€Œæ¯æ¬¡å°ä¸‘å–œæ¬¢æåˆ°è‡ªå·±çš„æ•…äº‹ï¼Œè‡ªå·±çš„è€å©†å¾ˆæ¼‚äº®ï¼Œçªç„¶å˜ä¸‘åï¼Œè‡ªå·±ä¸èƒ½é¢å¯¹ï¼Œå…¶å®æ˜¯ä¸èƒ½é¢å¯¹è‡ªå·±çš„ä¸‘é™‹é¢ã€‚å½“è‡ªå·±æŠŠè‡ªå·±å˜ä¸‘å’Œè‡ªå·±çš„å¦»å­ä¸€èµ·çš„æ—¶å€™ï¼Œå¦»å­å´å‘ç°è‡ªå·±æ›´åŠ ä¸èƒ½æ¥å—è‡ªå·±çš„ä¸ˆå¤«å¦‚æ­¤çš„ä¸‘é™‹ã€‚å› æ­¤å¯¼è‡´æœ€åå…¨å®¶åˆ†æ•£ï¼Œå¦å¤–å°ä¸‘è‡ªå·±ç”Ÿæ´»åœ¨ä¸€ä¸ªå®Œå…¨æš´åŠ›å’Œä¸€ä¸ªå¿ƒç†éå¸¸å—æŒ«çš„ç¯å¢ƒä¸­ï¼Œå¯¼è‡´å°ä¸‘åšäº‹æƒ…å®Œå…¨æ— åŸåˆ™æ€§ï¼Œæ— è§„å¾‹æ€§ã€‚ç”µå½±ä¸­å°ä¸‘å¯¹æ¯ä¸ªäººçš„å¿ƒç†åˆ†æçš„éƒ½éå¸¸çš„åˆ°ä½ï¼Œå¦‚ç»‘æ¶è™è ä¾ å¥³å‹å’Œå…‰æ˜éª‘å£«ï¼Œæœ€ç»ˆä¸¤åº§ç©¿ä¸Šçš„ä¹˜å®¢ï¼Œä»¥åŠå¯¹ä¸¹ç‰¹çš„åˆ†æç­‰ç­‰ã€‚ä»–å°†ä¸¹ç‰¹ä»ä¸€ä¸ªå…‰æ˜éª‘å£«ï¼Œå˜ä¸ºåŒé¢éª‘å£«ï¼Œæœ€ç»ˆå˜ä¸ºä¸€ä¸ªå¤±è´¥è€…ï¼Œæ‘§æ¯äººä»¬å¿ƒä¸­çš„è‹±é›„ã€‚è¿™å¯¹äºå°ä¸‘è¿™æ— ç–‘æ˜¯èƒœåˆ©çš„ã€‚ç¤¾ä¼šæœ€ç»ˆé€‰æ‹©è™è ä¾ è€Œæ²¡æœ‰é€‰æ‹©å°ä¸‘ï¼Œä¸æ˜¯å› ä¸ºè™è ä¾ æ˜¯å¯¹çš„ï¼Œåªæ˜¯å› ä¸ºè™è ä¾ åšå®ˆçš„ä¸œè¥¿å’Œç¤¾ä¼šçš„ç°å®ç¦»å¾—æ›´è¿‘ã€‚æ‰€ä»¥ä»æŸä¸ªè§’åº¦è®²ï¼Œå°ä¸‘æ˜¯ä¸ªå½»å½»åº•åº•çš„é©å‘½æ´¾ï¼Œè€Œè™è ä¾ åˆ™æ˜¯ä¸ªæ ‡å‡†çš„ä¿å®ˆæ´¾ï¼Œå¹¶ä¸”é‚£ç§ç¬¦åˆè™è ä¾ ä¿¡ä»°çš„ç¤¾ä¼šå¯èƒ½è®©äººæ›´åŠ åœ°æ„Ÿåˆ°èˆ’æœä¸€ç‚¹ã€‚</p><p>æœ€åä¸¤ä¸ªè½®èˆ¹ä¸Šäººä»¬å¿ƒç†çš„å¯¹å³™ï¼Œå½“åˆ«äººçš„å‘½è¿æŒæ¡åœ¨è‡ªå·±çš„æ‰‹ä¸­ï¼Œè€Œä¸”èƒ½å¤Ÿå†³å®šè‡ªå·±çš„å‘½è¿çš„æ—¶å€™ï¼Œç¼–å‰§å¾ˆæ˜¾ç„¶é€‰æ‹©äº†ç›¸ä¿¡å¯¹æ–¹ï¼Œè¿™ä¸€å¹•æˆä¸ºäº†ç”µå½±çš„ä¸€å¤§äº®ç‚¹ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­çš„é‚£ç§çº ç»“ï¼Œç›¸ä¿¡å’Œä¸ä¿¡ä»»ç­‰ç­‰ã€‚æœ€ç»ˆæ˜¾ç¤ºäº†å…‰æ˜çš„ä¸€é¢ï¼Œäººä»¬é€‰æ‹©äº†ç›¸ä¿¡å¯¹æ–¹ï¼Œç›¸ä¿¡æ­£ä¹‰å­˜åœ¨ã€‚<br>å…¶ä»–</p>]]></content>
    
    
    <categories>
      
      <category>æ€è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç”µå½±</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jupyter-notebookè¿œç¨‹ç™»é™†é…ç½®ä»¥åŠsparkå¤šè¯­è¨€ç¯å¢ƒé…ç½®</title>
    <link href="/2017/07/09/jupyter-notebook%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8Aspark%E5%A4%9A%E8%AF%AD%E8%A8%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <url>/2017/07/09/jupyter-notebook%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8Aspark%E5%A4%9A%E8%AF%AD%E8%A8%80%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p><code>jupyter notebook</code>æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„<code>python</code>æ•°æ®åˆ†æå·¥å…·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œå…·æœ‰æå¼ºçš„äº¤äº’æ–¹å¼å’Œå¯Œæ–‡æœ¬çš„å±•ç¤ºæ•ˆæœã€‚<code>jupyter</code>æ˜¯å®ƒçš„å‡çº§ç‰ˆï¼Œå®ƒçš„å®‰è£…ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œä¸€èˆ¬<code>Anaconda</code>å®‰è£…åŒ…ä¸­ä¼šè‡ªå¸¦ã€‚å®‰è£…å¥½ä»¥åç›´æ¥è¾“å…¥<code>jupyter notebook</code>ä¾¿å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚ä½†æ˜¯å®ƒé»˜è®¤åªèƒ½åœ¨æœ¬åœ°è®¿é—®ï¼Œå¦‚æœæƒ³æŠŠå®ƒå®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼Œç„¶ååœ¨æœ¬åœ°è¿œç¨‹è®¿é—®ï¼Œåˆ™éœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š<a id="more"></a></p><ol><li><p>ç™»é™†è¿œç¨‹æœåŠ¡å™¨</p></li><li><p>ç”Ÿæˆé…ç½®æ–‡ä»¶<code>$jupyter notebook --generate-config</code></p></li><li><p>ç”Ÿæˆå¯†ç æ‰“å¼€<code>ipython</code>ï¼Œåˆ›å»ºä¸€ä¸ªå¯†æ–‡çš„å¯†ç ï¼š</p><pre><code class="shell">In [1]: from notebook.auth import passwdIn [2]: passwd()  Enter password:  Verify password:Out[2]: &#39;sha1:ce23d945972f:34769685a7ccd3d08c84a18c63968a41f1140274&#39;</code></pre><p>æŠŠç”Ÿæˆçš„å¯†æ–‡<code>sha1:ceâ€¦</code>å¤åˆ¶ä¸‹æ¥</p></li><li><p>ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶<br><code>$vim ~/.jupyter/jupyter_notebook_config.py</code><br>è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p><pre><code class="shell">c.NotebookApp.ip=&#39;*&#39;c.NotebookApp.password = u&#39;sha:ce...  # åˆšæ‰å¤åˆ¶çš„é‚£ä¸ªå¯†æ–‡&#39;c.NotebookApp.open_browser = Falsec.NotebookApp.port =8888 #éšä¾¿æŒ‡å®šä¸€ä¸ªç«¯å£</code></pre></li><li><p>å¯åŠ¨<code>jupyter notebookï¼š$jupyter notebook</code></p></li><li><p>è¿œç¨‹è®¿é—®<br>æ­¤æ—¶åº”è¯¥å¯ä»¥ç›´æ¥ä»æœ¬åœ°æµè§ˆå™¨ç›´æ¥è®¿é—®<code>http://address_of_remote:8888</code>å°±å¯ä»¥çœ‹åˆ°<code>jupyter</code>çš„ç™»é™†ç•Œé¢ã€‚</p></li><li><p>å»ºç«‹<code>ssh</code>é€šé“<br>å¦‚æœç™»é™†å¤±è´¥ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯æœåŠ¡å™¨é˜²ç«å¢™è®¾ç½®çš„é—®é¢˜ï¼Œæ­¤æ—¶æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨æœ¬åœ°å»ºç«‹ä¸€ä¸ª<code>ss</code>hé€šé“ï¼šåœ¨æœ¬åœ°ç»ˆç«¯ä¸­è¾“å…¥<code>ssh username@address_of_remote -L127.0.0.1:1234:127.0.0.1:8888</code>ä¾¿å¯ä»¥åœ¨<code>localhost:1234</code>ç›´æ¥è®¿é—®è¿œç¨‹çš„<code>jupyter</code>äº†ã€‚</p></li><li><p>ç»™<code>jupyter-notebook</code>æœåŠ¡å™¨æ¢ä¸ªçš®è‚¤</p><pre><code>pip install jupyterthemesjt -l`  #ã€€çœ‹çœ‹æœ‰å“ªäº›çš®è‚¤ï¼Œå†ç”¨jt -t {çš®è‚¤å} -cellw 960 -T -tfs 11 -f source -nf ubuntu -tf source -fs 10</code></pre><p>é‡å¯<code>jupyter-notebook</code>æœåŠ¡å™¨ï¼Œå³å¯äº«å—æ–°çš®è‚¤ã€‚</p></li><li><p>ç»™<code>jupyter</code>å®‰è£…æ’ä»¶  </p><pre><code># å®‰è£…`Jupyter Notebook extensions`conda install -c conda-forge jupyter_contrib_nbextensions orpip install https://github.com/ipython-contrib/IPython-notebook-xtensions/archive/master.zip --userpip install jupyter_contrib_nbextensionsjupyter contrib nbextension install --user</code></pre><p>è¿è¡Œ<code>Jupyter Notebook</code>, åœ¨æ‰“å¼€çš„<code>Notebook</code>ç•Œé¢é‡Œ, ä½ ä¼šå‘ç°å¤šäº†ä¸€ä¸ª<code>Nbextensions</code>,ç‚¹å‡»è¿™ä¸ª<code>tab</code>å‹¾é€‰<code>Table of Contents</code> (æœ‰çš„ç‰ˆæœ¬æ˜¯<code>toc2</code>). ç„¶ååˆ›å»ºæˆ–è€…æ‰“å¼€ä¸€ä¸ª<code>Jupter Notebook</code>ã€‚</p></li><li><p>éƒ¨ç½²ä¸åŒç‰ˆæœ¬çš„spark jupyter-notes</p></li></ol><p>ä¸ºäº†ä½¿ç”¨<code>jupyter</code>å¼€å‘<code>spark</code>,éœ€è¦å¯¹<code>spark</code>çš„<code>jupyter</code>ç¯å¢ƒè¿›è¡Œå¼€å‘,ä¸€èˆ¬å¯ä»¥ä½¿ç”¨<code>toree</code>è¿›è¡Œå®‰è£…ï¼Œæ–¹ä¾¿å¿«æ·ã€‚ä¹Ÿå¯ä»¥å®‰è£…ç»„ä»¶,ä½†æ˜¯ç›¸å¯¹å¤æ‚ã€‚ä½¿ç”¨<code>apache</code>çš„<code>toree</code>æ¥å®‰è£…<code>jupyter-scala</code>å’Œ<code>jupyter-spark</code>ï¼Œå¾ˆæ–¹ä¾¿å®ç”¨ã€‚æ—¢å¯ä»¥å®‰è£…<code>pyspark</code>è¿˜æ˜¯å¯ä»¥å®‰è£…<code>scala</code>ç‰ˆæœ¬çš„<code>jupyter-spark</code>ã€‚ä¸»è¦å®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre><code>pip install toree   # å®‰è£…toree`åŒ…jupyter toree install --spark_home=$SPARK_HOME  # ç”¨æˆ·jupyteré…ç½®Apache Toree&quot;&quot;&quot;    $ jupyter kernelspec list    Available kernels:    python3 /Users/myuser/Library/Jupyter/kernels/python3    apache_toree_scala /usr/local/share/jupyter/kernels/apache_toree_scala&quot;&quot;&quot;# å®‰è£…jupyter notebook å’Œ pysparkjupyter toree install --interpreters=PySparkorjupyter toree install --spark_home=$SPARK_HOME --interpreters=PySparkorjupyter toree install --spark_home=$SPARK_HOME --interpreters=Scala,PySpark,SparkR,SQL</code></pre>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jupyter</tag>
      
      <tag>spark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sparkä¸­åˆ›å»ºRDDçš„å‡ ç§æ–¹å¼</title>
    <link href="/2017/07/09/spark%E4%B8%AD%E5%88%9B%E5%BB%BARDD%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
    <url>/2017/07/09/spark%E4%B8%AD%E5%88%9B%E5%BB%BARDD%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>åˆ›å»º<code>RDD</code>ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼šä»å¤–éƒ¨æ•°æ®åˆ›å»º<code>RDD</code>ï¼Œä»å¦å¤–ä¸€ä¸ª<code>RDD</code>åˆ›å»ºï¼Œå¯¹ç°æœ‰çš„æ•°æ®åˆ—è¡¨æˆ–è€…æ•°æ®é›†åˆè¿›è¡Œåˆ›å»ºã€‚ä¸‰ç§æ–¹å¼å‡èƒ½å¤Ÿåˆ›å»º<code>RDD</code>å¯¹è±¡ã€‚<code>RDD</code>å¯ä»¥åŒ…å«<code>Scala</code>ï¼Œ<code>Python</code>ï¼Œ<code>Java</code>çš„ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œå› æ­¤ä»»ä½•æ•°æ®å‡å¯ä»¥åˆ›å»º<code>RDD</code>ã€‚<code>spark</code>åˆ›å»º<code>RDD</code>æ—¶é¦–å…ˆéœ€è¦é€šè¿‡<code>SpakContext</code>ä½œä¸ºå¯¹è±¡ï¼Œåˆ›å»ºä¸€ä¸ª<code>sc</code>å¯¹è±¡ï¼Œå†é€šè¿‡<code>sc</code>æ¥åˆ›å»º<code>RDD</code>ã€‚<code>sc</code>å¯¹è±¡ä¹‹å‰å¯ä»¥é€šè¿‡<code>sparkconf</code>å¯¹è±¡å¯¹<code>SpakContex</code>tè¿›è¡Œè®¾ç½®ã€‚å¦‚é›†ç¾¤çš„<code>URL</code>å’Œåº”ç”¨åç­‰ç­‰ã€‚ä¸‹é¢æ˜¯å¯¹<code>SpakContext</code>å¯¹è±¡è®¾ç½®ã€‚å¦‚ä¸‹ï¼š</p><pre><code class="python">from pyspark import SparkContext, SparkConfconf = SparkConf().setAppName(&quot;test&quot;).setMaster(&quot;local&quot;).setSparkHome(&quot;/opt/spark1.6.0/&quot;)sc = SparkContext(conf=conf)</code></pre><p>ä¸Šé¢é€šè¿‡<code>SparkConf</code>å¯¹è±¡è®¾ç½®äº†<code>conf</code>. å†åˆ›å»º<code>sc</code>å¯¹è±¡ï¼Œå¹¶å°†è®¾ç½®ä¼ ç»™<code>sc</code>å¯¹è±¡ã€‚<code>SparkConf</code>å¯¹è±¡çš„æ–¹æ³•æœ‰ï¼š<code>set(key,value),setIfMissing(key,value),setMaster(value),setAppName(value)ï¼ŒsetSparkHome(value)ï¼ŒsetExecutorEnv(key=None, value=None, pairs=None)ï¼ŒsetAll(pairs)</code>å¹¶å¯¹åº”äº†<code>get</code>æ–¹æ³•ã€‚</p><a id="more"></a><ul><li><strong>å¤–éƒ¨æ•°æ®åˆ›å»ºRDD</strong></li></ul><p><code>spark</code>æä¾›å¾ˆå¤šå¤–éƒ¨æ•°æ®åˆ›å»ºçš„æ¥å£ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºçš„<code>textFile</code>.è¿˜æœ‰<code>hadoopFile</code>,<code>pickleFile</code>ä»¥åŠ<code>sqlContext.jsonFile</code>ï¼Œè¿˜æä¾›<code>sql</code>ä»¥åŠ<code>hadoop</code>çš„æ¥å£ã€‚åŸºæœ¬åŒ…å«äº†ä¸»è¦çš„æ•°æ®æ ¼å¼çš„è¯»å…¥æ¥å£ã€‚ä¸‹é¢æ˜¯é€šè¿‡<code>textFile</code>å¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œåˆ›å»º<code>RDD</code>ã€‚</p><pre><code class="python">from pyspark import SparkContextfrom pyspark.mllib import classificationfrom pyspark.mllib.regression import LabeledPointfrom pyspark.mllib.evaluation import BinaryClassificationMetricslogFile = &quot;/opt/spark1.6.0/data/mllib/sample_svm_data.txt&quot;sc = SparkContext(&quot;local&quot;, &quot;Simple App&quot;)logData = sc.textFile(logFile)sc.stop()</code></pre><ul><li><strong>ä»é›†åˆæ•°æ®ä¸­åˆ›å»ºRDD</strong></li></ul><p>æ¯”å¦‚ä»<code>Python</code>çš„<code>array</code>ä¸­åˆ›å»º<code>RDD</code>ã€‚è¿™ç§åˆ›å»ºæ–¹å¼ä¸ºæœ€ç®€å•çš„ä¸€ç§æ–¹å¼ã€‚ç›´æ¥é€šè¿‡<code>SpakContext</code>çš„<code>paralleliza()</code>æ–¹æ³•å³å¯ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¿«é€Ÿçš„åˆ›å»º<code>RDD</code>å¯¹è±¡ï¼Œå†å¯¹<code>RDD</code>å¯¹è±¡è¿›è¡Œè½¬åŒ–æ“ä½œåŠè¡ŒåŠ¨æ“ä½œç­‰ç­‰ã€‚ä¸‹é¢ä¾‹å­ä¸­å°±æ˜¯é€šè¿‡<code>paralleliza</code>æ–¹æ³•åˆ›å»º<code>RDD</code>ã€‚</p><pre><code class="python">#!/usr/bin/env python# _*_ coding:utf8 _*_from sklearn.datasets import load_irisfrom pyspark import SparkContext, SparkConfconf = SparkConf().setAppName(&quot;test&quot;).setMaster(&quot;local&quot;).setSparkHome(&quot;/opt/spark1.6.0/&quot;)sc = SparkContext(conf=conf)data_set = load_iris()data = data_set[&quot;data&quot;]spark_data = sc.parallelize(data)print spark_data.collect()sc.stop()</code></pre><ul><li><strong>ä»å…¶ä»–RDDåˆ›å»º</strong></li></ul><p>è¿™ç§åˆ›å»ºæ–¹å¼ä¹Ÿç›¸å¯¹ç®€å•ï¼Œä¾¿æ·ã€‚æ¯”å¦‚<code>RDD</code>çš„è½¬åŒ–æ“ä½œä¾¿æ˜¯è¿™æ ·çš„æ“ä½œã€‚ä¸‹é¢å°±ä¸å†å¯¹è¯¥ä¸­æ–¹å¼è¿›è¡Œä¸¾ä¾‹è¯´æ˜ã€‚<br>åœ¨<code>spark</code>ä¸­ä¹Ÿæä¾›äº†<code>dataframe</code>ç±»å‹çš„æ¥å£ã€‚å¯ä»¥åˆ›å»º<code>dataframe</code>,å’Œ<code>pandas</code>ä¸‹çš„<code>dataframe</code>éå¸¸ç›¸ä¼¼ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šç›¸åŒçš„æ“ä½œã€‚åˆ›å»ºçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¯ä»¥ä»æ•°æ®åº“ä¸­åˆ›å»ºï¼Œå¦‚<code>mysqlï¼Œhiveï¼Œhdfsï¼Œjson</code>ç­‰ç­‰ã€‚ä¸‹é¢æ˜¯å„ä¸ªæ¥å£åˆ›å»º<code>dataframe</code>çš„ä¾‹å­ã€‚</p><pre><code class="python"># ä»Hiveä¸­çš„usersè¡¨æ„é€ DataFrameusers = sqlContext.table(&quot;users&quot;)# åŠ è½½S3ä¸Šçš„JSONæ–‡ä»¶logs = sqlContext.load(&quot;s3n://path/to/data.json&quot;, &quot;json&quot;)# åŠ è½½HDFSä¸Šçš„Parquetæ–‡ä»¶clicks = sqlContext.load(&quot;hdfs://path/to/data.parquet&quot;, &quot;parquet&quot;)# é€šè¿‡JDBCè®¿é—®MySQLcomments = sqlContext.jdbc(&quot;jdbc:mysql://localhost/comments&quot;, &quot;user&quot;)# å°†æ™®é€šRDDè½¬å˜ä¸ºDataFramerdd = sparkContext.textFile(&quot;article.txt&quot;) \                  .flatMap(lambda line: line.split()) \                  .map(lambda word: (word, 1)) \                  .reduceByKey(lambda a, b: a + b) \wordCounts = sqlContext.createDataFrame(rdd, [&quot;word&quot;, &quot;count&quot;])# å°†æœ¬åœ°æ•°æ®å®¹å™¨è½¬å˜ä¸ºDataFramedata = [(&quot;Alice&quot;, 21), (&quot;Bob&quot;, 24)]people = sqlContext.createDataFrame(data, [&quot;name&quot;, &quot;age&quot;])# å°†Pandas DataFrameè½¬å˜ä¸ºSpark DataFrameï¼ˆPython APIç‰¹æœ‰åŠŸèƒ½ï¼‰sparkDF = sqlContext.createDataFrame(pandasDF)# å®Œæ•´çš„ä¾‹å­#!/usr/bin/env python# _*_ coding:utf-8 _*_from sklearn.datasets import load_irisfrom pyspark import SparkContext, SparkConf, SQLContextimport pandas as pdconf = SparkConf().setAppName(&quot;test&quot;).setMaster(&quot;local&quot;).setSparkHome(&quot;/opt/spark-1.6.0/&quot;)sc = SparkContext(conf=conf)data_set = load_iris()data = data_set[&quot;data&quot;]df = pd.DataFrame(data=data)s_data = SQLContext(sc).createDataFrame(df)print s_data.count()print s_data.schema, s_data.columnssc.stop()</code></pre><p>è‹¥è¦æ”¶é›†<code>RDD</code>ä¸­çš„ä¿¡æ¯å¯ä»¥ä½¿ç”¨<code>token</code>æ–¹æ³•ï¼Œå¯¹<code>RDD</code>çš„å¯¹è±¡è¿›è¡Œæ”¶é›†ï¼Œå…¥ä¸‹ï¼š</p><pre><code class="python">for line in s_data.take(10):    print line</code></pre>]]></content>
    
    
    <categories>
      
      <category>spark</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spark</tag>
      
      <tag>RDD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockeréƒ¨ç½²anacondaå¼€å‘ç¯å¢ƒ</title>
    <link href="/2017/07/09/docker%E9%83%A8%E7%BD%B2anaconda%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    <url>/2017/07/09/docker%E9%83%A8%E7%BD%B2anaconda%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<p>ç”±äºåœ¨å·¥ä½œä¸­ä½¿ç”¨<code>docker</code>éƒ¨ç½²ä¸€ä¸ªç§‘å­¦è®¡ç®—çš„ç¯å¢ƒ<code>anaconda</code>ï¼Œå¦‚ï¼š<code>docker run -d -p 50001:22 anaconda2:ssh /usr/sbin/sshd -D</code>ï¼Œå¯ä»¥ç®€å•çš„ç”¨è„šæœ¬å¯åŠ¨ä¸€ä¸ªæŒ‡å®šæœ¬åœ°ç«¯å£æ˜ å°„åˆ°å®¹å™¨<code>22</code>ç«¯å£çš„ä¸€ä¸ªå®¹å™¨ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿæˆå¤šä¸ªå®¹å™¨æ—¶ã€‚å› æ­¤ä½¿ç”¨<code>python</code>å†™ä¸€ä¸ªè„šæœ¬èƒ½å¤Ÿå®ç°è¯¥åŠŸèƒ½ã€‚é¿å…åœ¨å·¥ä½œä¸­é‡å¤ä½¿ç”¨<code>docker run</code>çš„å‘½ä»¤æ¥ç”Ÿæˆå®¹å™¨ã€‚è¯¥è„šæœ¬è¿˜å¯ä»¥æ‰©å±•ä¸€äº›åŠŸèƒ½ï¼Œå¦‚è·å–å®¹å™¨çš„è™šæ‹Ÿ<code>IP</code>ï¼Œè·å–å®¹å™¨çš„åç§°å’Œå®¹å™¨<code>ID</code>ï¼Œå¯¹å®¹å™¨çš„æ“ä½œç­‰ç­‰ã€‚<a id="more"></a>ä¸‹é¢ä¸ºå®ç°çš„è„šæœ¬ï¼š</p><pre><code class="python">#!/usr/bin/pythonfrom __future__ import print_functionimport commandsfrom optparse import OptionParserimport sysdef check_stats(stats_code):    if not stats_code:        return True    return Falseparse = OptionParser()parse.add_option(&quot;-p&quot;, &quot;--port&quot;, action=&quot;store&quot;, dest=&quot;port&quot;, help=&quot;Config location host port.&quot;)parse.add_option(&quot;-i&quot;, &quot;--image&quot;, action=&quot;store&quot;, dest=&quot;image_name&quot;,                help=&quot;The image&#39;s name, use generate docker container.&quot;)parse.add_option(&quot;-s&quot;, &quot;--stop&quot;, action=&quot;store&quot;, dest=&quot;container_id&quot;,                help=&quot;Stop the container from give container&#39;s id.&quot;)option, args = parse.parse_args()if len(args) == 1:    print(args, &quot;The number of args is 1, must have many parameter.&quot;)if option.port:    stats, process_line = commands.getstatusoutput(&quot;ps aux | grep daemon | grep docker | grep -v grep&quot;)    if not stats:        start_stats, _ = commands.getstatusoutput(&quot;service docker restart&quot;)        if check_stats(start_stats):            print(&quot;The docker daemon service start success.&quot;)        else:            print(&quot;The docker daemon service start error.&quot;)            sys.exit(1)    image_name = option.image_name if option.image_name else &#39;anaconda2-ssh:ssh&#39;    stat, values = commands.getstatusoutput(&quot;docker run -d -p {0}:22 {1} /usr/sbin/sshd -D&quot;.                                            format(option.port, image_name))    if check_stats(stat):        container_id = commands.getoutput(&quot;docker ps -l -q&quot;)        print(container_id)    else:        print(&quot;Failed to create container.&quot;)        sys.exit(1)elif option.container_id:    mask_code, output_value = commands.getstatusoutput(&quot;docker stop {0}&quot;.format(option.container_id))    if check_stats(mask_code):        print(&quot;The container({0}) stop success.&quot;.format(option.container_id))    else:        print(&quot;Failed to stop container({0}).&quot;.format(option.container_id))        sys.exit(1)else:    print(&quot;This script use error. Reference: \n Usage: file.py [options]&quot;)    sys.exit(1)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>anaconda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨sparkè¯»å–mysqlæ•°æ®åº“æ•°æ®è½¬åŒ–ä¸ºdataframe</title>
    <link href="/2017/07/08/%E4%BD%BF%E7%94%A8spark%E8%AF%BB%E5%8F%96mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E8%BD%AC%E5%8C%96%E4%B8%BAdataframe/"/>
    <url>/2017/07/08/%E4%BD%BF%E7%94%A8spark%E8%AF%BB%E5%8F%96mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E8%BD%AC%E5%8C%96%E4%B8%BAdataframe/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨<code>spark</code>ä¸­çš„æ¥å£è¿æ¥<code>mysql</code>æ•°æ®åº“å¹¶è¯»å–å¹¶æŸ¥è¯¢å‡ºæ•°æ®åº“ä¸­çš„æ•°æ®å¹¶è½¬åŒ–ä¸º<code>spark</code>ä¸­çš„<code>dataframe</code>æ ¼å¼çš„<code>RDD</code>ã€‚å…¶ä¸­å®ç°äº†ä¸¤ç§æ–¹å¼æŸ¥è¯¢æ•°æ®ï¼Œä¸€ç§å•è¡¨æŸ¥è¯¢å’Œå¦å¤–ä¸€ç§çš„å¤šè¡¨å…³è”æŸ¥è¯¢æ•°æ®ã€‚å…¶ä¸­ä½¿ç”¨çš„æ–¹å¼åœ¨ä¸‹é¢ä»£ç çš„<code>main</code>å‡½æ•°ä¸­ã€‚<a id="more"></a></p><pre><code class="java">import org.apache.spark.SparkConfimport org.apache.spark.SparkContextimport org.apache.spark.sql.SQLContextclass sparkConnectMySQL(host: String, user: String, password: String) {    private val conf = new SparkConf().setMaster(&quot;local&quot;).setAppName(&quot;connection&quot;)    private val sc = new SparkContext(conf)    private var port = &quot;3306&quot;    private var database = &quot;situation&quot;    def this(host: String, user: String, password: String, port:String) {        this(host: String, user: String, password: String)        this.port = port    }    def this(host: String, user: String, password: String, port:String, database:String) {        this(host: String, user: String, password: String, port:String)        this.database = database    }    assert(host.isInstanceOf[String], println(&quot;The host must be string type.&quot;))    val jdbcURL = &quot;jdbc:mysql://&quot; + host + &quot;:&quot; + port + &quot;/&quot; + database  // ?user=root&amp;password=root123    val sqlContext = new SQLContext(sc)    def query(tableName:String, sqlScript:String, registerTable:String): org.apache.spark.sql.DataFrame = {        /**          * THis method is query one table, default table name: temp, this is register temp table name.          * tableName =&gt; The table&#39;s truth name in database.          * sqlScript =&gt; mySQL script.          * registerTable =&gt; create temp table name.          */        val execute = sqlContext.read.format(&quot;jdbc&quot;).options(Map(&quot;url&quot; -&gt; this.jdbcURL, &quot;dbtable&quot; -&gt; tableName,            &quot;user&quot; -&gt; user, &quot;password&quot; -&gt; password)).load()        execute.registerTempTable(registerTable)        execute.sqlContext.sql(sqlScript)  /* return DataFrame type class */    }    def queryMany(tableName:Array[String], sqlScript:String, registerTable:Array[String]): org.apache.spark.sql.DataFrame = {        /**          * THis method is query many table by join, default table name: temp, this is register temp table name.          * tableName&#39;s size as same as registerTable size.          * tableName =&gt; The table&#39;s truth name of array in database.          * sqlScript =&gt; mySQL script.          */        val tableZipRegister = tableName.zip(registerTable)        for ((name, temp) &lt;- tableZipRegister) {            val execute = sqlContext.read.format(&quot;jdbc&quot;).options(Map(&quot;url&quot; -&gt; this.jdbcURL, &quot;dbtable&quot; -&gt; name,                &quot;user&quot; -&gt; user, &quot;password&quot; -&gt; password)).load()            execute.registerTempTable(temp)        }        sqlContext.sql(sqlScript)    }}object sparkConnectTest{    def main(args: Array[String]): Unit ={        val scm = new sparkConnectMySQL(host = &quot;10.4.5.125&quot;, user = &quot;root&quot;, password = &quot;root123&quot;)        // use method example:        val dataframe = scm.query(tableName = &quot;BUG_ANALYZER_RESULT&quot;, sqlScript = &quot;select * from TEMP1&quot;, registerTable = &quot;TEMP1&quot;)        val frame = scm.queryMany(tableName = Array(&quot;GUARD_VIRUS_SCAN&quot;, &quot;GUARD_VIRUS_SCAN&quot;),                                  sqlScript = &quot;select a.scan_id,a.imei, b.app_name from temp1 a, temp2 b where a.scan_id = b.scan_id &quot;,                                  registerTable=Array(&quot;temp1&quot;, &quot;temp2&quot;))        dataframe.collect().take(10).foreach(println)        frame.collect().take(10).foreach(println)    }}</code></pre>]]></content>
    
    
    <categories>
      
      <category>spark</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spark</tag>
      
      <tag>RDD</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç‰¹å¾å¯è§†åŒ–å’Œç‰¹å¾é™ç»´ç®—æ³•T-SNEæ¨¡å‹è¯¦è§£</title>
    <link href="/2017/07/06/%E7%89%B9%E5%BE%81%E5%8F%AF%E8%A7%86%E5%8C%96%E5%92%8C%E7%89%B9%E5%BE%81%E9%99%8D%E7%BB%B4%E7%AE%97%E6%B3%95T-SNE%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/"/>
    <url>/2017/07/06/%E7%89%B9%E5%BE%81%E5%8F%AF%E8%A7%86%E5%8C%96%E5%92%8C%E7%89%B9%E5%BE%81%E9%99%8D%E7%BB%B4%E7%AE%97%E6%B3%95T-SNE%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<blockquote><p>T-SNE(<code>t-distributed stochastic neighbor embedding</code>)æ˜¯ç”¨äºé™ç»´çš„ä¸€ç§æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œæ˜¯ç”± Laurens van der Maaten å’Œ Geoffrey Hintonåœ¨08å¹´æå‡ºæ¥ã€‚æ­¤å¤–ï¼Œ<code>t-SNE</code> æ˜¯ä¸€ç§éçº¿æ€§é™ç»´ç®—æ³•ï¼Œéå¸¸é€‚ç”¨äºé«˜ç»´æ•°æ®é™ç»´åˆ°2ç»´æˆ–è€…3ç»´ï¼Œè¿›è¡Œå¯è§†åŒ–ã€‚t-SNEæ˜¯ç”±SNE(<code>Stochastic Neighbor Embedding, SNE; Hinton and Roweis</code>, 2002)å‘å±•è€Œæ¥ã€‚æˆ‘ä»¬å…ˆä»‹ç»SNEçš„åŸºæœ¬åŸç†ï¼Œä¹‹åå†æ‰©å±•åˆ°t-SNEã€‚æœ€åå†çœ‹ä¸€ä¸‹t-SNEçš„å®ç°ä»¥åŠä¸€äº›ä¼˜åŒ–ã€‚</p></blockquote><a id="more"></a><h2 id="1-SNE"><a href="#1-SNE" class="headerlink" title="1. SNE"></a>1. SNE</h2><h3 id="1-1-åŸºæœ¬åŸç†"><a href="#1-1-åŸºæœ¬åŸç†" class="headerlink" title="1.1 åŸºæœ¬åŸç†"></a>1.1 åŸºæœ¬åŸç†</h3><p>SNEæ˜¯é€šè¿‡ä»¿å°„(<code>affinitie</code>)å˜æ¢å°†æ•°æ®ç‚¹æ˜ å°„åˆ°æ¦‚ç‡åˆ†å¸ƒä¸Šï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>SNEæ„å»ºä¸€ä¸ªé«˜ç»´å¯¹è±¡ä¹‹é—´çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—ç›¸ä¼¼çš„å¯¹è±¡æœ‰æ›´é«˜çš„æ¦‚ç‡è¢«é€‰æ‹©ï¼Œè€Œä¸ç›¸ä¼¼çš„å¯¹è±¡æœ‰è¾ƒä½çš„æ¦‚ç‡è¢«é€‰æ‹©ã€‚</li><li>SNEåœ¨ä½ç»´ç©ºé—´é‡Œåœ¨æ„å»ºè¿™äº›ç‚¹çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—è¿™ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´å°½å¯èƒ½çš„ç›¸ä¼¼ã€‚</li></ul><p>æˆ‘ä»¬çœ‹åˆ°<code>t-SNE</code>æ¨¡å‹æ˜¯éç›‘ç£çš„é™ç»´ï¼Œä»–è·Ÿ<code>kmeans</code>ç­‰ä¸åŒï¼Œä»–ä¸èƒ½é€šè¿‡è®­ç»ƒå¾—åˆ°ä¸€äº›ä¸œè¥¿ä¹‹åå†ç”¨äºå…¶å®ƒæ•°æ®ï¼ˆæ¯”å¦‚<code>kmeans</code>å¯ä»¥é€šè¿‡è®­ç»ƒå¾—åˆ°kä¸ªç‚¹ï¼Œå†ç”¨äºå…¶å®ƒæ•°æ®é›†ï¼Œè€Œ<code>t-SNE</code>åªèƒ½å•ç‹¬çš„å¯¹æ•°æ®åšæ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ä»–åªæœ‰<code>fit\_transform</code>ï¼Œè€Œæ²¡æœ‰<code>fit</code>æ“ä½œï¼‰</p><h3 id="1-2-SNEåŸç†æ¨å¯¼"><a href="#1-2-SNEåŸç†æ¨å¯¼" class="headerlink" title="1.2 SNEåŸç†æ¨å¯¼"></a>1.2 SNEåŸç†æ¨å¯¼</h3><p><code>SNE</code>æ˜¯å…ˆå°†æ¬§å‡ é‡Œå¾—è·ç¦»è½¬æ¢ä¸ºæ¡ä»¶æ¦‚ç‡æ¥è¡¨è¾¾ç‚¹ä¸ç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚å…·ä½“æ¥è¯´ï¼Œç»™å®šä¸€ä¸ªNä¸ªé«˜ç»´çš„æ•°æ®$x_1,â€¦,x_n$æ³¨ï¼ˆæ„Nä¸æ˜¯ç»´åº¦ï¼‰, <code>t-SNE</code>é¦–å…ˆæ˜¯è®¡ç®—æ¦‚ç‡$p_{ij}$)ï¼Œæ­£æ¯”äº$x_i$å’Œ$x_j$ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼ˆè¿™ç§æ¦‚ç‡æ˜¯æˆ‘ä»¬è‡ªä¸»æ„å»ºçš„ï¼‰ï¼Œå³ï¼š<br>$${p_ {j \mid i} = \frac{\exp(- \mid  \mid  x_i -x_j  \mid  \mid  ^2 / (2 \sigma^2_i ))} {\sum_{k \neq i} \exp(- \mid  \mid  x_i - x_k  \mid  \mid  ^2 / (2 \sigma^2_i))}}$$<br>è¿™é‡Œçš„æœ‰ä¸€ä¸ªå‚æ•°æ˜¯$\sigma_i$ï¼Œå¯¹äºä¸åŒçš„ç‚¹$x_i$å–å€¼ä¸ä¸€æ ·ï¼Œåç»­ä¼šè®¨è®ºå¦‚ä½•è®¾ç½®ã€‚æ­¤å¤–è®¾ç½®$p_{x|x}=0$,å› ä¸ºæˆ‘ä»¬å…³æ³¨çš„æ˜¯ä¸¤ä¸¤ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚é‚£å¯¹äºä½ç»´åº¦ä¸‹çš„$y_i$ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šé«˜æ–¯åˆ†å¸ƒä¸ºæ–¹å·®ä¸º$\frac{1}{\sqrt{2}}$ï¼Œå› æ­¤å®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼åº¦å¦‚ä¸‹:<br>$${q_ {j \mid i} = \frac{\exp(- \mid  \mid  x_i -x_j  \mid  \mid  ^2)} {\sum_{k \neq i} \exp(- \mid  \mid  x_i - x_k  \mid  \mid  ^2)}}$$<br>åŒæ ·ï¼Œè®¾å®š$q_{i|i}=0$ã€‚å¦‚æœé™ç»´çš„æ•ˆæœæ¯”è¾ƒå¥½ï¼Œå±€éƒ¨ç‰¹å¾ä¿ç•™å®Œæ•´ï¼Œé‚£ä¹ˆ$p_{i \mid j} = q_{i \mid j}$, å› æ­¤æˆ‘ä»¬ä¼˜åŒ–ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„è·ç¦»-KLæ•£åº¦(<code>Kullback-Leibler divergences</code>)ï¼Œé‚£ä¹ˆç›®æ ‡å‡½æ•°(<code>cost function</code>)å¦‚ä¸‹:<br>$$C = \sum_i KL(P_i  \mid  \mid  Q_i) = \sum_i \sum_j p_{j \mid i} \log \frac{p_{j \mid i}}{q_{j \mid i}}$$<br>è¿™é‡Œçš„$p_i$è¡¨ç¤ºäº†ç»™å®šç‚¹$x_i$ä¸‹ï¼Œå…¶ä»–æ‰€æœ‰æ•°æ®ç‚¹çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯<strong>KLæ•£åº¦å…·æœ‰ä¸å¯¹ç§°æ€§</strong>ï¼Œåœ¨ä½ç»´æ˜ å°„ä¸­ä¸åŒçš„è·ç¦»å¯¹åº”çš„æƒ©ç½šæƒé‡æ˜¯ä¸åŒçš„ï¼Œå…·ä½“æ¥è¯´ï¼šè·ç¦»è¾ƒè¿œçš„ä¸¤ä¸ªç‚¹æ¥è¡¨è¾¾è·ç¦»è¾ƒè¿‘çš„ä¸¤ä¸ªç‚¹ä¼šäº§ç”Ÿæ›´å¤§çš„<code>cost</code>ï¼Œç›¸åï¼Œç”¨è¾ƒè¿‘çš„ä¸¤ä¸ªç‚¹æ¥è¡¨è¾¾è¾ƒè¿œçš„ä¸¤ä¸ªç‚¹äº§ç”Ÿçš„<code>cost</code>ç›¸å¯¹è¾ƒå°(æ³¨æ„ï¼šç±»ä¼¼äºå›å½’å®¹æ˜“å—å¼‚å¸¸å€¼å½±å“ï¼Œä½†æ•ˆæœç›¸å)ã€‚å³ç”¨è¾ƒå°çš„ $q_{j \mid i}=0.2$æ¥å»ºæ¨¡è¾ƒå¤§çš„ $p_{j \mid i}=0.8$ï¼Œ$cost=p \log(\frac{p}{q})=1.11$,åŒæ ·ç”¨è¾ƒå¤§çš„$q_{j \mid i}=0.8$æ¥å»ºæ¨¡è¾ƒå°çš„$p_{j \mid i}=0.2$, $cost=-0.277$, å› æ­¤ï¼Œ<strong><code>SNE</code>ä¼šå€¾å‘äºä¿ç•™æ•°æ®ä¸­çš„å±€éƒ¨ç‰¹å¾</strong>ã€‚</p><blockquote><p><strong>æ€è€ƒ:äº†è§£äº†åŸºæœ¬æ€è·¯ä¹‹åï¼Œä½ ä¼šæ€ä¹ˆé€‰æ‹©$\sigma$ï¼Œå›ºå®šåˆå§‹åŒ–?</strong></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹æ­£å¼çš„æ¨å¯¼SNEã€‚é¦–å…ˆä¸åŒçš„ç‚¹å…·æœ‰ä¸åŒçš„$\sigma_i$ï¼Œ$P_i$çš„ç†µ(<code>entropy</code>)ä¼šéšç€$\sigma_i$çš„å¢åŠ è€Œå¢åŠ ã€‚<code>SNE</code>ä½¿ç”¨å›°æƒ‘åº¦(<code>perplexity</code>)çš„æ¦‚å¿µï¼Œç”¨äºŒåˆ†æœç´¢çš„æ–¹å¼æ¥å¯»æ‰¾ä¸€ä¸ªæœ€ä½³çš„$\sigma$ã€‚å…¶ä¸­å›°æƒ‘åº¦æŒ‡:<br>$$Perp(P_i) = 2^{H(P_i)}$$<br>è¿™é‡Œçš„$H(P_i)$æ˜¯$P_i$çš„ç†µï¼Œå³:<br>$$H(P_i) = -\sum_j p_{j \mid i} \log_2 p_{j \mid i}$$<br>å›°æƒ‘åº¦å¯ä»¥è§£é‡Šä¸ºä¸€ä¸ªç‚¹é™„è¿‘çš„æœ‰æ•ˆè¿‘é‚»ç‚¹ä¸ªæ•°ã€‚<code>SNE</code>å¯¹å›°æƒ‘åº¦çš„è°ƒæ•´æ¯”è¾ƒæœ‰é²æ£’æ€§ï¼Œé€šå¸¸é€‰æ‹©<code>5-50</code>ä¹‹é—´ï¼Œç»™å®šä¹‹åï¼Œä½¿ç”¨äºŒåˆ†æœç´¢çš„æ–¹å¼å¯»æ‰¾åˆé€‚çš„$\sigma$ã€‚<br>é‚£ä¹ˆæ ¸å¿ƒé—®é¢˜æ˜¯å¦‚ä½•æ±‚è§£æ¢¯åº¦äº†,ç›®æ ‡å‡½æ•°ç­‰ä»·äº$\sum \sum - p log(q)$è¿™ä¸ªå¼å­ä¸<code>softmax</code>éå¸¸çš„ç±»ä¼¼ï¼Œæˆ‘ä»¬çŸ¥é“<code>softmax</code>çš„ç›®æ ‡å‡½æ•°æ˜¯$\sum -y \log p$ï¼Œå¯¹åº”çš„æ¢¯åº¦æ˜¯$y - p$(æ³¨ï¼šè¿™é‡Œçš„<code>softmax</code>ä¸­<code>y</code>è¡¨ç¤º<code>label</code>ï¼Œ<code>p</code>è¡¨ç¤ºé¢„ä¼°å€¼)ã€‚ åŒæ ·æˆ‘ä»¬å¯ä»¥æ¨å¯¼<code>SNE</code>çš„ç›®æ ‡å‡½æ•°ä¸­çš„<code>i</code>åœ¨<code>j</code>ä¸‹çš„æ¡ä»¶æ¦‚ç‡æƒ…å†µçš„æ¢¯åº¦æ˜¯$2(p_{j \mid i}-q_{j \mid i})(y_i-y_j)$ï¼Œ åŒæ ·<code>j</code>åœ¨<code>i</code>ä¸‹çš„æ¡ä»¶æ¦‚ç‡çš„æ¢¯åº¦æ˜¯$2(p_{j \mid i}-q_{j \mid i})(y_i-y_j)$, æœ€åå¾—åˆ°å®Œæ•´çš„æ¢¯åº¦å…¬å¼å¦‚ä¸‹:<br>$$\frac{\delta C}{\delta y_i} = 2 \sum_j (p_{j \mid i} - q_{j \mid i} + p_{i \mid j} - q_{i \mid j})(y_i - y_j)$$<br>åœ¨åˆå§‹åŒ–ä¸­ï¼Œå¯ä»¥ç”¨è¾ƒå°çš„$\sigma$ä¸‹çš„é«˜æ–¯åˆ†å¸ƒæ¥è¿›è¡Œåˆå§‹åŒ–ã€‚ä¸ºäº†åŠ é€Ÿä¼˜åŒ–è¿‡ç¨‹å’Œé¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜è§£ï¼Œæ¢¯åº¦ä¸­éœ€è¦ä½¿ç”¨ä¸€ä¸ªç›¸å¯¹è¾ƒå¤§çš„åŠ¨é‡(<code>momentum</code>)ã€‚å³å‚æ•°æ›´æ–°ä¸­é™¤äº†å½“å‰çš„æ¢¯åº¦ï¼Œè¿˜è¦å¼•å…¥ä¹‹å‰çš„æ¢¯åº¦ç´¯åŠ çš„æŒ‡æ•°è¡°å‡é¡¹ï¼Œå¦‚ä¸‹:<br>$$Y^{(t)} = Y^{(t-1)} + \eta \frac{\delta C}{\delta Y} + \alpha(t)(Y^{(t-1)} - Y^{(t-2)})$$<br>è¿™é‡Œçš„$Y^{(t)}$è¡¨ç¤ºè¿­ä»£<code>t</code>æ¬¡çš„è§£ï¼Œ$\eta$è¡¨ç¤ºå­¦ä¹ é€Ÿç‡,$\alpha(t)$è¡¨ç¤ºè¿­ä»£<code>t</code>æ¬¡çš„åŠ¨é‡ã€‚æ­¤å¤–ï¼Œåœ¨åˆå§‹ä¼˜åŒ–çš„é˜¶æ®µï¼Œæ¯æ¬¡è¿­ä»£ä¸­å¯ä»¥å¼•å…¥ä¸€äº›é«˜æ–¯å™ªå£°ï¼Œä¹‹ååƒæ¨¡æ‹Ÿé€€ç«ä¸€æ ·é€æ¸å‡å°è¯¥å™ªå£°ï¼Œå¯ä»¥ç”¨æ¥é¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜è§£ã€‚å› æ­¤ï¼Œ<code>SNE</code>åœ¨é€‰æ‹©é«˜æ–¯å™ªå£°ï¼Œä»¥åŠå­¦ä¹ é€Ÿç‡ï¼Œä»€ä¹ˆæ—¶å€™å¼€å§‹è¡°å‡ï¼ŒåŠ¨é‡é€‰æ‹©ç­‰ç­‰è¶…å‚æ•°ä¸Šï¼Œéœ€è¦è·‘å¤šæ¬¡ä¼˜åŒ–æ‰å¯ä»¥ã€‚</p><blockquote><p><strong>æ€è€ƒ:SNEæœ‰å“ªäº›ä¸è¶³ï¼Ÿ é¢å¯¹SNEçš„ä¸è¶³ï¼Œä½ ä¼šåšä»€ä¹ˆæ”¹è¿›ï¼Ÿ</strong></p></blockquote><h2 id="2-T-SNE"><a href="#2-T-SNE" class="headerlink" title="2. T-SNE"></a>2. T-SNE</h2><p>å°½ç®¡<code>SNE</code>æä¾›äº†å¾ˆå¥½çš„å¯è§†åŒ–æ–¹æ³•ï¼Œä½†æ˜¯ä»–å¾ˆéš¾ä¼˜åŒ–ï¼Œè€Œä¸”å­˜åœ¨<code>crowding problem</code>(æ‹¥æŒ¤é—®é¢˜)ã€‚åç»­ä¸­ï¼Œ<code>Hinton</code>ç­‰äººåˆæå‡ºäº†<code>t-SNE</code>çš„æ–¹æ³•ã€‚ä¸<code>SNE</code>ä¸åŒï¼Œä¸»è¦å¦‚ä¸‹:</p><ul><li>ä½¿ç”¨å¯¹ç§°ç‰ˆçš„<code>SNE</code>ï¼Œç®€åŒ–æ¢¯åº¦å…¬å¼</li><li>ä½ç»´ç©ºé—´ä¸‹ï¼Œä½¿ç”¨<code>t</code>åˆ†å¸ƒæ›¿ä»£é«˜æ–¯åˆ†å¸ƒè¡¨è¾¾ä¸¤ç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦</li></ul><p><code>t-SNE</code>åœ¨ä½ç»´ç©ºé—´ä¸‹ä½¿ç”¨æ›´é‡é•¿å°¾åˆ†å¸ƒçš„<code>t</code>åˆ†å¸ƒæ¥é¿å…<code>crowding</code>é—®é¢˜å’Œä¼˜åŒ–é—®é¢˜ã€‚åœ¨è¿™é‡Œï¼Œé¦–å…ˆä»‹ç»ä¸€ä¸‹å¯¹ç§°ç‰ˆçš„<code>SNE</code>ï¼Œä¹‹åä»‹ç»<code>crowding</code>é—®é¢˜ï¼Œä¹‹åå†ä»‹ç»<code>t-SNE</code></p><h3 id="2-1-Symmetric-SNE"><a href="#2-1-Symmetric-SNE" class="headerlink" title="2.1 Symmetric SNE"></a>2.1 Symmetric SNE</h3><p>ä¼˜åŒ–$p_{i \mid j}$å’Œ$q_{i \mid j}$çš„<code>KL</code>æ•£åº¦çš„ä¸€ç§æ›¿æ¢æ€è·¯æ˜¯ï¼Œä½¿ç”¨è”åˆæ¦‚ç‡åˆ†å¸ƒæ¥æ›¿æ¢æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒï¼Œå³<code>P</code>æ˜¯é«˜ç»´ç©ºé—´é‡Œå„ä¸ªç‚¹çš„è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œ<code>Q</code>æ˜¯ä½ç»´ç©ºé—´ä¸‹çš„ï¼Œç›®æ ‡å‡½æ•°ä¸º:<br>$$C = KL(P \mid  \mid Q) = \sum_i \sum_j p_{i,j} \log \frac{p_{ij}}{q_{ij}}$$<br>è¿™é‡Œçš„$p_{ii}$,$q_{ii}$ä¸º0ï¼Œæˆ‘ä»¬å°†è¿™ç§<code>SNE</code>ç§°ä¹‹ä¸º<code>symmetric SNE</code>(å¯¹ç§°<code>SNE</code>)ï¼Œå› ä¸ºä»–å‡è®¾äº†å¯¹äºä»»æ„<code>i</code>,$p_{ij} = p_{ji}, q_{ij} = q_{ji}$ï¼Œå› æ­¤æ¦‚ç‡åˆ†å¸ƒå¯ä»¥æ”¹å†™ä¸º:<br>$$p_{ij} = \frac{\exp(- \mid  \mid x_i - x_i \mid  \mid ^2 / 2\sigma^2)}{\sum_{k \neq l} \exp(- \mid  \mid x_i-x_j \mid  \mid ^2 / 2\sigma^2)}  \ \ \ \  q_{ij} = \frac{\exp(- \mid  \mid y_i - y_i \mid  \mid ^2)}{\sum_{k \neq l} \exp(- \mid  \mid y_i-y_j \mid  \mid ^2)}$$<br>è¿™ç§è¡¨è¾¾æ–¹å¼ï¼Œä½¿å¾—æ•´ä½“ç®€æ´äº†å¾ˆå¤šã€‚ä½†æ˜¯ä¼šå¼•å…¥å¼‚å¸¸å€¼çš„é—®é¢˜ã€‚æ¯”å¦‚$x_i$æ˜¯å¼‚å¸¸å€¼ï¼Œé‚£ä¹ˆ$âˆ£âˆ£x_iâˆ’x_jâˆ£âˆ£^2$ä¼šå¾ˆå¤§ï¼Œå¯¹åº”çš„æ‰€æœ‰çš„<code>j</code>,$p_{il}$éƒ½ä¼šå¾ˆå°(ä¹‹å‰æ˜¯ä»…åœ¨$x_i$ä¸‹å¾ˆå°)ï¼Œå¯¼è‡´ä½ç»´æ˜ å°„ä¸‹çš„$y_i$å¯¹<code>cost</code>å½±å“å¾ˆå°ã€‚</p><blockquote><p><strong>æ€è€ƒ: å¯¹äºå¼‚å¸¸å€¼ï¼Œä½ ä¼šåšä»€ä¹ˆæ”¹è¿›ï¼Ÿpipiè¡¨ç¤ºä»€ä¹ˆï¼Ÿ</strong></p></blockquote><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†è”åˆæ¦‚ç‡åˆ†å¸ƒå®šä¹‰ä¿®æ­£ä¸º: $p_{ij} = \frac{p_{i \mid j} + p_{j \mid i}}{2}$, è¿™ä¿è¯äº†$\sum_j p_{ij} \gt \frac{1}{2n}$, ä½¿å¾—æ¯ä¸ªç‚¹å¯¹äº<code>cost</code>éƒ½ä¼šæœ‰ä¸€å®šçš„è´¡çŒ®ã€‚å¯¹ç§°<code>SNE</code>çš„æœ€å¤§ä¼˜ç‚¹æ˜¯æ¢¯åº¦è®¡ç®—å˜å¾—ç®€å•äº†ï¼Œå¦‚ä¸‹:<br>$$\frac{\delta C}{\delta y_i} = 4 \sum_j (p_{ij} - q_{ij})(y_i - y_j)$$<br>å®éªŒä¸­ï¼Œå‘ç°å¯¹ç§°<code>SNE</code>èƒ½å¤Ÿäº§ç”Ÿå’Œ<code>SNE</code>ä¸€æ ·å¥½çš„ç»“æœï¼Œæœ‰æ—¶ç”šè‡³ç•¥å¥½ä¸€ç‚¹ã€‚</p><h3 id="2-2-Crowdingé—®é¢˜"><a href="#2-2-Crowdingé—®é¢˜" class="headerlink" title="2.2 Crowdingé—®é¢˜"></a>2.2 Crowdingé—®é¢˜</h3><p>æ‹¥æŒ¤é—®é¢˜å°±æ˜¯è¯´å„ä¸ªç°‡èšé›†åœ¨ä¸€èµ·ï¼Œæ— æ³•åŒºåˆ†ã€‚æ¯”å¦‚æœ‰ä¸€ç§æƒ…å†µï¼Œé«˜ç»´åº¦æ•°æ®åœ¨é™ç»´åˆ°10ç»´ä¸‹ï¼Œå¯ä»¥æœ‰å¾ˆå¥½çš„è¡¨è¾¾ï¼Œä½†æ˜¯é™ç»´åˆ°ä¸¤ç»´åæ— æ³•å¾—åˆ°å¯ä¿¡æ˜ å°„ï¼Œæ¯”å¦‚é™ç»´å¦‚10ç»´ä¸­æœ‰11ä¸ªç‚¹ä¹‹é—´ä¸¤ä¸¤ç­‰è·ç¦»çš„ï¼Œåœ¨äºŒç»´ä¸‹å°±æ— æ³•å¾—åˆ°å¯ä¿¡çš„æ˜ å°„ç»“æœ(æœ€å¤š3ä¸ªç‚¹)ã€‚ è¿›ä¸€æ­¥çš„è¯´æ˜ï¼Œå‡è®¾ä¸€ä¸ªä»¥æ•°æ®ç‚¹$x_i$ä¸ºä¸­å¿ƒï¼ŒåŠå¾„ä¸ºrçš„mç»´çƒ(ä¸‰ç»´ç©ºé—´å°±æ˜¯çƒ)ï¼Œå…¶ä½“ç§¯æ˜¯æŒ‰$r^m$å¢é•¿çš„ï¼Œå‡è®¾æ•°æ®ç‚¹æ˜¯åœ¨mç»´çƒä¸­å‡åŒ€åˆ†å¸ƒçš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä»–æ•°æ®ç‚¹ä¸$x_i$çš„è·ç¦»éšç»´åº¦å¢å¤§è€Œäº§ç”Ÿçš„å˜åŒ–ã€‚<br><img src="/uploads/f1.png" srcset="/img/loading.gif" alt=""><br>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œéšç€ç»´åº¦çš„å¢å¤§ï¼Œå¤§éƒ¨åˆ†æ•°æ®ç‚¹éƒ½èšé›†åœ¨mç»´çƒçš„è¡¨é¢é™„è¿‘ï¼Œä¸ç‚¹$x_i$çš„è·ç¦»åˆ†å¸ƒæä¸å‡è¡¡ã€‚å¦‚æœç›´æ¥å°†è¿™ç§è·ç¦»å…³ç³»ä¿ç•™åˆ°ä½ç»´ï¼Œå°±ä¼šå‡ºç°æ‹¥æŒ¤é—®é¢˜ã€‚</p><blockquote><p><strong>æ€ä¹ˆè§£å†³crowdingé—®é¢˜å‘¢?</strong></p></blockquote><p><code>Cook et al.(2007)</code> æå‡ºä¸€ç§<code>slight repulsion</code>çš„æ–¹å¼ï¼Œåœ¨åŸºçº¿æ¦‚ç‡åˆ†å¸ƒ(<code>uniform background</code>)ä¸­å¼•å…¥ä¸€ä¸ªè¾ƒå°çš„æ··åˆå› å­$\rho$,è¿™æ ·$q_{ij}$å°±æ°¸è¿œä¸ä¼šå°äº\frac{2 \rho}{n(n-1)}(å› ä¸ºä¸€å…±äº†<code>n(n-1)</code>ä¸ª<code>pairs</code>)ï¼Œè¿™æ ·åœ¨é«˜ç»´ç©ºé—´ä¸­æ¯”è¾ƒè¿œçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„$q_{ij}$æ€»æ˜¯ä¼šæ¯”$p_{ij}$å¤§ä¸€ç‚¹ã€‚è¿™ç§ç§°ä¹‹ä¸º<code>UNI-SNE</code>ï¼Œæ•ˆæœé€šå¸¸æ¯”æ ‡å‡†çš„<code>SNE</code>è¦å¥½ã€‚ä¼˜åŒ–<code>UNI-SNE</code>çš„æ–¹æ³•æ˜¯å…ˆè®©$\rho$ä¸º0ï¼Œä½¿ç”¨æ ‡å‡†çš„<code>SNE</code>ä¼˜åŒ–ï¼Œä¹‹åç”¨æ¨¡æ‹Ÿé€€ç«çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå†æ…¢æ…¢å¢åŠ $\rho$. ç›´æ¥ä¼˜åŒ–<code>UNI-SNE</code>æ˜¯ä¸è¡Œçš„(å³ä¸€å¼€å§‹$\rho$ä¸ä¸º0)ï¼Œå› ä¸ºè·ç¦»è¾ƒè¿œçš„ä¸¤ä¸ªç‚¹åŸºæœ¬æ˜¯ä¸€æ ·çš„$q_{ij}$(ç­‰äºåŸºçº¿åˆ†å¸ƒ), å³ä½¿$p_{ij}$å¾ˆå¤§ï¼Œä¸€äº›è·ç¦»å˜åŒ–å¾ˆéš¾åœ¨$q_{ij}$ä¸­äº§ç”Ÿä½œç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ä¼˜åŒ–ä¸­åˆšå¼€å§‹è·ç¦»è¾ƒè¿œçš„ä¸¤ä¸ªèšç±»ç‚¹ï¼Œåç»­å°±æ— æ³•å†æŠŠä»–ä»¬æ‹‰è¿‘äº†ã€‚</p><h3 id="2-3-t-sne"><a href="#2-3-t-sne" class="headerlink" title="2.3 t-sne"></a>2.3 t-sne</h3><p>å¯¹ç§°<code>SNE</code>å®é™…ä¸Šåœ¨é«˜ç»´åº¦ä¸‹ å¦å¤–ä¸€ç§å‡è½»â€æ‹¥æŒ¤é—®é¢˜â€çš„æ–¹æ³•ï¼šåœ¨é«˜ç»´ç©ºé—´ä¸‹ï¼Œåœ¨é«˜ç»´ç©ºé—´ä¸‹æˆ‘ä»¬ä½¿ç”¨é«˜æ–¯åˆ†å¸ƒå°†è·ç¦»è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œåœ¨ä½ç»´ç©ºé—´ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ›´åŠ åé‡é•¿å°¾åˆ†å¸ƒçš„æ–¹å¼æ¥å°†è·ç¦»è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—é«˜ç»´åº¦ä¸‹ä¸­ä½ç­‰çš„è·ç¦»åœ¨æ˜ å°„åèƒ½å¤Ÿæœ‰ä¸€ä¸ªè¾ƒå¤§çš„è·ç¦»ã€‚<br><img src="/uploads/f2.png" srcset="/img/loading.gif" alt=""><br>æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹é«˜æ–¯åˆ†å¸ƒå’Œ<code>t</code>åˆ†å¸ƒ(å¦‚ä¸Šå›¾), <code>t</code>åˆ†å¸ƒå—å¼‚å¸¸å€¼å½±å“æ›´å°ï¼Œæ‹Ÿåˆç»“æœæ›´ä¸ºåˆç†ï¼Œè¾ƒå¥½çš„æ•è·äº†æ•°æ®çš„æ•´ä½“ç‰¹å¾ã€‚ä½¿ç”¨äº†<code>t</code>åˆ†å¸ƒä¹‹åçš„<code>q</code>å˜åŒ–ï¼Œå¦‚ä¸‹:<br>$$q_{ij} = \frac{(1 +  \mid  \mid y_i -y_j \mid  \mid ^2)^{-1}}{\sum_{k \neq l} (1 +  \mid  \mid y_i -y_j \mid  \mid ^2)^{-1}}$$<br>æ­¤å¤–ï¼Œ<code>t</code>åˆ†å¸ƒæ˜¯æ— é™å¤šä¸ªé«˜æ–¯åˆ†å¸ƒçš„å åŠ ï¼Œè®¡ç®—ä¸Šä¸æ˜¯æŒ‡æ•°çš„ï¼Œä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ä¼˜åŒ–çš„æ¢¯åº¦å¦‚ä¸‹:<br>$$\frac{\delta C}{\delta y_i} = 4 \sum_j(p_{ij}-q_{ij})(y_i-y_j)(1+ \mid  \mid y_i-y_j \mid  \mid ^2)^{-1}$$<br><img src="/uploads/f3.png" srcset="/img/loading.gif" alt=""><br><code>t-sne</code>çš„æœ‰æ•ˆæ€§ï¼Œä¹Ÿå¯ä»¥ä»ä¸Šå›¾ä¸­çœ‹åˆ°ï¼šæ¨ªè½´è¡¨ç¤ºè·ç¦»ï¼Œçºµè½´è¡¨ç¤ºç›¸ä¼¼åº¦, å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºè¾ƒå¤§ç›¸ä¼¼åº¦çš„ç‚¹ï¼Œ<code>t</code>åˆ†å¸ƒåœ¨ä½ç»´ç©ºé—´ä¸­çš„è·ç¦»éœ€è¦ç¨å°ä¸€ç‚¹ï¼›è€Œå¯¹äºä½ç›¸ä¼¼åº¦çš„ç‚¹ï¼Œ<code>t</code>åˆ†å¸ƒåœ¨ä½ç»´ç©ºé—´ä¸­çš„è·ç¦»éœ€è¦æ›´è¿œã€‚è¿™æ°å¥½æ»¡è¶³äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå³åŒä¸€ç°‡å†…çš„ç‚¹(è·ç¦»è¾ƒè¿‘)èšåˆçš„æ›´ç´§å¯†ï¼Œä¸åŒç°‡ä¹‹é—´çš„ç‚¹(è·ç¦»è¾ƒè¿œ)æ›´åŠ ç–è¿œã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œt-SNEçš„æ¢¯åº¦æ›´æ–°æœ‰<strong>ä¸¤å¤§ä¼˜åŠ¿</strong>ï¼š</p><ul><li>å¯¹äºä¸ç›¸ä¼¼çš„ç‚¹ï¼Œç”¨ä¸€ä¸ªè¾ƒå°çš„è·ç¦»ä¼šäº§ç”Ÿè¾ƒå¤§çš„æ¢¯åº¦æ¥è®©è¿™äº›ç‚¹æ’æ–¥å¼€æ¥ã€‚</li><li>è¿™ç§æ’æ–¥åˆä¸ä¼šæ— é™å¤§(æ¢¯åº¦ä¸­åˆ†æ¯)ï¼Œé¿å…ä¸ç›¸ä¼¼çš„ç‚¹è·ç¦»å¤ªè¿œã€‚</li></ul><h3 id="2-4-ç®—æ³•è¿‡ç¨‹"><a href="#2-4-ç®—æ³•è¿‡ç¨‹" class="headerlink" title="2.4 ç®—æ³•è¿‡ç¨‹"></a>2.4 ç®—æ³•è¿‡ç¨‹</h3><ul><li>Data: $X = {x_1, â€¦ , x_n}$</li><li>è®¡ç®—<code>cost function</code>çš„å‚æ•°ï¼šå›°æƒ‘åº¦<code>Perp</code></li><li>ä¼˜åŒ–å‚æ•°: è®¾ç½®è¿­ä»£æ¬¡æ•°<code>T</code>ï¼Œ å­¦ä¹ é€Ÿç‡$\eta$, åŠ¨é‡$\alpha(t)$</li><li>ç›®æ ‡ç»“æœæ˜¯ä½ç»´æ•°æ®è¡¨ç¤º$Y^T = {y_1, â€¦ , y_n}$</li><li>å¼€å§‹ä¼˜åŒ–<ul><li>è®¡ç®—åœ¨ç»™å®š<code>Perp</code>ä¸‹çš„æ¡ä»¶æ¦‚ç‡$p_{j \mid i}$(å‚è§ä¸Šé¢å…¬å¼)</li><li>ä»¤ $p_{ij} = \frac{p_{j \mid i} + p_{i \mid j}}{2n}$</li><li>ç”¨N(0, 10^{-4}I)éšæœºåˆå§‹åŒ–<code>Y</code></li><li>è¿­ä»£ï¼Œä» <code>t = 1</code> åˆ° <code>T</code>ï¼Œ åšå¦‚ä¸‹æ“ä½œ:<ul><li>è®¡ç®—ä½ç»´åº¦ä¸‹çš„$q_{ij}$(å‚è§ä¸Šé¢çš„å…¬å¼)</li><li>è®¡ç®—æ¢¯åº¦ï¼ˆå‚è§ä¸Šé¢çš„å…¬å¼ï¼‰</li><li>æ›´æ–°$Y^{t} = Y^{t-1} + \eta \frac{dC}{dY} + \alpha(t)(Y^{t-1} - Y^{t-2})$</li></ul></li><li>ç»“æŸ</li></ul></li><li>ç»“æŸ</li></ul><p><strong>ä¼˜åŒ–è¿‡ç¨‹ä¸­å¯ä»¥å°è¯•çš„ä¸¤ä¸ª<code>trick</code>:</strong></p><ul><li>æå‰å‹ç¼©(<code>early compression</code>):å¼€å§‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå„ä¸ªç‚¹è¦ç¦»å¾—è¿‘ä¸€ç‚¹ã€‚è¿™æ ·å°çš„è·ç¦»ï¼Œæ–¹ä¾¿å„ä¸ªèšç±»ä¸­å¿ƒçš„ç§»åŠ¨ã€‚å¯ä»¥é€šè¿‡å¼•å…¥<code>L2</code>æ­£åˆ™é¡¹(è·ç¦»çš„å¹³æ–¹å’Œ)æ¥å®ç°ã€‚</li><li>æå‰å¤¸å¤§(<code>early exaggeration</code>)ï¼šåœ¨å¼€å§‹ä¼˜åŒ–é˜¶æ®µï¼Œ$p_{ij}$ä¹˜ä»¥ä¸€ä¸ªå¤§äº1çš„æ•°è¿›è¡Œæ‰©å¤§ï¼Œæ¥é¿å…å› ä¸º$q_{ij}$å¤ªå°å¯¼è‡´ä¼˜åŒ–å¤ªæ…¢çš„é—®é¢˜ã€‚æ¯”å¦‚å‰50æ¬¡è¿­ä»£ï¼Œ$p_{ij}$ä¹˜ä»¥4</li></ul><h3 id="2-5-ä¸è¶³"><a href="#2-5-ä¸è¶³" class="headerlink" title="2.5 ä¸è¶³"></a>2.5 ä¸è¶³</h3><p><strong>ä¸»è¦ä¸è¶³æœ‰å››ä¸ª:</strong></p><ul><li>ä¸»è¦ç”¨äºå¯è§†åŒ–ï¼Œå¾ˆéš¾ç”¨äºå…¶ä»–ç›®çš„ã€‚æ¯”å¦‚æµ‹è¯•é›†åˆé™ç»´ï¼Œå› ä¸ºä»–æ²¡æœ‰æ˜¾å¼çš„é¢„ä¼°éƒ¨åˆ†ï¼Œä¸èƒ½åœ¨æµ‹è¯•é›†åˆç›´æ¥é™ç»´ï¼›æ¯”å¦‚é™ç»´åˆ°10ç»´ï¼Œå› ä¸ºtåˆ†å¸ƒåé‡é•¿å°¾ï¼Œ1ä¸ªè‡ªç”±åº¦çš„tåˆ†å¸ƒå¾ˆéš¾ä¿å­˜å¥½å±€éƒ¨ç‰¹å¾ï¼Œå¯èƒ½éœ€è¦è®¾ç½®æˆæ›´é«˜çš„è‡ªç”±åº¦ã€‚</li><li>t-SNEå€¾å‘äºä¿å­˜å±€éƒ¨ç‰¹å¾ï¼Œå¯¹äºæœ¬å¾ç»´æ•°(intrinsic dimensionality)æœ¬èº«å°±å¾ˆé«˜çš„æ•°æ®é›†ï¼Œæ˜¯ä¸å¯èƒ½å®Œæ•´çš„æ˜ å°„åˆ°2-3ç»´çš„ç©ºé—´</li><li>t-SNEæ²¡æœ‰å”¯ä¸€æœ€ä¼˜è§£ï¼Œä¸”æ²¡æœ‰é¢„ä¼°éƒ¨åˆ†ã€‚å¦‚æœæƒ³è¦åšé¢„ä¼°ï¼Œå¯ä»¥è€ƒè™‘é™ç»´ä¹‹åï¼Œå†æ„å»ºä¸€ä¸ªå›å½’æ–¹ç¨‹ä¹‹ç±»çš„æ¨¡å‹å»åšã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œt-sneä¸­è·ç¦»æœ¬èº«æ˜¯æ²¡æœ‰æ„ä¹‰ï¼Œéƒ½æ˜¯æ¦‚ç‡åˆ†å¸ƒé—®é¢˜ã€‚</li><li>è®­ç»ƒå¤ªæ…¢ã€‚æœ‰å¾ˆå¤šåŸºäºæ ‘çš„ç®—æ³•åœ¨t-sneä¸Šåšä¸€äº›æ”¹è¿›</li></ul><h2 id="3-å˜ç§"><a href="#3-å˜ç§" class="headerlink" title="3. å˜ç§"></a>3. å˜ç§</h2><ul><li><code>multiple maps of t-SNE</code></li><li><code>parametric t-SNE</code></li><li><code>Visualizing Large-scale and High-dimensional Data</code></li></ul><h2 id="4-å‚è€ƒèµ„æ–™"><a href="#4-å‚è€ƒèµ„æ–™" class="headerlink" title="4. å‚è€ƒèµ„æ–™"></a>4. å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://www.datakit.cn/blog/2017/02/05/t_sne_full.html" target="_blank" rel="noopener">t-sneå®Œæ•´å­¦ä¹ ç¬”è®°</a></li><li><a href="http://blog.csdn.net/lzl1663515011/article/details/46328337" target="_blank" rel="noopener">t-sneç®—æ³•ç†è§£</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç‰¹å¾è¿‡ç¨‹</tag>
      
      <tag>é™ç»´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”¨sparkå¯¹æ—¶é—´æ•°æ®è¿›è¡Œåˆ†ç»„æ±‚å¹³å‡å€¼</title>
    <link href="/2017/07/03/%E7%94%A8spark%E5%AF%B9%E6%97%B6%E9%97%B4%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%B1%82%E5%B9%B3%E5%9D%87%E5%80%BC/"/>
    <url>/2017/07/03/%E7%94%A8spark%E5%AF%B9%E6%97%B6%E9%97%B4%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E6%B1%82%E5%B9%B3%E5%9D%87%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<h3 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h3><p>æ•°æ®æ ¼å¼ä¸ºkey,timestrap,valueã€‚éœ€æ±‚æ˜¯æŒ‰ç…§<code>key</code>å¹¶å¯¹<code>timestrap</code>å›ºå®šæ—¶é—´é—´éš”è®¡ç®—ï¼Œå†å°†<code>key</code>å’Œæ—¶é—´é—´éš”ä½œä¸º<code>key</code>è¿›è¡Œåˆ†ç»„ç»Ÿè®¡<code>value</code>çš„å‡å€¼ã€‚å…¶ä¸­åˆ©ç”¨äº†<code>spark</code>çš„<code>gourpbykey</code>æ“ä½œï¼Œå¹¶å¯¹æ—¶é—´è¿›è¡Œäº†è½¬æ¢ã€‚å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre><code class="java">package org.app.spark/**  * Created by root on 17-7-2.  */import org.apache.spark.rdd.RDDimport org.apache.spark.{HashPartitioner, SparkConf, SparkContext}import java.text.SimpleDateFormatimport java.util.{Calendar, Date}import scala.collection.mutable.ArrayBufferclass ParseTimeSeries(path: String) {    val conf = new SparkConf().setAppName(&quot;ParseSeries&quot;).setMaster(&quot;local[2]&quot;)    val sc = new SparkContext(conf)    def getData: RDD[(String, Date, Int)] = {        val line: RDD[Array[String]] = sc.textFile(path).map(s =&gt; s.split(&quot;,&quot;))        val newLine = line.map(line =&gt; {            val timeString = line.apply(1)            val tf: SimpleDateFormat = new SimpleDateFormat(&quot;yyyy/MM/dd HH:mm&quot;)            val timeFormat: Date = tf.parse(timeString)            (line.apply(0), timeFormat, line.apply(2).toInt)        })        newLine    }    def processSeriesByKey(rdd: RDD[(String, Date, Int)]): RDD[(String, Int, Int)] = {        val toCalendar = Calendar.getInstance()        val array = new ArrayBuffer[(String, Int, Int)]()        for (x &lt;- rdd.collect()) {            toCalendar.setTime(x._2)            val day = toCalendar.get(Calendar.HOUR_OF_DAY)            val flag = day / 10            array.+=((x._1, flag, x._3))        }        sc.parallelize(array)    }}object testParseTimeSeries {    def main(args: Array[String]): Unit = {        val file: String = &quot;/opt/Project/spark_project/data/TimeValue.csv&quot;        val parse = new ParseTimeSeries(file)        val new_rdd = parse.processSeriesByKey(parse.getData)        new_rdd.collect().foreach(println)        val other = new_rdd.keyBy(x =&gt; (x._1, x._2)).map(x =&gt; (x._1, x._2._3)).groupByKey().            map(x =&gt; (x._1, x._2.sum/x._2.count(x=&gt;true).toDouble))        other.foreach(println)        other.aggregate()    }}</code></pre><a id="more"></a><h3 id="éƒ¨åˆ†æ•°æ®"><a href="#éƒ¨åˆ†æ•°æ®" class="headerlink" title="éƒ¨åˆ†æ•°æ®"></a>éƒ¨åˆ†æ•°æ®</h3><pre><code>a,2016/1/2 12:12,41a,2016/1/2 13:12,19a,2016/1/2 14:12,12a,2016/1/2 15:12,84a,2016/1/2 16:12,67a,2016/1/2 17:12,50a,2016/1/2 18:12,72a,2016/1/2 19:12,82a,2016/1/2 20:12,77a,2016/1/2 21:12,12a,2016/1/2 22:12,16a,2016/1/2 23:12,16a,2016/1/3 0:12,28a,2016/1/3 1:12,67a,2016/1/3 2:12,86a,2016/1/3 3:12,93a,2016/1/3 4:12,6a,2016/1/3 5:12,57a,2016/1/3 6:12,78a,2016/1/3 7:12,39a,2016/1/3 8:12,45a,2016/1/3 9:12,2a,2016/1/3 10:12,71a,2016/1/3 11:12,26a,2016/1/3 12:12,1a,2016/1/3 13:12,99a,2016/1/3 14:12,51a,2016/1/3 15:12,66b,2016/1/3 16:12,67b,2016/1/3 17:12,51b,2016/1/3 18:12,75b,2016/1/3 19:12,90b,2016/1/3 20:12,2b,2016/1/3 21:12,90b,2016/1/3 22:12,95b,2016/1/3 23:12,7b,2016/1/4 0:12,32b,2016/1/4 1:12,14b,2016/1/4 2:12,82b,2016/1/4 3:12,29b,2016/1/4 4:12,74b,2016/1/4 5:12,57b,2016/1/4 6:12,13b,2016/1/4 7:12,75b,2016/1/4 8:12,100b,2016/1/4 9:12,49</code></pre>]]></content>
    
    
    <categories>
      
      <category>spark</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spark</tag>
      
      <tag>å¤§æ•°æ®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sparkç®—å­aggregate,fold,lookupè¯¦è§£</title>
    <link href="/2017/07/03/spark%E7%AE%97%E5%AD%90aggregate-fold-lookup%E8%AF%A6%E8%A7%A3/"/>
    <url>/2017/07/03/spark%E7%AE%97%E5%AD%90aggregate-fold-lookup%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h3 id="aggregate"><a href="#aggregate" class="headerlink" title="aggregate"></a>aggregate</h3><p>å®šä¹‰å¦‚ä¸‹ï¼š<br><code>def aggregate[U](zeroValue: U)(seqOp: (U, T) â‡’ U, combOp: (U, U) â‡’ U)(implicit arg0: ClassTag[U]): U</code><br>aggregateç”¨æˆ·èšåˆRDDä¸­çš„å…ƒç´ ï¼Œå…ˆä½¿ç”¨seqOpå°†RDDä¸­æ¯ä¸ªåˆ†åŒºä¸­çš„Tç±»å‹å…ƒç´ èšåˆæˆUç±»å‹ï¼Œå†ä½¿ç”¨combOpå°†ä¹‹å‰æ¯ä¸ªåˆ†åŒºèšåˆåçš„Uç±»å‹èšåˆæˆUç±»å‹ï¼Œç‰¹åˆ«æ³¨æ„seqOpå’ŒcombOpéƒ½ä¼šä½¿ç”¨zeroValueçš„å€¼ï¼ŒzeroValueçš„ç±»å‹ä¸ºUã€‚</p><pre><code>var rdd1 = sc.makeRDD(1 to 10,2)rdd1.mapPartitionsWithIndex {        (partIdx,iter) =&gt; {          var part_map = scala.collection.mutable.Map[String,List[Int]]()            while(iter.hasNext){              var part_name = &quot;part_&quot; + partIdx;              var elem = iter.next()              if(part_map.contains(part_name)) {                var elems = part_map(part_name)                elems ::= elem                part_map(part_name) = elems              } else {                part_map(part_name) = List[Int]{elem}              }            }            part_map.iterator        }      }.collectres16: Array[(String, List[Int])] = Array((part_0,List(5, 4, 3, 2, 1)), (part_1,List(10, 9, 8, 7, 6)))</code></pre><a id="more"></a> <p>ç¬¬ä¸€ä¸ªåˆ†åŒºä¸­åŒ…å«5,4,3,2,1<br>ç¬¬äºŒä¸ªåˆ†åŒºä¸­åŒ…å«10,9,8,7,6</p><pre><code class="scala">scala&gt; rdd1.aggregate(1)(     |           {(x : Int,y : Int) =&gt; x + y},      |           {(a : Int,b : Int) =&gt; a + b}     |     )res17: Int = 58</code></pre><p>ç»“æœä¸ºä»€ä¹ˆæ˜¯58ï¼Œçœ‹ä¸‹é¢çš„è®¡ç®—è¿‡ç¨‹ï¼š</p><p>å…ˆåœ¨æ¯ä¸ªåˆ†åŒºä¸­è¿­ä»£æ‰§è¡Œ<code>(x : Int,y : Int) =&gt; x + y</code>å¹¶ä¸”ä½¿ç”¨<code>zeroValue</code>çš„å€¼<code>1</code><br>å³ï¼š<code>part_0</code>ä¸­<code>zeroValue+5+4+3+2+1 = 1+5+4+3+2+1 = 16</code><br><code>part_1</code>ä¸­ <code>zeroValue+10+9+8+7+6 = 1+10+9+8+7+6 = 41</code><br>å†å°†ä¸¤ä¸ªåˆ†åŒºçš„ç»“æœåˆå¹¶<code>(a : Int,b : Int) =&gt; a + b</code>ï¼Œå¹¶ä¸”ä½¿ç”¨<code>zeroValue</code>çš„å€¼<code>1</code><br>å³ï¼š<code>zeroValue+part_0+part_1 = 1 + 16 + 41 = 58</code><br>å†æ¯”å¦‚ï¼š</p><pre><code>scala&gt; rdd1.aggregate(2)(     |           {(x : Int,y : Int) =&gt; x + y},      |           {(a : Int,b : Int) =&gt; a * b}     |     )res18: Int = 1428</code></pre><p>è¿™æ¬¡<code>zeroValue=2</code><br><code>part_0</code>ä¸­ <code>zeroValue+5+4+3+2+1 = 2+5+4+3+2+1 = 17</code><br><code>part_1</code>ä¸­ <code>zeroValue+10+9+8+7+6 = 2+10+9+8+7+6 = 42</code><br>æœ€åï¼š<code>zeroValue*part_0*part_1 = 2 * 17 * 42 = 1428</code><br>å› æ­¤ï¼Œ<code>zeroValue</code>å³ç¡®å®šäº†<code>U</code>çš„ç±»å‹ï¼Œä¹Ÿä¼šå¯¹ç»“æœäº§ç”Ÿè‡³å…³é‡è¦çš„å½±å“ï¼Œä½¿ç”¨æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ã€‚</p><h3 id="fold"><a href="#fold" class="headerlink" title="fold"></a>fold</h3><pre><code class="scala">def fold(zeroValue: T)(op: (T, T) â‡’ T): T// foldæ˜¯aggregateçš„ç®€åŒ–ï¼Œå°†aggregateä¸­çš„seqOpå’ŒcombOpä½¿ç”¨åŒä¸€ä¸ªå‡½æ•°opã€‚scala&gt; rdd1.fold(1)(     |       (x,y) =&gt; x + y         |     )res19: Int = 58</code></pre><p>ç»“æœåŒä¸Šé¢ä½¿ç”¨aggregateçš„ç¬¬ä¸€ä¸ªä¾‹å­ä¸€æ ·ï¼Œå³ï¼š</p><pre><code class="scala">scala&gt; rdd1.aggregate(1)(     |           {(x,y) =&gt; x + y},      |           {(a,b) =&gt; a + b}     |     )res20: Int = 58</code></pre><h3 id="lookup"><a href="#lookup" class="headerlink" title="lookup"></a>lookup</h3><p><code>def lookup(key: K): Seq[V]</code><br>lookupç”¨äº(K,V)ç±»å‹çš„RDD,æŒ‡å®šKå€¼ï¼Œè¿”å›RDDä¸­è¯¥Kå¯¹åº”çš„æ‰€æœ‰Vå€¼ã€‚</p><pre><code>scala&gt; var rdd1 = sc.makeRDD(Array((&quot;A&quot;,0),(&quot;A&quot;,2),(&quot;B&quot;,1),(&quot;B&quot;,2),(&quot;C&quot;,1)))rdd1: org.apache.spark.rdd.RDD[(String, Int)] = ParallelCollectionRDD[0] at makeRDD at :21scala&gt; rdd1.lookup(&quot;A&quot;)res0: Seq[Int] = WrappedArray(0, 2)scala&gt; rdd1.lookup(&quot;B&quot;)res1: Seq[Int] = WrappedArray(1, 2)</code></pre>]]></content>
    
    
    <categories>
      
      <category>spark</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bootstrap,Boosting,Bagging,Randforestå‡ ç§æ–¹æ³•ä»‹ç»</title>
    <link href="/2017/06/12/Bootstrap-Boosting-Bagging-Randforest%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D/"/>
    <url>/2017/06/12/Bootstrap-Boosting-Bagging-Randforest%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h3 id="bagging-boosting-random-forestå’Œboostingç®—æ³•ä»‹ç»"><a href="#bagging-boosting-random-forestå’Œboostingç®—æ³•ä»‹ç»" class="headerlink" title="bagging, boosting, random forestå’Œboostingç®—æ³•ä»‹ç»"></a>bagging, boosting, random forestå’Œboostingç®—æ³•ä»‹ç»</h3><p>è¿™ä¸¤å¤©åœ¨çœ‹å…³äº<code>boosting</code>ç®—æ³•æ—¶ï¼Œçœ‹åˆ°ä¸€ç¯‡ä¸é”™çš„æ–‡ç« è®²<code>bootstrap, jackknife, bagging, boosting, random forest</code>éƒ½æœ‰ä»‹ç»ï¼Œä»¥ä¸‹æ˜¯æœç´¢å¾—åˆ°çš„åŸæ–‡ï¼Œæ²¡æ‰¾åˆ°åšå®¢ä½œè€…çš„åœ°å€ï¼Œåœ¨è¿™é‡Œè‡´è°¢ä½œè€…çš„ç ”ç©¶ã€‚ ä¸€å¹¶åˆ—å‡ºä¸€äº›æ‰¾åˆ°çš„ä»‹ç»<code>boosting</code>ç®—æ³•çš„èµ„æº:</p><ol><li>è§†é¢‘è®²ä¹‰ï¼Œä»‹ç»boostingç®—æ³•ï¼Œä¸»è¦ä»‹ç»<a href="http://videolectures.net/mlss05us_schapire_b/" target="_blank" rel="noopener">AdaBoosing</a></li><li>åœ¨è¿™ä¸ªç½‘ç«™çš„èµ„æºé¡¹é‡Œåˆ—å‡ºäº†å¯¹äºboostingç®—æ³•æ¥æºä»‹ç»çš„å‡ ç¯‡æ–‡ç« ï¼Œå¯ä»¥<a href="http://www.boosting.org/tutorials" target="_blank" rel="noopener">ä¸‹è½½</a></li><li>ä¸€ä¸ªåšå®¢ä»‹ç»äº†è®¸å¤šè§†è§‰ä¸­å¸¸ç”¨ç®—æ³•ï¼Œä½œè€…çš„å®éªŒå’Œç†è§£ï¼Œè¿™é‡Œé™„å½•çš„é“¾æ¥æ˜¯å…³äºä½¿ç”¨<a href="http://www.cnblogs.com/tornadomeet/archive/2012/03/28/2420936.html" target="_blank" rel="noopener">opencvè¿›è¡Œäººè„¸æ£€æµ‹</a>çš„è¿‡ç¨‹å’Œä»£ç ï¼Œå¯ä»¥å¸®åŠ©ç†è§£è®­ç»ƒè¿‡ç¨‹æ˜¯å¦‚ä½•å®Œæˆçš„</li><li>è¿™é‡Œæ˜¯ä¸€ä¸ªå°æ¹¾çš„ç”µå­æœŸåˆŠä¸Šå…³äº<a href="http://140.113.87.114/cvrc/edm/vol_6/tech1.htm" target="_blank" rel="noopener">AdaBoostçš„ä»‹ç»</a> â€” <code>Jackknifeï¼ŒBootstraping, bagging, boosting, AdaBoosting, Rand forest</code> å’Œ <code>gradient boosting</code>è¿™äº›æœ¯è¯­ï¼Œæˆ‘ç»å¸¸ææ··æ·†ï¼Œç°åœ¨æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼Œä»¥ç¤ºåŒºåˆ«ã€‚(éƒ¨åˆ†æ–‡å­—æ¥è‡ªç½‘ç»œï¼Œç”±äºæ˜¯ä¹‹å‰è®°çš„ç¬”è®°ï¼Œå¿˜è®°æ¥æºäº†ï¼Œç‰¹æ­¤å‘ä½œè€…æŠ±æ­‰ï¼‰ </li></ol><p><code>Bootstraping</code>: åå­—æ¥è‡ªæˆè¯­<code>pull up by your own bootstraps</code>ï¼Œæ„æ€æ˜¯ä¾é ä½ è‡ªå·±çš„èµ„æºï¼Œç§°ä¸ºè‡ªåŠ©æ³•ï¼Œå®ƒæ˜¯ä¸€ç§æœ‰æ”¾å›çš„æŠ½æ ·æ–¹æ³•ï¼Œå®ƒæ˜¯éå‚æ•°ç»Ÿè®¡ä¸­ä¸€ç§é‡è¦çš„ä¼°è®¡ç»Ÿè®¡é‡æ–¹å·®è¿›è€Œè¿›è¡ŒåŒºé—´ä¼°è®¡çš„ç»Ÿè®¡æ–¹æ³•ã€‚å…¶æ ¸å¿ƒæ€æƒ³å’ŒåŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š </p><ol><li>é‡‡ç”¨é‡æŠ½æ ·æŠ€æœ¯ä»åŸå§‹æ ·æœ¬ä¸­æŠ½å–ä¸€å®šæ•°é‡ï¼ˆè‡ªå·±ç»™å®šï¼‰çš„æ ·æœ¬ï¼Œæ­¤è¿‡ç¨‹å…è®¸é‡å¤æŠ½æ ·ã€‚</li><li>æ ¹æ®æŠ½å‡ºçš„æ ·æœ¬è®¡ç®—ç»™å®šçš„ç»Ÿè®¡é‡Tã€‚ </li><li>é‡å¤ä¸Šè¿°Næ¬¡ï¼ˆä¸€èˆ¬å¤§äº1000ï¼‰ï¼Œå¾—åˆ°Nä¸ªç»Ÿè®¡é‡Tã€‚ </li><li>è®¡ç®—ä¸Šè¿°Nä¸ªç»Ÿè®¡é‡Tçš„æ ·æœ¬æ–¹å·®ï¼Œå¾—åˆ°ç»Ÿè®¡é‡çš„æ–¹å·®ã€‚ </li></ol><p>åº”è¯¥è¯´Bootstrapæ˜¯ç°ä»£ç»Ÿè®¡å­¦è¾ƒä¸ºæµè¡Œçš„ä¸€ç§ç»Ÿè®¡æ–¹æ³•ï¼Œåœ¨å°æ ·æœ¬æ—¶æ•ˆæœå¾ˆå¥½ã€‚é€šè¿‡æ–¹å·®çš„ä¼°è®¡å¯ä»¥æ„é€ ç½®ä¿¡åŒºé—´ç­‰ï¼Œå…¶è¿ç”¨èŒƒå›´å¾—åˆ°è¿›ä¸€æ­¥å»¶ä¼¸ã€‚Jackknifeï¼š å’Œä¸Šé¢è¦ä»‹ç»çš„BootstrapåŠŸèƒ½ç±»ä¼¼ï¼Œåªæ˜¯æœ‰ä¸€ç‚¹ç»†èŠ‚ä¸ä¸€æ ·ï¼Œå³æ¯æ¬¡ä»æ ·æœ¬ä¸­æŠ½æ ·æ—¶å€™åªæ˜¯å»é™¤å‡ ä¸ªæ ·æœ¬ï¼ˆè€Œä¸æ˜¯æŠ½æ ·ï¼‰ï¼Œå°±åƒå°åˆ€ä¸€æ ·å‰²å»ä¸€éƒ¨åˆ†ã€‚</p><a id="more"></a><h3 id="ä¸‹åˆ—æ–¹æ³•éƒ½æ˜¯ä¸Šè¿°Bootstrapingæ€æƒ³çš„ä¸€ç§åº”ç”¨ã€‚"><a href="#ä¸‹åˆ—æ–¹æ³•éƒ½æ˜¯ä¸Šè¿°Bootstrapingæ€æƒ³çš„ä¸€ç§åº”ç”¨ã€‚" class="headerlink" title="ä¸‹åˆ—æ–¹æ³•éƒ½æ˜¯ä¸Šè¿°Bootstrapingæ€æƒ³çš„ä¸€ç§åº”ç”¨ã€‚"></a>ä¸‹åˆ—æ–¹æ³•éƒ½æ˜¯ä¸Šè¿°Bootstrapingæ€æƒ³çš„ä¸€ç§åº”ç”¨ã€‚</h3><h4 id="baggingç®—æ³•"><a href="#baggingç®—æ³•" class="headerlink" title="baggingç®—æ³•"></a>baggingç®—æ³•</h4><p><code>baggingï¼šbootstrap aggregating</code>çš„ç¼©å†™ã€‚è®©è¯¥å­¦ä¹ ç®—æ³•è®­ç»ƒå¤šè½®ï¼Œæ¯è½®çš„è®­ç»ƒé›†ç”±ä»åˆå§‹çš„è®­ç»ƒé›†ä¸­éšæœºå–å‡ºçš„nä¸ªè®­ç»ƒæ ·æœ¬ç»„æˆï¼ŒæŸä¸ªåˆå§‹è®­ç»ƒæ ·æœ¬åœ¨æŸè½®è®­ç»ƒé›†ä¸­å¯ä»¥å‡ºç°å¤šæ¬¡æˆ–æ ¹æœ¬ä¸å‡ºç°ï¼Œè®­ç»ƒä¹‹åå¯å¾—åˆ°ä¸€ä¸ªé¢„æµ‹å‡½æ•°åºåˆ—<code>h_1ï¼Œâ‹¯ â‹¯h_n</code> ï¼Œæœ€ç»ˆçš„é¢„æµ‹å‡½æ•°Hå¯¹åˆ†ç±»é—®é¢˜é‡‡ç”¨æŠ•ç¥¨æ–¹å¼ï¼Œå¯¹å›å½’é—®é¢˜é‡‡ç”¨ç®€å•å¹³å‡æ–¹æ³•å¯¹æ–°ç¤ºä¾‹è¿›è¡Œåˆ¤åˆ«ã€‚<br>è®­ç»ƒRä¸ªåˆ†ç±»å™¨<code>f_i</code>ï¼Œåˆ†ç±»å™¨ä¹‹é—´å…¶ä»–ç›¸åŒå°±æ˜¯å‚æ•°ä¸åŒã€‚å…¶ä¸­<code>f_i</code>æ˜¯é€šè¿‡ä»è®­ç»ƒé›†åˆä¸­(Nç¯‡æ–‡æ¡£)éšæœºå–(å–åæ”¾å›)Næ¬¡æ–‡æ¡£æ„æˆçš„è®­ç»ƒé›†åˆè®­ç»ƒå¾—åˆ°çš„ã€‚å¯¹äºæ–°æ–‡æ¡£dï¼Œç”¨è¿™Rä¸ªåˆ†ç±»å™¨å»åˆ†ç±»ï¼Œå¾—åˆ°çš„æœ€å¤šçš„é‚£ä¸ªç±»åˆ«ä½œä¸ºdçš„æœ€ç»ˆç±»åˆ«ã€‚</p><h4 id="boostingç®—æ³•"><a href="#boostingç®—æ³•" class="headerlink" title="boostingç®—æ³•"></a>boostingç®—æ³•</h4><p>boosting: å…¶ä¸­ä¸»è¦çš„æ˜¯<code>AdaBoost(Adaptive Boosting)</code>ã€‚åˆå§‹åŒ–æ—¶å¯¹æ¯ä¸€ä¸ªè®­ç»ƒä¾‹èµ‹ç›¸ç­‰çš„æƒé‡<code>1ï¼n</code>ï¼Œç„¶åç”¨è¯¥å­¦ç®—æ³•å¯¹è®­ç»ƒé›†è®­ç»ƒtè½®ï¼Œæ¯æ¬¡è®­ç»ƒåï¼Œå¯¹è®­ç»ƒå¤±è´¥çš„è®­ç»ƒä¾‹èµ‹ä»¥è¾ƒå¤§çš„æƒé‡ï¼Œä¹Ÿå°±æ˜¯è®©å­¦ä¹ ç®—æ³•åœ¨åç»­çš„å­¦ä¹ ä¸­é›†ä¸­å¯¹æ¯”è¾ƒéš¾çš„è®­ç»ƒä¾‹è¿›è¡Œå­¦ä¹ ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªé¢„æµ‹å‡½æ•°åºåˆ—<code>h_1,â‹¯, h_m</code>, å…¶ä¸­<code>h_i</code>ä¹Ÿæœ‰ä¸€å®šçš„æƒé‡ï¼Œé¢„æµ‹æ•ˆæœå¥½çš„é¢„æµ‹å‡½æ•°æƒé‡è¾ƒå¤§ï¼Œåä¹‹è¾ƒå°ã€‚æœ€ç»ˆçš„é¢„æµ‹å‡½æ•°Hå¯¹åˆ†ç±»é—®é¢˜é‡‡ç”¨æœ‰æƒé‡çš„æŠ•ç¥¨æ–¹å¼ï¼Œå¯¹å›å½’é—®é¢˜é‡‡ç”¨åŠ æƒå¹³å‡çš„æ–¹æ³•å¯¹æ–°ç¤ºä¾‹è¿›è¡Œåˆ¤åˆ«ã€‚ï¼ˆç±»ä¼¼<code>Bagging</code>æ–¹æ³•ï¼Œä½†æ˜¯è®­ç»ƒæ˜¯ä¸²è¡Œè¿›è¡Œçš„ï¼Œç¬¬kä¸ªåˆ†ç±»å™¨è®­ç»ƒæ—¶å…³æ³¨å¯¹å‰<code>k-1</code>åˆ†ç±»å™¨ä¸­é”™åˆ†çš„æ–‡æ¡£ï¼Œå³ä¸æ˜¯éšæœºå–ï¼Œè€Œæ˜¯åŠ å¤§å–è¿™äº›æ–‡æ¡£çš„æ¦‚ç‡ã€‚) </p><h4 id="boostingå’Œbaggingçš„åŒºåˆ«"><a href="#boostingå’Œbaggingçš„åŒºåˆ«" class="headerlink" title="boostingå’Œbaggingçš„åŒºåˆ«"></a>boostingå’Œbaggingçš„åŒºåˆ«</h4><p><code>Bagging</code>ä¸<code>Boosting</code>çš„åŒºåˆ«ï¼šäºŒè€…çš„ä¸»è¦åŒºåˆ«æ˜¯å–æ ·æ–¹å¼ä¸åŒã€‚<code>Bagging</code>é‡‡ç”¨å‡åŒ€å–æ ·ï¼Œè€Œ<code>Boosting</code>æ ¹æ®é”™è¯¯ç‡æ¥å–æ ·ï¼Œå› æ­¤<code>Boosting</code>çš„åˆ†ç±»ç²¾åº¦è¦ä¼˜äº<code>Bagging</code>ã€‚<code>Bagging</code>çš„è®­ç»ƒé›†çš„é€‰æ‹©æ˜¯éšæœºçš„ï¼Œå„è½®è®­ç»ƒé›†ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œè€Œ<code>Boostlng</code>çš„å„è½®è®­ç»ƒé›†çš„é€‰æ‹©ä¸å‰é¢å„è½®çš„å­¦ä¹ ç»“æœæœ‰å…³ï¼›<code>Bagging</code>çš„å„ä¸ªé¢„æµ‹å‡½æ•°æ²¡æœ‰æƒé‡ï¼Œè€Œ<code>Boosting</code>æ˜¯æœ‰æƒé‡çš„ï¼›<code>Bagging</code>çš„å„ä¸ªé¢„æµ‹å‡½æ•°å¯ä»¥å¹¶è¡Œç”Ÿæˆï¼Œè€Œ<code>Boosting</code>çš„å„ä¸ªé¢„æµ‹å‡½æ•°åªèƒ½é¡ºåºç”Ÿæˆã€‚å¯¹äºè±¡ç¥ç»ç½‘ç»œè¿™æ ·æä¸ºè€—æ—¶çš„å­¦ä¹ æ–¹æ³•ã€‚<code>Bagging</code>å¯é€šè¿‡å¹¶è¡Œè®­ç»ƒèŠ‚çœå¤§é‡æ—¶é—´å¼€é”€ã€‚<code>bagging</code>å’Œ<code>boosting</code>éƒ½å¯ä»¥æœ‰æ•ˆåœ°æé«˜åˆ†ç±»çš„å‡†ç¡®æ€§ã€‚åœ¨å¤§å¤šæ•°æ•°æ®é›†ä¸­ï¼Œ<code>boosting</code>çš„å‡†ç¡®æ€§æ¯”<code>bagging</code>é«˜ã€‚åœ¨æœ‰äº›æ•°æ®é›†ä¸­ï¼Œ<code>boosting</code>ä¼šå¼•èµ·é€€åŒ–ã€‚</p><p><code>Boosting</code>æ€æƒ³çš„ä¸€ç§æ”¹è¿›å‹<code>AdaBoost</code>æ–¹æ³•åœ¨é‚®ä»¶è¿‡æ»¤ã€æ–‡æœ¬åˆ†ç±»æ–¹é¢éƒ½æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚ <code>gradient boosting</code>ï¼ˆåˆå«Mart, Treenet)ï¼š<code>Boosting</code>æ˜¯ä¸€ç§æ€æƒ³ï¼Œ<code>Gradient Boosting</code>æ˜¯ä¸€ç§å®ç°<code>Boosting</code>çš„æ–¹æ³•ï¼Œå®ƒä¸»è¦çš„æ€æƒ³æ˜¯ï¼Œæ¯ä¸€æ¬¡å»ºç«‹æ¨¡å‹æ˜¯åœ¨ä¹‹å‰å»ºç«‹æ¨¡å‹æŸå¤±å‡½æ•°çš„æ¢¯åº¦ä¸‹é™æ–¹å‘ã€‚æŸå¤±å‡½æ•°(<code>loss function</code>)æè¿°çš„æ˜¯æ¨¡å‹çš„ä¸é è°±ç¨‹åº¦ï¼ŒæŸå¤±å‡½æ•°è¶Šå¤§ï¼Œåˆ™è¯´æ˜æ¨¡å‹è¶Šå®¹æ˜“å‡ºé”™ã€‚å¦‚æœæˆ‘ä»¬çš„æ¨¡å‹èƒ½å¤Ÿè®©æŸå¤±å‡½æ•°æŒç»­çš„ä¸‹é™ï¼Œåˆ™è¯´æ˜æˆ‘ä»¬çš„æ¨¡å‹åœ¨ä¸åœçš„æ”¹è¿›ï¼Œè€Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯è®©æŸå¤±å‡½æ•°åœ¨å…¶æ¢¯åº¦(<code>Gradient</code>)çš„æ–¹å‘ä¸Šä¸‹é™ã€‚ </p><h4 id="RandomForestç®—æ³•"><a href="#RandomForestç®—æ³•" class="headerlink" title="RandomForestç®—æ³•"></a>RandomForestç®—æ³•</h4><p><code>Rand forest</code>ï¼š éšæœºæ£®æ—ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ç”¨éšæœºçš„æ–¹å¼å»ºç«‹ä¸€ä¸ªæ£®æ—ï¼Œæ£®æ—é‡Œé¢æœ‰å¾ˆå¤šçš„å†³ç­–æ ‘ç»„æˆï¼Œéšæœºæ£®æ—çš„æ¯ä¸€æ£µå†³ç­–æ ‘ä¹‹é—´æ˜¯æ²¡æœ‰å…³è”çš„ã€‚åœ¨å¾—åˆ°æ£®æ—ä¹‹åï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„è¾“å…¥æ ·æœ¬è¿›å…¥çš„æ—¶å€™ï¼Œå°±è®©æ£®æ—ä¸­çš„æ¯ä¸€æ£µå†³ç­–æ ‘åˆ†åˆ«è¿›è¡Œä¸€ä¸‹åˆ¤æ–­ï¼Œçœ‹çœ‹è¿™ä¸ªæ ·æœ¬åº”è¯¥å±äºå“ªä¸€ç±»ï¼ˆå¯¹äºåˆ†ç±»ç®—æ³•ï¼‰ï¼Œç„¶åçœ‹çœ‹å“ªä¸€ç±»è¢«é€‰æ‹©æœ€å¤šï¼Œå°±é¢„æµ‹è¿™ä¸ªæ ·æœ¬ä¸ºé‚£ä¸€ç±»ã€‚ åœ¨å»ºç«‹æ¯ä¸€æ£µå†³ç­–æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ â€“ é‡‡æ ·ä¸å®Œå…¨åˆ†è£‚ã€‚é¦–å…ˆæ˜¯ä¸¤ä¸ªéšæœºé‡‡æ ·çš„è¿‡ç¨‹ï¼Œ<code>random forest</code>å¯¹è¾“å…¥çš„æ•°æ®è¦è¿›è¡Œè¡Œã€åˆ—çš„é‡‡æ ·ã€‚å¯¹äºè¡Œé‡‡æ ·ï¼Œé‡‡ç”¨æœ‰æ”¾å›çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨é‡‡æ ·å¾—åˆ°çš„æ ·æœ¬é›†åˆä¸­ï¼Œå¯èƒ½æœ‰é‡å¤çš„æ ·æœ¬ã€‚å‡è®¾è¾“å…¥æ ·æœ¬ä¸ºNä¸ªï¼Œé‚£ä¹ˆé‡‡æ ·çš„æ ·æœ¬ä¹Ÿä¸ºNä¸ªã€‚è¿™æ ·ä½¿å¾—åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œæ¯ä¸€æ£µæ ‘çš„è¾“å…¥æ ·æœ¬éƒ½ä¸æ˜¯å…¨éƒ¨çš„æ ·æœ¬ï¼Œä½¿å¾—ç›¸å¯¹ä¸å®¹æ˜“å‡ºç°over-fittingã€‚ç„¶åè¿›è¡Œåˆ—é‡‡æ ·ï¼Œä»Mä¸ª<code>feature</code>ä¸­ï¼Œé€‰æ‹©mä¸ª<code>(m &lt;&lt; M)</code>ã€‚ä¹‹åå°±æ˜¯å¯¹é‡‡æ ·ä¹‹åçš„æ•°æ®ä½¿ç”¨å®Œå…¨åˆ†è£‚çš„æ–¹å¼å»ºç«‹å‡ºå†³ç­–æ ‘ï¼Œè¿™æ ·å†³ç­–æ ‘çš„æŸä¸€ä¸ªå¶å­èŠ‚ç‚¹è¦ä¹ˆæ˜¯æ— æ³•ç»§ç»­åˆ†è£‚çš„ï¼Œè¦ä¹ˆé‡Œé¢çš„æ‰€æœ‰æ ·æœ¬çš„éƒ½æ˜¯æŒ‡å‘çš„åŒä¸€ä¸ªåˆ†ç±»ã€‚ä¸€èˆ¬å¾ˆå¤šçš„å†³ç­–æ ‘ç®—æ³•éƒ½ä¸€ä¸ªé‡è¦çš„æ­¥éª¤ â€“ å‰ªæï¼Œä½†æ˜¯è¿™é‡Œä¸è¿™æ ·å¹²ï¼Œç”±äºä¹‹å‰çš„ä¸¤ä¸ªéšæœºé‡‡æ ·çš„è¿‡ç¨‹ä¿è¯äº†éšæœºæ€§ï¼Œæ‰€ä»¥å°±ç®—ä¸å‰ªæï¼Œä¹Ÿä¸ä¼šå‡ºç°<code>over-fitting</code>ã€‚ æŒ‰è¿™ç§ç®—æ³•å¾—åˆ°çš„éšæœºæ£®æ—ä¸­çš„æ¯ä¸€æ£µéƒ½æ˜¯å¾ˆå¼±çš„ï¼Œä½†æ˜¯å¤§å®¶ç»„åˆèµ·æ¥å°±å¾ˆå‰å®³äº†ã€‚å¯ä»¥è¿™æ ·æ¯”å–»éšæœºæ£®æ—ç®—æ³•ï¼šæ¯ä¸€æ£µå†³ç­–æ ‘å°±æ˜¯ä¸€ä¸ªç²¾é€šäºæŸä¸€ä¸ªçª„é¢†åŸŸçš„ä¸“å®¶ï¼ˆå› ä¸ºæˆ‘ä»¬ä»Mä¸ª<code>feature</code>ä¸­é€‰æ‹©mè®©æ¯ä¸€æ£µå†³ç­–æ ‘è¿›è¡Œå­¦ä¹ ï¼‰ï¼Œè¿™æ ·åœ¨éšæœºæ£®æ—ä¸­å°±æœ‰äº†å¾ˆå¤šä¸ªç²¾é€šä¸åŒé¢†åŸŸçš„ä¸“å®¶ï¼Œå¯¹ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼ˆæ–°çš„è¾“å…¥æ•°æ®ï¼‰ï¼Œå¯ä»¥ç”¨ä¸åŒçš„è§’åº¦å»çœ‹å¾…å®ƒï¼Œæœ€ç»ˆç”±å„ä¸ªä¸“å®¶ï¼ŒæŠ•ç¥¨å¾—åˆ°ç»“æœã€‚ </p><p><code>Rand forest</code>ä¸<code>bagging</code>çš„åŒºåˆ«ï¼š</p><ol><li><code>Rand forest</code>æ˜¯é€‰ä¸è¾“å…¥æ ·æœ¬çš„æ•°ç›®ç›¸åŒå¤šçš„æ¬¡æ•°ï¼ˆå¯èƒ½ä¸€ä¸ªæ ·æœ¬ä¼šè¢«é€‰å–å¤šæ¬¡ï¼ŒåŒæ—¶ä¹Ÿä¼šé€ æˆä¸€äº›æ ·æœ¬ä¸ä¼šè¢«é€‰å–åˆ°ï¼‰ï¼Œè€Œ<code>bagging</code>ä¸€èˆ¬é€‰å–æ¯”è¾“å…¥æ ·æœ¬çš„æ•°ç›®å°‘çš„æ ·æœ¬ï¼›</li><li><code>bagging</code>æ˜¯ç”¨å…¨éƒ¨ç‰¹å¾æ¥å¾—åˆ°åˆ†ç±»å™¨ï¼Œè€Œ<code>rand forest</code>æ˜¯éœ€è¦ä»å…¨éƒ¨ç‰¹å¾ä¸­é€‰å–å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ¥è®­ç»ƒå¾—åˆ°åˆ†ç±»å™¨ï¼› ä¸€èˆ¬<code>Rand forest</code>æ•ˆæœæ¯”<code>bagging</code>æ•ˆæœå¥½ï¼ </li></ol><p><code>bootstrps bagging boosting</code>è¿™å‡ ä¸ªæ¦‚å¿µç»å¸¸ç”¨åˆ°ï¼Œç°ä»”ç»†å­¦ä¹ äº†ä¸€ä¸‹ï¼šä»–ä»¬éƒ½å±äºé›†æˆå­¦ä¹ æ–¹æ³•ï¼Œ(å¦‚ï¼š<code>Baggingï¼ŒBoostingï¼ŒStacking</code>)ï¼Œå°†è®­ç»ƒçš„å­¦ä¹ å™¨é›†æˆåœ¨ä¸€èµ·,åŸç†æ¥æºäºPACå­¦ä¹ æ¨¡å‹ï¼ˆ<code>ProbablyApproximately CorrectK</code>ï¼‰ã€‚Kearnså’ŒValiantæŒ‡å‡ºï¼Œåœ¨PACå­¦ä¹ æ¨¡å‹ä¸­ï¼Œè‹¥å­˜åœ¨ä¸€ä¸ªå¤šé¡¹å¼çº§çš„å­¦ä¹ ç®—æ³•æ¥è¯†åˆ«ä¸€ç»„æ¦‚å¿µï¼Œå¹¶ä¸”è¯†åˆ«æ­£ç¡®ç‡å¾ˆé«˜ï¼Œé‚£ä¹ˆè¿™ç»„æ¦‚å¿µæ˜¯å¼ºå¯å­¦ä¹ çš„ï¼›è€Œå¦‚æœå­¦ä¹ ç®—æ³•è¯†åˆ«ä¸€ç»„æ¦‚å¿µçš„æ­£ç¡®ç‡ä»…æ¯”éšæœºçŒœæµ‹ç•¥å¥½ï¼Œé‚£ä¹ˆè¿™ç»„æ¦‚å¿µæ˜¯å¼±å¯å­¦ä¹ çš„ã€‚ä»–ä»¬æå‡ºäº†å¼±å­¦ä¹ ç®—æ³•ä¸å¼ºå­¦ä¹ ç®—æ³•çš„ç­‰ä»·æ€§é—®é¢˜ï¼Œå³æ˜¯å¦å¯ä»¥å°†å¼±å­¦ä¹ ç®—æ³•æå‡æˆå¼ºå­¦ä¹ ç®—æ³•ã€‚å¦‚æœä¸¤è€…ç­‰ä»·ï¼Œé‚£ä¹ˆåœ¨å­¦ä¹ æ¦‚å¿µæ—¶ï¼Œåªè¦æ‰¾åˆ°ä¸€ä¸ªæ¯”éšæœºçŒœæµ‹ç•¥å¥½çš„å¼±å­¦ä¹ ç®—æ³•ï¼Œå°±å¯ä»¥å°†å…¶æå‡ä¸ºå¼ºå­¦ä¹ ç®—æ³•ï¼Œè€Œä¸å¿…ç›´æ¥å»æ‰¾é€šå¸¸æƒ…å†µä¸‹å¾ˆéš¾è·å¾—çš„å¼ºå­¦ä¹ ç®—æ³•ã€‚ </p><p>æ–‡æœ¬åˆ†ç±»ä¸­ä½¿ç”¨çš„æŠ•ç¥¨æ–¹æ³•ï¼ˆ<code>Voting</code>ï¼Œä¹Ÿå«ç»„åˆåˆ†ç±»å™¨ï¼‰å°±æ˜¯ä¸€ç§å…¸å‹çš„é›†æˆæœºå™¨å­¦ä¹ æ–¹æ³•ã€‚å®ƒé€šè¿‡ç»„åˆå¤šä¸ªå¼±åˆ†ç±»å™¨æ¥å¾—åˆ°ä¸€ä¸ªå¼ºåˆ†ç±»å™¨ï¼ŒåŒ…æ‹¬<code>Bagging</code>å’Œ<code>Boosting</code>ä¸¤ç§æ–¹å¼ï¼ŒäºŒè€…çš„ä¸»è¦åŒºåˆ«æ˜¯å–æ ·æ–¹å¼ä¸åŒã€‚<code>Bagging</code>é‡‡ç”¨å‡åŒ€å–æ ·ï¼Œè€Œ<code>Boosting</code>æ ¹æ®é”™è¯¯ç‡æ¥å–æ ·ï¼Œå› æ­¤<code>Boosting</code>çš„åˆ†ç±»ç²¾åº¦è¦ä¼˜äº<code>Bagging</code>ã€‚æŠ•ç¥¨åˆ†ç±»æ–¹æ³•è™½ç„¶åˆ†ç±»ç²¾åº¦è¾ƒé«˜ï¼Œä½†è®­ç»ƒæ—¶é—´è¾ƒé•¿ã€‚<code>Boostin</code>gæ€æƒ³çš„ä¸€ç§æ”¹è¿›å‹<code>AdaBoost</code>æ–¹æ³•åœ¨é‚®ä»¶è¿‡æ»¤ã€æ–‡æœ¬åˆ†ç±»æ–¹é¢éƒ½æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>bagging</tag>
      
      <tag>boosting</tag>
      
      <tag>randomforest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¿¡æ¯å¢ç›Šç­›é€‰å˜é‡å’Œpythonå®ç°</title>
    <link href="/2017/06/12/%E4%BF%A1%E6%81%AF%E5%A2%9E%E7%9B%8A%E7%AD%9B%E9%80%89%E5%8F%98%E9%87%8F%E5%92%8Cpython%E5%AE%9E%E7%8E%B0/"/>
    <url>/2017/06/12/%E4%BF%A1%E6%81%AF%E5%A2%9E%E7%9B%8A%E7%AD%9B%E9%80%89%E5%8F%98%E9%87%8F%E5%92%8Cpython%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="ç†µçš„å®šä¹‰"><a href="#ç†µçš„å®šä¹‰" class="headerlink" title="ç†µçš„å®šä¹‰"></a>ç†µçš„å®šä¹‰</h3><p>åœ¨äº†è§£ä¿¡æ¯å¢ç›Šä¹‹å‰éœ€è¦æ¸…æ¥šä¿¡æ¯ç†µçš„å®šä¹‰ï¼Œç†µèµ·æºäºç‰©ç†å­¦ï¼Œåæ¥è¢«é¦™å†œå¼•å…¥ä¿¡æ¯è®ºä¸­ã€‚ç†µæ˜¯ä¿¡æ¯è®ºä¸­å¯¹ä¿¡æ¯é‡çš„ä¸€ä¸ªè¡¡é‡å€¼ï¼ŒæŒ‡æ¥æ”¶çš„æ¯æ¡æ¶ˆæ¯ä¸­åŒ…å«çš„ä¿¡æ¯çš„å¹³å‡é‡ã€‚è¿™é‡Œçš„æ¶ˆæ¯ä»£è¡¨äº†æ ·æœ¬ï¼Œç‰¹å¾ã€‚ç†µæ„ä¹‰å¯ä»¥è§£é‡Šä¸ºä¸ç¡®å®šæ€§çš„åº¦é‡ï¼Œç‰¹å¾çš„éšæœºæ€§æˆ–è€…æ··ä¹±ç¨‹åº¦è¶Šå¤§é‚£ä¹ˆç†µå€¼è¶Šå¤§ã€‚å› æ­¤ç†µè¢«é‡åŒ–ç‰¹å¾åŒ…å«ä¿¡æ¯é‡çš„å¤§å°ï¼Œåœ¨æœºå™¨å­¦ä¹ é¢†åŸŸè¢«å¹¿æ³›å¼•ç”¨ã€‚</p><h3 id="ç†µçš„è®¡ç®—"><a href="#ç†µçš„è®¡ç®—" class="headerlink" title="ç†µçš„è®¡ç®—"></a>ç†µçš„è®¡ç®—</h3><center> H(X)=-SUM(P(x(i))log(p(x(i)), b)) </center><p>è¿™é‡Œçš„bä¸ºå¯¹æ•°ä½¿ç”¨çš„åº•æ•°ï¼Œé€šå¸¸ä¸º2ï¼Œæˆ–è€…è‡ªç„¶å¸¸ç†Ÿe, p(i)ä¸ºXä¸­ç¬¬iä¸ªå–å€¼åœ¨æ‰€åœ¨æ ·æœ¬ä¸­çš„æ¦‚ç‡ã€‚</p><h3 id="ä¿¡æ¯å¢ç›ŠIG-Y-X"><a href="#ä¿¡æ¯å¢ç›ŠIG-Y-X" class="headerlink" title="ä¿¡æ¯å¢ç›ŠIG(Y|X)"></a>ä¿¡æ¯å¢ç›ŠIG(Y|X)</h3><p>è¡¡é‡æ¯ä¸ªå±æ€§XåŒºåˆ†ç›®æ ‡æ ·æœ¬Yçš„èƒ½åŠ›ï¼Œå½“æ–°å¢ä¸€ä¸ªå±æ€§æˆ–ç‰¹å¾Xæ—¶ï¼Œä¿¡æ¯ç†µçš„å˜åŒ–å¤§å°å³ä¸ºä¿¡æ¯å¢ç›Šã€‚IG(Y|X)çš„å€¼è¶Šå¤§é‚£ä¹ˆXå¯¹äºYè¶Šé‡è¦ã€‚ æ¡ä»¶ç†µï¼šH(Y|X)ï¼Œå½“Xæ¡ä»¶ä¸‹Yçš„ä¿¡æ¯ç†µã€‚</p><center> IG(Y|X)=H(Y)-H(Y|X) </center><a id="more"></a>ä¸‹é¢æ˜¯é€šè¿‡pythonå®ç°è®¡ç®—æ ·æœ¬ç‰¹å¾çš„ä¿¡æ¯å¢ç›Šï¼š<pre><code class="python"># -*-coding:utf-8-*-import numpy as npfrom collections import Counterclass EntropyGain(object):    &quot;&quot;&quot;    The datasets information entropy, it&#39;s contains feature entropy and information gain. Use to select the bests    feature, if the gain value the bigger the better.    Parameters    -------------------        X: array, the train datasets.        Y: array, class label        alpha: float or int, the best of feature&#39;s threshold value.    Attributes    -------------------        X, y, alpha, like the parameter.    Methods    -------------------        get_feature_class_label: get feature&#39;s value map to class label and apply to entropy value.        select_k_best_feature: select the best of feature apply to alpha.    Samples    -------------------    &gt;&gt; eg = EntropyGain(X, Y, alpha=10)    &gt;&gt; eg.select_k_best_feature()        [(0, 0.8321), (2, 0.7681), (5, 0.7163), ..., (1, 0.4908)]    &quot;&quot;&quot;    def __init__(self, X, Y, alpha=0.80):        self.x = X        self.y = Y        self.alpha = alpha    def __prob_y(self, y_=None):        if y_ is None:            y_ = self.y        if not self.y.size:            print &quot;The variable %s is NoneType object.&quot; % &#39;y_&#39;        n_sample = len(y_)        label_prob = {v: float(c)/n_sample for v, c in Counter(y_.flatten()).iteritems()}        return label_prob    def __get_label_entropy(self, class_prob=None):        &quot;&quot;&quot;        param class_prob: the class label probability value, it&#39;s &#39;collections.Counter&#39; object.        return: float, the class label entropy        &quot;&quot;&quot;        if not class_prob:            print &quot;This variable class_prob is NoneType object.&quot;            class_prob = self.__prob_y(y_=self.y)        return reduce(lambda x1, x2: x1 + x2, [-p * np.log2(p) for v, p in class_prob.iteritems()])    def get_feature_class_label(self, feature_or_index):        &quot;&quot;&quot;        parameter            x: the model train data x            feature_or_index: the datasets x feature or index.            y: class label datasets.        return:            filter label data&#39;s label counter.        &quot;&quot;&quot;        x_ = self.x[:, feature_or_index]        feature_prob_dict = self.__prob_y(y_=x_)        feature_entropy = {v: self.__get_label_entropy(self.__prob_y(y_=self.y[x_ == v])) for v in np.unique(x_)}        return reduce(lambda x1, x2: x1 + x2, [feature_prob_dict[k] * entropy for k, entropy in                                              feature_entropy.iteritems()])    def select_k_best_feature(self):        &quot;&quot;&quot;        parameter:            x: array, the feature datasets.            y: array, class label            alpha: float or int, filter threshold value.        return:            feature index and entropy gain.        &quot;&quot;&quot;        row_num, col_num = self.x.shape        index_map_entropy = dict()        entropy_h0 = self.__get_label_entropy(self.__prob_y(y_=self.y))        print u&quot;åˆå§‹ä¿¡æ¯ç†µä¸º:&quot;, round(entropy_h0, 4)        for _index_ in range(col_num):            index_map_entropy[_index_] = round(entropy_h0 - self.get_feature_class_label(_index_), 4)        if isinstance(self.alpha, int) and self.alpha &lt;= col_num:            return sorted(index_map_entropy.iteritems(), key=lambda d: d[1], reverse=True)[:self.alpha]        if isinstance(self.alpha, float) and 0.0 &lt; self.alpha &lt;= 1:            index_num = int(col_num * self.alpha)            return sorted(index_map_entropy.iteritems(), key=lambda d: d[1], reverse=True)[:index_num]</code></pre>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç‰¹å¾é€‰æ‹©</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é­”æ³•æ–¹æ³•__getattr__å’Œ__getattribute__çš„è¯¦è§£</title>
    <link href="/2017/06/06/%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95__getattr__%E5%92%8C__getattribute__%E7%9A%84%E8%AF%A6%E8%A7%A3/"/>
    <url>/2017/06/06/%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95__getattr__%E5%92%8C__getattribute__%E7%9A%84%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h3 id="getattr-å’Œ-getattribute-çš„å®šä¹‰"><a href="#getattr-å’Œ-getattribute-çš„å®šä¹‰" class="headerlink" title="__getattr__() å’Œ __getattribute__()çš„å®šä¹‰"></a><code>__getattr__()</code> å’Œ <code>__getattribute__()</code>çš„å®šä¹‰</h3><p>pythonåœ¨å±æ€§è®¿é—®ä¸Šå®šä¹‰äº†<code>__getattr__()</code> å’Œ <code>__getattribute__()</code>ä¸¤ç§æ–¹æ³•ã€‚åŒºåˆ«æ˜¯å¾ˆå°ï¼Œä½†æ˜¯å¿…é¡»äº†è§£ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œå¦åˆ™åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´ä¸¥é‡çš„åæœã€‚é¦–å…ˆçœ‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼š</p><ol><li>å¦‚æœåœ¨ç±»ä¸­å®šä¹‰äº†<code>__getattr__()</code>è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å¯¹è±¡æŸ¥è¯¢å±æ€§æ—¶,å¦‚æœè¿™ä¸ªå±æ€§åœ¨ç±»ä¸­å®šä¹‰äº†ï¼Œå¦‚ä¸€ä¸ªå·²ç»å®ä¾‹åŒ–çš„å¯¹è±¡xå®šä¹‰äº†å±æ€§nameï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨x.nameæ—¶å°±ä¸ä¼šè°ƒç”¨<code>__getattr__(</code>name<code>)</code>ï¼›ä¼šç›´æ¥è¿”å›nameå·²ç»å®šä¹‰å¥½çš„å€¼ã€‚ç®€å•çš„è¯´ï¼š<code>__getattr__()</code>ä¼šåœ¨å¯¹è±¡ä¸­ä¸å­˜åœ¨è¿™ä¸ªå±æ€§æ—¶è¢«è°ƒç”¨ã€‚</li><li>å¦‚æœåœ¨ç±»å®šä¹‰äº†<code>__getattribute__()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒæ— æ¡ä»¶è¢«è°ƒç”¨ã€‚å½“å®ä¾‹åŒ–çš„å¯¹è±¡æ¯æ¬¡å¼•ç”¨å±æ€§å’Œæ–¹æ³•æ—¶éƒ½ä¼šå…ˆè°ƒç”¨å®ƒã€‚å¦‚æœå±æ€§æŸ¥æ‰¾ä¸åˆ°é‚£ä¹ˆå°±ä¼šå¼•å‘AttributeErrorçš„å¼‚å¸¸ã€‚é™¤éåœ¨ç±»ä¸­åŒæ—¶å®šä¹‰äº†<code>__getattribute__()</code>å’Œ<code>__getattr__()</code>ä¸¤ä¸ªæ–¹æ³•ã€‚</li></ol><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ª<code>__setattr__</code>çš„å®ä¾‹ï¼š</p><pre><code class="python">class MagicTest(object):    def __init__(self):        self.name = &quot;Miller&quot;        self.age = 25    def __getattr__(self, name):        return Noneif __name__ == &quot;__main__&quot;:    magic = MagicTest()    print magic.name    print magic.age    print magic.sex# ouputMiller25None</code></pre><a id="more"></a><h3 id="getattribute-çš„ä½¿ç”¨"><a href="#getattribute-çš„ä½¿ç”¨" class="headerlink" title="__getattribute__çš„ä½¿ç”¨"></a><code>__getattribute__</code>çš„ä½¿ç”¨</h3><p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“ï¼Œmagicåœ¨å¼•ç”¨sexä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œè°ƒç”¨äº†<code>__getattr__</code>æ–¹æ³•ã€‚å› æ­¤è¿”å›äº†Noneã€‚é‚£ä¹ˆç°åœ¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š<code>__getattribute__</code>æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç ç¨ä½œä¿®æ”¹çœ‹ä¼šæ€ä¹ˆæ ·ã€‚å¦‚ä¸‹ï¼š</p><pre><code class="python">class MagicTest1(object):    def __init__(self):        self.name = &quot;Miller&quot;        self.age = 25    def __getattribute__(self, name):        print &quot;__getattribute__&quot;        return super(MagicTest1, self).__getattribute__(name)     (1)if __name__ == &quot;__main__&quot;:    magic1 = MagicTest1()    print magic1.name    print magic1.age    print magic1.sex# output__getattribute__Miller__getattribute__25-------------------AttributeError Traceback (most recent call last)AttributeError: `MagicTest1` object has no attribute `sex`  (2)</code></pre><p>å¯ä»¥çœ‹å‡ºä¸Šé¢çš„ä»£ç ä¸­æœ‰å‡ ä¸ªåœ°æ–¹å¾ˆç–‘æƒ‘ï¼Œåœ¨ä¸Šé¢æˆ‘å·²ç»è¿›è¡Œäº†æ ‡è®°(1),(2)ã€‚é¦–å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªç–‘æƒ‘çš„åœ°æ–¹ï¼š<br>(1)ä¸ºä»€ä¹ˆè¦ä½¿ç”¨superæ¥è°ƒç”¨objectçš„<code>__getattribute__</code>æ–¹æ³•å‘¢ï¼Ÿé¦–å…ˆï¼Œ<code>__getattribute__</code>æ–¹æ³•åœ¨æ–°å¼ç±»ä¸­æ‰å­˜åœ¨ï¼Œåœ¨python2.xéœ€è¦ç»§æ‰¿objectæ‰ä¼šæœ‰è¿™ä¸ªæ–¹æ³•ï¼Œpython3.xå…¨æ˜¯æ–°å¼ç±»ã€‚å…¶æ¬¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯é˜²æ­¢æ— çº¿å¾ªç¯æŸ¥æ‰¾å±æ€§ã€‚å› ä¸ºgetattributeåœ¨è®¿é—®å±æ€§çš„æ—¶å€™ä¸€ç›´ä¼šè¢«è°ƒç”¨ï¼Œè‡ªå®šä¹‰çš„getattributeæ–¹æ³•é‡Œé¢åŒæ—¶éœ€è¦è¿”å›ç›¸åº”çš„å±æ€§ï¼Œé€šè¿‡<code>self.__dict__</code>å–å€¼ä¼šç»§ç»­å‘ä¸‹è°ƒç”¨getattributeï¼Œé€ æˆå¾ªç¯è°ƒç”¨.<br>(2)ä¸ºä»€ä¹ˆä¼šæœ‰AttributeErrorå‘¢ï¼Ÿå› åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>__getattribute__</code>ä¼šè¢«æ— æ¡ä»¶è°ƒç”¨ï¼Œå½“è°ƒç”¨sexå±æ€§æ—¶ï¼Œå»å®ä¾‹å¯¹è±¡magic1ä¸­æŸ¥æ‰¾æ˜¯å¦å…·å¤‡è¯¥å±æ€§ï¼š<code>t.__dict__</code>ä¸­æŸ¥æ‰¾ï¼Œæ¯ä¸ªç±»å’Œå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>__dict__</code>çš„å±æ€§ï¼Œè‹¥åœ¨<code>t.__dict__</code>ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„å±æ€§ï¼Œåˆ™å»è¯¥å®ä¾‹çš„ç±»ä¸­å¯»æ‰¾ï¼Œå³<code>t.__class__.__dict__</code>ã€‚è‹¥åœ¨å®ä¾‹çš„ç±»ä¸­ä¹Ÿæ‹›ä¸åˆ°è¯¥å±æ€§ï¼Œåˆ™å»çˆ¶ç±»ä¸­å¯»æ‰¾ï¼Œå³<code>t.__class__.__bases__.__dict_</code>ä¸­å¯»æ‰¾ã€‚è‹¥ä»¥ä¸Šå‡æ— æ³•æ‰¾åˆ°ï¼Œåˆ™ä¼šè°ƒç”¨<code>__getattr__</code>æ–¹æ³•ï¼Œæ‰§è¡Œå†…éƒ¨çš„å‘½ä»¤ï¼ˆè‹¥æœªé‡è½½<code>__getattr__</code>æ–¹æ³•ï¼Œåˆ™ç›´æ¥æŠ¥é”™ï¼šAttributeError)ã€‚</p><p>æ€»ä½“æ¥è¯´æŸ¥æ‰¾è¿‡ç¨‹æ˜¯:<code>__dict__</code> â€”â€”&gt; <code>__class__.__dict__</code> â€”â€”&gt; <code>__class__.__bases__.__dict__</code>ï¼›å¦‚æœéƒ½æŸ¥æ‰¾ä¸åˆ°å°±ä¼šè°ƒç”¨<code>__getattr__</code>æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰<code>__getattr__</code>æ–¹æ³•åˆ™ä¼šå¼•å‘å¼‚å¸¸AttributeErrorã€‚<br>ä¸‹é¢æˆ‘ä»¬å¯ä»¥æ‰“å°å‡ºå¯¹è±¡çš„å±æ€§çœ‹é‡Œé¢çš„å€¼ï¼š</p><pre><code class="python">print magic1.__dict__print magic1.__class__.__bases__.__dict__print magic1.__class__.__dict____getattribute__{`age`: 25, `name`: `Miller`}__getattribute__{`__module__`: `__main__`, `__getattribute__`: &lt;function __getattribute__ at 0x00000000042C6E48&gt;, `__dict__`: &lt;attribute `__dict__` of `MagicTest1` objects&gt;, `__weakref__`: &lt;attribute `__weakref__` of `MagicTest1` objects&gt;, `__doc__`: None, `__init__`: &lt;function __init__ at 0x00000000042C6F28&gt;}__getattribute__AttributeError: `tuple` object has no attribute `__dict__`</code></pre><p>å¯ä»¥çŸ¥é“ã€‚ä¸Šé¢è¾“å‡ºæ˜¯è¿˜æ˜¯è°ƒç”¨äº†<code>__getattribute__</code>æ–¹æ³•ï¼Œå› æ­¤åœ¨è¾“å‡ºæ—¶æ‰ä¼šæ‰“å°<code>__getattribute__</code>ã€‚è¾“å‡ºçš„<code>__dict__</code>å¦‚ä¸Šé¢è¾“å‡ºæ‰€ç¤ºã€‚<br>å› ä¸ºåœ¨ä¸Šé¢çš„MagicTest1ä¸­æˆ‘ä»¬å®šä¹‰äº†nameå’Œageå±æ€§ã€‚æˆ‘æ”¹å˜ä»£ç å¹¶å¹¶æ˜¾å¼å®šä¹‰ä¸ªå±æ€§sexå¹¶è¿›è¡Œèµ‹å€¼çœ‹ä¼šæ˜¯ä»€ä¹ˆç»“æœï¼Ÿ</p><pre><code class="python">class MagicTest1(object):    def __init__(self):        self.name = &quot;Miller&quot;        self.age = 25    def __getattribute__(self, name):        print &quot;__getattribute__&quot;        if name == &quot;sex&quot;:            return &quot;Women&quot;        return object.__getattribute__(self, name)if __name__ == &quot;__main__&quot;:    magic1 = MagicTest1()    magic1.sex = &quot;man&quot;    print magic1.sex__getattribute__Women</code></pre><p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œç»™sexå±æ€§èµ‹å€¼åå¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚è¿™æ˜¯å› ä¸ºåœ¨è®¿é—®å±æ€§å’Œæ–¹æ³•æ—¶ä¼šè¢«æ— æ¡ä»¶çš„è°ƒç”¨ï¼Œå› æ­¤å¯¼è‡´sexå±æ€§çš„å€¼å¹¶æœªç”Ÿæ•ˆã€‚å› æ­¤ä¸€å®šè¦æ³¨æ„é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿã€‚å¦‚æœå®šä¹‰äº†ç±»çš„<code>__getattribute__()</code>æ–¹æ³•ï¼Œä½ å¯èƒ½è¿˜æƒ³å®šä¹‰ä¸€ä¸ª<code>__setattr__()</code>æ–¹æ³•ï¼Œå¹¶åœ¨ä¸¤è€…ä¹‹é—´è¿›è¡ŒååŒï¼Œä»¥è·Ÿè¸ªå±æ€§çš„å€¼ã€‚å¦åˆ™ï¼Œåœ¨åˆ›å»ºå®ä¾‹ä¹‹åæ‰€è®¾ç½®çš„å€¼å°†ä¼šæ¶ˆå¤±åœ¨é»‘æ´ä¸­ã€‚å¦‚ä¸‹çš„ä»£ç ï¼š</p><pre><code class="python">class MagicTest1(object):    def __init__(self):        self.name = &quot;Miller&quot;        self.age = 25    def __getattribute__(self, name):        print &quot;__getattribute__&quot;        if name == &quot;sex&quot;:            try:                return self.__dict__[name]            except:                raise AttributeError(&quot;This object has no attribute!&quot;)        return object.__getattribute__(self, name)    def __setattr__(self, name, value):        self.__dict__[name] = valueif __name__ == &quot;__main__&quot;:    magic1 = MagicTest1()    magic1.sex = &quot;man&quot;    print magic1.sex</code></pre><h3 id="å®šä¹‰ä¸‰ç§æ–¹æ³•"><a href="#å®šä¹‰ä¸‰ç§æ–¹æ³•" class="headerlink" title="å®šä¹‰ä¸‰ç§æ–¹æ³•"></a>å®šä¹‰ä¸‰ç§æ–¹æ³•</h3><p>å‡è®¾æˆ‘ä»¬åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰äº†<code>__getattribute__</code>ï¼Œ<code>__setattr__</code>ï¼Œ<code>__getattr__</code>è¿™ä¸‰ä¸ªæ–¹æ³•ï¼š</p><pre><code class="python">class CardHolder(object):    acctlen = 8  # Class data    retireage = 59.5    def __init__(self, acct, name, age, addr):        self.acct = acct  # Instance data        self.name = name  # These trigger __setattr__ too        self.age = age  # acct not mangled: name tested        self.addr = addr  # addr is not managed    def __getattr__(self, name):        return None    def __getattribute__(self, name):        superget = object.__getattribute__  # Don`t loop: one level up        if name == &quot;acct&quot;: # On all attr fetches            return superget(self, &#39;acct&#39;)[:-3] + &quot;***&quot;        elif name == &quot;remain&quot;:            return superget(self, &quot;retireage&quot;) - superget(self, &quot;age&quot;)        else:            print &quot;This variable %s is not exists.&quot; % name            return superget(self, name)  # name, age, addr: stored    def __setattr__(self, name, value):        if name == &quot;name&quot;:  # On all attr assignments            value = value.lower().replace(&quot;&quot;, &quot;_&quot;)  # addr stored directly        elif name == &quot;age&quot;:            if value &lt; 0 or value &gt; 150:                raise ValueError(`invalid age`)        elif name == &quot;acct&quot;:            value = value.replace(&quot;-&quot;, &quot;&quot;)            if len(value) != self.acctlen:                raise TypeError(&quot;invald acct number&quot;)        elif name == &quot;remain&quot;:            raise TypeError(&quot;cannot set remain&quot;)        self.__dict__[name] = value  # Avoid loops, orig names</code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼šåœ¨å±æ€§èµ‹å€¼æ—¶é¦–å…ˆä¼šè°ƒç”¨<code>__setattr__</code>æ–¹æ³•ï¼Œå³ä½¿æ˜¯åœ¨<code>__init__</code>ä¸­èµ‹å€¼ä¹Ÿä¼šè°ƒç”¨<code>__setattr__</code>ã€‚<code>__getattribute__</code>å®ç°äº†å¯¹éƒ¨åˆ†å±æ€§å€¼çš„è®¡ç®—ï¼Œåœ¨<code>__setattr__</code>ä¹Ÿå¯ä»¥å®ç°å€¼çš„è®¡ç®—æˆ–è€…ç±»å‹æ£€æµ‹ç­‰æ“ä½œã€‚åœ¨å®é™…åº”ç”¨ä¸­æœ‰åˆ©äºç»Ÿä¸€æ¥å£ï¼Œä½¿æ•´ä¸ªç±»æ›´åŠ çš„ä¸¥è°¨ç­‰å¾ˆå¤šå¥½å¤„ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å½“è®¿é—®æŸä¸ªå®ä¾‹å±æ€§æ—¶ï¼Œ<code>__getattribute__</code>ä¼šè¢«æ— æ¡ä»¶è°ƒç”¨ï¼Œå¦‚æœªå®ç°è‡ªå·±çš„<code>__getattr__</code>æ–¹æ³•ï¼Œä¼šæŠ›å‡ºAttributeErroræç¤ºæ‰¾ä¸åˆ°è¿™ä¸ªå±æ€§ï¼Œå¦‚æœè‡ªå®šä¹‰äº†è‡ªå·±<strong>getattr</strong>æ–¹æ³•çš„è¯ï¼Œæ–¹æ³•ä¼šåœ¨è¿™ç§æ‰¾ä¸åˆ°å±æ€§çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­çš„æƒ…å†µã€‚æ‰€ä»¥åœ¨æ‰¾ä¸åˆ°å±æ€§çš„æƒ…å†µä¸‹é€šè¿‡å®ç°è‡ªå®šä¹‰çš„getattræ–¹æ³•æ¥å®ç°ä¸€äº›åŠŸèƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒä¸ä¼šåƒ<code>__getattribute__</code>æ–¹æ³•æ¯æ¬¡éƒ½ä¼šè°ƒç”¨å¯èƒ½ä¼šå½±å“ä¸€äº›æ­£å¸¸æƒ…å†µä¸‹çš„å±æ€§è®¿é—®ã€‚<br>å‚è€ƒæ–‡æ¡£ï¼š</p><ul><li><a href="http://python.jobbole.com/84095/" target="_blank" rel="noopener">Python <code>__getattribute__</code> vs <code>__getattr__</code> æµ…è°ˆ</a></li><li><a href="https://www.ibm.com/developerworks/cn/linux/l-python-elegance-2.html" target="_blank" rel="noopener">å¯çˆ±çš„ Python: Python ä¹‹ä¼˜é›…ä¸ç‘•ç–µï¼Œç¬¬ 2 éƒ¨åˆ†</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nohupå‘½ä»¤åŠå…¶è¾“å‡ºæ–‡ä»¶</title>
    <link href="/2017/06/06/nohup%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%85%B6%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6/"/>
    <url>/2017/06/06/nohup%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%85%B6%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h3 id="nohupå‘½ä»¤åŠå…¶è¾“å‡ºæ–‡ä»¶"><a href="#nohupå‘½ä»¤åŠå…¶è¾“å‡ºæ–‡ä»¶" class="headerlink" title="nohupå‘½ä»¤åŠå…¶è¾“å‡ºæ–‡ä»¶"></a>nohupå‘½ä»¤åŠå…¶è¾“å‡ºæ–‡ä»¶</h3><p>ä»Šå¤©åœ¨linuxä¸Šéƒ¨ç½²wdtç¨‹åºï¼Œåœ¨SSHå®¢æˆ·ç«¯æ‰§è¡Œ./start-dishi.sh,å¯åŠ¨æˆåŠŸ,åœ¨å…³é—­SSHå®¢æˆ·ç«¯åï¼Œè¿è¡Œçš„ç¨‹åºä¹ŸåŒæ—¶ç»ˆæ­¢äº†ï¼Œæ€æ ·æ‰èƒ½ä¿è¯åœ¨æ¨å‡ºSSHå®¢æˆ·ç«¯åç¨‹åºèƒ½ä¸€ç›´æ‰§è¡Œå‘¢ï¼Ÿé€šè¿‡ç½‘ä¸ŠæŸ¥æ‰¾èµ„æ–™ï¼Œå‘ç°éœ€è¦ä½¿ç”¨nohupå‘½ä»¤ã€‚</p><p>å®Œç¾è§£å†³æ–¹æ¡ˆï¼š<code>nohup ./start-dishi.sh &gt;output 2&gt;&amp;1 &amp;</code></p><a id="more"></a><h3 id="ç°å¯¹ä¸Šé¢çš„å‘½ä»¤è¿›è¡Œä¸‹è§£é‡Š"><a href="#ç°å¯¹ä¸Šé¢çš„å‘½ä»¤è¿›è¡Œä¸‹è§£é‡Š" class="headerlink" title="ç°å¯¹ä¸Šé¢çš„å‘½ä»¤è¿›è¡Œä¸‹è§£é‡Š"></a>ç°å¯¹ä¸Šé¢çš„å‘½ä»¤è¿›è¡Œä¸‹è§£é‡Š</h3><ul><li>ç”¨é€”ï¼šä¸æŒ‚æ–­åœ°è¿è¡Œå‘½ä»¤ã€‚</li><li>è¯­æ³•ï¼š<code>nohup Command [ Arg ... ] [ã€€&amp; ]</code></li><li>æè¿°ï¼šnohup å‘½ä»¤è¿è¡Œç”± Command å‚æ•°å’Œä»»ä½•ç›¸å…³çš„ Arg å‚æ•°æŒ‡å®šçš„å‘½ä»¤ï¼Œå¿½ç•¥æ‰€æœ‰æŒ‚æ–­ï¼ˆSIGHUPï¼‰ä¿¡å·ã€‚åœ¨æ³¨é”€åä½¿ç”¨ nohup å‘½ä»¤è¿è¡Œåå°ä¸­çš„ç¨‹åºã€‚è¦è¿è¡Œåå°ä¸­çš„ nohup å‘½ä»¤ï¼Œæ·»åŠ  &amp; ï¼ˆ è¡¨ç¤ºâ€œandâ€çš„ç¬¦å·ï¼‰åˆ°å‘½ä»¤çš„å°¾éƒ¨ã€‚</li></ul><p>æ“ä½œç³»ç»Ÿä¸­æœ‰ä¸‰ä¸ªå¸¸ç”¨çš„æµï¼š<br>ã€€ã€€0ï¼šæ ‡å‡†è¾“å…¥æµ stdin<br>ã€€ã€€1ï¼šæ ‡å‡†è¾“å‡ºæµ stdout<br>ã€€ã€€2ï¼šæ ‡å‡†é”™è¯¯æµ stderr<br>ä¸€èˆ¬å½“æˆ‘ä»¬ç”¨<code>&gt; console.txt</code>ï¼Œå®é™…æ˜¯ <code>1&gt;console.txt</code>çš„çœç•¥ç”¨æ³•ï¼›<code>&lt; console.txt</code> ï¼Œå®é™…æ˜¯ <code>0 &lt; console.txt</code>çš„çœç•¥ç”¨æ³•ã€‚</p><h3 id="ä¸‹é¢æ­¥å…¥æ­£é¢˜ï¼š"><a href="#ä¸‹é¢æ­¥å…¥æ­£é¢˜ï¼š" class="headerlink" title="ä¸‹é¢æ­¥å…¥æ­£é¢˜ï¼š"></a>ä¸‹é¢æ­¥å…¥æ­£é¢˜ï¼š</h3><pre><code class="shell">&gt;nohup ./start-dishi.sh &gt;output 2&gt;&amp;1 &amp;</code></pre><p>è§£é‡Š:</p><ol><li>å¸¦&amp;çš„å‘½ä»¤è¡Œï¼Œå³ä½¿terminalï¼ˆç»ˆç«¯ï¼‰å…³é—­ï¼Œæˆ–è€…ç”µè„‘æ­»æœºç¨‹åºä¾ç„¶è¿è¡Œï¼ˆå‰ææ˜¯ä½ æŠŠç¨‹åºé€’äº¤åˆ°æœåŠ¡å™¨ä¸Š)ï¼›</li><li><code>2&gt;&amp;1</code>çš„æ„æ€: è¿™ä¸ªæ„æ€æ˜¯æŠŠæ ‡å‡†é”™è¯¯ï¼ˆ2ï¼‰é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼ˆ1ï¼‰ï¼Œè€Œæ ‡å‡†è¾“å‡ºåˆå¯¼å…¥æ–‡ä»¶outputé‡Œé¢ï¼Œæ‰€ä»¥ç»“æœæ˜¯æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºéƒ½å¯¼å…¥æ–‡ä»¶outputé‡Œé¢äº†ã€‚ è‡³äºä¸ºä»€ä¹ˆéœ€è¦å°†æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºçš„åŸå› ï¼Œé‚£å°±å½’ç»“ä¸ºæ ‡å‡†é”™è¯¯æ²¡æœ‰ç¼“å†²åŒºï¼Œè€Œstdoutæœ‰ã€‚è¿™å°±ä¼šå¯¼è‡´<code>&gt;output 2&gt;output</code> æ–‡ä»¶outputè¢«ä¸¤æ¬¡æ‰“å¼€ï¼Œè€Œstdoutå’Œstderrå°†ä¼šç«äº‰è¦†ç›–ï¼Œè¿™è‚¯å®šä¸æ˜¯æˆ‘é—¨æƒ³è¦çš„.<br>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰äººä¼šå†™æˆ: <code>nohup ./command.sh &gt;output 2&gt;output</code>å‡ºé”™çš„åŸå› äº†.</li></ol><p>æœ€åè°ˆä¸€ä¸‹/dev/nullæ–‡ä»¶çš„ä½œç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— åº•æ´ï¼Œä»»ä½•ä¸œè¥¿éƒ½å¯ä»¥å®šå‘åˆ°è¿™é‡Œï¼Œä½†æ˜¯å´æ— æ³•æ‰“å¼€ã€‚ æ‰€ä»¥ä¸€èˆ¬å¾ˆå¤§çš„stdouå’Œstderrå½“ä½ ä¸å…³å¿ƒçš„æ—¶å€™å¯ä»¥åˆ©ç”¨stdoutå’Œstderrå®šå‘åˆ°è¿™é‡Œ<code>&gt;./command.sh &gt;/dev/null 2&gt;&amp;1</code><br>Itâ€™s not too late to change.</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
